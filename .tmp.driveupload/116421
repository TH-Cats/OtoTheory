module.exports=[13332,a=>{"use strict";a.s(["default",()=>a_],13332);var b=a.i(87924),c=a.i(72131),d=a.i(34747),e=a.i(21482),f=a.i(14511),g=a.i(13512),h=a.i(1731),h=h,i=a.i(58078),j=a.i(32653),k=a.i(46617),h=h;let l={0:0,2:1,4:2,5:3,7:4,9:5,11:6},m={0:0,2:1,3:2,5:3,7:4,8:5,10:6},n=["I","ii","iii","IV","V","vi","vii°"],o=["i","ii°","III","iv","v","VI","VII"];function p(a){return/maj7|M7/.test(a)}function q(a,b,c,d={}){let{showQuality:e=!0,accidentalsForNonDiatonic:f=!1}=d;if(!a||!b)return"";let i=(0,g.noteToPc)(b),j=a.split("/")[0].match(/^([A-G](?:#|b)?)(.*)$/i);if(!j)return a;let k=function(a){let b=(0,g.noteToPc)(a);return h.PC_NAMES[b]??a}(j[1].toUpperCase()),r=j[2]||"",s=((0,g.noteToPc)(k)-i+12)%12,t="major"===c?n:o,u=("major"===c?l:m)[s];if(void 0!==u){let a=d.uppercase?["I","II","III","IV","V","VI","VII"][u]:t[u];return(d.uppercase&&("major"===c&&6===u||"minor"===c&&1===u)&&(a+="°"),e)?p(r)?a+"M7":!(p(r)||/m7b5|ø|dim7/.test(r))&&(/(\b|[^a-zA-Z])7(?![b#0-9])/i.test(r)||/\bm7\b/i.test(r))?a+"7":a:a}if(f){let a="major"===c?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10];for(let b=0;b<a.length;b++){let c=a[b];if((c+1)%12===s)return"#"+t[b];if((c+11)%12===s)return"b"+t[b]}}return`(${k})`}var r=a.i(6164),s=a.i(55147);function t({children:a,className:c="",right:d,as:e="h2"}){return(0,b.jsxs)("div",{className:`mb-2 flex items-center gap-2 ${c}`,children:[(0,b.jsx)(e,{className:"text-xl md:text-2xl font-semibold tracking-tight text-foreground",children:a}),d?(0,b.jsx)("div",{className:"ml-auto",children:d}):null]})}function u({children:a,className:c="",right:d,as:e="h3"}){return(0,b.jsxs)("div",{className:`mb-1.5 flex items-center gap-2 ${c}`,children:[(0,b.jsx)(e,{className:"text-sm md:text-base font-semibold tracking-wide text-foreground",children:a}),d?(0,b.jsx)("div",{className:"ml-auto text-xs md:text-sm text-muted-foreground",children:d}):null]})}var v=a.i(10516);let w=["M","m","7","M7","m7","sus4","dim"],x=["6","m6","9","m9","11","M11","13","M13"],y=["7b5","7#5","7b9","7#9","7#11","7b13","7alt"],z=["dim7","m7b5"],A=["sus2","add9","add11","add13","6/9"],B=["aug","mM7"],C=[...x,...y,...z,...A,...B,"/bass"],D=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"];var E=a.i(67010);let F=({title:a="Advanced — Pro",children:c})=>{let{upgrade:d}=(0,E.usePro)();return(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"pointer-events-none opacity-50",children:c}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white/60 backdrop-blur-sm rounded",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,b.jsxs)("div",{className:"text-sm font-medium",children:["🔒 ",a]}),(0,b.jsx)("button",{className:"px-3 py-1 rounded bg-[var(--brand-primary)] text-white",onClick:d,children:"Upgrade to Pro"})]})})]})};function G({open:a,onClose:c,title:d="Go Pro to unlock Advanced chords",body:e="Advanced chord qualities (aug, add9, tensions, and slash chords) are available in Pro."}){let{upgrade:f}=(0,E.usePro)();return a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,b.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:d}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e}),(0,b.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,b.jsx)("button",{className:"px-3 py-1.5 rounded border",onClick:c,children:"Maybe later"}),(0,b.jsx)("button",{className:"px-3 py-1.5 rounded bg-[var(--brand-primary)] text-white",onClick:f,children:"Upgrade to Pro"})]})]})}):null}let H=a=>a.startsWith("M")||"M"===a?"major":a.startsWith("m")?"minor":"7"===a||/^7/.test(a)||["9","11","13"].includes(a)?"dominant":a.startsWith("dim")||"m7b5"===a?"diminished":"aug"===a?"augmented":"unknown",I=(a,b)=>{let c=(a=>["M9","M11","M13","6"].includes(a)?"major":["m6","m9"].includes(a)?"minor":["7b5","7#5","7b9","7#9","7#11","7b13","7alt","9","11","13"].includes(a)?"dominant":["dim7","m7b5"].includes(a)?"diminished":(["add9","add11","add13","sus2","6/9"].includes(a),"any"))(b);return"any"===c||"unknown"===a||!("major"===a&&"minor"===c||"minor"===a&&"major"===c||"dominant"!==a&&["7b5","7#5","7b9","7#9","7#11","7b13","7alt","9","11","13"].includes(b)||"diminished"!==a&&["dim7","m7b5"].includes(b))};var J=a.i(79735);let K=[{id:"doo-wop",name:"Doo‑Wop (I–vi–IV–V)",mode:"major",seq:["I","vi","IV","V"],summary:"50s/60s loop: I→vi→IV→V back to I."},{id:"axis",name:"Axis (I–V–vi–IV)",mode:"major",seq:["I","V","vi","IV"],summary:"Modern pop four‑chords loop."},{id:"canon",name:"Pachelbel's Canon",mode:"major",seq:["I","V","vi","iii","IV","I","IV","V"],variants:[["I","V","vi","IV"]],summary:"Pachelbel‑style ground; long loop back to I."},{id:"ii-V-I",name:"ii–V–I",mode:"any",seq:["ii","V","I"],summary:"The classic resolution run‑up."},{id:"turnaround",name:"Turnaround (I–vi–ii–V)",mode:"any",seq:["I","vi","ii","V"],summary:"Quick loop returning to the top."},{id:"andalusian",name:"Andalusian (i–VII–VI–V)",mode:"minor",seq:["i","VII","VI","V"],summary:"Classic minor descent; flamenco/Latin flavor."},{id:"authentic",name:"Authentic cadence (V–I)",mode:"any",seq:["V","I"],summary:"Perfect cadence V→I."},{id:"plagal",name:"Plagal cadence (IV–I)",mode:"any",seq:["IV","I"],summary:"Gentle IV→I resolution."},{id:"deceptive",name:"Deceptive cadence (V–vi)",mode:"major",seq:["V","vi"],summary:"Deceptive V→vi keeps motion going."}],L={dooWop:"Doo‑Wop (I–VI–IV–V)",axis:"Axis (I–V–vi–IV)",canon:"Canon (I–V–vi–iii–IV–I–IV–V)",twoFiveOne:"ii–V–I",turnaround:"Turnaround",andalusian:"Andalusian cadence",authentic:"Perfect cadence (V → I)",plagal:"Plagal cadence (IV → I)",deceptive:"Deceptive cadence (V → vi)"},M={dooWop:"’50s progression. Nostalgic loop: tonic → relative minor → subdominant → dominant. Try adding 7ths for color.",axis:"Modern pop staple. A catchy loop that feels forward yet stable. Swap to ii–V at the end for a stronger landing.",canon:"Pachelbel‑style ground. Persistent bass motion with rotating functions; great for variations and melodies.",twoFiveOne:"The classic run‑up then land. Link by guide tones (3rd↔7th). Works anywhere you want a clear resolution.",turnaround:"Short cycle that brings you back to the top (e.g., I–VI7–ii7–V7). Use at phrase ends or between sections.",andalusian:"Descending minor flavor (e.g., i–♭VII–♭VI–V). Adds drama; land clearly on the target chord.",authentic:"Strong homecoming: dominant pulls into tonic. Extend V with 7/9/13; keep the landing clean on I.",plagal:"Gentler IV → I resolution. Use to soften endings or after a bright Lydian moment.",deceptive:"Twist the expectation: V → vi instead of I. Keeps energy moving; return to I later for closure."};function N(a){return(a||"").toString().trim().toUpperCase().replace(/MAJ7|M7|7|MAJ|MIN|MI|DIM|AUG|SUS\d?|ADD\d+|Ø|O/g,"").replace(/\(|\)/g,"").replace(/[^IVB#]+/g,"").replace(/B/g,"B")}var O=a.i(47473);let P="ot_sketches",Q=()=>JSON.parse(localStorage.getItem(P)||"[]"),R=a=>{let b=Q().filter(b=>b.id!==a.id);return(b.unshift(a),b.length>3)?(localStorage.setItem(P,JSON.stringify(b.slice(0,3))),{ok:!1,reason:"limit_exceeded"}):(localStorage.setItem(P,JSON.stringify(b)),{ok:!0})},S=async a=>({ok:!0});var T=a.i(58037),U=a.i(20226);let V=()=>Math.random().toString(36).substr(2,9),W=(0,U.create)((a,b)=>({sketches:[],currentSketch:null,isLoading:!1,error:null,loadSketches:()=>{a({isLoading:!0,error:null});try{let b=Q();a({sketches:b,isLoading:!1})}catch(b){a({error:"Failed to load sketches",isLoading:!1})}},saveSketch:async b=>{let c={...b,id:V(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(R(c).ok)return a({sketches:Q(),currentSketch:c}),{ok:!0};try{await S(c);let b=Q();return a({sketches:b,currentSketch:c}),{ok:!0}}catch(a){return{ok:!1,reason:"cloud_save_failed"}}},loadSketch:c=>{let d=b().sketches.find(a=>a.id===c);d&&a({currentSketch:d})},deleteSketch:c=>{let d=b().sketches.filter(a=>a.id!==c);localStorage.setItem("ot_sketches",JSON.stringify(d)),a({sketches:d}),b().currentSketch?.id===c&&a({currentSketch:null})},duplicateSketch:c=>{let d=b().sketches.find(a=>a.id===c);if(d){let b={...d,id:V(),name:`${d.name} Copy`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};R(b).ok&&a({sketches:Q(),currentSketch:b})}},renameSketch:(c,d)=>{let e=b().sketches.map(a=>a.id===c?{...a,name:d,updatedAt:new Date().toISOString()}:a);localStorage.setItem("ot_sketches",JSON.stringify(e)),a({sketches:e}),b().currentSketch?.id===c&&a({currentSketch:{...b().currentSketch,name:d,updatedAt:new Date().toISOString()}})},startAutoSave:c=>setTimeout(()=>{let d=b();if(d.currentSketch?.id===c.id){let b={...c,updatedAt:new Date().toISOString()};R(b).ok&&a({sketches:Q(),currentSketch:b})}},3e3),stopAutoSave:()=>{}})),X=(()=>{let a=0;return()=>(a+=1,`u${`0000${(1679616*Math.random()|0).toString(36)}`.slice(-4)}${a}`)})();function Y(a){let b=[];for(let c=0,d=a.length;c<d;c++)b.push(a[c]);return b}let Z=null;function $(a={}){return Z||(Z=a.includeStyleProperties?a.includeStyleProperties:Y(window.getComputedStyle(document.documentElement)))}function _(a,b){let c=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b);return c?parseFloat(c.replace("px","")):0}function aa(a,b={}){return{width:b.width||function(a){let b=_(a,"border-left-width"),c=_(a,"border-right-width");return a.clientWidth+b+c}(a),height:b.height||function(a){let b=_(a,"border-top-width"),c=_(a,"border-bottom-width");return a.clientHeight+b+c}(a)}}function ab(a){return new Promise((b,c)=>{let d=new Image;d.onload=()=>{d.decode().then(()=>{requestAnimationFrame(()=>b(d))})},d.onerror=c,d.crossOrigin="anonymous",d.decoding="async",d.src=a})}async function ac(a){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(a)).then(encodeURIComponent).then(a=>`data:image/svg+xml;charset=utf-8,${a}`)}async function ad(a,b,c){let d="http://www.w3.org/2000/svg",e=document.createElementNS(d,"svg"),f=document.createElementNS(d,"foreignObject");return e.setAttribute("width",`${b}`),e.setAttribute("height",`${c}`),e.setAttribute("viewBox",`0 0 ${b} ${c}`),f.setAttribute("width","100%"),f.setAttribute("height","100%"),f.setAttribute("x","0"),f.setAttribute("y","0"),f.setAttribute("externalResourcesRequired","true"),e.appendChild(f),f.appendChild(a),ac(e)}let ae=(a,b)=>{if(a instanceof b)return!0;let c=Object.getPrototypeOf(a);return null!==c&&(c.constructor.name===b.name||ae(c,b))};function af(a,b,c,d){let e=window.getComputedStyle(a,c),f=e.getPropertyValue("content");if(""===f||"none"===f)return;let g=X();try{b.className=`${b.className} ${g}`}catch(a){return}let h=document.createElement("style");h.appendChild(function(a,b,c,d){let e=`.${a}:${b}`,f=c.cssText?function(a){let b=a.getPropertyValue("content");return`${a.cssText} content: '${b.replace(/'|"/g,"")}';`}(c):$(d).map(a=>{let b=c.getPropertyValue(a),d=c.getPropertyPriority(a);return`${a}: ${b}${d?" !important":""};`}).join(" ");return document.createTextNode(`${e}{${f}}`)}(g,c,e,d)),b.appendChild(h)}let ag="application/font-woff",ah="image/jpeg",ai={woff:ag,woff2:ag,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:ah,jpeg:ah,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function aj(a){return ai[(function(a){let b=/\.([^./]*?)$/g.exec(a);return b?b[1]:""})(a).toLowerCase()]||""}function ak(a){return -1!==a.search(/^(data:)/)}function al(a,b){return`data:${b};base64,${a}`}async function am(a,b,c){let d=await fetch(a,b);if(404===d.status)throw Error(`Resource "${d.url}" not found`);let e=await d.blob();return new Promise((a,b)=>{let f=new FileReader;f.onerror=b,f.onloadend=()=>{try{a(c({res:d,result:f.result}))}catch(a){b(a)}},f.readAsDataURL(e)})}let an={};async function ao(a,b,c){var d,e,f;let g,h,i=(d=a,e=b,f=c.includeQueryParams,h=d.replace(/\?.*/,""),f&&(h=d),/ttf|otf|eot|woff2?/i.test(h)&&(h=h.replace(/.*\//,"")),e?`[${e}]${h}`:h);if(null!=an[i])return an[i];c.cacheBust&&(a+=(/\?/.test(a)?"&":"?")+new Date().getTime());try{let d=await am(a,c.fetchRequestInit,({res:a,result:c})=>(b||(b=a.headers.get("Content-Type")||""),c.split(/,/)[1]));g=al(d,b)}catch(d){g=c.imagePlaceholder||"";let b=`Failed to fetch resource: ${a}`;d&&(b="string"==typeof d?d:d.message),b&&console.warn(b)}return an[i]=g,g}async function ap(a){let b=a.toDataURL();return"data:,"===b?a.cloneNode(!1):ab(b)}async function aq(a,b){if(a.currentSrc){let b=document.createElement("canvas"),c=b.getContext("2d");return b.width=a.clientWidth,b.height=a.clientHeight,null==c||c.drawImage(a,0,0,b.width,b.height),ab(b.toDataURL())}let c=a.poster,d=aj(c);return ab(await ao(c,d,b))}async function ar(a,b){var c;try{if(null==(c=null==a?void 0:a.contentDocument)?void 0:c.body)return await aw(a.contentDocument.body,b,!0)}catch(a){}return a.cloneNode(!1)}async function as(a,b){return ae(a,HTMLCanvasElement)?ap(a):ae(a,HTMLVideoElement)?aq(a,b):ae(a,HTMLIFrameElement)?ar(a,b):a.cloneNode(at(a))}let at=a=>null!=a.tagName&&"SVG"===a.tagName.toUpperCase();async function au(a,b,c){var d,e;if(at(b))return b;let f=[];return 0===(f=null!=a.tagName&&"SLOT"===a.tagName.toUpperCase()&&a.assignedNodes?Y(a.assignedNodes()):ae(a,HTMLIFrameElement)&&(null==(d=a.contentDocument)?void 0:d.body)?Y(a.contentDocument.body.childNodes):Y((null!=(e=a.shadowRoot)?e:a).childNodes)).length||ae(a,HTMLVideoElement)||await f.reduce((a,d)=>a.then(()=>aw(d,c)).then(a=>{a&&b.appendChild(a)}),Promise.resolve()),b}async function av(a,b){let c=a.querySelectorAll?a.querySelectorAll("use"):[];if(0===c.length)return a;let d={};for(let e=0;e<c.length;e++){let f=c[e].getAttribute("xlink:href");if(f){let c=a.querySelector(f),e=document.querySelector(f);c||!e||d[f]||(d[f]=await aw(e,b,!0))}}let e=Object.values(d);if(e.length){let b="http://www.w3.org/1999/xhtml",c=document.createElementNS(b,"svg");c.setAttribute("xmlns",b),c.style.position="absolute",c.style.width="0",c.style.height="0",c.style.overflow="hidden",c.style.display="none";let d=document.createElementNS(b,"defs");c.appendChild(d);for(let a=0;a<e.length;a++)d.appendChild(e[a]);a.appendChild(c)}return a}async function aw(a,b,c){return c||!b.filter||b.filter(a)?Promise.resolve(a).then(a=>as(a,b)).then(c=>au(a,c,b)).then(c=>(function(a,b,c){if(ae(b,Element)&&(!function(a,b,c){let d=b.style;if(!d)return;let e=window.getComputedStyle(a);e.cssText?(d.cssText=e.cssText,d.transformOrigin=e.transformOrigin):$(c).forEach(c=>{let f=e.getPropertyValue(c);if("font-size"===c&&f.endsWith("px")){let a=Math.floor(parseFloat(f.substring(0,f.length-2)))-.1;f=`${a}px`}ae(a,HTMLIFrameElement)&&"display"===c&&"inline"===f&&(f="block"),"d"===c&&b.getAttribute("d")&&(f=`path(${b.getAttribute("d")})`),d.setProperty(c,f,e.getPropertyPriority(c))})}(a,b,c),af(a,b,":before",c),af(a,b,":after",c),ae(a,HTMLTextAreaElement)&&(b.innerHTML=a.value),ae(a,HTMLInputElement)&&b.setAttribute("value",a.value),ae(a,HTMLSelectElement))){let c=Array.from(b.children).find(b=>a.value===b.getAttribute("value"));c&&c.setAttribute("selected","")}return b})(a,c,b)).then(a=>av(a,b)):null}let ax=/url\((['"]?)([^'"]+?)\1\)/g,ay=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,az=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function aA(a,b,c,d,e){try{let f,g=c?function(a,b){if(a.match(/^[a-z]+:\/\//i))return a;if(a.match(/^\/\//))return window.location.protocol+a;if(a.match(/^[a-z]+:/i))return a;let c=document.implementation.createHTMLDocument(),d=c.createElement("base"),e=c.createElement("a");return c.head.appendChild(d),c.body.appendChild(e),b&&(d.href=b),e.href=a,e.href}(b,c):b,h=aj(b);if(e){let a=await e(g);f=al(a,h)}else f=await ao(g,h,d);return a.replace(function(a){let b=a.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return RegExp(`(url\\(['"]?)(${b})(['"]?\\))`,"g")}(b),`$1${f}$3`)}catch(a){}return a}function aB(a){return -1!==a.search(ax)}async function aC(a,b,c){if(!aB(a))return a;let d=function(a,{preferredFontFormat:b}){return b?a.replace(az,a=>{for(;;){let[c,,d]=ay.exec(a)||[];if(!d)return"";if(d===b)return`src: ${c};`}}):a}(a,c);return(function(a){let b=[];return a.replace(ax,(a,c,d)=>(b.push(d),a)),b.filter(a=>!ak(a))})(d).reduce((a,d)=>a.then(a=>aA(a,d,b,c)),Promise.resolve(d))}async function aD(a,b,c){var d;let e=null==(d=b.style)?void 0:d.getPropertyValue(a);if(e){let d=await aC(e,null,c);return b.style.setProperty(a,d,b.style.getPropertyPriority(a)),!0}return!1}async function aE(a,b){await aD("background",a,b)||await aD("background-image",a,b),await aD("mask",a,b)||await aD("-webkit-mask",a,b)||await aD("mask-image",a,b)||await aD("-webkit-mask-image",a,b)}async function aF(a,b){let c=ae(a,HTMLImageElement);if(!(c&&!ak(a.src))&&!(ae(a,SVGImageElement)&&!ak(a.href.baseVal)))return;let d=c?a.src:a.href.baseVal,e=await ao(d,aj(d),b);await new Promise((d,f)=>{a.onload=d,a.onerror=b.onImageErrorHandler?(...a)=>{try{d(b.onImageErrorHandler(...a))}catch(a){f(a)}}:f,a.decode&&(a.decode=d),"lazy"===a.loading&&(a.loading="eager"),c?(a.srcset="",a.src=e):a.href.baseVal=e})}async function aG(a,b){let c=Y(a.childNodes).map(a=>aH(a,b));await Promise.all(c).then(()=>a)}async function aH(a,b){ae(a,Element)&&(await aE(a,b),await aF(a,b),await aG(a,b))}let aI={};async function aJ(a){let b=aI[a];if(null!=b)return b;let c=await fetch(a);return b={url:a,cssText:await c.text()},aI[a]=b,b}async function aK(a,b){let c=a.cssText,d=/url\(["']?([^"')]+)["']?\)/g;return Promise.all((c.match(/url\([^)]+\)/g)||[]).map(async e=>{let f=e.replace(d,"$1");return f.startsWith("https://")||(f=new URL(f,a.url).href),am(f,b.fetchRequestInit,({result:a})=>(c=c.replace(e,`url(${a})`),[e,a]))})).then(()=>c)}function aL(a){if(null==a)return[];let b=[],c=a.replace(/(\/\*[\s\S]*?\*\/)/gi,""),d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){let a=d.exec(c);if(null===a)break;b.push(a[0])}c=c.replace(d,"");let e=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,f=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let a=e.exec(c);if(null===a){if(null===(a=f.exec(c)))break;e.lastIndex=f.lastIndex}else f.lastIndex=e.lastIndex;b.push(a[0])}return b}async function aM(a,b){let c=[],d=[];return a.forEach(c=>{if("cssRules"in c)try{Y(c.cssRules||[]).forEach((a,e)=>{if(a.type===CSSRule.IMPORT_RULE){let f=e+1,g=a.href,h=aJ(g).then(a=>aK(a,b)).then(a=>aL(a).forEach(a=>{try{c.insertRule(a,a.startsWith("@import")?f+=1:c.cssRules.length)}catch(b){console.error("Error inserting rule from remote css",{rule:a,error:b})}})).catch(a=>{console.error("Error loading remote css",a.toString())});d.push(h)}})}catch(f){let e=a.find(a=>null==a.href)||document.styleSheets[0];null!=c.href&&d.push(aJ(c.href).then(a=>aK(a,b)).then(a=>aL(a).forEach(a=>{e.insertRule(a,e.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",f)}}),Promise.all(d).then(()=>(a.forEach(a=>{if("cssRules"in a)try{Y(a.cssRules||[]).forEach(a=>{c.push(a)})}catch(b){console.error(`Error while reading CSS rules from ${a.href}`,b)}}),c))}async function aN(a,b){if(null==a.ownerDocument)throw Error("Provided element is not within a Document");let c=Y(a.ownerDocument.styleSheets);return(await aM(c,b)).filter(a=>a.type===CSSRule.FONT_FACE_RULE).filter(a=>aB(a.style.getPropertyValue("src")))}function aO(a){return a.trim().replace(/["']/g,"")}async function aP(a,b){let c=await aN(a,b),d=function(a){let b=new Set;return!function a(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(a=>{b.add(aO(a))}),Array.from(c.children).forEach(b=>{b instanceof HTMLElement&&a(b)})}(a),b}(a);return(await Promise.all(c.filter(a=>d.has(aO(a.style.fontFamily))).map(a=>{let c=a.parentStyleSheet?a.parentStyleSheet.href:null;return aC(a.cssText,c,b)}))).join("\n")}async function aQ(a,b){let c=null!=b.fontEmbedCSS?b.fontEmbedCSS:b.skipFonts?null:await aP(a,b);if(c){let b=document.createElement("style"),d=document.createTextNode(c);b.appendChild(d),a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b)}}async function aR(a,b={}){let{width:c,height:d}=aa(a,b),e=await aw(a,b,!0);return await aQ(e,b),await aH(e,b),!function(a,b){let{style:c}=a;b.backgroundColor&&(c.backgroundColor=b.backgroundColor),b.width&&(c.width=`${b.width}px`),b.height&&(c.height=`${b.height}px`);let d=b.style;null!=d&&Object.keys(d).forEach(a=>{c[a]=d[a]})}(e,b),await ad(e,c,d)}async function aS(a,b={}){let{width:c,height:d}=aa(a,b),e=await aR(a,b),f=await ab(e),g=document.createElement("canvas"),h=g.getContext("2d"),i=b.pixelRatio||function(){let a,b;try{b=process}catch(a){}let c=b&&b.env?b.env.devicePixelRatio:null;return c&&Number.isNaN(a=parseInt(c,10))&&(a=1),a||window.devicePixelRatio||1}(),j=b.canvasWidth||c,k=b.canvasHeight||d;return g.width=j*i,g.height=k*i,!b.skipAutoScale&&(g.width>16384||g.height>16384)&&(g.width>16384&&g.height>16384?g.width>g.height?(g.height*=16384/g.width,g.width=16384):(g.width*=16384/g.height,g.height=16384):g.width>16384?(g.height*=16384/g.width,g.width=16384):(g.width*=16384/g.height,g.height=16384)),g.style.width=`${j}`,g.style.height=`${k}`,b.backgroundColor&&(h.fillStyle=b.backgroundColor,h.fillRect(0,0,g.width,g.height)),h.drawImage(f,0,0,g.width,g.height),g}async function aT(a,b={}){return(await aS(a,b)).toDataURL()}let aU=!1;async function aV(a,b="auto"){if(!aU){aU=!0;try{let c=a.style.opacity,d=a.style.visibility;a.style.opacity="1",a.style.visibility="visible";let e=a.querySelectorAll("*"),f=[];e.forEach(a=>{let b=a.style.color,c=a.style.fill,d=a.style.background;if(f.push({elem:a,color:b,fill:c,bg:d}),a.style.color="#000000",("text"===a.tagName||"tspan"===a.tagName)&&(a.style.fill="#000000"),"SPAN"===a.tagName&&a.className.includes("inline-block")){let b=a.textContent?.trim();b&&/^\d+$/.test(b)&&(a.style.background="#f3f4f6",a.style.color="#000000")}}),await new Promise(a=>setTimeout(a,150)),a.dataset.export=b;let g=await aT(a,{pixelRatio:2,backgroundColor:"#ffffff",cacheBust:!0});a.style.opacity=c,a.style.visibility=d,f.forEach(({elem:a,color:b,fill:c,bg:d})=>{a.style.color=b,a.style.fill=c,a.style.background=d});let h=document.createElement("a");h.href=g,h.download="ot-progression.png",h.click(),T.track("export_png",{page:"chord_progression",ok:!0})}catch(a){T.track("export_png",{page:"chord_progression",ok:!1,err:String(a)})}finally{a.removeAttribute("data-export"),aU=!1}}}var aW=a.i(61478),aX=a.i(90944);let aY={info:"bg-blue-600",success:"bg-green-600",warning:"bg-orange-600"};function aZ({message:a,type:d="info",ctaText:e,ctaHref:f,ctaPlace:g,onClose:h,duration:i=5e3}){let{trackClick:j}=(0,aX.useCtaTracking)();(0,c.useEffect)(()=>{if(i>0){let a=setTimeout(h,i);return()=>clearTimeout(a)}},[i,h]);let k=(0,c.useCallback)(()=>{g&&j(g)},[g,j]),l=aY[d];return(0,b.jsx)("div",{className:"fixed bottom-20 sm:bottom-6 left-1/2 -translate-x-1/2 z-50 animate-slide-up max-w-md w-full mx-4",role:"alert","aria-live":"polite",children:(0,b.jsxs)("div",{className:`${l} text-white rounded-lg shadow-2xl p-4 flex items-center justify-between gap-3`,children:[(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsx)("p",{className:"text-sm font-medium",children:a})}),e&&f&&(0,b.jsx)("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 px-3 py-1.5 text-sm font-medium bg-white/20 hover:bg-white/30 rounded transition-colors",onClick:k,children:e}),(0,b.jsx)("button",{onClick:h,className:"flex-shrink-0 w-6 h-6 flex items-center justify-center hover:bg-white/20 rounded transition-colors","aria-label":"Close notification",children:"✕"})]})})}var a$=a.i(65404);function a_(){let a=(0,a$.useCtaMessages)(),l=(0,c.useRef)(null);(0,e.useRovingTabs)(l,{orientation:"horizontal"});let m=(0,c.useRef)(null);(0,e.useRovingTabs)(m,{orientation:"horizontal"});let n=(0,c.useRef)(null);(0,e.useRovingTabs)(n,{orientation:"horizontal"});let o=(0,c.useRef)(null),p=(0,c.useRef)(null),[P,Q]=(0,c.useState)(()=>{let a=Array(12).fill("");return a[0]="C",a[1]="Am",a[2]="F",a[3]="G",a}),U=(0,c.useMemo)(()=>P.reduce((a,b,c)=>(b&&a.push(c),a),[]),[P]),V=(0,c.useMemo)(()=>U.map(a=>P[a]),[U,P]),X=(0,c.useMemo)(()=>{let a=P.findIndex(a=>!a);return -1===a?11:a},[P]),[Y,Z]=(0,c.useState)(0);(0,c.useEffect)(()=>{Z(X)},[X]);let $=(0,c.useMemo)(()=>["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],[]);(0,c.useMemo)(()=>[{label:"M",value:""},{label:"M7",value:"maj7"},{label:"7",value:"7"},{label:"6",value:"6"},{label:"add9",value:"add9"},{label:"sus4",value:"sus4"},{label:"sus2",value:"sus2"},{label:"m",value:"m"},{label:"m7",value:"m7"},{label:"dim",value:"dim"},{label:"m7b5",value:"m7b5"},{label:"aug",value:"aug"}],[]);let[_,aa]=(0,c.useState)("C"),[ab,ac]=(0,c.useState)("M"),[ad,ae]=(0,c.useState)([]);(0,c.useMemo)(()=>[{label:"sus2",value:"sus2"},{label:"sus4",value:"sus4"},{label:"add9",value:"add9"},{label:"add11",value:"add11"},{label:"add13",value:"add13"}],[]);let[af,ag]=(0,c.useState)([]),[ah,ai]=(0,c.useState)(""),[aj,ak]=(0,c.useState)(null),[al,am]=(0,c.useState)([]),[an,ao]=(0,c.useState)([]),[ap,aq]=(0,c.useState)(null),[ar,as]=(0,c.useState)([]),{keyCandidates:at,selectedKey:au,analyze:av,selectKey:aw,scaleCandidates:ax,selectedScale:ay,selectScale:az,reset:aA}=(0,r.useAnalysisStore)(),[aB,aC]=(0,c.useState)("degrees"),[aD,aE]=(0,c.useState)(null),[aF,aG]=(0,c.useState)(null),[aH,aI]=(0,c.useState)(null),[aJ,aK]=(0,c.useState)(null),aL=(0,c.useCallback)(()=>{aI(null),aK(null)},[]),aM=(0,c.useMemo)(()=>{let a=ay?.type,b=a?i.SCALE_INTERVALS[a]:null;return!b||7===b.length},[ay?.type]);(0,c.useEffect)(()=>{aM||"degrees"===aB||aC("degrees")},[aM]);let[aN,aO]=(0,c.useState)(null),aP=(0,c.useRef)(null),aQ=(0,c.useRef)(null),aR=(0,c.useRef)(null),aS=(0,c.useRef)(null),[aT,aU]=(0,c.useState)(null),aX=(0,c.useRef)(null);(0,c.useRef)(null);let[aY,a_]=(0,c.useState)(!1),[a2,a3]=(0,c.useState)(120),a4=(0,c.useRef)(null),[a5,a6]=(0,c.useState)(-1),a7=(0,c.useCallback)((a,b)=>{Q(c=>{if(a===b)return c;let d=c.slice(),e=d[a];return d[a]=d[b],d[b]=e,d})},[]),[a8,a9]=(0,c.useState)(null),ba=(0,c.useCallback)((a,b)=>{if(!P[b])return;a.stopPropagation();let c=a.touches[0];aX.current={index:b,startX:c.clientX,startY:c.clientY},aU(b),a9(null)},[P]),bb=(0,c.useCallback)((a,b)=>{if(null===aX.current||null===aT)return;let c=a.touches[0],d=document.elementFromPoint(c.clientX,c.clientY);for(;d&&!d.hasAttribute("data-slot-index");)d=d.parentElement;if(d){let a=parseInt(d.getAttribute("data-slot-index")||"-1");a>=0&&a!==aT&&a9(a)}},[aT]),bc=(0,c.useCallback)(a=>{null!==aX.current&&null!==aT&&null!==a8&&aT!==a8&&a7(aT,a8),aX.current=null,aU(null),a9(null)},[aT,a8,a7]),bd=(0,c.useRef)(!1),be=(0,c.useCallback)(()=>{bd.current=!1,a4.current&&(clearInterval(a4.current),a4.current=null),a_(!1),a6(-1)},[]),bf=(0,c.useCallback)(async()=>{let a=P.map((a,b)=>({chord:a,index:b})).filter(a=>a.chord);if(0===a.length)return;be(),await O.player.resume(),bd.current=!0,a_(!0),a6(0);let b=60/a2*1e3;for(let a=0;a<4;a++){if(!bd.current||(await new Promise(a=>setTimeout(a,b)),!bd.current))return;O.player.playNote(84,100)}let c=0,d=0,e=async()=>{if(!bd.current){a4.current&&(clearInterval(a4.current),a4.current=null);return}if(d%4==0){c>=a.length&&(c=0);let{chord:b,index:d}=a[c];a6(d),await b9(b),c++}else if(c>0&&c<=a.length){let{chord:b}=a[c-1];await b9(b)}d++};bd.current&&(await e(),bd.current&&(a4.current=setInterval(e,b),(0,T.track)("progression_play",{page:"chord_progression",bpm:a2,chordCount:a.length})))},[P,a2,be]),bg=(0,c.useCallback)(()=>{aY?be():bf()},[aY,bf,be]);(0,c.useEffect)(()=>()=>{a4.current&&clearInterval(a4.current)},[]),(0,c.useEffect)(()=>{aY&&be()},[P]);let bh=(0,c.useCallback)(a=>{Q(b=>{let c=b.slice();return c[a]="",c})},[]),{isPro:bi}=(0,E.usePro)(),{sketch:bj,setSketch:bk}=(a=>{let[b,d]=(0,c.useState)(null),e=(0,c.useRef)(null);return(0,c.useEffect)(()=>{e.current&&window.clearTimeout(e.current),e.current=window.setTimeout(()=>{b&&(async()=>{let c=a?await S(b):R(b);c.ok||"limit_exceeded"!==c.reason?T.track("save_project",{page:"chord_progression"}):T.track("project_limit_warn",{page:"chord_progression"})})()},3e3)},[b]),{sketch:b,setSketch:d}})(bi),bl=(0,c.useRef)(null),{sketches:bm,loadSketches:bn,deleteSketch:bo,saveSketch:bp}=W(),[bq,br]=(0,c.useState)(!1),[bs,bt]=(0,c.useState)(null),bu=(0,c.useRef)(null),[bv,bw]=(0,c.useState)(""),[bx,by]=(0,c.useState)(!1),[bz,bA]=(0,c.useState)("C"),bB=(0,c.useRef)(null);(0,c.useEffect)(()=>{bq&&bn()},[bq,bn]),(0,c.useEffect)(()=>{let a=a=>{if(!bq)return;let b=bu.current;b&&!b.contains(a.target)&&br(!1)},b=a=>{"Escape"===a.key&&br(!1)};return document.addEventListener("mousedown",a),document.addEventListener("keydown",b),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("keydown",b)}},[bq]),(0,c.useEffect)(()=>{if(!bx)return;let a=a=>{let b=bB.current;b&&!b.contains(a.target)&&by(!1)},b=a=>{"Escape"===a.key&&by(!1)};return document.addEventListener("mousedown",a),document.addEventListener("keydown",b),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("keydown",b)}},[bx]);let[bC,bD]=(0,c.useState)(!1),[bE,bF]=(0,c.useState)(""),bG=(0,c.useMemo)(()=>V.length?V.join(" "):`Untitled ${new Date().toLocaleString()}`,[V]),[bH,bI]=(0,c.useState)(null),bJ=(0,c.useRef)(new Set);(0,c.useEffect)(()=>{let b=P.filter(a=>""!==a).length;9!==b||bJ.current.has("limit_warn")?12!==b||bJ.current.has("limit_block")||(bI({message:a.toast.limitBlock,type:"warning",ctaText:a.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,T.trackToast)("limit_block",{page:"chord_progression",chordCount:b}),bJ.current.add("limit_block")):(bI({message:a.toast.limitWarn,type:"info",ctaText:a.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,T.trackToast)("limit_warn",{page:"chord_progression",chordCount:b}),bJ.current.add("limit_warn"))},[P]);let[bK,bL]=(0,c.useState)(""),bM=async b=>{try{if(!p.current)return;bL(b.name||"Untitled Sketch"),await new Promise(a=>setTimeout(a,50));let c=p.current;c.style.opacity="1",c.style.visibility="visible",await new Promise(a=>setTimeout(a,200)),await aV(c,"auto"),c.style.opacity="0.0001",c.style.visibility="hidden",bL(""),(0,T.track)("export_png",{page:"chord_progression",source:"sketch",id:b.id}),bJ.current.has("png_export")||(bI({message:a.toast.pngExport,type:"success",ctaText:a.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"png_toast"}),bJ.current.add("png_export"))}catch(a){console.error("Export failed:",a),bL("")}},bN=async()=>{try{if(!bi){let b=JSON.parse(localStorage.getItem("ot_sketches")||"[]");if(console.log("[DEBUG] doSaveSketch - isPro:",bi,"existing sketches:",b.length),b.length>=3){console.log("[DEBUG] Blocking save - limit reached"),bD(!1),bF(""),bI({message:a.toast.sketchLimit,type:"warning",ctaText:a.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,T.trackToast)("limit_block",{page:"chord_progression",context:"sketch_limit"});return}}console.log("[DEBUG] Proceeding with save");let b=au?h.PC_NAMES[au.tonic]:aN?aN.tonic:"C",c=ay?.type||(au?au.mode:"Ionian"),d={name:(bE.trim()||bG).slice(0,48),schema:"sketch_v1",appVersion:"3.0.0",key:{tonic:b,scaleId:String(c)},capo:{fret:0,note:"Shaped"},progression:{items:V.map((a,b)=>({id:a,degree:"",quality:""}))},fretboardView:{mode:"names"===aB?"Names":"Degrees",guide:!!aF}},e=await bp(d);(0,T.track)("save_project",{page:"chord_progression",ok:e?.ok}),bD(!1),bF("")}catch{}},[bO,bP]=(0,c.useState)(!1),[bQ,bR]=(0,c.useState)(!1),[bS,bT]=(0,c.useState)(!1),[bU,bV]=(0,c.useTransition)(),[bW,bX]=(0,c.useState)([]),[bY,bZ]=(0,c.useState)([]),[b$,b_]=(0,c.useState)(null),b0=(0,c.useRef)(null),b1=a=>{ac(a),ae(b=>b.filter(b=>I(H(a),b))),ah===_&&ai("")},b2=a=>{if(!bi)return void bR(!0);I(H(ab),a)&&ae(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},b3=(a,b,c)=>{let d=(0,g.noteToPc)(c);if(void 0===d||d<0||d>11)return;let e=b.map(a=>(0,g.romanToChordSymbol)(a,d,"Major"));Q(a=>{let b=[...a],c=b.findIndex(a=>!a);return -1===c&&(c=0),e.forEach((a,d)=>{b[(c+d)%12]=a}),b}),Z(a=>{let b=[...P];e.forEach((a,c)=>{let d=b.findIndex(a=>!a);if(-1===d)return 0;b[(d+c)%12]=a});let c=b.findIndex(a=>!a);return -1===c?0:c}),(0,T.track)("preset_inserted",{page:"chord_progression",preset:a}),by(!1)};(0,c.useEffect)(()=>{let a=au||aN;if(!a)return;let b="number"==typeof a.tonic?h.PC_NAMES[a.tonic]:a.tonic,c="Major"===a.mode||"Minor"===a.mode?"Major"===a.mode?"major":"minor":a.mode;as(V.map(a=>q(a,b,c,{showQuality:!0,uppercase:!0})))},[au,aN,V]),(0,c.useEffect)(()=>{if(!aN||0===ar.length)return void bX([]);aN.mode,bX(function(a,b){let c=a.map(N),d=[];for(let a of K)for(let b of[a.seq,...a.variants??[]].map(a=>a.map(N))){let e=b.length;for(let f=0;f+e<=c.length;f++){let g=!0;for(let a=0;a<e;a++)if(c[f+a]!==b[a]){g=!1;break}if(g){d.push({id:a.id,name:a.name,summary:a.tooltip,start:f,end:f+e});break}}}return d.sort((a,b)=>b.end-b.start-(a.end-a.start)),function(a){let b=[];for(let c of a)b.some(a=>!(c.end<=a.start||a.end<=c.start))||b.push(c);return b}(d)}(ar,0))},[ar,aN]),(0,c.useEffect)(()=>{if(!ar||0===ar.length)return void bZ([]);let a=ar.map(a=>{let b=a.replace(/\s+/g,"").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);if(!b)return a.toUpperCase();let c=b[1]??"",d=(b[2]??"").toUpperCase();return`${c}${d}`}),b=null;try{b=g.detectCadence(a)}catch{}let c=(Array.isArray(b)?b:b?[b]:[]).map(a=>"string"==typeof a?{type:a}:{type:a?.type??a,tail:a?.tailRoman??(a?.pair?{from:a.pair[0],to:a.pair[1]}:void 0)});if(a.length>=2){let b=a[a.length-1],d=a[0];c.some(a=>"perfect"===a.type)||"V"!==b||"I"!==d||c.push({type:"perfect",tail:{from:"V",to:"I"}}),c.some(a=>"deceptive"===a.type)||"V"!==b||"VI"!==d||c.push({type:"deceptive",tail:{from:"V",to:"vi"}})}bZ(c)},[ar]);let b4=(0,c.useMemo)(()=>{if(!ar||0===ar.length)return null;let a=ar.map(a=>{let b=a.replace(/\s+/g,"").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);if(!b)return a.toUpperCase();let c=b[1]??"",d=(b[2]??"").toUpperCase();return`${c}${d}`});if(a.length<2)return null;let b=a[0],c=a[a.length-1];return"V"===c&&"I"===b?{type:"perfect",tail:{from:"V",to:"I"}}:"V"===c&&"VI"===b?{type:"deceptive",tail:{from:"V",to:"vi"}}:"V"===c?{type:"half",tail:{from:void 0,to:"V"}}:null},[ar]);(0,c.useEffect)(()=>{let a=()=>{aP.current&&aQ.current&&aR.current&&(aQ.current.style.minHeight="0px")};requestAnimationFrame(a);let b=setTimeout(a,120),c=null,d=()=>{c&&clearTimeout(c),c=setTimeout(a,120)};window.addEventListener("resize",d),window.addEventListener("orientationchange",d),window.addEventListener("load",a);let e=null,f=null;if("undefined"!=typeof ResizeObserver&&aS.current){let b=null;(e=new ResizeObserver(()=>{b&&clearTimeout(b),b=setTimeout(a,100)})).observe(aS.current)}if("undefined"!=typeof ResizeObserver&&aR.current){let b=null;(f=new ResizeObserver(()=>{b&&clearTimeout(b),b=setTimeout(a,100)})).observe(aR.current)}return()=>{clearTimeout(b),c&&clearTimeout(c),window.removeEventListener("resize",d),window.removeEventListener("orientationchange",d),window.removeEventListener("load",a),e&&e.disconnect(),f&&f.disconnect()}},[]),(0,c.useEffect)(()=>{aQ.current},[aj,bO,V.length]);let b5=("M"===ab?`${_}`:`${_}${ab}`)+(ad.length?` ${ad.join(" ")}`:"")+(ah?`/${ah}`:""),b6=async()=>{if(!_)return;let a=h.PC_NAMES.indexOf(_);if(a<0)return;let b=60+a,c=ab.toLowerCase(),d=a=>ad.includes(a),e=[0,4,7];c.includes("m")&&!c.includes("maj")&&(e=[0,3,7]),c.includes("dim")&&(e=[0,3,6]),c.includes("maj7")||c.includes("mmaj7")?e=[...c.includes("m")?[0,3,7]:[0,4,7],11]:c.includes("7")&&(e=[0,4,7,10]),d("sus2")&&(e=[0,2,7]),d("sus4")&&(e=[0,5,7]);let f=e.map(a=>b+a%12);try{await O.player.resume(),O.player.playChord(f,"lightStrum",300)}catch{}};(0,c.useEffect)(()=>{try{let a=(bl.current||(bl.current=Math.random().toString(36).slice(2,10)),bl.current),b=V.length?V.join(" ").slice(0,48):`Untitled ${new Date().toLocaleString()}`,c=au?h.PC_NAMES[au.tonic]:aN?aN.tonic:"C",d=ay?.type||(au?au.mode:"Ionian");bk({id:a,name:b,createdAt:bj?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),schema:"sketch_v1",appVersion:"3.0.0",key:{tonic:c,scaleId:String(d)},capo:{fret:0,note:"Shaped"},progression:{items:V.map((a,b)=>({id:`${b+1}-${a}`,degree:"",quality:""}))},fretboardView:{mode:"names"===aB?"Names":"Degrees",guide:!!aF}})}catch{}},[P,aB,aF,au,aN,ay]);let[b7,b8]=(0,c.useState)(!1);(0,c.useEffect)(()=>{try{let a="ontouchstart"in window||(navigator?.maxTouchPoints??0)>0;b8(!!a)}catch{b8(!1)}},[]);let b9=async a=>{try{await O.player.resume();let b=(0,aW.chordToMidi)(a);b&&b.length>0&&O.player.playChord(b,"lightStrum",300)}catch(b){console.error("Failed to play chord:",a,b)}};return(0,b.jsxs)("main",{ref:o,className:"ot-page ot-stack","data-page":"find-key",children:[(0,b.jsxs)("section",{id:"progression",className:"ot-card prog-compact",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 sm:gap-3 mb-1 sm:mb-2",children:[(0,b.jsx)(t,{className:"mb-0 text-left",children:"Build progression"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 relative",children:[(0,b.jsxs)("button",{type:"button",className:"btn-ghost btn-reset chip-pressable text-sm px-3 py-1 inline-flex items-center gap-1",title:"Reset progression",onClick:()=>{Q(Array(12).fill("")),Z(0),aA(),am([]),ak(null),aG(null),aE(null),aC("degrees")},children:[(0,b.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,b.jsx)("path",{d:"M12 5V2L7 7l5 5V9c2.76 0 5 2.24 5 5a5 5 0 1 1-5-5z"})}),(0,b.jsx)("span",{children:"Reset"})]}),(0,b.jsxs)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs border",title:"Show sketches",onClick:()=>br(a=>!a),"aria-expanded":bq,children:[(0,b.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,b.jsx)("path",{d:"M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h12v2H3v-2z"})}),"Sketches"]}),bq&&(0,b.jsx)("div",{ref:bu,className:"fixed right-4 top-20 z-[10000] w-[320px] max-h-[70vh] overflow-auto rounded-md border bg-white dark:bg-neutral-900 shadow-2xl p-2 space-y-2",children:0===bm.length?(0,b.jsx)("div",{className:"text-xs opacity-70 p-2",children:"No sketches yet"}):bm.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/10",children:[(0,b.jsx)("button",{className:"text-left text-sm flex-1 truncate",title:`${a.name}`,onClick:()=>bt(a),children:a.name}),(0,b.jsx)("button",{className:"ot-btn-ghost text-xs",title:"Delete",onClick:b=>{b.stopPropagation(),bo(a.id),bn(),(0,T.track)("project_delete",{page:"chord_progression",id:a.id})},children:"🗑️"})]},a.id))}),(0,b.jsx)("div",{className:"w-4","aria-hidden":"true"}),(0,b.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)("button",{type:"button",className:"chip-pressable text-sm px-3 py-1.5 inline-flex items-center gap-1.5 rounded-lg border",title:aY?"Stop playback":"Play progression",onClick:bg,disabled:0===V.length,style:{opacity:0===V.length?.5:1},children:aY?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,b.jsx)("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})}),(0,b.jsx)("span",{children:"Stop"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,b.jsx)("path",{d:"M8 5v14l11-7z"})}),(0,b.jsx)("span",{children:"Play"})]})}),(0,b.jsxs)("div",{className:"inline-flex items-center gap-1.5",children:[(0,b.jsx)("label",{htmlFor:"bpm-input",className:"text-xs opacity-70",children:"BPM:"}),(0,b.jsx)("input",{id:"bpm-input",type:"number",min:"40",max:"240",value:a2,onChange:a=>a3(Math.max(40,Math.min(240,parseInt(a.target.value)||120))),className:"w-16 px-2 py-1 text-sm rounded border bg-transparent",disabled:aY})]})]}),(0,b.jsxs)("select",{className:"chip","aria-label":"Instrument",defaultValue:"acoustic_guitar_steel",onChange:async a=>{let b=a.currentTarget.value;await O.player.setInstrument(b)},children:[(0,b.jsx)("option",{value:"acoustic_guitar_steel",children:"Acoustic Steel"}),(0,b.jsx)("option",{value:"acoustic_guitar_nylon",children:"Acoustic Nylon"}),(0,b.jsx)("option",{value:"electric_guitar_clean",children:"Electric Clean"}),(0,b.jsx)("option",{value:"distortion_guitar",children:"Distortion"}),(0,b.jsx)("option",{value:"overdriven_guitar",children:"Over Drive"}),(0,b.jsx)("option",{value:"electric_guitar_muted",children:"Muted"}),(0,b.jsx)("option",{value:"acoustic_grand_piano",children:"Piano"})]})]})]}),(0,b.jsx)("div",{className:"prog-slots mt-2 flex flex-wrap gap-1","aria-label":"Progression slots",children:Array.from({length:12}).map((a,c)=>{let d=!!P[c],e=c<8?0:(c-7)*.08,f=`rgba(16,185,129,${e.toFixed(2)})`,g=Y===c,h=a5===c&&aY;return(0,b.jsxs)("div",{"data-slot-index":c,className:["inline-flex items-center justify-center rounded border text-xs select-none relative chip-pressable",d?"bg-black/5 dark:bg-white/10":"bg-transparent",g?"ring-2 ring-emerald-400/60":"",h?"ring-4 ring-blue-500/80 shadow-lg":"",aT===c?"opacity-50 scale-105":"",a8===c?"ring-2 ring-blue-400":""].join(" "),style:{padding:"6px 10px",minWidth:72,minHeight:36,background:d?void 0:f,borderColor:"var(--line)",transition:"opacity 0.15s, transform 0.15s, box-shadow 0.15s",touchAction:d?"none":"auto"},onClick:()=>{d?b9(P[c]):Z(c)},draggable:d,onDragStart:()=>aU(c),onDragOver:a=>a.preventDefault(),onDrop:()=>{null!==aT&&(a7(aT,c),aU(null))},onTouchStart:a=>ba(a,c),onTouchMove:a=>bb(a,c),onTouchEnd:bc,children:[(0,b.jsx)("span",{className:"absolute left-1 top-1 text-[10px] opacity-70 select-none pointer-events-none",children:String(c+1)}),d?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:P[c]}),(0,b.jsx)("button",{"aria-label":"Remove chord",className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-black/50 text-white text-[10px] leading-4 hover:bg-black/70",onClick:a=>{a.stopPropagation(),bh(c)},children:"×"})]}):null]},`slot-${c}`)})})]}),(0,b.jsxs)("section",{id:"choose",ref:aS,className:"ot-card right-panel",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)(t,{className:"mb-0 text-left",children:"Choose chords"}),(0,b.jsxs)("button",{type:"button",className:"chip-pressable text-sm px-3 py-1 inline-flex items-center gap-1 rounded-lg border",title:"Load preset progression",onClick:()=>by(!0),children:[(0,b.jsx)("span",{children:"📋"}),(0,b.jsx)("span",{children:"Presets"})]})]}),(0,b.jsxs)("div",{className:"mt-1 sm:mt-2 space-y-1",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs opacity-70 mb-0.5",children:"Root"}),(0,b.jsx)("div",{ref:l,className:"chips-row overflow-x-auto whitespace-nowrap",role:"tablist","aria-orientation":"horizontal","aria-label":"Select key",children:$.map(a=>(0,b.jsx)("button",{role:"tab","aria-selected":_===a,tabIndex:_===a?0:-1,className:`chip ${_===a?"chip--active":""}`,onClick:()=>aa(a),children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs opacity-70 mb-0.5",children:"Quick"}),(0,b.jsx)("div",{className:"chips-row overflow-x-auto whitespace-nowrap",children:w.map(a=>(0,b.jsx)("button",{className:`chip ${ab===a?"chip--active":""}`,onClick:()=>b1(a),children:a},`quick-${a}`))})]}),(0,b.jsxs)("div",{className:"mt-1",children:[(0,b.jsxs)("button",{"data-testid":"adv-toggle",className:`adv-toggle ${bO?"is-open":""}`,onClick:()=>bP(a=>!a),"aria-expanded":bO,children:[(0,b.jsx)("span",{className:"caret","aria-hidden":!0}),(0,b.jsx)("span",{className:"spark","aria-hidden":!0,children:(0,b.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,b.jsx)("path",{d:"M12 2l1.9 4.6L18.5 8 13.9 9.4 12 14l-1.9-4.6L5.5 8l4.6-1.4L12 2zm6 9l.95 2.3L21 14l-2.05.7L18 17l-.95-2.3L15 14l2.05-.7L18 11zM5 12l.8 1.9L8 14l-2.2.8L5 17l-.8-2.2L2 14l2.2-.8L5 12z"})})}),(0,b.jsx)("span",{className:"label",children:"Advanced"})]}),bi&&bO&&(0,b.jsxs)("div",{className:"mt-2 space-y-3",children:[(0,b.jsx)(a0,{title:"Extensions",children:x.map(a=>{let c=!I(H(ab),a),d=ad.includes(a);return(0,b.jsx)(a1,{label:a,onClick:()=>b2(a),disabled:c,active:d},`adv-${a}`)})}),(0,b.jsx)(a0,{title:"Altered Dominant",children:y.map(a=>{let c=!I(H(ab),a),d=ad.includes(a);return(0,b.jsx)(a1,{label:a,onClick:()=>b2(a),disabled:c,active:d},`adv-${a}`)})}),(0,b.jsx)(a0,{title:"Diminished / Variants",children:z.map(a=>{let c=!I(H(ab),a),d=ad.includes(a);return(0,b.jsx)(a1,{label:a,onClick:()=>b2(a),disabled:c,active:d},`adv-${a}`)})}),(0,b.jsx)(a0,{title:"Suspensions / Adds",children:A.map(a=>{let c=!I(H(ab),a),d=ad.includes(a);return(0,b.jsx)(a1,{label:a,onClick:()=>b2(a),disabled:c,active:d},`adv-${a}`)})}),(0,b.jsx)(a0,{title:"Aug / mM7",children:B.map(a=>{let c=ab===a;return(0,b.jsx)(a1,{label:a,onClick:()=>b1(a),active:c},`adv-${a}`)})}),(0,b.jsx)(a0,{title:"Slash (On)",children:(0,b.jsx)("div",{className:"adv-grid",children:D.map(a=>(0,b.jsx)("button",{className:`chip ${ah===a?"chip--active":""}`,onClick:()=>(a=>{if(!bi)return void bR(!0);a===_||a===ah?ai(""):ai(a)})(a),children:a},`bass-${a}`))})})]}),!bi&&bO&&(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(F,{title:"Advanced — Pro (preview)",children:(0,b.jsxs)("div",{className:"space-y-3 grayscale opacity-40",children:[(0,b.jsx)(a0,{title:"Extensions",children:x.map(a=>(0,b.jsx)(a1,{label:a,disabled:!0},`adv-${a}`))}),(0,b.jsx)(a0,{title:"Altered Dominant",children:y.map(a=>(0,b.jsx)(a1,{label:a,disabled:!0},`adv-${a}`))}),(0,b.jsx)(a0,{title:"Diminished / Variants",children:z.map(a=>(0,b.jsx)(a1,{label:a,disabled:!0},`adv-${a}`))}),(0,b.jsx)(a0,{title:"Suspensions / Adds",children:A.map(a=>(0,b.jsx)(a1,{label:a,disabled:!0},`adv-${a}`))}),(0,b.jsx)(a0,{title:"Aug / mM7",children:B.map(a=>(0,b.jsx)(a1,{label:a,disabled:!0},`adv-${a}`))}),(0,b.jsx)(a0,{title:"Slash (On)",children:(0,b.jsx)("div",{className:"adv-grid",children:D.map(a=>(0,b.jsx)("button",{className:"chip chip--disabled",children:a},`bass-${a}`))})})]})})}),(0,b.jsx)(G,{open:bQ,onClose:()=>bR(!1)}),(0,b.jsx)("div",{className:"preview-sticky mt-2 mb-[6px]",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsxs)("div",{className:"text-sm flex items-center gap-2",children:[(0,b.jsx)("span",{className:"opacity-70",children:"Preview:"}),(0,b.jsxs)("button",{type:"button",className:"preview-chord inline-flex items-center gap-1 px-2 py-1 rounded border border-emerald-400/60 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 hover:border-emerald-500 dark:text-emerald-100 dark:bg-emerald-900/40 dark:border-emerald-500/80 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300",title:"Click to preview chord",onClick:b6,children:[(0,b.jsx)("svg",{className:"h-6 w-6",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,b.jsx)("path",{d:"M8 5v14l11-7z"})}),b5||"-"]}),(0,b.jsx)("button",{className:`rounded-lg px-4 py-2 text-sm ml-1 border transition-all active:scale-[.98] active:translate-y-px focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300 ${bS?"bg-emerald-100 border-emerald-300 text-emerald-900":"bg-emerald-500 border-emerald-600 text-white hover:bg-emerald-600"}`,onClick:()=>{b5&&(Q(a=>{let b=a.slice();return b[Y]=b5,b}),ae([]),ai(""),bT(!0),window.setTimeout(()=>bT(!1),600),Z(a=>Math.min(11,a+1)))},"aria-live":"polite",children:bS?"Added ✓":"Add"})]}),(0,b.jsx)("button",{className:`w-full sm:w-auto sm:ml-auto mt-2 sm:mt-0 px-6 py-2 text-base min-w-0 sm:min-w-[220px] rounded-lg font-semibold text-white transition-transform active:scale-[.98] active:translate-y-px focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300 ${bU?"bg-rose-400/70 cursor-wait":"bg-rose-400 hover:bg-rose-500"}`,onClick:()=>{(!V.map(a=>{let b=a.match(/^([A-G](?:#|b)?)(.*)$/);return{root:b?.[1]||a,quality:b?.[2]||""}}).some(a=>C.some(b=>a.quality.includes(b)))||bi)&&bV(()=>{ak((0,v.analyzeChordProgression)(V));let a=(0,g.rankKeys)(V);if(am(a.slice(0,4)),a.length>0){let b="Major"===a[0].mode?"major":"minor",c={tonic:a[0].label.split(" ")[0],mode:b};aO(c),as(V.map(a=>q(a,c.tonic,c.mode,{showQuality:!0,uppercase:!0})))}else ao([]),aO(null),as([]);av(V),setTimeout(()=>{let a=document.getElementById("result");a&&a.scrollIntoView({behavior:"smooth",block:"start"})},100),setTimeout(()=>{let a=document.getElementById("result");a&&a.scrollIntoView({behavior:"smooth",block:"start"})},100)})},disabled:bU,"aria-busy":bU,children:bU?(0,b.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,b.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4z"})]}),"Analyzing…"]}):"Analyze"})]})})]})]})]}),(0,b.jsxs)("section",{id:"result",ref:aR,className:"ot-card",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(t,{className:"text-left mb-0",children:"Result"}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:()=>bD(!0),title:"Save sketch",children:[(0,b.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,b.jsx)("path",{d:"M17 3H5a2 2 0 0 0-2 2v14l4-4h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"})}),"Save"]})})]}),bC&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[10000]",role:"dialog","aria-modal":"true",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{bD(!1),bF("")}}),(0,b.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[420px]",children:[(0,b.jsx)("div",{className:"text-base font-semibold mb-2",children:"Save sketch"}),(0,b.jsx)("input",{type:"text",className:"chip px-2 py-2 text-sm w-full",placeholder:bG,value:bE,onChange:a=>bF(a.target.value),"aria-label":"Sketch name",autoFocus:!0}),(0,b.jsxs)("div",{className:"mt-3 flex items-center justify-end gap-2",children:[(0,b.jsx)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:()=>{bD(!1),bF("")},children:"Cancel"}),(0,b.jsx)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:bN,children:"OK"})]})]})]}),bs&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[10001]",role:"dialog","aria-modal":"true",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>bt(null)}),(0,b.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[320px]",children:[(0,b.jsx)("div",{className:"text-base font-semibold mb-3",children:bs.name}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>{try{let a=Array(12).fill("");(bs?.progression?.items||[]).forEach((b,c)=>{c<12&&(a[c]=String(b?.id||""))}),Q(a),Z(-1===a.findIndex(a=>!a)?11:a.findIndex(a=>!a));try{av(a.filter(Boolean))}catch{}let b=h.PC_NAMES.indexOf(bs.key.tonic);if(b>=0)try{aw?.({tonic:b,mode:String(bs.key.scaleId||"")?.toLowerCase().includes("aeolian")||String(bs.key.scaleId||"").toLowerCase().includes("minor")?"Minor":"Major"})}catch{}(0,T.track)("open_project",{page:"chord_progression",id:bs.id}),br(!1),bt(null)}catch{}},children:"Edit"}),(0,b.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:async()=>{try{await bM(bs),bt(null)}catch{}},children:"Export"}),(0,b.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>bt(null),children:"Cancel"})]})]})]}),(0,b.jsx)("div",{ref:p,"aria-hidden":!0,style:{position:"fixed",left:0,top:0,zIndex:9999,opacity:1e-4,pointerEvents:"none",width:800,height:600,background:"#ffffff",color:"#000000",padding:24,borderRadius:12,border:"2px solid #cbd5e1",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},children:(()=>{let a=bK||(bE?.trim()?bE:bG),c=au?`${h.PC_NAMES[au.tonic]} ${au.mode}`:"-",d=V.join(" "),e=ay?(0,i.scaleTypeLabel)(ay.type):"-",g=(()=>{let a=ay?ay.root:void 0,c=ay&&"number"==typeof a?(0,i.getScalePitchesById)(a,ay.type).map(a=>h.PC_NAMES[a]):[],d=aM?aB:"degrees",e=(()=>{let a=ay?.type;return a&&(a.toLowerCase().includes("aeolian")||a.toLowerCase().startsWith("min"))?"min":"maj"})();return(0,b.jsx)("div",{style:{marginTop:8,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",width:"100%"},children:(0,b.jsx)(f.default,{overlay:{viewMode:"sounding",capo:0,notes:c,chordNotes:aF??void 0,showScaleGhost:!!aF,display:d,scaleRootPc:"number"==typeof a?a:0,scaleType:ay?.type??"Ionian",context:{chordRootPc:"number"==typeof a?a:0,quality:e}},onRequestForms:()=>{}})})})();return(0,b.jsxs)("div",{style:{background:"#ffffff",color:"#000000",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif",width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:"12px",padding:"8px"},children:[(0,b.jsx)("div",{style:{fontWeight:700,fontSize:24,color:"#000000",lineHeight:1.3},children:a}),(0,b.jsxs)("div",{style:{fontSize:18,color:"#000000",fontWeight:600},children:["Key: ",(0,b.jsx)("span",{style:{color:"#1e40af"},children:c})]}),(0,b.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Progression: ",(0,b.jsx)("span",{style:{color:"#1e40af"},children:d||"-"})]}),(0,b.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Scale: ",(0,b.jsx)("span",{style:{color:"#1e40af"},children:e})]}),(0,b.jsx)("div",{style:{flex:1,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",overflow:"hidden"},children:g})]})})()}),at.length>0?(0,b.jsxs)("div",{className:"space-y-4",children:[at.length>0&&V.length<8&&(0,b.jsxs)("div",{className:"text-xs px-3 py-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200",children:["⚠️ 精度向上のため、8コード以上の入力を推奨します（現在: ",V.length,"コード）"]}),(0,b.jsx)(u,{children:"Key"}),(0,b.jsx)("div",{className:"flex items-center justify-between gap-2",children:(0,b.jsx)("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Key candidates",children:at.map((a,c)=>{let d=au&&au.tonic===a.tonic&&au.mode===a.mode,e=`${h.PC_NAMES[a.tonic]} ${a.mode}`,f=a.reasons.join("\n");return(0,b.jsxs)("button",{role:"tab","aria-selected":d,className:["chip chip--key",d?"chip--active":""].join(" "),title:`Why this key
${f}`,onClick:()=>aw({tonic:a.tonic,mode:a.mode}),"data-roving":"item",children:[e," ",Math.round(a.confidence),"%"]},`${e}-${c}`)})})}),(0,b.jsxs)("div",{className:"result-block",children:[(0,b.jsx)(u,{children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{children:"Scale"}),(()=>{let a=ay?.type??ax?.[0]?.type??"Ionian",c=k.SCALE_CATALOG.find(b=>b.id===a);if(!c)return null;let d=(0,i.getScalePitchesById)(0,c.id).map(a=>h.PC_NAMES[a]).join(" ");return(0,b.jsx)(s.default,{title:c.display.en,className:"ml-1",linkHref:"/resources/glossary",linkLabel:"Glossary",children:(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsxs)("div",{className:"mb-1",children:[(0,b.jsx)("b",{children:"Degrees:"})," ",c.degrees.join(" ")]}),(0,b.jsxs)("div",{className:"mb-1",children:[(0,b.jsx)("b",{children:"Notes in C:"})," ",d]}),c.info?.oneLiner&&(0,b.jsxs)("div",{className:"mb-1",children:[(0,b.jsx)("b",{children:"About:"})," ",c.info.oneLiner]})]})})})()]})}),(0,b.jsx)("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Scale candidates",children:ax.map((a,c)=>{console.log("[Scale type]",a.type);let d=(0,i.normalizeScaleId)(a.type),e=ay?.type===d&&ay?.root===a.root,f=`${h.PC_NAMES[a.root]} ${(0,i.scaleTypeLabel)(d)}`;return(0,b.jsxs)("button",{role:"tab","aria-selected":e,className:["chip chip--key",e?"chip--active":""].join(" "),onClick:()=>{az(a),(0,T.track)("scale_pick",{page:"find-key",scale:a.type,key:h.PC_NAMES[a.root]})},"data-roving":"item",children:[f," ",Math.round(a.score),"%"]},`${f}-${c}`)})})]})]}):(0,b.jsx)("div",{className:"text-sm opacity-70",children:"Click Analyze to see results."})]}),(0,b.jsxs)("section",{className:"ot-card mt-2",children:[(0,b.jsx)(t,{children:"Tools"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"result-block",children:[(0,b.jsx)(u,{right:(0,b.jsxs)("div",{ref:m,className:"flex items-center gap-2 bg-transparent shadow-none fretboard-toggle","aria-label":"Fretboard notation",role:"tablist",children:[(0,b.jsx)("button",{role:"tab","aria-selected":"degrees"===aB,tabIndex:"degrees"===aB?0:-1,className:["chip chip--key","degrees"===aB?"chip--active":""].join(" "),onClick:()=>aC("degrees"),"data-roving":"item",children:"Degrees"}),(0,b.jsx)("button",{role:"tab","aria-selected":"names"===aB,tabIndex:aM&&"names"===aB?0:-1,"aria-disabled":!aM,className:["chip chip--key","names"===aB?"chip--active":"",!aM?"chip--disabled":""].join(" "),onClick:()=>{aM&&aC("names")},"data-roving":"item",children:"Names"})]}),children:"Fretboard"}),(0,b.jsx)("div",{className:"fret-wrap",children:(0,b.jsx)("div",{className:"fret-inner",children:ay?(()=>{let a=ay.root,c=(0,i.getScalePitchesById)(a,ay.type).map(a=>h.PC_NAMES[a]),d=aM?aB:"degrees",e=(()=>{let a=ay?.type;return a&&(a.toLowerCase().includes("aeolian")||a.toLowerCase().startsWith("min"))?"min":"maj"})();return(0,b.jsx)(f.default,{overlay:{viewMode:"sounding",capo:0,notes:c,chordNotes:aF??void 0,showScaleGhost:!!aF,display:d,scaleRootPc:a,scaleType:ay.type,context:{chordRootPc:a,quality:e}},onRequestForms:(b,c)=>{aI({at:b,rootPc:c.rootPc??a,quality:c.quality})},formShape:aJ})})():(0,b.jsx)("div",{className:"text-center text-sm opacity-50 py-8",children:"Click Analyze to see fretboard"})})})]}),(0,b.jsxs)("section",{className:"result-block space-y-2",children:[(0,b.jsx)(u,{children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{children:"Diatonic"}),(0,b.jsxs)(s.default,{className:"ml-1",title:"Diatonic chords",linkHref:"/resources/glossary",linkLabel:"Glossary",children:[(0,b.jsx)("p",{className:"text-sm",children:"Chords built only from the key’s scale tones (I–ii–iii–IV–V–vi–vii°)."}),(0,b.jsxs)("ul",{className:"mt-2 list-disc pl-5 space-y-1 text-sm",children:[(0,b.jsx)("li",{children:"Stable sound: everything stays inside the key."}),(0,b.jsx)("li",{children:"Use: begin inside → add color with a borrowed chord (iv, bVII, bVI)."}),(0,b.jsx)("li",{children:"Try: ii–V–I or IV–V–I for clear motion."})]}),(0,b.jsx)("h4",{className:"mt-3 font-medium",children:"Shaped vs. Sounding (Capo)"}),(0,b.jsxs)("ul",{className:"mt-1 list-disc pl-5 space-y-1 text-sm",children:[(0,b.jsx)("li",{children:"Shaped: labels show the shapes you fret after capo."}),(0,b.jsx)("li",{children:"Sounding: labels show the actual pitch you hear."})]})]})]})}),(0,b.jsx)(J.default,{selectedId:aD,onSelectId:a=>aE(a),onPick:async({id:a,pcs:b,isRightClick:c})=>{if(c){let b=r.useAnalysisStore.getState().selectedKey,c=r.useAnalysisStore.getState().selectedScale;if(!b||!c)return;let d=c.type,e=i.SCALE_INTERVALS[d]??[];if(7!==e.length){let a=(0,i.parentModeOf)(d);a&&(e=i.SCALE_INTERVALS[a]??[])}if(7!==e.length)return;let f=(0,j.diatonicTriads)({tonicPc:b.tonic,scaleIntervals:e})[parseInt(a.replace("open-",""))];if(!f)return;let g=(0,j.triadToChordSym)({rootPc:f.rootPc,quality:f.quality}),h=[...P];h[Y]=g,Q(h),Y<11&&Z(Y+1),(0,T.track)("diatonic_pick",{page:"find-key",action:"right_click_add"});return}if(aD===a){aG(null),aE(null),aL();return}aG(b.map(a=>h.PC_NAMES[a])),aE(a),aL(),(0,T.track)("diatonic_pick",{page:"find-key"});try{await O.player.resume();let a=b.map(a=>60+a%12);O.player.playChord(a,"lightStrum",260)}catch{}}})]}),aM&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u,{children:"Roman"}),(0,b.jsx)("div",{ref:b0,className:"rounded-md border px-3 py-2","aria-live":"polite","data-testid":"roman-row",children:(0,b.jsx)("div",{className:"flex-1 overflow-x-auto whitespace-nowrap text-lg md:text-xl tracking-wide",children:0===ar.length?(0,b.jsx)("span",{children:"-"}):ar.map((a,d)=>(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsx)("span",{"data-idx":d,className:b$&&d>=b$.start&&d<=b$.end?"roman-mark":void 0,children:String(a||"").toUpperCase()}),d<ar.length-1?(0,b.jsx)("span",{"aria-hidden":!0,className:"mx-1",children:"–"}):null]},`rom-${d}`))})})]}),bW.length>0&&(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs opacity-70",children:"Patterns"}),(()=>{var a;let c=bW[0],d={"doo-wop":"dooWop",axis:"axis",canon:"canon","ii-V-I":"twoFiveOne",turnaround:"turnaround",andalusian:"andalusian",authentic:"authentic",plagal:"plagal",deceptive:"deceptive"},e=d[c.id]?{label:L[a=d[c.id]],summary:M[a]}:null,f=e?.label||c.name.replace(/\(([^)]+)\)/g,(a,b)=>{let c=b.replace(/[ivx]+/g,a=>a.toUpperCase());return`(${c})`}).replace(/\(I–vi–IV–V\)/,"(I–VI–IV–V)"),g=e?.summary||c.summary||c.name;return b$&&b$.start===c.start&&(b$.end,c.end),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{type:"button",className:"text-sm leading-tight font-medium hover:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/50 rounded",title:g,onClick:()=>{b_(a=>a&&a.start===c.start&&a.end===c.end?null:{start:Math.max(0,c.start),end:Math.max(c.start,Math.min(ar.length-1,c.end))}),requestAnimationFrame(()=>{let a=b0.current;if(!a)return;let b=a.querySelector(`[data-idx="${c.start}"]`);b&&(a.scrollLeft=Math.max(0,b.offsetLeft-12))})},children:f},`${c.id}-0`),(0,b.jsx)(s.default,{ariaLabel:`${f} – info`,text:`${f}

${g}`})]})})()]}),(bY.length>0||b4)&&(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs opacity-70",children:"Cadence"}),(()=>{let a=bY[0]??b4,c=a?.type??a,d=a?.tail??a?.tailRoman,e=c?"perfect"===c?`Perfect (${d?.from??"V"} → ${d?.to??"I"})`:"deceptive"===c?`Deceptive (${d?.from??"V"} → ${d?.to??"vi"})`:`Half (${d?.from?`${d.from} → `:"… → "}V)`:"";return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5 text-sm leading-tight",children:[(0,b.jsx)("span",{className:"font-medium",children:e}),(0,b.jsx)(s.default,{text:c?"perfect"===c?"Resolves to the Tonic: V → I. Feels fully resolved.":"deceptive"===c?"Surprises by avoiding I: V → vi (or similar).":"Phrase ends on the Dominant: … → V. Feels unresolved.":"No cadence detected."})]})})()]})]})]}),(0,b.jsx)("section",{className:"ot-card","aria-label":"Ad",children:(0,b.jsx)(d.default,{page:"chord_progression",format:"horizontal"})}),bx&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",style:{backdropFilter:"blur(4px)"},children:(0,b.jsxs)("div",{ref:bB,className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Load Preset"}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"text-xs opacity-70 mb-1 block",children:"Key"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map(a=>(0,b.jsx)("button",{className:`chip ${bz===a?"chip--active":""}`,onClick:()=>bA(a),children:a},a))})]}),(0,b.jsxs)("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-V-vi-IV",["Ⅰ","Ⅴ","Ⅵm","Ⅳ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅳ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Pop progression"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("ii-V-I",["Ⅱm","Ⅴ","Ⅰ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅱm–Ⅴ–Ⅰ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Jazz turnaround"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("12-bar-blues",["Ⅰ","Ⅰ","Ⅰ","Ⅰ","Ⅳ","Ⅳ","Ⅰ","Ⅰ","Ⅴ","Ⅳ","Ⅰ","Ⅴ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"12-bar Blues"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Classic blues form (all 12 slots)"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-II",["Ⅰ","Ⅱ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅱ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Simple two-chord progression"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-bVII-IV",["Ⅰ","♭Ⅶ","Ⅳ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Rock progression"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("vi-IV-I-V",["Ⅵm","Ⅳ","Ⅰ","Ⅴ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅴ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Emotional / Ballad (I-V-vi-IVの逆回転)"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-vi-IV-V",["Ⅰ","Ⅵm","Ⅳ","Ⅴ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅵm–Ⅳ–Ⅴ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"50's progression / Doo-wop"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-IV-V",["Ⅰ","Ⅳ","Ⅴ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳ–Ⅴ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Three-chord song / Rock classic"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("vi-ii-V-I",["Ⅵm","Ⅱm","Ⅴ","Ⅰ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅱm–Ⅴ–Ⅰ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Circle progression / Jazz standard"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-bVII-bVI-bVII",["Ⅰ","♭Ⅶ","♭Ⅵ","♭Ⅶ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–♭Ⅵ–♭Ⅶ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Mixolydian vamp / Rock anthem"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-IVm-I-V",["Ⅰ","Ⅳm","Ⅰ","Ⅴ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳm–Ⅰ–Ⅴ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Borrowed chord / Minor IV"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("vi-IV-I-III",["Ⅵm","Ⅳ","Ⅰ","Ⅲ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅲ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Andalusian cadence / Spanish feel"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-bIII-bVII-IV",["Ⅰ","♭Ⅲ","♭Ⅶ","Ⅳ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅲ–♭Ⅶ–Ⅳ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Modal interchange / Epic progression"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-iii-IV-V",["Ⅰ","Ⅲm","Ⅳ","Ⅴ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅳ–Ⅴ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Classic progression / Beatles style"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-V-vi-iii-IV-I-IV-V",["Ⅰ","Ⅴ","Ⅵm","Ⅲm","Ⅳ","Ⅰ","Ⅳ","Ⅴ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅲm–Ⅳ–Ⅰ–Ⅳ–Ⅴ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Pachelbel's Canon / Wedding classic"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-bVI-bVII-I",["Ⅰ","♭Ⅵ","♭Ⅶ","Ⅰ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅵ–♭Ⅶ–Ⅰ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Power ballad / 80s rock"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("vi-V-IV-III",["Ⅵm","Ⅴ","Ⅳ","Ⅲ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅴ–Ⅳ–Ⅲ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Descending progression / Melancholic"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-IV-bVII-IV",["Ⅰ","Ⅳ","♭Ⅶ","Ⅳ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳ–♭Ⅶ–Ⅳ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Folk/Country vamp"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-bVII-IV-I",["Ⅰ","♭Ⅶ","Ⅳ","Ⅰ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ–Ⅰ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Stadium anthem / Closing progression"})]}),(0,b.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>b3("I-iii-vi-IV",["Ⅰ","Ⅲm","Ⅵm","Ⅳ"],bz),children:[(0,b.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅵm–Ⅳ"}),(0,b.jsx)("div",{className:"text-xs opacity-70",children:"Smooth descent / R&B style"})]})]}),(0,b.jsx)("button",{className:"mt-4 w-full px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600",onClick:()=>by(!1),children:"Cancel"})]})}),bH&&(0,b.jsx)(aZ,{message:bH.message,type:bH.type,ctaText:bH.ctaText,ctaHref:bH.ctaHref,ctaPlace:bH.ctaPlace,onClose:()=>bI(null)})]})}let a0=({title:a,children:c})=>(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-black/60 dark:text-white/60 mb-1",children:a}),(0,b.jsx)("div",{className:"adv-grid",children:c})]}),a1=({label:a,onClick:c,disabled:d,active:e,small:f})=>(0,b.jsx)("button",{className:["chip",f?"chip--sm":"",e?"chip--active":"",d?"chip--disabled":""].join(" "),onClick:c,"aria-disabled":d,children:a})}];

//# sourceMappingURL=src_app_chord-progression_page_tsx_4b90b741._.js.map