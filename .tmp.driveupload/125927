(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,48988,e=>{"use strict";e.s(["default",()=>e1],48988);var t=e.i(43476),a=e.i(71645),n=e.i(12187),l=e.i(77613),r=e.i(9760),i=e.i(81745),s=e.i(88327),s=s,o=e.i(15803),c=e.i(16728),d=e.i(29428),s=s;let u={0:0,2:1,4:2,5:3,7:4,9:5,11:6},m={0:0,2:1,3:2,5:3,7:4,8:5,10:6},h=["I","ii","iii","IV","V","vi","vii°"],p=["i","ii°","III","iv","v","VI","VII"];function g(e){return/maj7|M7/.test(e)}function x(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{showQuality:l=!0,accidentalsForNonDiatonic:r=!1}=n;if(!e||!t)return"";let o=(0,i.noteToPc)(t),c=e.split("/")[0].match(/^([A-G](?:#|b)?)(.*)$/i);if(!c)return e;let d=function(e){var t;let a=(0,i.noteToPc)(e);return null!=(t=s.PC_NAMES[a])?t:e}(c[1].toUpperCase()),x=c[2]||"",f=((0,i.noteToPc)(d)-o+12)%12,b="major"===a?h:p,v=("major"===a?u:m)[f];if(void 0!==v){let e=n.uppercase?["I","II","III","IV","V","VI","VII"][v]:b[v];return(n.uppercase&&("major"===a&&6===v||"minor"===a&&1===v)&&(e+="°"),l)?g(x)?e+"M7":!(g(x)||/m7b5|ø|dim7/.test(x))&&(/(\b|[^a-zA-Z])7(?![b#0-9])/i.test(x)||/\bm7\b/i.test(x))?e+"7":e:e}if(r){let e="major"===a?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10];for(let t=0;t<e.length;t++){let a=e[t];if((a+1)%12===f)return"#"+b[t];if((a+11)%12===f)return"b"+b[t]}}return"(".concat(d,")")}var f=e.i(52739),b=e.i(96751);function v(e){let{children:a,className:n="",right:l,as:r="h2"}=e;return(0,t.jsxs)("div",{className:"mb-2 flex items-center gap-2 ".concat(n),children:[(0,t.jsx)(r,{className:"text-xl md:text-2xl font-semibold tracking-tight text-foreground",children:a}),l?(0,t.jsx)("div",{className:"ml-auto",children:l}):null]})}function y(e){let{children:a,className:n="",right:l,as:r="h3"}=e;return(0,t.jsxs)("div",{className:"mb-1.5 flex items-center gap-2 ".concat(n),children:[(0,t.jsx)(r,{className:"text-sm md:text-base font-semibold tracking-wide text-foreground",children:a}),l?(0,t.jsx)("div",{className:"ml-auto text-xs md:text-sm text-muted-foreground",children:l}):null]})}var j=e.i(8118);let w=["M","m","7","M7","m7","sus4","dim"],k=["6","m6","9","m9","11","M11","13","M13"],N=["7b5","7#5","7b9","7#9","7#11","7b13","7alt"],I=["dim7","m7b5"],S=["sus2","add9","add11","add13","6/9"],C=["aug","mM7"],V=[...k,...N,...I,...S,...C,"/bass"],E=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"];var A=e.i(7442);let P=e=>{let{title:a="Advanced — Pro",children:n}=e,{upgrade:l}=(0,A.usePro)();return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"pointer-events-none opacity-50",children:n}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white/60 backdrop-blur-sm rounded",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsxs)("div",{className:"text-sm font-medium",children:["🔒 ",a]}),(0,t.jsx)("button",{className:"px-3 py-1 rounded bg-[var(--brand-primary)] text-white",onClick:l,children:"Upgrade to Pro"})]})})]})};function M(e){let{open:a,onClose:n,title:l="Go Pro to unlock Advanced chords",body:r="Advanced chord qualities (aug, add9, tensions, and slash chords) are available in Pro."}=e,{upgrade:i}=(0,A.usePro)();return a?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,t.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:l}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:r}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)("button",{className:"px-3 py-1.5 rounded border",onClick:n,children:"Maybe later"}),(0,t.jsx)("button",{className:"px-3 py-1.5 rounded bg-[var(--brand-primary)] text-white",onClick:i,children:"Upgrade to Pro"})]})]})}):null}let T=e=>e.startsWith("M")||"M"===e?"major":e.startsWith("m")?"minor":"7"===e||/^7/.test(e)||["9","11","13"].includes(e)?"dominant":e.startsWith("dim")||"m7b5"===e?"diminished":"aug"===e?"augmented":"unknown",R=(e,t)=>{let a=(e=>["M9","M11","M13","6"].includes(e)?"major":["m6","m9"].includes(e)?"minor":["7b5","7#5","7b9","7#9","7#11","7b13","7alt","9","11","13"].includes(e)?"dominant":["dim7","m7b5"].includes(e)?"diminished":(["add9","add11","add13","sus2","6/9"].includes(e),"any"))(t);return"any"===a||"unknown"===e||!("major"===e&&"minor"===a||"minor"===e&&"major"===a||"dominant"!==e&&["7b5","7#5","7b9","7#9","7#11","7b13","7alt","9","11","13"].includes(t)||"diminished"!==e&&["dim7","m7b5"].includes(t))};var _=e.i(49204);let L=[{id:"doo-wop",name:"Doo‑Wop (I–vi–IV–V)",mode:"major",seq:["I","vi","IV","V"],summary:"50s/60s loop: I→vi→IV→V back to I."},{id:"axis",name:"Axis (I–V–vi–IV)",mode:"major",seq:["I","V","vi","IV"],summary:"Modern pop four‑chords loop."},{id:"canon",name:"Pachelbel's Canon",mode:"major",seq:["I","V","vi","iii","IV","I","IV","V"],variants:[["I","V","vi","IV"]],summary:"Pachelbel‑style ground; long loop back to I."},{id:"ii-V-I",name:"ii–V–I",mode:"any",seq:["ii","V","I"],summary:"The classic resolution run‑up."},{id:"turnaround",name:"Turnaround (I–vi–ii–V)",mode:"any",seq:["I","vi","ii","V"],summary:"Quick loop returning to the top."},{id:"andalusian",name:"Andalusian (i–VII–VI–V)",mode:"minor",seq:["i","VII","VI","V"],summary:"Classic minor descent; flamenco/Latin flavor."},{id:"authentic",name:"Authentic cadence (V–I)",mode:"any",seq:["V","I"],summary:"Perfect cadence V→I."},{id:"plagal",name:"Plagal cadence (IV–I)",mode:"any",seq:["IV","I"],summary:"Gentle IV→I resolution."},{id:"deceptive",name:"Deceptive cadence (V–vi)",mode:"major",seq:["V","vi"],summary:"Deceptive V→vi keeps motion going."}],D={dooWop:"Doo‑Wop (I–VI–IV–V)",axis:"Axis (I–V–vi–IV)",canon:"Canon (I–V–vi–iii–IV–I–IV–V)",twoFiveOne:"ii–V–I",turnaround:"Turnaround",andalusian:"Andalusian cadence",authentic:"Perfect cadence (V → I)",plagal:"Plagal cadence (IV → I)",deceptive:"Deceptive cadence (V → vi)"},z={dooWop:"’50s progression. Nostalgic loop: tonic → relative minor → subdominant → dominant. Try adding 7ths for color.",axis:"Modern pop staple. A catchy loop that feels forward yet stable. Swap to ii–V at the end for a stronger landing.",canon:"Pachelbel‑style ground. Persistent bass motion with rotating functions; great for variations and melodies.",twoFiveOne:"The classic run‑up then land. Link by guide tones (3rd↔7th). Works anywhere you want a clear resolution.",turnaround:"Short cycle that brings you back to the top (e.g., I–VI7–ii7–V7). Use at phrase ends or between sections.",andalusian:"Descending minor flavor (e.g., i–♭VII–♭VI–V). Adds drama; land clearly on the target chord.",authentic:"Strong homecoming: dominant pulls into tonic. Extend V with 7/9/13; keep the landing clean on I.",plagal:"Gentler IV → I resolution. Use to soften endings or after a bright Lydian moment.",deceptive:"Twist the expectation: V → vi instead of I. Keeps energy moving; return to I later for closure."};function F(e){return(e||"").toString().trim().toUpperCase().replace(/MAJ7|M7|7|MAJ|MIN|MI|DIM|AUG|SUS\d?|ADD\d+|Ø|O/g,"").replace(/\(|\)/g,"").replace(/[^IVB#]+/g,"").replace(/B/g,"B")}var B=e.i(26393);let O="ot_sketches",H=()=>JSON.parse(localStorage.getItem(O)||"[]"),q=e=>{let t=H().filter(t=>t.id!==e.id);return(t.unshift(e),t.length>3)?(localStorage.setItem(O,JSON.stringify(t.slice(0,3))),{ok:!1,reason:"limit_exceeded"}):(localStorage.setItem(O,JSON.stringify(t)),{ok:!0})},U=async e=>({ok:!0});var W=e.i(9593),G=e.i(68834);let K=()=>Math.random().toString(36).substr(2,9),J=(0,G.create)((e,t)=>({sketches:[],currentSketch:null,isLoading:!1,error:null,loadSketches:()=>{e({isLoading:!0,error:null});try{let t=H();e({sketches:t,isLoading:!1})}catch(t){e({error:"Failed to load sketches",isLoading:!1})}},saveSketch:async t=>{let a={...t,id:K(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(q(a).ok)return e({sketches:H(),currentSketch:a}),{ok:!0};try{await U(a);let t=H();return e({sketches:t,currentSketch:a}),{ok:!0}}catch(e){return{ok:!1,reason:"cloud_save_failed"}}},loadSketch:a=>{let n=t().sketches.find(e=>e.id===a);n&&e({currentSketch:n})},deleteSketch:a=>{var n;let l=t().sketches.filter(e=>e.id!==a);localStorage.setItem("ot_sketches",JSON.stringify(l)),e({sketches:l}),(null==(n=t().currentSketch)?void 0:n.id)===a&&e({currentSketch:null})},duplicateSketch:a=>{let n=t().sketches.find(e=>e.id===a);if(n){let t={...n,id:K(),name:"".concat(n.name," Copy"),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};q(t).ok&&e({sketches:H(),currentSketch:t})}},renameSketch:(a,n)=>{var l;let r=t().sketches.map(e=>e.id===a?{...e,name:n,updatedAt:new Date().toISOString()}:e);localStorage.setItem("ot_sketches",JSON.stringify(r)),e({sketches:r}),(null==(l=t().currentSketch)?void 0:l.id)===a&&e({currentSketch:{...t().currentSketch,name:n,updatedAt:new Date().toISOString()}})},startAutoSave:a=>setTimeout(()=>{var n;if((null==(n=t().currentSketch)?void 0:n.id)===a.id){let t={...a,updatedAt:new Date().toISOString()};q(t).ok&&e({sketches:H(),currentSketch:t})}},3e3),stopAutoSave:()=>{}}));var $=e.i(47167);let Y=(()=>{let e=0;return()=>(e+=1,"u".concat("0000".concat((1679616*Math.random()|0).toString(36)).slice(-4)).concat(e))})();function Q(e){let t=[];for(let a=0,n=e.length;a<n;a++)t.push(e[a]);return t}let X=null;function Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return X||(X=e.includeStyleProperties?e.includeStyleProperties:Q(window.getComputedStyle(document.documentElement)))}function ee(e,t){let a=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return a?parseFloat(a.replace("px","")):0}function et(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{width:t.width||function(e){let t=ee(e,"border-left-width"),a=ee(e,"border-right-width");return e.clientWidth+t+a}(e),height:t.height||function(e){let t=ee(e,"border-top-width"),a=ee(e,"border-bottom-width");return e.clientHeight+t+a}(e)}}function ea(e){return new Promise((t,a)=>{let n=new Image;n.onload=()=>{n.decode().then(()=>{requestAnimationFrame(()=>t(n))})},n.onerror=a,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function en(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(e=>"data:image/svg+xml;charset=utf-8,".concat(e))}async function el(e,t,a){let n="http://www.w3.org/2000/svg",l=document.createElementNS(n,"svg"),r=document.createElementNS(n,"foreignObject");return l.setAttribute("width","".concat(t)),l.setAttribute("height","".concat(a)),l.setAttribute("viewBox","0 0 ".concat(t," ").concat(a)),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("externalResourcesRequired","true"),l.appendChild(r),r.appendChild(e),en(l)}let er=(e,t)=>{if(e instanceof t)return!0;let a=Object.getPrototypeOf(e);return null!==a&&(a.constructor.name===t.name||er(a,t))};function ei(e,t,a,n){let l=window.getComputedStyle(e,a),r=l.getPropertyValue("content");if(""===r||"none"===r)return;let i=Y();try{t.className="".concat(t.className," ").concat(i)}catch(e){return}let s=document.createElement("style");s.appendChild(function(e,t,a,n){let l=".".concat(e,":").concat(t),r=a.cssText?function(e){let t=e.getPropertyValue("content");return"".concat(e.cssText," content: '").concat(t.replace(/'|"/g,""),"';")}(a):Z(n).map(e=>{let t=a.getPropertyValue(e),n=a.getPropertyPriority(e);return"".concat(e,": ").concat(t).concat(n?" !important":"",";")}).join(" ");return document.createTextNode("".concat(l,"{").concat(r,"}"))}(i,a,l,n)),t.appendChild(s)}let es="application/font-woff",eo="image/jpeg",ec={woff:es,woff2:es,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:eo,jpeg:eo,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function ed(e){return ec[(function(e){let t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""})(e).toLowerCase()]||""}function eu(e){return -1!==e.search(/^(data:)/)}function em(e,t){return"data:".concat(t,";base64,").concat(e)}async function eh(e,t,a){let n=await fetch(e,t);if(404===n.status)throw Error('Resource "'.concat(n.url,'" not found'));let l=await n.blob();return new Promise((e,t)=>{let r=new FileReader;r.onerror=t,r.onloadend=()=>{try{e(a({res:n,result:r.result}))}catch(e){t(e)}},r.readAsDataURL(l)})}let ep={};async function eg(e,t,a){var n,l,r;let i,s,o=(n=e,l=t,r=a.includeQueryParams,s=n.replace(/\?.*/,""),r&&(s=n),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),l?"[".concat(l,"]").concat(s):s);if(null!=ep[o])return ep[o];a.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());try{let n=await eh(e,a.fetchRequestInit,e=>{let{res:a,result:n}=e;return t||(t=a.headers.get("Content-Type")||""),n.split(/,/)[1]});i=em(n,t)}catch(n){i=a.imagePlaceholder||"";let t="Failed to fetch resource: ".concat(e);n&&(t="string"==typeof n?n:n.message),t&&console.warn(t)}return ep[o]=i,i}async function ex(e){let t=e.toDataURL();return"data:,"===t?e.cloneNode(!1):ea(t)}async function ef(e,t){if(e.currentSrc){let t=document.createElement("canvas"),a=t.getContext("2d");return t.width=e.clientWidth,t.height=e.clientHeight,null==a||a.drawImage(e,0,0,t.width,t.height),ea(t.toDataURL())}let a=e.poster,n=ed(a);return ea(await eg(a,n,t))}async function eb(e,t){var a;try{if(null==(a=null==e?void 0:e.contentDocument)?void 0:a.body)return await ek(e.contentDocument.body,t,!0)}catch(e){}return e.cloneNode(!1)}async function ev(e,t){return er(e,HTMLCanvasElement)?ex(e):er(e,HTMLVideoElement)?ef(e,t):er(e,HTMLIFrameElement)?eb(e,t):e.cloneNode(ey(e))}let ey=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();async function ej(e,t,a){var n,l;if(ey(t))return t;let r=[];return 0===(r=null!=e.tagName&&"SLOT"===e.tagName.toUpperCase()&&e.assignedNodes?Q(e.assignedNodes()):er(e,HTMLIFrameElement)&&(null==(n=e.contentDocument)?void 0:n.body)?Q(e.contentDocument.body.childNodes):Q((null!=(l=e.shadowRoot)?l:e).childNodes)).length||er(e,HTMLVideoElement)||await r.reduce((e,n)=>e.then(()=>ek(n,a)).then(e=>{e&&t.appendChild(e)}),Promise.resolve()),t}async function ew(e,t){let a=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===a.length)return e;let n={};for(let l=0;l<a.length;l++){let r=a[l].getAttribute("xlink:href");if(r){let a=e.querySelector(r),l=document.querySelector(r);a||!l||n[r]||(n[r]=await ek(l,t,!0))}}let l=Object.values(n);if(l.length){let t="http://www.w3.org/1999/xhtml",a=document.createElementNS(t,"svg");a.setAttribute("xmlns",t),a.style.position="absolute",a.style.width="0",a.style.height="0",a.style.overflow="hidden",a.style.display="none";let n=document.createElementNS(t,"defs");a.appendChild(n);for(let e=0;e<l.length;e++)n.appendChild(l[e]);e.appendChild(a)}return e}async function ek(e,t,a){return a||!t.filter||t.filter(e)?Promise.resolve(e).then(e=>ev(e,t)).then(a=>ej(e,a,t)).then(a=>(function(e,t,a){if(er(t,Element)&&(!function(e,t,a){let n=t.style;if(!n)return;let l=window.getComputedStyle(e);l.cssText?(n.cssText=l.cssText,n.transformOrigin=l.transformOrigin):Z(a).forEach(a=>{let r=l.getPropertyValue(a);if("font-size"===a&&r.endsWith("px")){let e=Math.floor(parseFloat(r.substring(0,r.length-2)))-.1;r="".concat(e,"px")}er(e,HTMLIFrameElement)&&"display"===a&&"inline"===r&&(r="block"),"d"===a&&t.getAttribute("d")&&(r="path(".concat(t.getAttribute("d"),")")),n.setProperty(a,r,l.getPropertyPriority(a))})}(e,t,a),ei(e,t,":before",a),ei(e,t,":after",a),er(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),er(e,HTMLInputElement)&&t.setAttribute("value",e.value),er(e,HTMLSelectElement))){let a=Array.from(t.children).find(t=>e.value===t.getAttribute("value"));a&&a.setAttribute("selected","")}return t})(e,a,t)).then(e=>ew(e,t)):null}let eN=/url\((['"]?)([^'"]+?)\1\)/g,eI=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,eS=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function eC(e,t,a,n,l){try{let r,i=a?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;let a=document.implementation.createHTMLDocument(),n=a.createElement("base"),l=a.createElement("a");return a.head.appendChild(n),a.body.appendChild(l),t&&(n.href=t),l.href=e,l.href}(t,a):t,s=ed(t);if(l){let e=await l(i);r=em(e,s)}else r=await eg(i,s,n);return e.replace(function(e){let t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return RegExp("(url\\(['\"]?)(".concat(t,")(['\"]?\\))"),"g")}(t),"$1".concat(r,"$3"))}catch(e){}return e}function eV(e){return -1!==e.search(eN)}async function eE(e,t,a){if(!eV(e))return e;let n=function(e,t){let{preferredFontFormat:a}=t;return a?e.replace(eS,e=>{for(;;){let[t,,n]=eI.exec(e)||[];if(!n)return"";if(n===a)return"src: ".concat(t,";")}}):e}(e,a);return(function(e){let t=[];return e.replace(eN,(e,a,n)=>(t.push(n),e)),t.filter(e=>!eu(e))})(n).reduce((e,n)=>e.then(e=>eC(e,n,t,a)),Promise.resolve(n))}async function eA(e,t,a){var n;let l=null==(n=t.style)?void 0:n.getPropertyValue(e);if(l){let n=await eE(l,null,a);return t.style.setProperty(e,n,t.style.getPropertyPriority(e)),!0}return!1}async function eP(e,t){await eA("background",e,t)||await eA("background-image",e,t),await eA("mask",e,t)||await eA("-webkit-mask",e,t)||await eA("mask-image",e,t)||await eA("-webkit-mask-image",e,t)}async function eM(e,t){let a=er(e,HTMLImageElement);if(!(a&&!eu(e.src))&&!(er(e,SVGImageElement)&&!eu(e.href.baseVal)))return;let n=a?e.src:e.href.baseVal,l=await eg(n,ed(n),t);await new Promise((n,r)=>{e.onload=n,e.onerror=t.onImageErrorHandler?function(){for(var e=arguments.length,a=Array(e),l=0;l<e;l++)a[l]=arguments[l];try{n(t.onImageErrorHandler(...a))}catch(e){r(e)}}:r,e.decode&&(e.decode=n),"lazy"===e.loading&&(e.loading="eager"),a?(e.srcset="",e.src=l):e.href.baseVal=l})}async function eT(e,t){let a=Q(e.childNodes).map(e=>eR(e,t));await Promise.all(a).then(()=>e)}async function eR(e,t){er(e,Element)&&(await eP(e,t),await eM(e,t),await eT(e,t))}let e_={};async function eL(e){let t=e_[e];if(null!=t)return t;let a=await fetch(e);return t={url:e,cssText:await a.text()},e_[e]=t,t}async function eD(e,t){let a=e.cssText,n=/url\(["']?([^"')]+)["']?\)/g;return Promise.all((a.match(/url\([^)]+\)/g)||[]).map(async l=>{let r=l.replace(n,"$1");return r.startsWith("https://")||(r=new URL(r,e.url).href),eh(r,t.fetchRequestInit,e=>{let{result:t}=e;return a=a.replace(l,"url(".concat(t,")")),[l,t]})})).then(()=>a)}function ez(e){if(null==e)return[];let t=[],a=e.replace(/(\/\*[\s\S]*?\*\/)/gi,""),n=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){let e=n.exec(a);if(null===e)break;t.push(e[0])}a=a.replace(n,"");let l=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,r=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=l.exec(a);if(null===e){if(null===(e=r.exec(a)))break;l.lastIndex=r.lastIndex}else r.lastIndex=l.lastIndex;t.push(e[0])}return t}async function eF(e,t){let a=[],n=[];return e.forEach(a=>{if("cssRules"in a)try{Q(a.cssRules||[]).forEach((e,l)=>{if(e.type===CSSRule.IMPORT_RULE){let r=l+1,i=e.href,s=eL(i).then(e=>eD(e,t)).then(e=>ez(e).forEach(e=>{try{a.insertRule(e,e.startsWith("@import")?r+=1:a.cssRules.length)}catch(t){console.error("Error inserting rule from remote css",{rule:e,error:t})}})).catch(e=>{console.error("Error loading remote css",e.toString())});n.push(s)}})}catch(r){let l=e.find(e=>null==e.href)||document.styleSheets[0];null!=a.href&&n.push(eL(a.href).then(e=>eD(e,t)).then(e=>ez(e).forEach(e=>{l.insertRule(e,l.cssRules.length)})).catch(e=>{console.error("Error loading remote stylesheet",e)})),console.error("Error inlining remote css file",r)}}),Promise.all(n).then(()=>(e.forEach(e=>{if("cssRules"in e)try{Q(e.cssRules||[]).forEach(e=>{a.push(e)})}catch(t){console.error("Error while reading CSS rules from ".concat(e.href),t)}}),a))}async function eB(e,t){if(null==e.ownerDocument)throw Error("Provided element is not within a Document");let a=Q(e.ownerDocument.styleSheets);return(await eF(a,t)).filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>eV(e.style.getPropertyValue("src")))}function eO(e){return e.trim().replace(/["']/g,"")}async function eH(e,t){let a=await eB(e,t),n=function(e){let t=new Set;return!function e(a){(a.style.fontFamily||getComputedStyle(a).fontFamily).split(",").forEach(e=>{t.add(eO(e))}),Array.from(a.children).forEach(t=>{t instanceof HTMLElement&&e(t)})}(e),t}(e);return(await Promise.all(a.filter(e=>n.has(eO(e.style.fontFamily))).map(e=>{let a=e.parentStyleSheet?e.parentStyleSheet.href:null;return eE(e.cssText,a,t)}))).join("\n")}async function eq(e,t){let a=null!=t.fontEmbedCSS?t.fontEmbedCSS:t.skipFonts?null:await eH(e,t);if(a){let t=document.createElement("style"),n=document.createTextNode(a);t.appendChild(n),e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}}async function eU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{width:a,height:n}=et(e,t),l=await ek(e,t,!0);return await eq(l,t),await eR(l,t),!function(e,t){let{style:a}=e;t.backgroundColor&&(a.backgroundColor=t.backgroundColor),t.width&&(a.width="".concat(t.width,"px")),t.height&&(a.height="".concat(t.height,"px"));let n=t.style;null!=n&&Object.keys(n).forEach(e=>{a[e]=n[e]})}(l,t),await el(l,a,n)}async function eW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{width:a,height:n}=et(e,t),l=await eU(e,t),r=await ea(l),i=document.createElement("canvas"),s=i.getContext("2d"),o=t.pixelRatio||function(){let e,t;try{t=$.default}catch(e){}let a=t&&t.env?t.env.devicePixelRatio:null;return a&&Number.isNaN(e=parseInt(a,10))&&(e=1),e||window.devicePixelRatio||1}(),c=t.canvasWidth||a,d=t.canvasHeight||n;return i.width=c*o,i.height=d*o,!t.skipAutoScale&&(i.width>16384||i.height>16384)&&(i.width>16384&&i.height>16384?i.width>i.height?(i.height*=16384/i.width,i.width=16384):(i.width*=16384/i.height,i.height=16384):i.width>16384?(i.height*=16384/i.width,i.width=16384):(i.width*=16384/i.height,i.height=16384)),i.style.width="".concat(c),i.style.height="".concat(d),t.backgroundColor&&(s.fillStyle=t.backgroundColor,s.fillRect(0,0,i.width,i.height)),s.drawImage(r,0,0,i.width,i.height),i}async function eG(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await eW(e,t)).toDataURL()}let eK=!1;async function eJ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto";if(!eK){eK=!0;try{let a=e.style.opacity,n=e.style.visibility;e.style.opacity="1",e.style.visibility="visible";let l=e.querySelectorAll("*"),r=[];l.forEach(e=>{let t=e.style.color,a=e.style.fill,n=e.style.background;if(r.push({elem:e,color:t,fill:a,bg:n}),e.style.color="#000000",("text"===e.tagName||"tspan"===e.tagName)&&(e.style.fill="#000000"),"SPAN"===e.tagName&&e.className.includes("inline-block")){var l;let t=null==(l=e.textContent)?void 0:l.trim();t&&/^\d+$/.test(t)&&(e.style.background="#f3f4f6",e.style.color="#000000")}}),await new Promise(e=>setTimeout(e,150)),e.dataset.export=t;let i=await eG(e,{pixelRatio:2,backgroundColor:"#ffffff",cacheBust:!0});e.style.opacity=a,e.style.visibility=n,r.forEach(e=>{let{elem:t,color:a,fill:n,bg:l}=e;t.style.color=a,t.style.fill=n,t.style.background=l});let s=document.createElement("a");s.href=i,s.download="ot-progression.png",s.click(),W.track("export_png",{page:"chord_progression",ok:!0})}catch(e){W.track("export_png",{page:"chord_progression",ok:!1,err:String(e)})}finally{e.removeAttribute("data-export"),eK=!1}}}var e$=e.i(9976),eY=e.i(41749);let eQ={info:"bg-blue-600",success:"bg-green-600",warning:"bg-orange-600"};function eX(e){let{message:n,type:l="info",ctaText:r,ctaHref:i,ctaPlace:s,onClose:o,duration:c=5e3}=e,{trackClick:d}=(0,eY.useCtaTracking)();(0,a.useEffect)(()=>{if(c>0){let e=setTimeout(o,c);return()=>clearTimeout(e)}},[c,o]);let u=(0,a.useCallback)(()=>{s&&d(s)},[s,d]),m=eQ[l];return(0,t.jsx)("div",{className:"fixed bottom-20 sm:bottom-6 left-1/2 -translate-x-1/2 z-50 animate-slide-up max-w-md w-full mx-4",role:"alert","aria-live":"polite",children:(0,t.jsxs)("div",{className:"".concat(m," text-white rounded-lg shadow-2xl p-4 flex items-center justify-between gap-3"),children:[(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("p",{className:"text-sm font-medium",children:n})}),r&&i&&(0,t.jsx)("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 px-3 py-1.5 text-sm font-medium bg-white/20 hover:bg-white/30 rounded transition-colors",onClick:u,children:r}),(0,t.jsx)("button",{onClick:o,className:"flex-shrink-0 w-6 h-6 flex items-center justify-center hover:bg-white/20 rounded transition-colors","aria-label":"Close notification",children:"✕"})]})})}var eZ=e.i(60158),e0=e.i(18566);function e1(){let e=(0,eZ.useCtaMessages)(),u=(0,e0.usePathname)().startsWith("/ja"),m=(0,a.useRef)(null);(0,l.useRovingTabs)(m,{orientation:"horizontal"});let h=(0,a.useRef)(null);(0,l.useRovingTabs)(h,{orientation:"horizontal"});let p=(0,a.useRef)(null);(0,l.useRovingTabs)(p,{orientation:"horizontal"});let g=(0,a.useRef)(null),O=(0,a.useRef)(null),[H,G]=(0,a.useState)(()=>{let e=Array(12).fill("");return e[0]="C",e[1]="Am",e[2]="F",e[3]="G",e}),K=(0,a.useMemo)(()=>H.reduce((e,t,a)=>(t&&e.push(a),e),[]),[H]),$=(0,a.useMemo)(()=>K.map(e=>H[e]),[K,H]),Y=(0,a.useMemo)(()=>{let e=H.findIndex(e=>!e);return -1===e?11:e},[H]),[Q,X]=(0,a.useState)(0);(0,a.useEffect)(()=>{X(Y)},[Y]);let Z=(0,a.useMemo)(()=>["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],[]);(0,a.useMemo)(()=>[{label:"M",value:""},{label:"M7",value:"maj7"},{label:"7",value:"7"},{label:"6",value:"6"},{label:"add9",value:"add9"},{label:"sus4",value:"sus4"},{label:"sus2",value:"sus2"},{label:"m",value:"m"},{label:"m7",value:"m7"},{label:"dim",value:"dim"},{label:"m7b5",value:"m7b5"},{label:"aug",value:"aug"}],[]);let[ee,et]=(0,a.useState)("C"),[ea,en]=(0,a.useState)("M"),[el,er]=(0,a.useState)([]);(0,a.useMemo)(()=>[{label:"sus2",value:"sus2"},{label:"sus4",value:"sus4"},{label:"add9",value:"add9"},{label:"add11",value:"add11"},{label:"add13",value:"add13"}],[]);let[ei,es]=(0,a.useState)([]),[eo,ec]=(0,a.useState)(""),[ed,eu]=(0,a.useState)(null),[em,eh]=(0,a.useState)([]),[ep,eg]=(0,a.useState)([]),[ex,ef]=(0,a.useState)(null),[eb,ev]=(0,a.useState)([]),{keyCandidates:ey,selectedKey:ej,analyze:ew,selectKey:ek,scaleCandidates:eN,selectedScale:eI,selectScale:eS,reset:eC}=(0,f.useAnalysisStore)(),[eV,eE]=(0,a.useState)("degrees"),[eA,eP]=(0,a.useState)(null),[eM,eT]=(0,a.useState)(null),[eR,e_]=(0,a.useState)(null),[eL,eD]=(0,a.useState)(null),ez=(0,a.useCallback)(()=>{e_(null),eD(null)},[]),eF=(0,a.useMemo)(()=>{let e=null==eI?void 0:eI.type,t=e?o.SCALE_INTERVALS[e]:null;return!t||7===t.length},[null==eI?void 0:eI.type]);(0,a.useEffect)(()=>{eF||"degrees"===eV||eE("degrees")},[eF]);let[eB,eO]=(0,a.useState)(null),eH=(0,a.useRef)(null),eq=(0,a.useRef)(null),eU=(0,a.useRef)(null),eW=(0,a.useRef)(null),[eG,eK]=(0,a.useState)(null),eY=(0,a.useRef)(null);(0,a.useRef)(null);let[eQ,e1]=(0,a.useState)(!1),[e7,e5]=(0,a.useState)(120),e3=(0,a.useRef)(null),[e6,e8]=(0,a.useState)(-1),e9=(0,a.useCallback)((e,t)=>{G(a=>{if(e===t)return a;let n=a.slice(),l=n[e];return n[e]=n[t],n[t]=l,n})},[]),[te,tt]=(0,a.useState)(null),ta=(0,a.useCallback)((e,t)=>{if(!H[t])return;e.stopPropagation();let a=e.touches[0];eY.current={index:t,startX:a.clientX,startY:a.clientY},eK(t),tt(null)},[H]),tn=(0,a.useCallback)((e,t)=>{if(null===eY.current||null===eG)return;let a=e.touches[0],n=document.elementFromPoint(a.clientX,a.clientY);for(;n&&!n.hasAttribute("data-slot-index");)n=n.parentElement;if(n){let e=parseInt(n.getAttribute("data-slot-index")||"-1");e>=0&&e!==eG&&tt(e)}},[eG]),tl=(0,a.useCallback)(e=>{null!==eY.current&&null!==eG&&null!==te&&eG!==te&&e9(eG,te),eY.current=null,eK(null),tt(null)},[eG,te,e9]),tr=(0,a.useRef)(!1),ti=(0,a.useCallback)(()=>{tr.current=!1,e3.current&&(clearInterval(e3.current),e3.current=null),e1(!1),e8(-1)},[]),ts=(0,a.useCallback)(async()=>{let e=H.map((e,t)=>({chord:e,index:t})).filter(e=>e.chord);if(0===e.length)return;ti(),await B.player.resume(),tr.current=!0,e1(!0),e8(0);let t=60/e7*1e3;for(let e=0;e<4;e++){if(!tr.current||(await new Promise(e=>setTimeout(e,t)),!tr.current))return;B.player.playNote(84,100)}let a=0,n=0,l=async()=>{if(!tr.current){e3.current&&(clearInterval(e3.current),e3.current=null);return}if(n%4==0){a>=e.length&&(a=0);let{chord:t,index:n}=e[a];e8(n),await at(t),a++}else if(a>0&&a<=e.length){let{chord:t}=e[a-1];await at(t)}n++};tr.current&&(await l(),tr.current&&(e3.current=setInterval(l,t),(0,W.track)("progression_play",{page:"chord_progression",bpm:e7,chordCount:e.length})))},[H,e7,ti]),to=(0,a.useCallback)(()=>{eQ?ti():ts()},[eQ,ts,ti]);(0,a.useEffect)(()=>()=>{e3.current&&clearInterval(e3.current)},[]),(0,a.useEffect)(()=>{eQ&&ti()},[H]);let tc=(0,a.useCallback)(e=>{G(t=>{let a=t.slice();return a[e]="",a})},[]),{isPro:td}=(0,A.usePro)(),{sketch:tu,setSketch:tm}=(e=>{let[t,n]=(0,a.useState)(null),l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{l.current&&window.clearTimeout(l.current),l.current=window.setTimeout(()=>{t&&(async()=>{let a=e?await U(t):q(t);a.ok||"limit_exceeded"!==a.reason?W.track("save_project",{page:"chord_progression"}):W.track("project_limit_warn",{page:"chord_progression"})})()},3e3)},[t]),{sketch:t,setSketch:n}})(td),th=(0,a.useRef)(null),{sketches:tp,loadSketches:tg,deleteSketch:tx,saveSketch:tf}=J(),[tb,tv]=(0,a.useState)(!1),[ty,tj]=(0,a.useState)(null),tw=(0,a.useRef)(null),[tk,tN]=(0,a.useState)(""),[tI,tS]=(0,a.useState)(!1),[tC,tV]=(0,a.useState)("C"),tE=(0,a.useRef)(null);(0,a.useEffect)(()=>{tb&&tg()},[tb,tg]),(0,a.useEffect)(()=>{let e=e=>{if(!tb)return;let t=tw.current;t&&!t.contains(e.target)&&tv(!1)},t=e=>{"Escape"===e.key&&tv(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[tb]),(0,a.useEffect)(()=>{if(!tI)return;let e=e=>{let t=tE.current;t&&!t.contains(e.target)&&tS(!1)},t=e=>{"Escape"===e.key&&tS(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[tI]);let[tA,tP]=(0,a.useState)(!1),[tM,tT]=(0,a.useState)(""),tR=(0,a.useMemo)(()=>$.length?$.join(" "):"Untitled ".concat(new Date().toLocaleString()),[$]),[t_,tL]=(0,a.useState)(null),tD=(0,a.useRef)(new Set);(0,a.useEffect)(()=>{let t=H.filter(e=>""!==e).length;9!==t||tD.current.has("limit_warn")?12!==t||tD.current.has("limit_block")||(tL({message:e.toast.limitBlock,type:"warning",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,W.trackToast)("limit_block",{page:"chord_progression",chordCount:t}),tD.current.add("limit_block")):(tL({message:e.toast.limitWarn,type:"info",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,W.trackToast)("limit_warn",{page:"chord_progression",chordCount:t}),tD.current.add("limit_warn"))},[H]);let[tz,tF]=(0,a.useState)(""),tB=async t=>{try{if(!O.current)return;tF(t.name||"Untitled Sketch"),await new Promise(e=>setTimeout(e,50));let a=O.current;a.style.opacity="1",a.style.visibility="visible",await new Promise(e=>setTimeout(e,200)),await eJ(a,"auto"),a.style.opacity="0.0001",a.style.visibility="hidden",tF(""),(0,W.track)("export_png",{page:"chord_progression",source:"sketch",id:t.id}),tD.current.has("png_export")||(tL({message:e.toast.pngExport,type:"success",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"png_toast"}),tD.current.add("png_export"))}catch(e){console.error("Export failed:",e),tF("")}},tO=async()=>{try{if(!td){let t=JSON.parse(localStorage.getItem("ot_sketches")||"[]");if(console.log("[DEBUG] doSaveSketch - isPro:",td,"existing sketches:",t.length),t.length>=3){console.log("[DEBUG] Blocking save - limit reached"),tP(!1),tT(""),tL({message:e.toast.sketchLimit,type:"warning",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,W.trackToast)("limit_block",{page:"chord_progression",context:"sketch_limit"});return}}console.log("[DEBUG] Proceeding with save");let t=ej?s.PC_NAMES[ej.tonic]:eB?eB.tonic:"C",a=(null==eI?void 0:eI.type)||(ej?ej.mode:"Ionian"),n={name:(tM.trim()||tR).slice(0,48),schema:"sketch_v1",appVersion:"3.0.0",key:{tonic:t,scaleId:String(a)},capo:{fret:0,note:"Shaped"},progression:{items:$.map((e,t)=>({id:e,degree:"",quality:""}))},fretboardView:{mode:"names"===eV?"Names":"Degrees",guide:!!eM}},l=await tf(n);(0,W.track)("save_project",{page:"chord_progression",ok:null==l?void 0:l.ok}),tP(!1),tT("")}catch(e){}},[tH,tq]=(0,a.useState)(!1),[tU,tW]=(0,a.useState)(!1),[tG,tK]=(0,a.useState)(!1),[tJ,t$]=(0,a.useTransition)(),[tY,tQ]=(0,a.useState)([]),[tX,tZ]=(0,a.useState)([]),[t0,t1]=(0,a.useState)(null),t2=(0,a.useRef)(null),t4=e=>{en(e),er(t=>t.filter(t=>R(T(e),t))),eo===ee&&ec("")},t7=e=>{if(!td)return void tW(!0);R(T(ea),e)&&er(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},t5=(e,t,a)=>{let n=(0,i.noteToPc)(a);if(void 0===n||n<0||n>11)return;let l=t.map(e=>(0,i.romanToChordSymbol)(e,n,"Major"));G(e=>{let t=[...e],a=t.findIndex(e=>!e);return -1===a&&(a=0),l.forEach((e,n)=>{t[(a+n)%12]=e}),t}),X(e=>{let t=[...H];l.forEach((e,a)=>{let n=t.findIndex(e=>!e);if(-1===n)return 0;t[(n+a)%12]=e});let a=t.findIndex(e=>!e);return -1===a?0:a}),(0,W.track)("preset_inserted",{page:"chord_progression",preset:e}),tS(!1)};(0,a.useEffect)(()=>{let e=ej||eB;if(!e)return;let t="number"==typeof e.tonic?s.PC_NAMES[e.tonic]:e.tonic,a="Major"===e.mode||"Minor"===e.mode?"Major"===e.mode?"major":"minor":e.mode;ev($.map(e=>x(e,t,a,{showQuality:!0,uppercase:!0})))},[ej,eB,$]),(0,a.useEffect)(()=>{if(!eB||0===eb.length)return void tQ([]);eB.mode,tQ(function(e,t){let a=e.map(F),n=[];for(let e of L){var l;for(let t of[e.seq,...null!=(l=e.variants)?l:[]].map(e=>e.map(F))){let l=t.length;for(let r=0;r+l<=a.length;r++){let i=!0;for(let e=0;e<l;e++)if(a[r+e]!==t[e]){i=!1;break}if(i){n.push({id:e.id,name:e.name,summary:e.tooltip,start:r,end:r+l});break}}}}return n.sort((e,t)=>t.end-t.start-(e.end-e.start)),function(e){let t=[];for(let a of e)t.some(e=>!(a.end<=e.start||e.end<=a.start))||t.push(a);return t}(n)}(eb,0))},[eb,eB]),(0,a.useEffect)(()=>{if(!eb||0===eb.length)return void tZ([]);let e=eb.map(e=>{var t,a;let n=e.replace(/\s+/g,"").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);if(!n)return e.toUpperCase();let l=null!=(t=n[1])?t:"",r=(null!=(a=n[2])?a:"").toUpperCase();return"".concat(l).concat(r)}),t=null;try{t=i.detectCadence(e)}catch(e){}let a=(Array.isArray(t)?t:t?[t]:[]).map(e=>{var t,a;return"string"==typeof e?{type:e}:{type:null!=(t=null==e?void 0:e.type)?t:e,tail:null!=(a=null==e?void 0:e.tailRoman)?a:(null==e?void 0:e.pair)?{from:e.pair[0],to:e.pair[1]}:void 0}});if(e.length>=2){let t=e[e.length-1],n=e[0];a.some(e=>"perfect"===e.type)||"V"!==t||"I"!==n||a.push({type:"perfect",tail:{from:"V",to:"I"}}),a.some(e=>"deceptive"===e.type)||"V"!==t||"VI"!==n||a.push({type:"deceptive",tail:{from:"V",to:"vi"}})}tZ(a)},[eb]);let t3=(0,a.useMemo)(()=>{if(!eb||0===eb.length)return null;let e=eb.map(e=>{var t,a;let n=e.replace(/\s+/g,"").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);if(!n)return e.toUpperCase();let l=null!=(t=n[1])?t:"",r=(null!=(a=n[2])?a:"").toUpperCase();return"".concat(l).concat(r)});if(e.length<2)return null;let t=e[0],a=e[e.length-1];return"V"===a&&"I"===t?{type:"perfect",tail:{from:"V",to:"I"}}:"V"===a&&"VI"===t?{type:"deceptive",tail:{from:"V",to:"vi"}}:"V"===a?{type:"half",tail:{from:void 0,to:"V"}}:null},[eb]);(0,a.useEffect)(()=>{let e=()=>{if(!eH.current||!eq.current||!eU.current)return;if(!(window.matchMedia&&window.matchMedia("(min-width: 1024px)").matches)){eq.current.style.minHeight="0px";return}let e=eq.current.style.minHeight;eq.current.style.minHeight="0px",eq.current.offsetHeight;let t=eH.current.getBoundingClientRect().top+window.scrollY,a=Math.max(0,Math.ceil(Math.max(eW.current?eW.current.getBoundingClientRect().bottom+window.scrollY:0,eU.current.getBoundingClientRect().top+window.scrollY)-t));Math.abs(a-parseFloat(e||"0"))>1&&(eq.current.style.minHeight="".concat(a,"px"))};requestAnimationFrame(e);let t=setTimeout(e,120),a=null,n=()=>{a&&clearTimeout(a),a=setTimeout(e,120)};window.addEventListener("resize",n),window.addEventListener("orientationchange",n),window.addEventListener("load",e);let l=null,r=null;if("undefined"!=typeof ResizeObserver&&eW.current){let t=null;(l=new ResizeObserver(()=>{t&&clearTimeout(t),t=setTimeout(e,100)})).observe(eW.current)}if("undefined"!=typeof ResizeObserver&&eU.current){let t=null;(r=new ResizeObserver(()=>{t&&clearTimeout(t),t=setTimeout(e,100)})).observe(eU.current)}return()=>{clearTimeout(t),a&&clearTimeout(a),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.removeEventListener("load",e),l&&l.disconnect(),r&&r.disconnect()}},[]),(0,a.useEffect)(()=>{eq.current&&window.matchMedia&&window.matchMedia("(min-width: 1024px)").matches&&requestAnimationFrame(()=>{let e=new Event("resize");window.dispatchEvent(e)})},[ed,tH,$.length]);let t6=("M"===ea?"".concat(ee):"".concat(ee).concat(ea))+(el.length?" ".concat(el.join(" ")):"")+(eo?"/".concat(eo):""),t8=async()=>{if(!ee)return;let e=s.PC_NAMES.indexOf(ee);if(e<0)return;let t=60+e,a=ea.toLowerCase(),n=e=>el.includes(e),l=[0,4,7];a.includes("m")&&!a.includes("maj")&&(l=[0,3,7]),a.includes("dim")&&(l=[0,3,6]),a.includes("maj7")||a.includes("mmaj7")?l=[...a.includes("m")?[0,3,7]:[0,4,7],11]:a.includes("7")&&(l=[0,4,7,10]),n("sus2")&&(l=[0,2,7]),n("sus4")&&(l=[0,5,7]);let r=l.map(e=>t+e%12);try{await B.player.resume(),B.player.playChord(r,"lightStrum",300)}catch(e){}};(0,a.useEffect)(()=>{try{let e=(th.current||(th.current=Math.random().toString(36).slice(2,10)),th.current),t=$.length?$.join(" ").slice(0,48):"Untitled ".concat(new Date().toLocaleString()),a=ej?s.PC_NAMES[ej.tonic]:eB?eB.tonic:"C",n=(null==eI?void 0:eI.type)||(ej?ej.mode:"Ionian");tm({id:e,name:t,createdAt:(null==tu?void 0:tu.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString(),schema:"sketch_v1",appVersion:"3.0.0",key:{tonic:a,scaleId:String(n)},capo:{fret:0,note:"Shaped"},progression:{items:$.map((e,t)=>({id:"".concat(t+1,"-").concat(e),degree:"",quality:""}))},fretboardView:{mode:"names"===eV?"Names":"Degrees",guide:!!eM}})}catch(e){}},[H,eV,eM,ej,eB,eI]);let[t9,ae]=(0,a.useState)(!1);(0,a.useEffect)(()=>{try{var e,t;let a="ontouchstart"in window||(null!=(t=null==(e=navigator)?void 0:e.maxTouchPoints)?t:0)>0;ae(!!a)}catch(e){ae(!1)}},[]);let at=async e=>{try{await B.player.resume();let t=(0,e$.chordToMidi)(e);t&&t.length>0&&B.player.playChord(t,"lightStrum",300)}catch(t){console.error("Failed to play chord:",e,t)}};return(0,t.jsxs)("main",{ref:g,className:"ot-page ot-stack","data-page":"find-key",children:[(0,t.jsxs)("section",{id:"progression",className:"ot-card prog-compact",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4 sm:gap-3 mb-1 sm:mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v,{className:"mb-0 text-left",children:"Build progression"}),(0,t.jsx)(b.default,{title:"Build Progression",text:u?"Choose Chordsからコードを選んでスロットに追加ボタンから追加してください。上部のプリセットからコード進行を選択して追加することもできます。":"Select chords from Choose Chords and add them using the slot add button. You can also select chord progressions from the presets at the top to add them."})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 relative",children:[(0,t.jsxs)("button",{type:"button",className:"btn-ghost btn-reset chip-pressable text-sm px-3 py-1 inline-flex items-center gap-1",title:"Reset progression",onClick:()=>{G(Array(12).fill("")),X(0),eC(),eh([]),eu(null),eT(null),eP(null),eE("degrees")},children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M12 5V2L7 7l5 5V9c2.76 0 5 2.24 5 5a5 5 0 1 1-5-5z"})}),(0,t.jsx)("span",{children:"Reset"})]}),(0,t.jsxs)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs border",title:"Show sketches",onClick:()=>tv(e=>!e),"aria-expanded":tb,children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h12v2H3v-2z"})}),"Sketches"]}),tb&&(0,t.jsx)("div",{ref:tw,className:"fixed right-4 top-20 z-[10000] w-[320px] max-h-[70vh] overflow-auto rounded-md border bg-white dark:bg-neutral-900 shadow-2xl p-2 space-y-2",children:0===tp.length?(0,t.jsx)("div",{className:"text-xs opacity-70 p-2",children:"No sketches yet"}):tp.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/10",children:[(0,t.jsx)("button",{className:"text-left text-sm flex-1 truncate",title:"".concat(e.name),onClick:()=>tj(e),children:e.name}),(0,t.jsx)("button",{className:"ot-btn-ghost text-xs",title:"Delete",onClick:t=>{t.stopPropagation(),tx(e.id),tg(),(0,W.track)("project_delete",{page:"chord_progression",id:e.id})},children:"🗑️"})]},e.id))}),(0,t.jsx)("div",{className:"w-4","aria-hidden":"true"}),(0,t.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",className:"chip-pressable text-sm px-3 py-1.5 inline-flex items-center gap-1.5 rounded-lg border",title:eQ?"Stop playback":"Play progression",onClick:to,disabled:0===$.length,style:{opacity:0===$.length?.5:1},children:eQ?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})}),(0,t.jsx)("span",{children:"Stop"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})}),(0,t.jsx)("span",{children:"Play"})]})}),(0,t.jsxs)("div",{className:"inline-flex items-center gap-1.5",children:[(0,t.jsx)("label",{htmlFor:"bpm-input",className:"text-xs opacity-70",children:"BPM:"}),(0,t.jsx)("input",{id:"bpm-input",type:"number",min:"40",max:"240",value:e7,onChange:e=>e5(Math.max(40,Math.min(240,parseInt(e.target.value)||120))),className:"w-16 px-2 py-1 text-sm rounded border bg-transparent",disabled:eQ})]})]}),(0,t.jsxs)("select",{className:"chip","aria-label":"Instrument",defaultValue:localStorage.getItem("ot-instrument")||"acoustic_guitar_steel",onChange:async e=>{let t=e.currentTarget.value;await B.player.setInstrument(t)},children:[(0,t.jsx)("option",{value:"acoustic_guitar_steel",children:"Acoustic Steel"}),(0,t.jsx)("option",{value:"acoustic_guitar_nylon",children:"Acoustic Nylon"}),(0,t.jsx)("option",{value:"electric_guitar_clean",children:"Electric Clean"}),(0,t.jsx)("option",{value:"distortion_guitar",children:"Distortion"}),(0,t.jsx)("option",{value:"overdriven_guitar",children:"Over Drive"}),(0,t.jsx)("option",{value:"electric_guitar_muted",children:"Muted"}),(0,t.jsx)("option",{value:"acoustic_grand_piano",children:"Piano"})]})]})]}),(0,t.jsx)("div",{className:"prog-slots mt-2 flex flex-wrap gap-1","aria-label":"Progression slots",children:Array.from({length:12}).map((e,a)=>{let n=!!H[a],l=a<8?0:(a-7)*.08,r="rgba(16,185,129,".concat(l.toFixed(2),")"),i=Q===a,s=e6===a&&eQ;return(0,t.jsxs)("div",{"data-slot-index":a,className:["inline-flex items-center justify-center rounded border text-xs select-none relative chip-pressable",n?"bg-black/5 dark:bg-white/10":"bg-transparent",i?"ring-2 ring-emerald-400/60":"",s?"ring-4 ring-blue-500/80 shadow-lg":"",eG===a?"opacity-50 scale-105":"",te===a?"ring-2 ring-blue-400":""].join(" "),style:{padding:"6px 10px",minWidth:72,minHeight:36,background:n?void 0:r,borderColor:"var(--line)",transition:"opacity 0.15s, transform 0.15s, box-shadow 0.15s",touchAction:n?"none":"auto"},onClick:()=>{n?at(H[a]):X(a)},draggable:n,onDragStart:()=>eK(a),onDragOver:e=>e.preventDefault(),onDrop:()=>{null!==eG&&(e9(eG,a),eK(null))},onTouchStart:e=>ta(e,a),onTouchMove:e=>tn(e,a),onTouchEnd:tl,children:[(0,t.jsx)("span",{className:"absolute left-1 top-1 text-[10px] opacity-70 select-none pointer-events-none",children:String(a+1)}),n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:H[a]}),(0,t.jsx)("button",{"aria-label":"Remove chord",className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-black/50 text-white text-[10px] leading-4 hover:bg-black/70",onClick:e=>{e.stopPropagation(),tc(a)},children:"×"})]}):null]},"slot-".concat(a))})})]}),(0,t.jsxs)("section",{id:"choose",ref:eW,className:"ot-card right-panel",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v,{className:"mb-0 text-left",children:"Choose chords"}),(0,t.jsx)(b.default,{title:"Choose Chords",text:u?"ルートとコードタイプを選んでください。追加ボタンでコード進行のスロットに追加できます。\nProプランの場合、より複雑なコードタイプを選ぶことができます。":"Select a root note and chord type. Use the Add button to add to chord progression slots.\nPro plan allows you to select more complex chord types."})]}),(0,t.jsxs)("button",{type:"button",className:"chip-pressable text-sm px-3 py-1 inline-flex items-center gap-1 rounded-lg border",title:"Load preset progression",onClick:()=>tS(!0),children:[(0,t.jsx)("span",{children:"📋"}),(0,t.jsx)("span",{children:"Presets"})]})]}),(0,t.jsxs)("div",{className:"mt-1 sm:mt-2 space-y-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-xs opacity-70 mb-0.5 flex items-center gap-1",children:["Root",(0,t.jsx)(b.default,{title:"Root",text:u?"コードの基準となる音で、コード名の元になります。Cコードのルート音は「C（ド）」。":'The fundamental note that serves as the basis of the chord and forms the root of the chord name. The root note of a C chord is "C".',icon:"graduation"})]}),(0,t.jsx)("div",{ref:m,className:"chips-row overflow-x-auto whitespace-nowrap",role:"tablist","aria-orientation":"horizontal","aria-label":"Select key",children:Z.map(e=>(0,t.jsx)("button",{role:"tab","aria-selected":ee===e,tabIndex:ee===e?0:-1,className:"chip ".concat(ee===e?"chip--active":""),onClick:()=>et(e),children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-xs opacity-70 mb-0.5 flex items-center gap-1",children:[u?"コードタイプ":"Quality",(0,t.jsx)(b.default,{title:u?"コードタイプ":"Quality",text:u?"コードの「音の雰囲気」を決める要素。メジャーは明るく元気、マイナーは暗くて切ない、M7はジャズっぽくオシャレな響きに。同じルート音でも全く違う印象になります。":'Defines the "mood" of a chord. Major sounds bright and happy, minor sounds sad and emotional, M7 sounds jazzy and sophisticated. Even with the same root note, the quality completely changes the character.',icon:"graduation"})]}),(0,t.jsx)("div",{className:"chips-row overflow-x-auto whitespace-nowrap",children:w.map(e=>(0,t.jsx)("button",{className:"chip ".concat(ea===e?"chip--active":""),onClick:()=>t4(e),children:e},"quick-".concat(e)))})]}),(0,t.jsxs)("div",{className:"mt-1",children:[(0,t.jsxs)("button",{"data-testid":"adv-toggle",className:"adv-toggle ".concat(tH?"is-open":""),onClick:()=>tq(e=>!e),"aria-expanded":tH,children:[(0,t.jsx)("span",{className:"caret","aria-hidden":!0}),(0,t.jsx)("span",{className:"spark","aria-hidden":!0,children:(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M12 2l1.9 4.6L18.5 8 13.9 9.4 12 14l-1.9-4.6L5.5 8l4.6-1.4L12 2zm6 9l.95 2.3L21 14l-2.05.7L18 17l-.95-2.3L15 14l2.05-.7L18 11zM5 12l.8 1.9L8 14l-2.2.8L5 17l-.8-2.2L2 14l2.2-.8L5 12z"})})}),(0,t.jsx)("span",{className:"label",children:"Advanced"})]}),td&&tH&&(0,t.jsxs)("div",{className:"mt-2 space-y-3",children:[(0,t.jsx)(e2,{title:"Extensions",children:k.map(e=>{let a=!R(T(ea),e),n=el.includes(e);return(0,t.jsx)(e4,{label:e,onClick:()=>t7(e),disabled:a,active:n},"adv-".concat(e))})}),(0,t.jsx)(e2,{title:"Altered Dominant",children:N.map(e=>{let a=!R(T(ea),e),n=el.includes(e);return(0,t.jsx)(e4,{label:e,onClick:()=>t7(e),disabled:a,active:n},"adv-".concat(e))})}),(0,t.jsx)(e2,{title:"Diminished / Variants",children:I.map(e=>{let a=!R(T(ea),e),n=el.includes(e);return(0,t.jsx)(e4,{label:e,onClick:()=>t7(e),disabled:a,active:n},"adv-".concat(e))})}),(0,t.jsx)(e2,{title:"Suspensions / Adds",children:S.map(e=>{let a=!R(T(ea),e),n=el.includes(e);return(0,t.jsx)(e4,{label:e,onClick:()=>t7(e),disabled:a,active:n},"adv-".concat(e))})}),(0,t.jsx)(e2,{title:"Aug / mM7",children:C.map(e=>{let a=ea===e;return(0,t.jsx)(e4,{label:e,onClick:()=>t4(e),active:a},"adv-".concat(e))})}),(0,t.jsx)(e2,{title:"Slash (On)",children:(0,t.jsx)("div",{className:"adv-grid",children:E.map(e=>(0,t.jsx)("button",{className:"chip ".concat(eo===e?"chip--active":""),onClick:()=>(e=>{if(!td)return void tW(!0);e===ee||e===eo?ec(""):ec(e)})(e),children:e},"bass-".concat(e)))})})]}),!td&&tH&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(P,{title:"Advanced — Pro (preview)",children:(0,t.jsxs)("div",{className:"space-y-3 grayscale opacity-40",children:[(0,t.jsx)(e2,{title:"Extensions",children:k.map(e=>(0,t.jsx)(e4,{label:e,disabled:!0},"adv-".concat(e)))}),(0,t.jsx)(e2,{title:"Altered Dominant",children:N.map(e=>(0,t.jsx)(e4,{label:e,disabled:!0},"adv-".concat(e)))}),(0,t.jsx)(e2,{title:"Diminished / Variants",children:I.map(e=>(0,t.jsx)(e4,{label:e,disabled:!0},"adv-".concat(e)))}),(0,t.jsx)(e2,{title:"Suspensions / Adds",children:S.map(e=>(0,t.jsx)(e4,{label:e,disabled:!0},"adv-".concat(e)))}),(0,t.jsx)(e2,{title:"Aug / mM7",children:C.map(e=>(0,t.jsx)(e4,{label:e,disabled:!0},"adv-".concat(e)))}),(0,t.jsx)(e2,{title:"Slash (On)",children:(0,t.jsx)("div",{className:"adv-grid",children:E.map(e=>(0,t.jsx)("button",{className:"chip chip--disabled",children:e},"bass-".concat(e)))})})]})})}),(0,t.jsx)(M,{open:tU,onClose:()=>tW(!1)}),(0,t.jsx)("div",{className:"preview-sticky mt-2 mb-[6px]",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsxs)("div",{className:"text-sm flex items-center gap-2",children:[(0,t.jsx)("span",{className:"opacity-70",children:"Preview:"}),(0,t.jsxs)("button",{type:"button",className:"preview-chord inline-flex items-center gap-1 px-2 py-1 rounded border border-emerald-400/60 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 hover:border-emerald-500 dark:text-emerald-100 dark:bg-emerald-900/40 dark:border-emerald-500/80 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300",title:"Click to preview chord",onClick:t8,children:[(0,t.jsx)("svg",{className:"h-6 w-6",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})}),t6||"-"]}),(0,t.jsx)("button",{className:"rounded-lg px-4 py-2 text-sm ml-1 border transition-all active:scale-[.98] active:translate-y-px focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300 ".concat(tG?"bg-emerald-100 border-emerald-300 text-emerald-900":"bg-emerald-500 border-emerald-600 text-white hover:bg-emerald-600"),onClick:()=>{t6&&(G(e=>{let t=e.slice();return t[Q]=t6,t}),er([]),ec(""),tK(!0),window.setTimeout(()=>tK(!1),600),X(e=>Math.min(11,e+1)))},"aria-live":"polite",children:tG?"Added ✓":"Add"})]}),(0,t.jsx)("button",{className:"w-full sm:w-auto sm:ml-auto mt-2 sm:mt-0 px-6 py-2 text-base min-w-0 sm:min-w-[220px] rounded-lg font-semibold text-white transition-transform active:scale-[.98] active:translate-y-px focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300 ".concat(tJ?"bg-rose-400/70 cursor-wait":"bg-rose-400 hover:bg-rose-500"),onClick:()=>{if($.map(e=>{let t=e.match(/^([A-G](?:#|b)?)(.*)$/);return{root:(null==t?void 0:t[1])||e,quality:(null==t?void 0:t[2])||""}}).some(e=>V.some(t=>e.quality.includes(t)))&&!td)return void window.alert("Advanced chords detected. Remove them or upgrade to Pro.");t$(()=>{eu((0,j.analyzeChordProgression)($));let e=(0,i.rankKeys)($);if(eh(e.slice(0,4)),e.length>0){let t="Major"===e[0].mode?"major":"minor",a={tonic:e[0].label.split(" ")[0],mode:t};eO(a),ev($.map(e=>x(e,a.tonic,a.mode,{showQuality:!0,uppercase:!0})))}else eg([]),eO(null),ev([]);ew($),setTimeout(()=>{let e=document.getElementById("result");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)})},disabled:tJ,"aria-busy":tJ,children:tJ?(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,t.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4z"})]}),"Analyzing…"]}):"Analyze"})]})})]})]})]}),(0,t.jsxs)("section",{id:"result",ref:eU,className:"ot-card",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(v,{className:"text-left mb-0",children:"Result"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:()=>tP(!0),title:"Save sketch",children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M17 3H5a2 2 0 0 0-2 2v14l4-4h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"})}),"Save"]})})]}),tA&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[10000]",role:"dialog","aria-modal":"true",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{tP(!1),tT("")}}),(0,t.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[420px]",children:[(0,t.jsx)("div",{className:"text-base font-semibold mb-2",children:"Save sketch"}),(0,t.jsx)("input",{type:"text",className:"chip px-2 py-2 text-sm w-full",placeholder:tR,value:tM,onChange:e=>tT(e.target.value),"aria-label":"Sketch name",autoFocus:!0}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-end gap-2",children:[(0,t.jsx)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:()=>{tP(!1),tT("")},children:"Cancel"}),(0,t.jsx)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:tO,children:"OK"})]})]})]}),ty&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[10001]",role:"dialog","aria-modal":"true",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>tj(null)}),(0,t.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[320px]",children:[(0,t.jsx)("div",{className:"text-base font-semibold mb-3",children:ty.name}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>{try{var e,t;let a=Array(12).fill("");((null==ty||null==(e=ty.progression)?void 0:e.items)||[]).forEach((e,t)=>{t<12&&(a[t]=String((null==e?void 0:e.id)||""))}),G(a),X(-1===a.findIndex(e=>!e)?11:a.findIndex(e=>!e));try{ew(a.filter(Boolean))}catch(e){}let n=s.PC_NAMES.indexOf(ty.key.tonic);if(n>=0)try{null==ek||ek({tonic:n,mode:(null==(t=String(ty.key.scaleId||""))?void 0:t.toLowerCase().includes("aeolian"))||String(ty.key.scaleId||"").toLowerCase().includes("minor")?"Minor":"Major"})}catch(e){}(0,W.track)("open_project",{page:"chord_progression",id:ty.id}),tv(!1),tj(null)}catch(e){}},children:"Edit"}),(0,t.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:async()=>{try{await tB(ty),tj(null)}catch(e){}},children:"Export"}),(0,t.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>tj(null),children:"Cancel"})]})]})]}),(0,t.jsx)("div",{ref:O,"aria-hidden":!0,style:{position:"fixed",left:0,top:0,zIndex:9999,opacity:1e-4,pointerEvents:"none",width:800,height:600,background:"#ffffff",color:"#000000",padding:24,borderRadius:12,border:"2px solid #cbd5e1",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},children:(()=>{let e=tz||((null==tM?void 0:tM.trim())?tM:tR),a=ej?"".concat(s.PC_NAMES[ej.tonic]," ").concat(ej.mode):"-",n=$.join(" "),l=eI?(0,o.scaleTypeLabel)(eI.type):"-",i=(()=>{var e;let a=eI?eI.root:void 0,n=eI&&"number"==typeof a?(0,o.getScalePitchesById)(a,eI.type).map(e=>s.PC_NAMES[e]):[],l=eF?eV:"degrees",i=(()=>{let e=null==eI?void 0:eI.type;return e&&(e.toLowerCase().includes("aeolian")||e.toLowerCase().startsWith("min"))?"min":"maj"})();return(0,t.jsx)("div",{style:{marginTop:8,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",width:"100%"},children:(0,t.jsx)(r.default,{overlay:{viewMode:"sounding",capo:0,notes:n,chordNotes:null!=eM?eM:void 0,showScaleGhost:!!eM,display:l,scaleRootPc:"number"==typeof a?a:0,scaleType:null!=(e=null==eI?void 0:eI.type)?e:"Ionian",context:{chordRootPc:"number"==typeof a?a:0,quality:i}},onRequestForms:()=>{}})})})();return(0,t.jsxs)("div",{style:{background:"#ffffff",color:"#000000",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif",width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:"12px",padding:"8px"},children:[(0,t.jsx)("div",{style:{fontWeight:700,fontSize:24,color:"#000000",lineHeight:1.3},children:e}),(0,t.jsxs)("div",{style:{fontSize:18,color:"#000000",fontWeight:600},children:["Key: ",(0,t.jsx)("span",{style:{color:"#1e40af"},children:a})]}),(0,t.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Progression: ",(0,t.jsx)("span",{style:{color:"#1e40af"},children:n||"-"})]}),(0,t.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Scale: ",(0,t.jsx)("span",{style:{color:"#1e40af"},children:l})]}),(0,t.jsx)("div",{style:{flex:1,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",overflow:"hidden"},children:i})]})})()}),ey.length>0?(0,t.jsxs)("div",{className:"space-y-4",children:[ey.length>0&&$.length<8&&(0,t.jsxs)("div",{className:"text-xs px-3 py-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200",children:["⚠️ 精度向上のため、8コード以上の入力を推奨します（現在: ",$.length,"コード）"]}),(0,t.jsx)(y,{children:"Key"}),(0,t.jsx)("div",{className:"flex items-center justify-between gap-2",children:(0,t.jsx)("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Key candidates",children:ey.map((e,a)=>{let n=ej&&ej.tonic===e.tonic&&ej.mode===e.mode,l="".concat(s.PC_NAMES[e.tonic]," ").concat(e.mode),r=e.reasons.join("\n");return(0,t.jsxs)("button",{role:"tab","aria-selected":n,className:["chip chip--key",n?"chip--active":""].join(" "),title:"Why this key\n".concat(r),onClick:()=>ek({tonic:e.tonic,mode:e.mode}),"data-roving":"item",children:[l," ",Math.round(e.confidence),"%"]},"".concat(l,"-").concat(a))})})}),(0,t.jsxs)("div",{className:"result-block",children:[(0,t.jsx)(y,{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"Scale"}),(()=>{var e,a,n,l;let r=null!=(l=null!=(n=null==eI?void 0:eI.type)?n:null==eN||null==(e=eN[0])?void 0:e.type)?l:"Ionian",i=d.SCALE_CATALOG.find(e=>e.id===r);if(!i)return null;let c=(0,o.getScalePitchesById)(0,i.id).map(e=>s.PC_NAMES[e]).join(" ");return(0,t.jsx)(b.default,{title:i.display.en,className:"ml-1",linkHref:"/resources/glossary",linkLabel:"Glossary",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"Degrees:"})," ",i.degrees.join(" ")]}),(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"Notes in C:"})," ",c]}),(null==(a=i.info)?void 0:a.oneLiner)&&(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"About:"})," ",i.info.oneLiner]})]})})})()]})}),(0,t.jsx)("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Scale candidates",children:eN.map((e,a)=>{let n=(0,o.normalizeScaleId)(e.type),l=(null==eI?void 0:eI.type)===n&&(null==eI?void 0:eI.root)===e.root,r="".concat(s.PC_NAMES[e.root]," ").concat((0,o.scaleTypeLabel)(n));return(0,t.jsxs)("button",{role:"tab","aria-selected":l,className:["chip chip--key",l?"chip--active":""].join(" "),onClick:()=>{eS(e),(0,W.track)("scale_pick",{page:"find-key",scale:e.type,key:s.PC_NAMES[e.root]})},"data-roving":"item",children:[r," ",Math.round(e.score),"%"]},"".concat(r,"-").concat(a))})})]})]}):(0,t.jsx)("div",{className:"text-sm opacity-70",children:"Click Analyze to see results."})]}),(0,t.jsxs)("section",{className:"ot-card mt-2",children:[(0,t.jsx)(v,{children:"Tools"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"result-block",children:[(0,t.jsx)(y,{right:(0,t.jsxs)("div",{ref:h,className:"flex items-center gap-2 bg-transparent shadow-none fretboard-toggle","aria-label":"Fretboard notation",role:"tablist",children:[(0,t.jsx)("button",{role:"tab","aria-selected":"degrees"===eV,tabIndex:"degrees"===eV?0:-1,className:["chip chip--key","degrees"===eV?"chip--active":""].join(" "),onClick:()=>eE("degrees"),"data-roving":"item",children:"Degrees"}),(0,t.jsx)("button",{role:"tab","aria-selected":"names"===eV,tabIndex:eF&&"names"===eV?0:-1,"aria-disabled":!eF,className:["chip chip--key","names"===eV?"chip--active":"",!eF?"chip--disabled":""].join(" "),onClick:()=>{eF&&eE("names")},"data-roving":"item",children:"Names"})]}),children:"Fretboard"}),(0,t.jsx)("div",{className:"fret-wrap",children:(0,t.jsx)("div",{className:"fret-inner",children:eI?(()=>{let e=eI.root,a=(0,o.getScalePitchesById)(e,eI.type).map(e=>s.PC_NAMES[e]),n=eF?eV:"degrees",l=(()=>{let e=null==eI?void 0:eI.type;return e&&(e.toLowerCase().includes("aeolian")||e.toLowerCase().startsWith("min"))?"min":"maj"})();return(0,t.jsx)(r.default,{overlay:{viewMode:"sounding",capo:0,notes:a,chordNotes:null!=eM?eM:void 0,showScaleGhost:!!eM,display:n,scaleRootPc:e,scaleType:eI.type,context:{chordRootPc:e,quality:l}},onRequestForms:(t,a)=>{var n;e_({at:t,rootPc:null!=(n=a.rootPc)?n:e,quality:a.quality})},formShape:eL})})():(0,t.jsx)("div",{className:"text-center text-sm opacity-50 py-8",children:"Click Analyze to see fretboard"})})})]}),(0,t.jsxs)("section",{className:"result-block space-y-2",children:[(0,t.jsx)(y,{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"Diatonic"}),(0,t.jsxs)(b.default,{className:"ml-1",title:"Diatonic chords",linkHref:"/resources/glossary",linkLabel:"Glossary",children:[(0,t.jsx)("p",{className:"text-sm",children:"Chords built only from the key’s scale tones (I–ii–iii–IV–V–vi–vii°)."}),(0,t.jsxs)("ul",{className:"mt-2 list-disc pl-5 space-y-1 text-sm",children:[(0,t.jsx)("li",{children:"Stable sound: everything stays inside the key."}),(0,t.jsx)("li",{children:"Use: begin inside → add color with a borrowed chord (iv, bVII, bVI)."}),(0,t.jsx)("li",{children:"Try: ii–V–I or IV–V–I for clear motion."})]}),(0,t.jsx)("h4",{className:"mt-3 font-medium",children:"Shaped vs. Sounding (Capo)"}),(0,t.jsxs)("ul",{className:"mt-1 list-disc pl-5 space-y-1 text-sm",children:[(0,t.jsx)("li",{children:"Shaped: labels show the shapes you fret after capo."}),(0,t.jsx)("li",{children:"Sounding: labels show the actual pitch you hear."})]})]})]})}),(0,t.jsx)(_.default,{selectedId:eA,onSelectId:e=>eP(e),onPick:async e=>{let{id:t,pcs:a,isRightClick:n}=e;if(n){var l,r;let e=f.useAnalysisStore.getState().selectedKey,a=f.useAnalysisStore.getState().selectedScale;if(!e||!a)return;let n=a.type,i=null!=(l=o.SCALE_INTERVALS[n])?l:[];if(7!==i.length){let e=(0,o.parentModeOf)(n);e&&(i=null!=(r=o.SCALE_INTERVALS[e])?r:[])}if(7!==i.length)return;let s=(0,c.diatonicTriads)({tonicPc:e.tonic,scaleIntervals:i})[parseInt(t.replace("open-",""))];if(!s)return;let d=(0,c.triadToChordSym)({rootPc:s.rootPc,quality:s.quality}),u=[...H];u[Q]=d,G(u),Q<11&&X(Q+1),(0,W.track)("diatonic_pick",{page:"find-key",action:"right_click_add"});return}if(eA===t){eT(null),eP(null),ez();return}eT(a.map(e=>s.PC_NAMES[e])),eP(t),ez(),(0,W.track)("diatonic_pick",{page:"find-key"});try{await B.player.resume();let e=a.map(e=>60+e%12);B.player.playChord(e,"lightStrum",260)}catch(e){}}})]}),eF&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y,{children:"Roman"}),(0,t.jsx)("div",{ref:t2,className:"rounded-md border px-3 py-2","aria-live":"polite","data-testid":"roman-row",children:(0,t.jsx)("div",{className:"flex-1 overflow-x-auto whitespace-nowrap text-lg md:text-xl tracking-wide",children:0===eb.length?(0,t.jsx)("span",{children:"-"}):eb.map((e,n)=>(0,t.jsxs)(a.default.Fragment,{children:[(0,t.jsx)("span",{"data-idx":n,className:t0&&n>=t0.start&&n<=t0.end?"roman-mark":void 0,children:String(e||"").toUpperCase()}),n<eb.length-1?(0,t.jsx)("span",{"aria-hidden":!0,className:"mx-1",children:"–"}):null]},"rom-".concat(n)))})})]}),tY.length>0&&(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs opacity-70",children:"Patterns"}),(()=>{var e;let a=tY[0],n={"doo-wop":"dooWop",axis:"axis",canon:"canon","ii-V-I":"twoFiveOne",turnaround:"turnaround",andalusian:"andalusian",authentic:"authentic",plagal:"plagal",deceptive:"deceptive"},l=n[a.id]?{label:D[e=n[a.id]],summary:z[e]}:null,r=(null==l?void 0:l.label)||a.name.replace(/\(([^)]+)\)/g,(e,t)=>{let a=t.replace(/[ivx]+/g,e=>e.toUpperCase());return"(".concat(a,")")}).replace(/\(I–vi–IV–V\)/,"(I–VI–IV–V)"),i=(null==l?void 0:l.summary)||a.summary||a.name;return t0&&t0.start===a.start&&(t0.end,a.end),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:"text-sm leading-tight font-medium hover:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/50 rounded",title:i,onClick:()=>{t1(e=>e&&e.start===a.start&&e.end===a.end?null:{start:Math.max(0,a.start),end:Math.max(a.start,Math.min(eb.length-1,a.end))}),requestAnimationFrame(()=>{let e=t2.current;if(!e)return;let t=e.querySelector('[data-idx="'.concat(a.start,'"]'));t&&(e.scrollLeft=Math.max(0,t.offsetLeft-12))})},children:r},"".concat(a.id,"-0")),(0,t.jsx)(b.default,{ariaLabel:"".concat(r," – info"),text:"".concat(r,"\n\n").concat(i)})]})})()]}),(tX.length>0||t3)&&(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs opacity-70",children:"Cadence"}),(()=>{var e,a,n,l,r,i,s;let o=null!=(e=tX[0])?e:t3,c=null!=(a=null==o?void 0:o.type)?a:o,d=null!=(n=null==o?void 0:o.tail)?n:null==o?void 0:o.tailRoman,u=c?"perfect"===c?"Perfect (".concat(null!=(l=null==d?void 0:d.from)?l:"V"," → ").concat(null!=(r=null==d?void 0:d.to)?r:"I",")"):"deceptive"===c?"Deceptive (".concat(null!=(i=null==d?void 0:d.from)?i:"V"," → ").concat(null!=(s=null==d?void 0:d.to)?s:"vi",")"):"Half (".concat((null==d?void 0:d.from)?"".concat(d.from," → "):"… → ","V)"):"";return(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5 text-sm leading-tight",children:[(0,t.jsx)("span",{className:"font-medium",children:u}),(0,t.jsx)(b.default,{text:c?"perfect"===c?"Resolves to the Tonic: V → I. Feels fully resolved.":"deceptive"===c?"Surprises by avoiding I: V → vi (or similar).":"Phrase ends on the Dominant: … → V. Feels unresolved.":"No cadence detected."})]})})()]})]})]}),(0,t.jsx)("section",{className:"ot-card","aria-label":"Ad",children:(0,t.jsx)(n.default,{page:"chord_progression",format:"horizontal"})}),tI&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",style:{backdropFilter:"blur(4px)"},children:(0,t.jsxs)("div",{ref:tE,className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Load Preset"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"text-xs opacity-70 mb-1 block",children:"Key"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map(e=>(0,t.jsx)("button",{className:"chip ".concat(tC===e?"chip--active":""),onClick:()=>tV(e),children:e},e))})]}),(0,t.jsxs)("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-V-vi-IV",["Ⅰ","Ⅴ","Ⅵm","Ⅳ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Pop progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("ii-V-I",["Ⅱm","Ⅴ","Ⅰ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅱm–Ⅴ–Ⅰ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Jazz turnaround"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("12-bar-blues",["Ⅰ","Ⅰ","Ⅰ","Ⅰ","Ⅳ","Ⅳ","Ⅰ","Ⅰ","Ⅴ","Ⅳ","Ⅰ","Ⅴ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"12-bar Blues"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Classic blues form (all 12 slots)"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-II",["Ⅰ","Ⅱ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅱ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Simple two-chord progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-bVII-IV",["Ⅰ","♭Ⅶ","Ⅳ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Rock progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("vi-IV-I-V",["Ⅵm","Ⅳ","Ⅰ","Ⅴ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Emotional / Ballad (I-V-vi-IVの逆回転)"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-vi-IV-V",["Ⅰ","Ⅵm","Ⅳ","Ⅴ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅵm–Ⅳ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"50's progression / Doo-wop"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-IV-V",["Ⅰ","Ⅳ","Ⅴ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Three-chord song / Rock classic"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("vi-ii-V-I",["Ⅵm","Ⅱm","Ⅴ","Ⅰ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅱm–Ⅴ–Ⅰ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Circle progression / Jazz standard"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-bVII-bVI-bVII",["Ⅰ","♭Ⅶ","♭Ⅵ","♭Ⅶ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–♭Ⅵ–♭Ⅶ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Mixolydian vamp / Rock anthem"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-IVm-I-V",["Ⅰ","Ⅳm","Ⅰ","Ⅴ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳm–Ⅰ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Borrowed chord / Minor IV"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("vi-IV-I-III",["Ⅵm","Ⅳ","Ⅰ","Ⅲ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅲ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Andalusian cadence / Spanish feel"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-bIII-bVII-IV",["Ⅰ","♭Ⅲ","♭Ⅶ","Ⅳ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅲ–♭Ⅶ–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Modal interchange / Epic progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-iii-IV-V",["Ⅰ","Ⅲm","Ⅳ","Ⅴ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅳ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Classic progression / Beatles style"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-V-vi-iii-IV-I-IV-V",["Ⅰ","Ⅴ","Ⅵm","Ⅲm","Ⅳ","Ⅰ","Ⅳ","Ⅴ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅲm–Ⅳ–Ⅰ–Ⅳ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Pachelbel's Canon / Wedding classic"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-bVI-bVII-I",["Ⅰ","♭Ⅵ","♭Ⅶ","Ⅰ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅵ–♭Ⅶ–Ⅰ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Power ballad / 80s rock"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("vi-V-IV-III",["Ⅵm","Ⅴ","Ⅳ","Ⅲ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅴ–Ⅳ–Ⅲ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Descending progression / Melancholic"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-IV-bVII-IV",["Ⅰ","Ⅳ","♭Ⅶ","Ⅳ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳ–♭Ⅶ–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Folk/Country vamp"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-bVII-IV-I",["Ⅰ","♭Ⅶ","Ⅳ","Ⅰ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ–Ⅰ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Stadium anthem / Closing progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>t5("I-iii-vi-IV",["Ⅰ","Ⅲm","Ⅵm","Ⅳ"],tC),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅵm–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Smooth descent / R&B style"})]})]}),(0,t.jsx)("button",{className:"mt-4 w-full px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600",onClick:()=>tS(!1),children:"Cancel"})]})}),t_&&(0,t.jsx)(eX,{message:t_.message,type:t_.type,ctaText:t_.ctaText,ctaHref:t_.ctaHref,ctaPlace:t_.ctaPlace,onClose:()=>tL(null)})]})}let e2=e=>{let{title:a,children:n}=e;return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-black/60 dark:text-white/60 mb-1",children:a}),(0,t.jsx)("div",{className:"adv-grid",children:n})]})},e4=e=>{let{label:a,onClick:n,disabled:l,active:r,small:i}=e;return(0,t.jsx)("button",{className:["chip",i?"chip--sm":"",r?"chip--active":"",l?"chip--disabled":""].join(" "),onClick:n,"aria-disabled":l,children:a})}}]);