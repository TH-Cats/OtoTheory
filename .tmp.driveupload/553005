exports.id=6744,exports.ids=[6744],exports.modules={5303:()=>{},8543:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>J});var a=s(326),l=s(7577),r=s.n(l),n=s(3345),i=s(3079),o=s(2331),c=s(3894),d=s(3934),u=s(920);let m={0:0,2:1,4:2,5:3,7:4,9:5,11:6},h={0:0,2:1,3:2,5:3,7:4,8:5,10:6},x=["I","ii","iii","IV","V","vi","vii\xb0"],p=["i","ii\xb0","III","iv","v","VI","VII"];function g(e){return/maj7|M7/.test(e)}var b=s(2534);function f({children:e,className:t="",right:s,as:l="h2"}){return(0,a.jsxs)("div",{className:`mb-2 flex items-center gap-2 ${t}`,children:[a.jsx(l,{className:"text-xl md:text-2xl font-semibold tracking-tight text-foreground",children:e}),s?a.jsx("div",{className:"ml-auto",children:s}):null]})}function y({children:e,className:t="",right:s,as:l="h3"}){return(0,a.jsxs)("div",{className:`mb-1.5 flex items-center gap-2 ${t}`,children:[a.jsx(l,{className:"text-sm md:text-base font-semibold tracking-wide text-foreground",children:e}),s?a.jsx("div",{className:"ml-auto text-xs md:text-sm text-muted-foreground",children:s}):null]})}var v=s(6961),j=s(4666),k=s(8602),w=s(4552);let N=["6","m6","9","m9","11","M11","13","M13","7b5","7#5","7b9","7#9","7#11","7b13","7alt","dim7","m7b5","sus2","add9","add11","add13","6/9","aug","mM7","/bass"];var I=s(7639),S=s(2784);let C={dooWop:"Doo‑Wop (I–VI–IV–V)",axis:"Axis (I–V–vi–IV)",canon:"Canon (I–V–vi–iii–IV–I–IV–V)",twoFiveOne:"ii–V–I",turnaround:"Turnaround",andalusian:"Andalusian cadence",authentic:"Perfect cadence (V → I)",plagal:"Plagal cadence (IV → I)",deceptive:"Deceptive cadence (V → vi)"},V={dooWop:"’50s progression. Nostalgic loop: tonic → relative minor → subdominant → dominant. Try adding 7ths for color.",axis:"Modern pop staple. A catchy loop that feels forward yet stable. Swap to ii–V at the end for a stronger landing.",canon:"Pachelbel‑style ground. Persistent bass motion with rotating functions; great for variations and melodies.",twoFiveOne:"The classic run‑up then land. Link by guide tones (3rd↔7th). Works anywhere you want a clear resolution.",turnaround:"Short cycle that brings you back to the top (e.g., I–VI7–ii7–V7). Use at phrase ends or between sections.",andalusian:"Descending minor flavor (e.g., i–♭VII–♭VI–V). Adds drama; land clearly on the target chord.",authentic:"Strong homecoming: dominant pulls into tonic. Extend V with 7/9/13; keep the landing clean on I.",plagal:"Gentler IV → I resolution. Use to soften endings or after a bright Lydian moment.",deceptive:"Twist the expectation: V → vi instead of I. Keeps energy moving; return to I later for closure."};var _=s(8936);let P="ot_sketches",M=()=>JSON.parse(localStorage.getItem(P)||"[]"),A=e=>{let t=M().filter(t=>t.id!==e.id);return(t.unshift(e),t.length>3)?(localStorage.setItem(P,JSON.stringify(t.slice(0,3))),{ok:!1,reason:"limit_exceeded"}):(localStorage.setItem(P,JSON.stringify(t)),{ok:!0})},D=async e=>({ok:!0});var T=s(3683);let $=e=>{let[t,s]=(0,l.useState)(null),a=(0,l.useRef)(null),r=()=>{a.current&&window.clearTimeout(a.current),a.current=window.setTimeout(()=>{t&&(async()=>{let s=e?await D(t):A(t);!s.ok&&"reason"in s&&"limit_exceeded"===s.reason?T.j("project_limit_warn",{page:"chord_progression"}):T.j("save_project",{page:"chord_progression"})})()},3e3)};return(0,l.useEffect)(()=>{r()},[t]),{sketch:t,setSketch:s}};var R=s(8408);let z=()=>Math.random().toString(36).substr(2,9),E=(0,R.U)((e,t)=>({sketches:[],currentSketch:null,isLoading:!1,error:null,loadSketches:()=>{e({isLoading:!0,error:null});try{let t=M();e({sketches:t,isLoading:!1})}catch(t){e({error:"Failed to load sketches",isLoading:!1})}},saveSketch:async t=>{let s={...t,id:z(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(A(s).ok)return e({sketches:M(),currentSketch:s}),{ok:!0};try{await D(s);let t=M();return e({sketches:t,currentSketch:s}),{ok:!0}}catch(e){return{ok:!1,reason:"cloud_save_failed"}}},loadSketch:s=>{let a=t().sketches.find(e=>e.id===s);a&&e({currentSketch:a})},deleteSketch:s=>{let a=t().sketches.filter(e=>e.id!==s);localStorage.setItem("ot_sketches",JSON.stringify(a)),e({sketches:a}),t().currentSketch?.id===s&&e({currentSketch:null})},duplicateSketch:s=>{let a=t().sketches.find(e=>e.id===s);if(a){let t={...a,id:z(),name:`${a.name} Copy`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};A(t).ok&&e({sketches:M(),currentSketch:t})}},renameSketch:(s,a)=>{let l=t().sketches.map(e=>e.id===s?{...e,name:a,updatedAt:new Date().toISOString()}:e);if(localStorage.setItem("ot_sketches",JSON.stringify(l)),e({sketches:l}),t().currentSketch?.id===s){let s=t().currentSketch;s&&e({currentSketch:{...s,name:a,updatedAt:new Date().toISOString()}})}},startAutoSave:s=>setTimeout(()=>{let a=t();if(a.currentSketch?.id===s.id){let t={...s,updatedAt:new Date().toISOString()};A(t).ok&&e({sketches:M(),currentSketch:t})}},3e3),stopAutoSave:()=>{}}));var B=s(7546);let F=!1;async function O(e,t="auto"){if(!F){F=!0;try{let s=e.style.opacity,a=e.style.visibility;e.style.opacity="1",e.style.visibility="visible";let l=e.querySelectorAll("*"),r=[];l.forEach(e=>{let t=e.style.color,s=e.style.fill,a=e.style.background;if(r.push({elem:e,color:t,fill:s,bg:a}),e.style.color="#000000",("text"===e.tagName||"tspan"===e.tagName)&&(e.style.fill="#000000"),"SPAN"===e.tagName&&e.className.includes("inline-block")){let t=e.textContent?.trim();t&&/^\d+$/.test(t)&&(e.style.background="#f3f4f6",e.style.color="#000000")}}),await new Promise(e=>setTimeout(e,150)),e.dataset.export=t;let n=await (0,B.YM)(e,{pixelRatio:2,backgroundColor:"#ffffff",cacheBust:!0});e.style.opacity=s,e.style.visibility=a,r.forEach(({elem:e,color:t,fill:s,bg:a})=>{e.style.color=t,e.style.fill=s,e.style.background=a});let i=document.createElement("a");i.href=n,i.download="ot-progression.png",i.click(),T.j("export_png",{page:"chord_progression",ok:!0})}catch(e){T.j("export_png",{page:"chord_progression",ok:!1,err:String(e)})}finally{e.removeAttribute("data-export"),F=!1}}}var H=s(2586),L=s(2672);let W={info:"bg-blue-600",success:"bg-green-600",warning:"bg-orange-600"};function U({message:e,type:t="info",ctaText:s,ctaHref:r,ctaPlace:n,onClose:i,duration:o=5e3}){let{trackClick:c}=(0,L.Z)(),d=(0,l.useCallback)(()=>{n&&c(n)},[n,c]),u=W[t];return a.jsx("div",{className:"fixed bottom-20 sm:bottom-6 left-1/2 -translate-x-1/2 z-50 animate-slide-up max-w-md w-full mx-4",role:"alert","aria-live":"polite",children:(0,a.jsxs)("div",{className:`${u} text-white rounded-lg shadow-2xl p-4 flex items-center justify-between gap-3`,children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("p",{className:"text-sm font-medium",children:e})}),s&&r&&a.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 px-3 py-1.5 text-sm font-medium bg-white/20 hover:bg-white/30 rounded transition-colors",onClick:d,children:s}),a.jsx("button",{onClick:i,className:"flex-shrink-0 w-6 h-6 flex items-center justify-center hover:bg-white/20 rounded transition-colors","aria-label":"Close notification",children:"✕"})]})})}var Z=s(5209),q=s(5047),G=s(2663);function J(){let e=(0,Z.p)(),t=(0,q.usePathname)(),s=(0,q.useSearchParams)(),P=t.startsWith("/ja"),M=(0,l.useRef)(null);(0,i.H)(M,{orientation:"horizontal"});let A=(0,l.useRef)(null);(0,i.H)(A,{orientation:"horizontal"});let D=(0,l.useRef)(null);(0,i.H)(D,{orientation:"horizontal"});let R=(0,l.useRef)(null),z=(0,l.useRef)(null),[B,F]=(0,l.useState)(()=>{let e=Array(12).fill("");return e[0]="C",e[1]="Am",e[2]="F",e[3]="G",e}),L=(0,l.useMemo)(()=>B.reduce((e,t,s)=>(t&&e.push(s),e),[]),[B]),W=(0,l.useMemo)(()=>L.map(e=>B[e]),[L,B]);(0,l.useMemo)(()=>{let e=B.findIndex(e=>!e);return -1===e?11:e},[B]);let[J,K]=(0,l.useState)(0);(0,l.useMemo)(()=>["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],[]),(0,l.useMemo)(()=>[{label:"M",value:""},{label:"M7",value:"maj7"},{label:"7",value:"7"},{label:"6",value:"6"},{label:"add9",value:"add9"},{label:"sus4",value:"sus4"},{label:"sus2",value:"sus2"},{label:"m",value:"m"},{label:"m7",value:"m7"},{label:"dim",value:"dim"},{label:"m7b5",value:"m7b5"},{label:"aug",value:"aug"}],[]);let[X,Y]=(0,l.useState)("C"),[Q,ee]=(0,l.useState)("M"),[et,es]=(0,l.useState)([]);(0,l.useMemo)(()=>[{label:"sus2",value:"sus2"},{label:"sus4",value:"sus4"},{label:"add9",value:"add9"},{label:"add11",value:"add11"},{label:"add13",value:"add13"}],[]);let[ea,el]=(0,l.useState)([]),[er,en]=(0,l.useState)(""),[ei,eo]=(0,l.useState)(null),[ec,ed]=(0,l.useState)([]),[eu,em]=(0,l.useState)([]),[eh,ex]=(0,l.useState)(null),[ep,eg]=(0,l.useState)([]),{keyCandidates:eb,selectedKey:ef,analyze:ey,selectKey:ev,scaleCandidates:ej,selectedScale:ek,selectScale:ew,reset:eN}=(0,b._)(),[eI,eS]=(0,l.useState)("degrees"),[eC,eV]=(0,l.useState)(null),[e_,eP]=(0,l.useState)(null),[eM,eA]=(0,l.useState)(null),[eD,eT]=(0,l.useState)(null),e$=(0,l.useCallback)(()=>{eA(null),eT(null)},[]),eR=e=>({Ionian:"major",Aeolian:"naturalMinor",Dorian:"dorian",Phrygian:"phrygian",Lydian:"lydian",Mixolydian:"mixolydian",Locrian:"locrian",MajorPentatonic:"majPent",MinorPentatonic:"minPent",Blues:"bluesMinor",HarmonicMinor:"harmonicMinor",MelodicMinor:"melodicMinor",DiminishedWH:"dimWholeHalf",DiminishedHW:"dimHalfWhole",Lydianb7:"lydianb7",Mixolydianb6:"mixolydianb6",PhrygianDominant:"phrygDominant",Altered:"altered",WholeTone:"wholeTone"})[e]||"major",ez=(0,l.useMemo)(()=>{let e=ek?.type,t=e?d.vb[e]:null;return!t||7===t.length},[ek?.type]),[eE,eB]=(0,l.useState)(null);(0,l.useRef)(null),(0,l.useRef)(null);let eF=(0,l.useRef)(null),eO=(0,l.useRef)(null),[eH,eL]=(0,l.useState)(null),eW=(0,l.useRef)(null);(0,l.useRef)(null);let[eU,eZ]=(0,l.useState)(!1),[eq,eG]=(0,l.useState)(120),eJ=(0,l.useRef)(null),[eK,eX]=(0,l.useState)(-1),eY=(0,l.useCallback)((e,t)=>{F(s=>{if(e===t)return s;let a=s.slice(),l=a[e];return a[e]=a[t],a[t]=l,a})},[]),[eQ,e0]=(0,l.useState)(null),e1=(0,l.useCallback)((e,t)=>{if(!B[t])return;e.stopPropagation();let s=e.touches[0];eW.current={index:t,startX:s.clientX,startY:s.clientY},eL(t),e0(null)},[B]),e2=(0,l.useCallback)((e,t)=>{if(null===eW.current||null===eH)return;let s=e.touches[0],a=document.elementFromPoint(s.clientX,s.clientY);for(;a&&!a.hasAttribute("data-slot-index");)a=a.parentElement;if(a){let e=parseInt(a.getAttribute("data-slot-index")||"-1");e>=0&&e!==eH&&e0(e)}},[eH]),e4=(0,l.useCallback)(e=>{null!==eW.current&&null!==eH&&null!==eQ&&eH!==eQ&&eY(eH,eQ),eW.current=null,eL(null),e0(null)},[eH,eQ,eY]),e5=(0,l.useRef)(!1),e7=(0,l.useCallback)(()=>{e5.current=!1,eJ.current&&(clearInterval(eJ.current),eJ.current=null),eZ(!1),eX(-1)},[]),e3=(0,l.useCallback)(async()=>{let e=B.map((e,t)=>({chord:e,index:t})).filter(e=>e.chord);if(0===e.length)return;e7(),await _.h.resume(),e5.current=!0,eZ(!0),eX(0);let t=60/eq*1e3;for(let e=0;e<4;e++){if(!e5.current||(await new Promise(e=>setTimeout(e,t)),!e5.current))return;_.h.playNote(84,100)}let s=0,a=0,l=async()=>{if(!e5.current){eJ.current&&(clearInterval(eJ.current),eJ.current=null);return}if(a%4==0){s>=e.length&&(s=0);let{chord:t,index:a}=e[s];eX(a),await tK(t),s++}else if(s>0&&s<=e.length){let{chord:t}=e[s-1];await tK(t)}a++};e5.current&&(await l(),e5.current&&(eJ.current=setInterval(l,t),(0,T.j)("progression_play",{page:"chord_progression",bpm:eq,chordCount:e.length})))},[B,eq,e7]),e6=(0,l.useCallback)(()=>{eU?e7():e3()},[eU,e3,e7]),e8=(0,l.useCallback)(e=>{F(t=>{let s=t.slice();return s[e]="",s})},[]),{isPro:e9}=(0,I.Z)();console.log("[debug] isPro in page:",e9);let{sketch:te,setSketch:tt}=$(e9);(0,l.useRef)(null);let{sketches:ts,loadSketches:ta,deleteSketch:tl,saveSketch:tr}=E(),[tn,ti]=(0,l.useState)(!1),[to,tc]=(0,l.useState)(null),td=(0,l.useRef)(null),[tu,tm]=(0,l.useState)(""),[th,tx]=(0,l.useState)(!1),[tp,tg]=(0,l.useState)("C"),tb=(0,l.useRef)(null),[tf,ty]=(0,l.useState)(!1),[tv,tj]=(0,l.useState)(""),tk=(0,l.useMemo)(()=>W.length?W.join(" "):`Untitled ${new Date().toLocaleString()}`,[W]),[tw,tN]=(0,l.useState)(null),tI=(0,l.useRef)(new Set),[tS,tC]=(0,l.useState)(""),tV=async t=>{try{if(!z.current)return;tC(t.name||"Untitled Sketch"),await new Promise(e=>setTimeout(e,50));let s=z.current;s.style.opacity="1",s.style.visibility="visible",await new Promise(e=>setTimeout(e,200)),await O(s,"auto"),s.style.opacity="0.0001",s.style.visibility="hidden",tC(""),(0,T.j)("export_png",{page:"chord_progression",source:"sketch",id:t.id}),tI.current.has("png_export")||(tN({message:e.toast.pngExport,type:"success",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"png_toast"}),tI.current.add("png_export"))}catch(e){console.error("Export failed:",e),tC("")}},t_=async()=>{try{if(!e9){let t=JSON.parse(localStorage.getItem("ot_sketches")||"[]");if(console.log("[DEBUG] doSaveSketch - isPro:",e9,"existing sketches:",t.length),t.length>=3){console.log("[DEBUG] Blocking save - limit reached"),ty(!1),tj(""),tN({message:e.toast.sketchLimit,type:"warning",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,T.EP)("limit_block",{page:"chord_progression",context:"sketch_limit"});return}}console.log("[DEBUG] Proceeding with save");let t=ef?c.T_[ef.tonic]:eE?eE.tonic:"C",s=ek?.type||(ef?ef.mode:"Ionian"),a={name:(tv.trim()||tk).slice(0,48),schema:"sketch_v1",appVersion:"3.0.0",key:{tonic:t,scaleId:String(s)},capo:{fret:0,note:"Shaped"},progression:{items:W.map((e,t)=>({id:e,degree:"",quality:""}))},fretboardView:{mode:"names"===eI?"Names":"Degrees",guide:!!e_}},l=await tr(a);(0,T.j)("save_project",{page:"chord_progression",ok:l?.ok}),ty(!1),tj("")}catch{}},[tP,tM]=(0,l.useState)(!1),[tA,tD]=(0,l.useState)(!1),[tT,t$]=(0,l.useState)(!1),[tR,tz]=(0,l.useTransition)(),[tE,tB]=(0,l.useState)([]),[tF,tO]=(0,l.useState)([]),[tH,tL]=(0,l.useState)(null),tW=(0,l.useRef)(null),tU=e=>e.map(e=>{let t=e.match(/^([A-G](?:#|b)?)(.*)$/);return{root:t?.[1]||e,quality:t?.[2]||""}}),tZ=(e,t,s)=>{let a=(0,c.Hl)(s);if(void 0===a||a<0||a>11)return;let l=t.map(e=>(0,c.O9)(e,a,"Major"));F(e=>{let t=[...e],s=t.findIndex(e=>!e);return -1===s&&(s=0),l.forEach((e,a)=>{t[(s+a)%12]=e}),t}),K(e=>{let t=[...B];l.forEach((e,s)=>{let a=t.findIndex(e=>!e);if(-1===a)return 0;t[(a+s)%12]=e});let s=t.findIndex(e=>!e);return -1===s?0:s}),(0,T.j)("preset_inserted",{page:"chord_progression",preset:e}),tx(!1)},tq=(0,l.useMemo)(()=>{if(!ep||0===ep.length)return null;let e=ep.map(e=>{let t=e.replace(/\s+/g,"").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);if(!t)return e.toUpperCase();let s=t[1]??"",a=(t[2]??"").toUpperCase();return`${s}${a}`});if(e.length<2)return null;let t=e[0],s=e[e.length-1];return"V"===s&&"I"===t?{type:"perfect",tail:{from:"V",to:"I"}}:"V"===s&&"VI"===t?{type:"deceptive",tail:{from:"V",to:"vi"}}:"V"===s?{type:"half",tail:{from:void 0,to:"V"}}:null},[ep]);et.length&&et.join(" ");let[tG,tJ]=(0,l.useState)(!1),tK=async e=>{try{await _.h.resume();let t=(0,H.h)(e);t&&t.length>0&&_.h.playChord(t,"lightStrum",300)}catch(t){console.error("Failed to play chord:",e,t)}};return(0,a.jsxs)("main",{ref:R,className:"ot-page ot-stack","data-page":"find-key",children:[(0,a.jsxs)("section",{id:"progression",className:"ot-card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx(f,{className:"mb-0 text-left",children:P?"コード進行を作る":"Build progression"}),a.jsx(v.Z,{title:P?"コード進行を作る":"Build Progression",text:P?"コードを選ぶからコードを選んでスロットに追加ボタンから追加してください。上部のプリセットからコード進行を選択して追加することもできます。":"Select chords from Choose Chords and add them using the slot add button. You can also select chord progressions from the presets at the top to add them."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("button",{type:"button",className:"chip text-sm px-4 py-2 inline-flex items-center gap-2",title:"Reset progression",onClick:()=>{F(Array(12).fill("")),K(0),eN(),ed([]),eo(null),eP(null),eV(null),eS("degrees")},children:[a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:a.jsx("path",{d:"M12 5V2L7 7l5 5V9c2.76 0 5 2.24 5 5a5 5 0 1 1-5-5z"})}),a.jsx("span",{children:P?"リセット":"Reset"})]}),(0,a.jsxs)("button",{type:"button",className:"chip inline-flex items-center gap-2 px-4 py-2",title:"Show sketches",onClick:()=>ti(e=>!e),"aria-expanded":tn,children:[a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:a.jsx("path",{d:"M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h12v2H3v-2z"})}),P?"My進行":"Sketches"]}),tn&&a.jsx("div",{ref:td,className:"fixed right-4 top-20 z-[10000] w-[320px] max-h-[70vh] overflow-auto rounded-md border bg-white dark:bg-neutral-900 shadow-2xl p-2 space-y-2",children:0===ts.length?a.jsx("div",{className:"text-xs opacity-70 p-2",children:P?"まだ進行がありません":"No sketches yet"}):ts.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/10",children:[a.jsx("button",{className:"text-left text-sm flex-1 truncate",title:`${e.name}`,onClick:()=>tc(e),children:e.name}),a.jsx("button",{className:"ot-btn-ghost text-xs",title:"Delete",onClick:t=>{t.stopPropagation(),tl(e.id),ta(),(0,T.j)("project_delete",{page:"chord_progression",id:e.id})},children:"\uD83D\uDDD1️"})]},e.id))}),a.jsx("div",{className:"w-4","aria-hidden":"true"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("button",{type:"button",className:"chip px-4 py-2 inline-flex items-center gap-2",title:eU?"Stop playback":"Play progression",onClick:e6,disabled:0===W.length,style:{opacity:0===W.length?.5:1},children:eU?(0,a.jsxs)(a.Fragment,{children:[a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:a.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})}),a.jsx("span",{children:P?"停止":"Stop"})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:a.jsx("path",{d:"M8 5v14l11-7z"})}),a.jsx("span",{children:P?"再生":"Play"})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("label",{htmlFor:"bpm-input",className:"text-sm font-medium",children:"BPM:"}),a.jsx("input",{id:"bpm-input",type:"number",min:"40",max:"240",value:eq,onChange:e=>eG(Math.max(40,Math.min(240,parseInt(e.target.value)||120))),className:"w-20 px-3 py-1 text-sm rounded-lg border bg-transparent",disabled:eU})]})]}),(0,a.jsxs)("select",{className:"chip px-4 py-2","aria-label":"Instrument",defaultValue:"acoustic_guitar_steel",onChange:async e=>{let t=e.currentTarget.value;await _.h.setInstrument(t)},children:[a.jsx("option",{value:"acoustic_guitar_steel",children:P?"アコースティックギター":"Acoustic Steel"}),a.jsx("option",{value:"acoustic_guitar_nylon",children:P?"クラシックギター":"Acoustic Nylon"}),a.jsx("option",{value:"electric_guitar_clean",children:P?"クリーントーン（エレキ）":"Electric Clean"}),a.jsx("option",{value:"distortion_guitar",children:P?"ディストーション":"Distortion"}),a.jsx("option",{value:"overdriven_guitar",children:P?"オーバードライブ":"Over Drive"}),a.jsx("option",{value:"electric_guitar_muted",children:P?"ミュート":"Muted"}),a.jsx("option",{value:"acoustic_grand_piano",children:P?"ピアノ":"Piano"})]})]})]}),a.jsx("div",{className:"prog-slots mt-6 flex flex-wrap gap-3","aria-label":"Progression slots",children:Array.from({length:12}).map((e,t)=>{let s=!!B[t],l=t<8?0:(t-7)*.08,r=`rgba(16,185,129,${l.toFixed(2)})`,n=J===t,i=eK===t&&eU;return(0,a.jsxs)("div",{"data-slot-index":t,className:["inline-flex items-center justify-center rounded-xl border text-sm select-none relative chip-pressable",s?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"bg-gray-50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700",n?"ring-2 ring-blue-400/60":"",i?"ring-4 ring-blue-500/80 shadow-lg":"",eH===t?"opacity-50 scale-105":"",eQ===t?"ring-2 ring-blue-400":""].join(" "),style:{padding:"12px 16px",minWidth:80,minHeight:48,background:s?void 0:r,transition:"all 0.2s ease",touchAction:s?"none":"auto"},onClick:()=>{s?tK(B[t]):K(t)},draggable:s,onDragStart:()=>eL(t),onDragOver:e=>e.preventDefault(),onDrop:()=>{null!==eH&&(eY(eH,t),eL(null))},onTouchStart:e=>e1(e,t),onTouchMove:e=>e2(e,t),onTouchEnd:e4,children:[a.jsx("span",{className:"absolute left-2 top-2 text-xs opacity-60 select-none pointer-events-none font-medium",children:String(t+1)}),s?(0,a.jsxs)(a.Fragment,{children:[a.jsx("span",{children:B[t]}),a.jsx("button",{"aria-label":"Remove chord",className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-red-500 text-white text-xs leading-6 hover:bg-red-600 transition-colors",onClick:e=>{e.stopPropagation(),e8(t)},children:"\xd7"})]}):null]},`slot-${t}`)})})]}),(0,a.jsxs)("section",{id:"choose",ref:eO,className:"ot-card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx(f,{className:"mb-0 text-left",children:P?"コードを選ぶ":"Choose chords"}),a.jsx(v.Z,{title:P?"コードを選ぶ":"Choose Chords",text:P?"ルートとコードタイプを選んでください。追加ボタンでコード進行のスロットに追加できます。\nProプランの場合、より複雑なコードタイプを選ぶことができます。":"Select a root note and chord type. Use the Add button to add to chord progression slots.\nPro plan allows you to select more complex chord types."})]}),(0,a.jsxs)("button",{type:"button",className:"chip px-4 py-2 inline-flex items-center gap-2",title:"Load preset progression",onClick:()=>tx(!0),children:[a.jsx("span",{children:"\uD83D\uDCCB"}),a.jsx("span",{children:P?"プリセット":"Presets"})]})]}),a.jsx(G.Z,{plan:(()=>{let e=s.get("plan");return"pro"===e||"free"===e?e:e9?"pro":"free"})(),onPreview:async e=>{try{await _.h.resume();let t=(0,H.h)(e);t&&_.h.playChord(t,"lightStrum",300)}catch{}},onBlock:(e,t)=>{"pro_quality"===e?alert(`「${t}」はPro機能です。

iOS版のOtoTheoryアプリでPro機能をお試しください！

App Storeでダウンロードできます。`):"pro_slash"===e&&alert("Slash機能はPro機能です。\n\niOS版のOtoTheoryアプリでPro機能をお試しください！\n\nApp Storeでダウンロードできます。")},onConfirm:e=>{F(t=>{let s=[...t],a=s.findIndex(e=>!e);return -1===a&&(a=0),s[a]=e,s}),K(e=>{let t=[...B].findIndex(e=>!e);return -1===t?0:t}),t$(!0)}}),a.jsx("div",{className:"mt-6",children:a.jsx("button",{className:`w-full px-6 py-3 text-base rounded-xl font-semibold text-white transition-all duration-200 active:scale-[.98] active:translate-y-px focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 ${tR?"bg-gray-400 cursor-wait":"bg-blue-500 hover:bg-blue-600 shadow-lg"}`,onClick:()=>{(!tU(W).some(e=>N.some(t=>e.quality.includes(t)))||e9)&&tz(()=>{eo((0,w.w)(W));let e=(0,c.EZ)(W);if(ed(e.slice(0,4)),e.length>0){let t="Major"===e[0].mode?"major":"minor",s={tonic:e[0].label.split(" ")[0],mode:t};eB(s),eg(W.map(e=>(function(e,t,s,a={}){let{showQuality:l=!0,accidentalsForNonDiatonic:r=!1}=a;if(!e||!t)return"";let n=(0,c.Hl)(t),i=e.split("/")[0].match(/^([A-G](?:#|b)?)(.*)$/i);if(!i)return e;let o=function(e){let t=(0,c.Hl)(e);return c.T_[t]??e}(i[1].toUpperCase()),d=i[2]||"",u=((0,c.Hl)(o)-n+12)%12,b="major"===s?x:p,f=("major"===s?m:h)[u];if(void 0!==f){let e=a.uppercase?["I","II","III","IV","V","VI","VII"][f]:b[f];return(a.uppercase&&("major"===s&&6===f||"minor"===s&&1===f)&&(e+="\xb0"),l)?g(d)?e+"M7":!(g(d)||/m7b5|ø|dim7/.test(d))&&(/(\b|[^a-zA-Z])7(?![b#0-9])/i.test(d)||/\bm7\b/i.test(d))?e+"7":e:e}if(r){let e="major"===s?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10];for(let t=0;t<e.length;t++){let s=e[t];if((s+1)%12===u)return"#"+b[t];if((s+11)%12===u)return"b"+b[t]}}return`(${o})`})(e,s.tonic,s.mode,{showQuality:!0,uppercase:!0})))}else em([]),eB(null),eg([]);ey(W),setTimeout(()=>{let e=document.getElementById("result");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)})},disabled:tR,"aria-busy":tR,children:tR?(0,a.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,a.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24","aria-hidden":"true",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4z"})]}),"Analyzing…"]}):P?"分析":"Analyze"})})]}),(0,a.jsxs)("section",{id:"result",ref:eF,className:"ot-card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[a.jsx(f,{className:"text-left mb-0",children:P?"結果":"Result"}),a.jsx("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("button",{type:"button",className:"chip px-4 py-2 inline-flex items-center gap-2",onClick:()=>ty(!0),title:"Save sketch",children:[a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:a.jsx("path",{d:"M17 3H5a2 2 0 0 0-2 2v14l4-4h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"})}),P?"保存":"Save"]})})]}),tf&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[10000]",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{ty(!1),tj("")}}),(0,a.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[420px]",children:[a.jsx("div",{className:"text-base font-semibold mb-2",children:P?"スケッチを保存":"Save sketch"}),a.jsx("input",{type:"text",className:"chip px-2 py-2 text-sm w-full",placeholder:tk,value:tv,onChange:e=>tj(e.target.value),"aria-label":"Sketch name",autoFocus:!0}),(0,a.jsxs)("div",{className:"mt-3 flex items-center justify-end gap-2",children:[a.jsx("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:()=>{ty(!1),tj("")},children:P?"キャンセル":"Cancel"}),a.jsx("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:t_,children:"OK"})]})]})]}),to&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[10001]",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>tc(null)}),(0,a.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[320px]",children:[a.jsx("div",{className:"text-base font-semibold mb-3",children:to.name}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>{try{let e=Array(12).fill("");(to?.progression?.items||[]).forEach((t,s)=>{s<12&&(e[s]=String(t?.id||""))}),F(e),K(-1===e.findIndex(e=>!e)?11:e.findIndex(e=>!e));try{ey(e.filter(Boolean))}catch{}let t=c.T_.indexOf(to.key.tonic);if(t>=0)try{ev?.({tonic:t,mode:String(to.key.scaleId||"")?.toLowerCase().includes("aeolian")||String(to.key.scaleId||"").toLowerCase().includes("minor")?"Minor":"Major"})}catch{}(0,T.j)("open_project",{page:"chord_progression",id:to.id}),ti(!1),tc(null)}catch{}},children:P?"編集":"Edit"}),a.jsx("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:async()=>{try{await tV(to),tc(null)}catch{}},children:P?"エクスポート":"Export"}),a.jsx("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>tc(null),children:P?"キャンセル":"Cancel"})]})]})]}),a.jsx("div",{ref:z,"aria-hidden":!0,style:{position:"fixed",left:0,top:0,zIndex:9999,opacity:1e-4,pointerEvents:"none",width:800,height:600,background:"#ffffff",color:"#000000",padding:24,borderRadius:12,border:"2px solid #cbd5e1",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},children:(()=>{let e=tS||(tv?.trim()?tv:tk),t=ef?`${c.T_[ef.tonic]} ${ef.mode}`:"-",s=W.join(" "),l=ek?(0,d.hg)(ek.type):"-",r=(()=>{let e=ek?ek.root:void 0,t=ek&&"number"==typeof e?(0,d.p3)(e,ek.type).map(e=>c.T_[e]):[],s=(()=>{let e=ek?.type;return e&&(e.toLowerCase().includes("aeolian")||e.toLowerCase().startsWith("min"))?"min":"maj"})();return a.jsx("div",{style:{marginTop:8,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",width:"100%"},children:a.jsx(o.Z,{overlay:{viewMode:"sounding",capo:0,notes:t,chordNotes:e_??void 0,showScaleGhost:!!e_,display:ez?eI:"degrees",scaleRootPc:"number"==typeof e?e:0,scaleType:ek?.type??"Ionian",context:{chordRootPc:"number"==typeof e?e:0,quality:s}},onRequestForms:()=>{}})})})();return(0,a.jsxs)("div",{style:{background:"#ffffff",color:"#000000",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif",width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:"12px",padding:"8px"},children:[a.jsx("div",{style:{fontWeight:700,fontSize:24,color:"#000000",lineHeight:1.3},children:e}),(0,a.jsxs)("div",{style:{fontSize:18,color:"#000000",fontWeight:600},children:["Key: ",a.jsx("span",{style:{color:"#1e40af"},children:t})]}),(0,a.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Progression: ",a.jsx("span",{style:{color:"#1e40af"},children:s||"-"})]}),(0,a.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Scale: ",a.jsx("span",{style:{color:"#1e40af"},children:l})]}),a.jsx("div",{style:{flex:1,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",overflow:"hidden"},children:r})]})})()}),eb.length>0?(0,a.jsxs)("div",{className:"space-y-4",children:[eb.length>0&&W.length<8&&(0,a.jsxs)("div",{className:"text-xs px-3 py-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200",children:["⚠️ 精度向上のため、8コード以上の入力を推奨します（現在: ",W.length,"コード）"]}),a.jsx(y,{children:P?"キー":"Key"}),a.jsx("div",{className:"flex items-center justify-between gap-2",children:a.jsx("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Key candidates",children:eb.map((e,t)=>{let s=ef&&ef.tonic===e.tonic&&ef.mode===e.mode,l="Major"===e.mode?c.T_[e.tonic]:`${c.T_[e.tonic]}m`,r=e.reasons.join("\n");return(0,a.jsxs)("button",{role:"tab","aria-selected":s,className:["chip","chip--key",s?"chip--active":""].join(" "),title:`Why this key
${r}`,onClick:()=>ev({tonic:e.tonic,mode:e.mode}),"data-roving":"item",children:[l," ",Math.round(e.confidence),"%"]},`${l}-${t}`)})})}),(0,a.jsxs)("div",{className:"result-block",children:[a.jsx(y,{children:P?"スケール":"Scale"}),a.jsx("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Scale candidates",children:ej.map((e,t)=>{let s=(0,d.cm)(e.type),l=ek?.type===s&&ek?.root===e.root,r=eR(e.type),n=(0,j.qi)(r),i=`${c.T_[e.root]} ${n?(0,j.ED)(n,"en"):(0,d.hg)(s)}`;return(0,a.jsxs)("div",{className:"relative inline-block",children:[a.jsx("button",{role:"tab","aria-selected":l,className:["chip","chip--key",l?"chip--active":"","flex items-center gap-2"].join(" "),onClick:t=>{t.stopPropagation(),ew(e),(0,T.j)("scale_pick",{page:"find-key",scale:e.type,key:c.T_[e.root]})},"data-roving":"item",children:(0,a.jsxs)("span",{children:[i," ",Math.round(e.score),"%"]})}),n&&a.jsx("div",{className:"absolute -top-1 -right-1",children:a.jsx(v.Z,{title:(0,j.ED)(n,"en"),placement:"top",trigger:a.jsx("button",{type:"button",className:"w-6 h-6 rounded-full bg-amber-50/90 hover:bg-amber-100 ring-1 ring-amber-300/60 shadow-sm flex items-center justify-center","aria-label":"Scale info",children:a.jsx("svg",{className:"w-4 h-4 text-amber-500",fill:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{d:"M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6A4.997 4.997 0 0 1 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"})})}),children:a.jsx(k.Z,{scaleId:r})})})]},`${i}-${t}`)})})]})]}):a.jsx("div",{className:"text-sm opacity-70",children:P?"分析をクリック":"Click Analyze to see results."})]}),(0,a.jsxs)("section",{className:"ot-card",children:[a.jsx(f,{children:P?"ツール":"Tools"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"result-block",children:[a.jsx(y,{right:(0,a.jsxs)("div",{ref:A,className:"flex items-center gap-2 bg-transparent shadow-none fretboard-toggle","aria-label":"Fretboard notation",role:"tablist",children:[a.jsx("button",{role:"tab","aria-selected":"degrees"===eI,tabIndex:"degrees"===eI?0:-1,className:["chip","chip--key","degrees"===eI?"chip--active":""].join(" "),onClick:()=>eS("degrees"),"data-roving":"item",children:P?"度数":"Degrees"}),a.jsx("button",{role:"tab","aria-selected":"names"===eI,tabIndex:ez&&"names"===eI?0:-1,"aria-disabled":!ez,className:["chip","chip--key","names"===eI?"chip--active":"",ez?"":"chip--disabled"].join(" "),onClick:()=>{ez&&eS("names")},"data-roving":"item",children:P?"音名":"Names"})]}),children:P?"フレットボード":"Fretboard"}),a.jsx("div",{className:"fret-wrap",children:a.jsx("div",{className:"fret-inner",children:ek?(()=>{let e=ek.root,t=(0,d.p3)(e,ek.type).map(e=>c.T_[e]),s=(()=>{let e=ek?.type;return e&&(e.toLowerCase().includes("aeolian")||e.toLowerCase().startsWith("min"))?"min":"maj"})();return a.jsx(o.Z,{overlay:{viewMode:"sounding",capo:0,notes:t,chordNotes:e_??void 0,showScaleGhost:!!e_,display:ez?eI:"degrees",scaleRootPc:e,scaleType:ek.type,context:{chordRootPc:e,quality:s}},onRequestForms:(t,s)=>{eA({at:t,rootPc:s.rootPc??e,quality:s.quality})},formShape:eD})})():a.jsx("div",{className:"text-center text-sm opacity-50 py-8",children:P?"分析をクリックしてフレットボードを表示":"Click Analyze to see fretboard"})})})]}),(0,a.jsxs)("section",{className:"result-block space-y-2",children:[a.jsx(y,{children:(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[a.jsx("span",{children:P?"ダイアトニック":"Diatonic"}),(0,a.jsxs)(v.Z,{className:"ml-1",title:P?"ダイアトニックコード":"Diatonic chords",linkHref:"/resources/glossary",linkLabel:"Glossary",children:[a.jsx("p",{className:"text-sm",children:"Chords built only from the key’s scale tones (I–ii–iii–IV–V–vi–vii\xb0)."}),(0,a.jsxs)("ul",{className:"mt-2 list-disc pl-5 space-y-1 text-sm",children:[a.jsx("li",{children:"Stable sound: everything stays inside the key."}),a.jsx("li",{children:"Use: begin inside → add color with a borrowed chord (iv, bVII, bVI)."}),a.jsx("li",{children:"Try: ii–V–I or IV–V–I for clear motion."})]}),a.jsx("h4",{className:"mt-3 font-medium",children:"Shaped vs. Sounding (Capo)"}),(0,a.jsxs)("ul",{className:"mt-1 list-disc pl-5 space-y-1 text-sm",children:[a.jsx("li",{children:"Shaped: labels show the shapes you fret after capo."}),a.jsx("li",{children:"Sounding: labels show the actual pitch you hear."})]})]})]})}),a.jsx(S.Z,{selectedId:eC,onSelectId:e=>eV(e),onPick:async({id:e,pcs:t,isRightClick:s})=>{if(s){let t=b._.getState().selectedKey,s=b._.getState().selectedScale;if(!t||!s)return;let a=s.type,l=d.vb[a]??[];if(7!==l.length){let e=(0,d.nZ)(a);e&&(l=d.vb[e]??[])}if(7!==l.length)return;let r=(0,u.Z)({tonicPc:t.tonic,scaleIntervals:l})[parseInt(e.replace("open-",""))];if(!r)return;let n=(0,u.Xs)({rootPc:r.rootPc,quality:r.quality}),i=[...B];i[J]=n,F(i),J<11&&K(J+1),(0,T.j)("diatonic_pick",{page:"find-key",action:"right_click_add"});return}if(eC===e){eP(null),eV(null),e$();return}eP(t.map(e=>c.T_[e])),eV(e),e$(),(0,T.j)("diatonic_pick",{page:"find-key"});try{await _.h.resume();let e=t.map(e=>60+e%12);_.h.playChord(e,"lightStrum",260)}catch{}}})]}),ez&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(y,{children:P?"度数進行":"Roman"}),a.jsx("div",{ref:tW,className:"rounded-md border px-3 py-2","aria-live":"polite","data-testid":"roman-row",children:a.jsx("div",{className:"flex-1 overflow-x-auto whitespace-nowrap text-lg md:text-xl tracking-wide",children:0===ep.length?a.jsx("span",{children:"-"}):ep.map((e,t)=>(0,a.jsxs)(r().Fragment,{children:[a.jsx("span",{"data-idx":t,className:tH&&t>=tH.start&&t<=tH.end?"roman-mark":void 0,children:String(e||"").toUpperCase()}),t<ep.length-1?a.jsx("span",{"aria-hidden":!0,className:"mx-1",children:"–"}):null]},`rom-${t}`))})})]}),tE.length>0&&(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"text-xs opacity-70",children:P?"パターン":"Patterns"}),(()=>{var e;let t=tE[0],s={"doo-wop":"dooWop",axis:"axis",canon:"canon","ii-V-I":"twoFiveOne",turnaround:"turnaround",andalusian:"andalusian",authentic:"authentic",plagal:"plagal",deceptive:"deceptive"},l=s[t.id]?{label:C[e=s[t.id]],summary:V[e]}:null,r=l?.label||t.name.replace(/\(([^)]+)\)/g,(e,t)=>{let s=t.replace(/[ivx]+/g,e=>e.toUpperCase());return`(${s})`}).replace(/\(I–vi–IV–V\)/,"(I–VI–IV–V)"),n=l?.summary||t.summary||t.name;return tH&&tH.start===t.start&&(tH.end,t.end),(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{type:"button",className:"text-sm leading-tight font-medium hover:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/50 rounded",title:n,onClick:()=>{tL(e=>e&&e.start===t.start&&e.end===t.end?null:{start:Math.max(0,t.start),end:Math.max(t.start,Math.min(ep.length-1,t.end))}),requestAnimationFrame(()=>{let e=tW.current;if(!e)return;let s=e.querySelector(`[data-idx="${t.start}"]`);s&&(e.scrollLeft=Math.max(0,s.offsetLeft-12))})},children:r},`${t.id}-0`),a.jsx(v.Z,{ariaLabel:`${r} – info`,text:`${r}

${n}`})]})})()]}),(tF.length>0||tq)&&(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"text-xs opacity-70",children:P?"カデンツ":"Cadence"}),(()=>{let e=tF[0]??tq,t=e?.type??e,s=e?.tail??e?.tailRoman,l=t?"perfect"===t?`Perfect (${s?.from??"V"} → ${s?.to??"I"})`:"deceptive"===t?`Deceptive (${s?.from??"V"} → ${s?.to??"vi"})`:`Half (${s?.from?`${s.from} → `:"… → "}V)`:"";return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1.5 text-sm leading-tight",children:[a.jsx("span",{className:"font-medium",children:l}),a.jsx(v.Z,{text:t?"perfect"===t?"Resolves to the Tonic: V → I. Feels fully resolved.":"deceptive"===t?"Surprises by avoiding I: V → vi (or similar).":"Phrase ends on the Dominant: … → V. Feels unresolved.":"No cadence detected."})]})})()]})]})]}),a.jsx("section",{className:"ot-card","aria-label":"Ad",children:a.jsx(n.default,{page:"chord_progression",format:"horizontal"})}),th&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",style:{backdropFilter:"blur(4px)"},children:(0,a.jsxs)("div",{ref:tb,className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:P?"プリセットを読み込み":"Load Preset"}),(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("label",{className:"text-xs opacity-70 mb-1 block",children:P?"キー":"Key"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map(e=>a.jsx("button",{className:`chip ${tp===e?"chip--active":""}`,onClick:()=>tg(e),children:e},e))})]}),(0,a.jsxs)("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-V-vi-IV",["Ⅰ","Ⅴ","Ⅵm","Ⅳ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅳ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Pop progression"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("ii-V-I",["Ⅱm","Ⅴ","Ⅰ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅱm–Ⅴ–Ⅰ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Jazz turnaround"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("12-bar-blues",["Ⅰ","Ⅰ","Ⅰ","Ⅰ","Ⅳ","Ⅳ","Ⅰ","Ⅰ","Ⅴ","Ⅳ","Ⅰ","Ⅴ"],tp),children:[a.jsx("div",{className:"font-medium",children:"12-bar Blues"}),a.jsx("div",{className:"text-xs opacity-70",children:"Classic blues form (all 12 slots)"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-II",["Ⅰ","Ⅱ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅱ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Simple two-chord progression"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-bVII-IV",["Ⅰ","♭Ⅶ","Ⅳ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Rock progression"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("vi-IV-I-V",["Ⅵm","Ⅳ","Ⅰ","Ⅴ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅴ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Emotional / Ballad (I-V-vi-IVの逆回転)"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-vi-IV-V",["Ⅰ","Ⅵm","Ⅳ","Ⅴ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅵm–Ⅳ–Ⅴ"}),a.jsx("div",{className:"text-xs opacity-70",children:"50's progression / Doo-wop"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-IV-V",["Ⅰ","Ⅳ","Ⅴ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅳ–Ⅴ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Three-chord song / Rock classic"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("vi-ii-V-I",["Ⅵm","Ⅱm","Ⅴ","Ⅰ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅵm–Ⅱm–Ⅴ–Ⅰ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Circle progression / Jazz standard"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-bVII-bVI-bVII",["Ⅰ","♭Ⅶ","♭Ⅵ","♭Ⅶ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–♭Ⅵ–♭Ⅶ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Mixolydian vamp / Rock anthem"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-IVm-I-V",["Ⅰ","Ⅳm","Ⅰ","Ⅴ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅳm–Ⅰ–Ⅴ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Borrowed chord / Minor IV"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("vi-IV-I-III",["Ⅵm","Ⅳ","Ⅰ","Ⅲ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅲ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Andalusian cadence / Spanish feel"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-bIII-bVII-IV",["Ⅰ","♭Ⅲ","♭Ⅶ","Ⅳ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅲ–♭Ⅶ–Ⅳ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Modal interchange / Epic progression"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-iii-IV-V",["Ⅰ","Ⅲm","Ⅳ","Ⅴ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅳ–Ⅴ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Classic progression / Beatles style"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-V-vi-iii-IV-I-IV-V",["Ⅰ","Ⅴ","Ⅵm","Ⅲm","Ⅳ","Ⅰ","Ⅳ","Ⅴ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅲm–Ⅳ–Ⅰ–Ⅳ–Ⅴ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Pachelbel's Canon / Wedding classic"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-bVI-bVII-I",["Ⅰ","♭Ⅵ","♭Ⅶ","Ⅰ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅵ–♭Ⅶ–Ⅰ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Power ballad / 80s rock"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("vi-V-IV-III",["Ⅵm","Ⅴ","Ⅳ","Ⅲ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅵm–Ⅴ–Ⅳ–Ⅲ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Descending progression / Melancholic"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-IV-bVII-IV",["Ⅰ","Ⅳ","♭Ⅶ","Ⅳ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅳ–♭Ⅶ–Ⅳ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Folk/Country vamp"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-bVII-IV-I",["Ⅰ","♭Ⅶ","Ⅳ","Ⅰ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ–Ⅰ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Stadium anthem / Closing progression"})]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tZ("I-iii-vi-IV",["Ⅰ","Ⅲm","Ⅵm","Ⅳ"],tp),children:[a.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅵm–Ⅳ"}),a.jsx("div",{className:"text-xs opacity-70",children:"Smooth descent / R&B style"})]})]}),a.jsx("button",{className:"mt-4 w-full px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600",onClick:()=>tx(!1),children:P?"キャンセル":"Cancel"})]})}),tw&&a.jsx(U,{message:tw.message,type:tw.type,ctaText:tw.ctaText,ctaHref:tw.ctaHref,ctaPlace:tw.ctaPlace,onClose:()=>tN(null)})]})}},2663:()=>{throw Error("Module build failed (from ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js):\nError: \n  \x1b[31mx\x1b[0m the name `locale` is defined multiple times\n    ,-[\x1b[36;1;4m/Users/nh/App/OtoTheory/ototheory-web/src/components/ChordBuilder.tsx\x1b[0m:28:1]\n \x1b[2m28\x1b[0m |   \n \x1b[2m29\x1b[0m |   // Language detection\n \x1b[2m30\x1b[0m |   const pathname = usePathname() || \"/\";\n \x1b[2m31\x1b[0m |   const locale = pathname.startsWith('/ja') ? 'ja' : 'en';\n    : \x1b[31;1m        ^^^|^^\x1b[0m\n    :            \x1b[31;1m`-- \x1b[31;1mprevious definition of `locale` here\x1b[0m\x1b[0m\n \x1b[2m32\x1b[0m |   console.log('[debug] Slash On buttons should be disabled for plan:', plan);\n \x1b[2m33\x1b[0m |   const baseSpec: ChordSpec = useMemo(() => ({\n \x1b[2m34\x1b[0m |     root: 'C',\n \x1b[2m35\x1b[0m |     family: 'maj',\n \x1b[2m36\x1b[0m |     seventh: 'none',\n \x1b[2m37\x1b[0m |     extMode: 'add',\n \x1b[2m38\x1b[0m |     ext: {},\n \x1b[2m39\x1b[0m |     alt: {},\n \x1b[2m40\x1b[0m |     sus: null,\n \x1b[2m41\x1b[0m |     slash: null,\n \x1b[2m42\x1b[0m |   }), []);\n \x1b[2m43\x1b[0m |   const [spec, setSpec] = useState<ChordSpec>(baseSpec);\n \x1b[2m44\x1b[0m |   const ctx: ChordContext = { ...DEFAULT_CONTEXT, plan };\n \x1b[2m45\x1b[0m |   // Locale: auto-detect from pathname (/ja/* -> ja)\n \x1b[2m46\x1b[0m |   const locale: 'ja' | 'en' = typeof window !== 'undefined' && window.location.pathname.startsWith('/ja') ? 'ja' : 'en';\n    : \x1b[33;1m        ^^^|^^\x1b[0m\n    :            \x1b[33;1m`-- \x1b[33;1m`locale` redefined here\x1b[0m\x1b[0m\n \x1b[2m47\x1b[0m |   \n \x1b[2m48\x1b[0m |   // Session state for 11th warning (show once per session)\n \x1b[2m49\x1b[0m |   const [has11thWarningShown, setHas11thWarningShown] = useState(false);\n    `----\n")},2654:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>r,default:()=>i});var a=s(8570);let l=(0,a.createProxy)(String.raw`/Users/nh/App/OtoTheory/ototheory-web/src/app/chord-progression/page.tsx`),{__esModule:r,$$typeof:n}=l;l.default;let i=(0,a.createProxy)(String.raw`/Users/nh/App/OtoTheory/ototheory-web/src/app/chord-progression/page.tsx#default`)}};