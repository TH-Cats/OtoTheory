(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,48988,e=>{"use strict";e.s(["default",()=>eQ],48988);var t=e.i(43476),a=e.i(71645),n=e.i(12187),r=e.i(77613),l=e.i(9760),o=e.i(81745),s=e.i(88327),s=s,i=e.i(15803),c=e.i(16728),d=e.i(29428),s=s;let u={0:0,2:1,4:2,5:3,7:4,9:5,11:6},m={0:0,2:1,3:2,5:3,7:4,8:5,10:6},h=["I","ii","iii","IV","V","vi","vii°"],p=["i","ii°","III","iv","v","VI","VII"];function g(e){return/maj7|M7/.test(e)}function f(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{showQuality:r=!0,accidentalsForNonDiatonic:l=!1}=n;if(!e||!t)return"";let i=(0,o.noteToPc)(t),c=e.split("/")[0].match(/^([A-G](?:#|b)?)(.*)$/i);if(!c)return e;let d=function(e){var t;let a=(0,o.noteToPc)(e);return null!=(t=s.PC_NAMES[a])?t:e}(c[1].toUpperCase()),f=c[2]||"",x=((0,o.noteToPc)(d)-i+12)%12,y="major"===a?h:p,v=("major"===a?u:m)[x];if(void 0!==v){let e=n.uppercase?["I","II","III","IV","V","VI","VII"][v]:y[v];return(n.uppercase&&("major"===a&&6===v||"minor"===a&&1===v)&&(e+="°"),r)?g(f)?e+"M7":!(g(f)||/m7b5|ø|dim7/.test(f))&&(/(\b|[^a-zA-Z])7(?![b#0-9])/i.test(f)||/\bm7\b/i.test(f))?e+"7":e:e}if(l){let e="major"===a?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10];for(let t=0;t<e.length;t++){let a=e[t];if((a+1)%12===x)return"#"+y[t];if((a+11)%12===x)return"b"+y[t]}}return"(".concat(d,")")}var x=e.i(52739),y=e.i(96751);function v(e){let{children:a,className:n="",right:r,as:l="h2"}=e;return(0,t.jsxs)("div",{className:"mb-2 flex items-center gap-2 ".concat(n),children:[(0,t.jsx)(l,{className:"text-xl md:text-2xl font-semibold tracking-tight text-foreground",children:a}),r?(0,t.jsx)("div",{className:"ml-auto",children:r}):null]})}function b(e){let{children:a,className:n="",right:r,as:l="h3"}=e;return(0,t.jsxs)("div",{className:"mb-1.5 flex items-center gap-2 ".concat(n),children:[(0,t.jsx)(l,{className:"text-sm md:text-base font-semibold tracking-wide text-foreground",children:a}),r?(0,t.jsx)("div",{className:"ml-auto text-xs md:text-sm text-muted-foreground",children:r}):null]})}var w=e.i(8118);let j=["6","m6","9","m9","11","M11","13","M13","7b5","7#5","7b9","7#9","7#11","7b13","7alt","dim7","m7b5","sus2","add9","add11","add13","6/9","aug","mM7","/bass"];var k=e.i(7442),N=e.i(49204);let S=[{id:"doo-wop",name:"Doo‑Wop (I–vi–IV–V)",mode:"major",seq:["I","vi","IV","V"],summary:"50s/60s loop: I→vi→IV→V back to I."},{id:"axis",name:"Axis (I–V–vi–IV)",mode:"major",seq:["I","V","vi","IV"],summary:"Modern pop four‑chords loop."},{id:"canon",name:"Pachelbel's Canon",mode:"major",seq:["I","V","vi","iii","IV","I","IV","V"],variants:[["I","V","vi","IV"]],summary:"Pachelbel‑style ground; long loop back to I."},{id:"ii-V-I",name:"ii–V–I",mode:"any",seq:["ii","V","I"],summary:"The classic resolution run‑up."},{id:"turnaround",name:"Turnaround (I–vi–ii–V)",mode:"any",seq:["I","vi","ii","V"],summary:"Quick loop returning to the top."},{id:"andalusian",name:"Andalusian (i–VII–VI–V)",mode:"minor",seq:["i","VII","VI","V"],summary:"Classic minor descent; flamenco/Latin flavor."},{id:"authentic",name:"Authentic cadence (V–I)",mode:"any",seq:["V","I"],summary:"Perfect cadence V→I."},{id:"plagal",name:"Plagal cadence (IV–I)",mode:"any",seq:["IV","I"],summary:"Gentle IV→I resolution."},{id:"deceptive",name:"Deceptive cadence (V–vi)",mode:"major",seq:["V","vi"],summary:"Deceptive V→vi keeps motion going."}],I={dooWop:"Doo‑Wop (I–VI–IV–V)",axis:"Axis (I–V–vi–IV)",canon:"Canon (I–V–vi–iii–IV–I–IV–V)",twoFiveOne:"ii–V–I",turnaround:"Turnaround",andalusian:"Andalusian cadence",authentic:"Perfect cadence (V → I)",plagal:"Plagal cadence (IV → I)",deceptive:"Deceptive cadence (V → vi)"},C={dooWop:"’50s progression. Nostalgic loop: tonic → relative minor → subdominant → dominant. Try adding 7ths for color.",axis:"Modern pop staple. A catchy loop that feels forward yet stable. Swap to ii–V at the end for a stronger landing.",canon:"Pachelbel‑style ground. Persistent bass motion with rotating functions; great for variations and melodies.",twoFiveOne:"The classic run‑up then land. Link by guide tones (3rd↔7th). Works anywhere you want a clear resolution.",turnaround:"Short cycle that brings you back to the top (e.g., I–VI7–ii7–V7). Use at phrase ends or between sections.",andalusian:"Descending minor flavor (e.g., i–♭VII–♭VI–V). Adds drama; land clearly on the target chord.",authentic:"Strong homecoming: dominant pulls into tonic. Extend V with 7/9/13; keep the landing clean on I.",plagal:"Gentler IV → I resolution. Use to soften endings or after a bright Lydian moment.",deceptive:"Twist the expectation: V → vi instead of I. Keeps energy moving; return to I later for closure."};function E(e){return(e||"").toString().trim().toUpperCase().replace(/MAJ7|M7|7|MAJ|MIN|MI|DIM|AUG|SUS\d?|ADD\d+|Ø|O/g,"").replace(/\(|\)/g,"").replace(/[^IVB#]+/g,"").replace(/B/g,"B")}var V=e.i(26393);let M="ot_sketches",P=()=>JSON.parse(localStorage.getItem(M)||"[]"),A=e=>{let t=P().filter(t=>t.id!==e.id);return(t.unshift(e),t.length>3)?(localStorage.setItem(M,JSON.stringify(t.slice(0,3))),{ok:!1,reason:"limit_exceeded"}):(localStorage.setItem(M,JSON.stringify(t)),{ok:!0})},T=async e=>({ok:!0});var R=e.i(9593),q=e.i(68834);let _=()=>Math.random().toString(36).substr(2,9),L=(0,q.create)((e,t)=>({sketches:[],currentSketch:null,isLoading:!1,error:null,loadSketches:()=>{e({isLoading:!0,error:null});try{let t=P();e({sketches:t,isLoading:!1})}catch(t){e({error:"Failed to load sketches",isLoading:!1})}},saveSketch:async t=>{let a={...t,id:_(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(A(a).ok)return e({sketches:P(),currentSketch:a}),{ok:!0};try{await T(a);let t=P();return e({sketches:t,currentSketch:a}),{ok:!0}}catch(e){return{ok:!1,reason:"cloud_save_failed"}}},loadSketch:a=>{let n=t().sketches.find(e=>e.id===a);n&&e({currentSketch:n})},deleteSketch:a=>{var n;let r=t().sketches.filter(e=>e.id!==a);localStorage.setItem("ot_sketches",JSON.stringify(r)),e({sketches:r}),(null==(n=t().currentSketch)?void 0:n.id)===a&&e({currentSketch:null})},duplicateSketch:a=>{let n=t().sketches.find(e=>e.id===a);if(n){let t={...n,id:_(),name:"".concat(n.name," Copy"),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};A(t).ok&&e({sketches:P(),currentSketch:t})}},renameSketch:(a,n)=>{var r;let l=t().sketches.map(e=>e.id===a?{...e,name:n,updatedAt:new Date().toISOString()}:e);localStorage.setItem("ot_sketches",JSON.stringify(l)),e({sketches:l}),(null==(r=t().currentSketch)?void 0:r.id)===a&&e({currentSketch:{...t().currentSketch,name:n,updatedAt:new Date().toISOString()}})},startAutoSave:a=>setTimeout(()=>{var n;if((null==(n=t().currentSketch)?void 0:n.id)===a.id){let t={...a,updatedAt:new Date().toISOString()};A(t).ok&&e({sketches:P(),currentSketch:t})}},3e3),stopAutoSave:()=>{}}));var J=e.i(47167);let F=(()=>{let e=0;return()=>(e+=1,"u".concat("0000".concat((1679616*Math.random()|0).toString(36)).slice(-4)).concat(e))})();function B(e){let t=[];for(let a=0,n=e.length;a<n;a++)t.push(e[a]);return t}let D=null;function z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return D||(D=e.includeStyleProperties?e.includeStyleProperties:B(window.getComputedStyle(document.documentElement)))}function O(e,t){let a=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return a?parseFloat(a.replace("px","")):0}function H(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{width:t.width||function(e){let t=O(e,"border-left-width"),a=O(e,"border-right-width");return e.clientWidth+t+a}(e),height:t.height||function(e){let t=O(e,"border-top-width"),a=O(e,"border-bottom-width");return e.clientHeight+t+a}(e)}}function U(e){return new Promise((t,a)=>{let n=new Image;n.onload=()=>{n.decode().then(()=>{requestAnimationFrame(()=>t(n))})},n.onerror=a,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function W(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(e=>"data:image/svg+xml;charset=utf-8,".concat(e))}async function G(e,t,a){let n="http://www.w3.org/2000/svg",r=document.createElementNS(n,"svg"),l=document.createElementNS(n,"foreignObject");return r.setAttribute("width","".concat(t)),r.setAttribute("height","".concat(a)),r.setAttribute("viewBox","0 0 ".concat(t," ").concat(a)),l.setAttribute("width","100%"),l.setAttribute("height","100%"),l.setAttribute("x","0"),l.setAttribute("y","0"),l.setAttribute("externalResourcesRequired","true"),r.appendChild(l),l.appendChild(e),W(r)}let K=(e,t)=>{if(e instanceof t)return!0;let a=Object.getPrototypeOf(e);return null!==a&&(a.constructor.name===t.name||K(a,t))};function Y(e,t,a,n){let r=window.getComputedStyle(e,a),l=r.getPropertyValue("content");if(""===l||"none"===l)return;let o=F();try{t.className="".concat(t.className," ").concat(o)}catch(e){return}let s=document.createElement("style");s.appendChild(function(e,t,a,n){let r=".".concat(e,":").concat(t),l=a.cssText?function(e){let t=e.getPropertyValue("content");return"".concat(e.cssText," content: '").concat(t.replace(/'|"/g,""),"';")}(a):z(n).map(e=>{let t=a.getPropertyValue(e),n=a.getPropertyPriority(e);return"".concat(e,": ").concat(t).concat(n?" !important":"",";")}).join(" ");return document.createTextNode("".concat(r,"{").concat(l,"}"))}(o,a,r,n)),t.appendChild(s)}let $="application/font-woff",Q="image/jpeg",X={woff:$,woff2:$,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Q,jpeg:Q,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Z(e){return X[(function(e){let t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""})(e).toLowerCase()]||""}function ee(e){return -1!==e.search(/^(data:)/)}function et(e,t){return"data:".concat(t,";base64,").concat(e)}async function ea(e,t,a){let n=await fetch(e,t);if(404===n.status)throw Error('Resource "'.concat(n.url,'" not found'));let r=await n.blob();return new Promise((e,t)=>{let l=new FileReader;l.onerror=t,l.onloadend=()=>{try{e(a({res:n,result:l.result}))}catch(e){t(e)}},l.readAsDataURL(r)})}let en={};async function er(e,t,a){var n,r,l;let o,s,i=(n=e,r=t,l=a.includeQueryParams,s=n.replace(/\?.*/,""),l&&(s=n),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),r?"[".concat(r,"]").concat(s):s);if(null!=en[i])return en[i];a.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());try{let n=await ea(e,a.fetchRequestInit,e=>{let{res:a,result:n}=e;return t||(t=a.headers.get("Content-Type")||""),n.split(/,/)[1]});o=et(n,t)}catch(n){o=a.imagePlaceholder||"";let t="Failed to fetch resource: ".concat(e);n&&(t="string"==typeof n?n:n.message),t&&console.warn(t)}return en[i]=o,o}async function el(e){let t=e.toDataURL();return"data:,"===t?e.cloneNode(!1):U(t)}async function eo(e,t){if(e.currentSrc){let t=document.createElement("canvas"),a=t.getContext("2d");return t.width=e.clientWidth,t.height=e.clientHeight,null==a||a.drawImage(e,0,0,t.width,t.height),U(t.toDataURL())}let a=e.poster,n=Z(a);return U(await er(a,n,t))}async function es(e,t){var a;try{if(null==(a=null==e?void 0:e.contentDocument)?void 0:a.body)return await em(e.contentDocument.body,t,!0)}catch(e){}return e.cloneNode(!1)}async function ei(e,t){return K(e,HTMLCanvasElement)?el(e):K(e,HTMLVideoElement)?eo(e,t):K(e,HTMLIFrameElement)?es(e,t):e.cloneNode(ec(e))}let ec=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();async function ed(e,t,a){var n,r;if(ec(t))return t;let l=[];return 0===(l=null!=e.tagName&&"SLOT"===e.tagName.toUpperCase()&&e.assignedNodes?B(e.assignedNodes()):K(e,HTMLIFrameElement)&&(null==(n=e.contentDocument)?void 0:n.body)?B(e.contentDocument.body.childNodes):B((null!=(r=e.shadowRoot)?r:e).childNodes)).length||K(e,HTMLVideoElement)||await l.reduce((e,n)=>e.then(()=>em(n,a)).then(e=>{e&&t.appendChild(e)}),Promise.resolve()),t}async function eu(e,t){let a=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===a.length)return e;let n={};for(let r=0;r<a.length;r++){let l=a[r].getAttribute("xlink:href");if(l){let a=e.querySelector(l),r=document.querySelector(l);a||!r||n[l]||(n[l]=await em(r,t,!0))}}let r=Object.values(n);if(r.length){let t="http://www.w3.org/1999/xhtml",a=document.createElementNS(t,"svg");a.setAttribute("xmlns",t),a.style.position="absolute",a.style.width="0",a.style.height="0",a.style.overflow="hidden",a.style.display="none";let n=document.createElementNS(t,"defs");a.appendChild(n);for(let e=0;e<r.length;e++)n.appendChild(r[e]);e.appendChild(a)}return e}async function em(e,t,a){return a||!t.filter||t.filter(e)?Promise.resolve(e).then(e=>ei(e,t)).then(a=>ed(e,a,t)).then(a=>(function(e,t,a){if(K(t,Element)&&(!function(e,t,a){let n=t.style;if(!n)return;let r=window.getComputedStyle(e);r.cssText?(n.cssText=r.cssText,n.transformOrigin=r.transformOrigin):z(a).forEach(a=>{let l=r.getPropertyValue(a);if("font-size"===a&&l.endsWith("px")){let e=Math.floor(parseFloat(l.substring(0,l.length-2)))-.1;l="".concat(e,"px")}K(e,HTMLIFrameElement)&&"display"===a&&"inline"===l&&(l="block"),"d"===a&&t.getAttribute("d")&&(l="path(".concat(t.getAttribute("d"),")")),n.setProperty(a,l,r.getPropertyPriority(a))})}(e,t,a),Y(e,t,":before",a),Y(e,t,":after",a),K(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),K(e,HTMLInputElement)&&t.setAttribute("value",e.value),K(e,HTMLSelectElement))){let a=Array.from(t.children).find(t=>e.value===t.getAttribute("value"));a&&a.setAttribute("selected","")}return t})(e,a,t)).then(e=>eu(e,t)):null}let eh=/url\((['"]?)([^'"]+?)\1\)/g,ep=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,eg=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function ef(e,t,a,n,r){try{let l,o=a?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;let a=document.implementation.createHTMLDocument(),n=a.createElement("base"),r=a.createElement("a");return a.head.appendChild(n),a.body.appendChild(r),t&&(n.href=t),r.href=e,r.href}(t,a):t,s=Z(t);if(r){let e=await r(o);l=et(e,s)}else l=await er(o,s,n);return e.replace(function(e){let t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return RegExp("(url\\(['\"]?)(".concat(t,")(['\"]?\\))"),"g")}(t),"$1".concat(l,"$3"))}catch(e){}return e}function ex(e){return -1!==e.search(eh)}async function ey(e,t,a){if(!ex(e))return e;let n=function(e,t){let{preferredFontFormat:a}=t;return a?e.replace(eg,e=>{for(;;){let[t,,n]=ep.exec(e)||[];if(!n)return"";if(n===a)return"src: ".concat(t,";")}}):e}(e,a);return(function(e){let t=[];return e.replace(eh,(e,a,n)=>(t.push(n),e)),t.filter(e=>!ee(e))})(n).reduce((e,n)=>e.then(e=>ef(e,n,t,a)),Promise.resolve(n))}async function ev(e,t,a){var n;let r=null==(n=t.style)?void 0:n.getPropertyValue(e);if(r){let n=await ey(r,null,a);return t.style.setProperty(e,n,t.style.getPropertyPriority(e)),!0}return!1}async function eb(e,t){await ev("background",e,t)||await ev("background-image",e,t),await ev("mask",e,t)||await ev("-webkit-mask",e,t)||await ev("mask-image",e,t)||await ev("-webkit-mask-image",e,t)}async function ew(e,t){let a=K(e,HTMLImageElement);if(!(a&&!ee(e.src))&&!(K(e,SVGImageElement)&&!ee(e.href.baseVal)))return;let n=a?e.src:e.href.baseVal,r=await er(n,Z(n),t);await new Promise((n,l)=>{e.onload=n,e.onerror=t.onImageErrorHandler?function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];try{n(t.onImageErrorHandler(...a))}catch(e){l(e)}}:l,e.decode&&(e.decode=n),"lazy"===e.loading&&(e.loading="eager"),a?(e.srcset="",e.src=r):e.href.baseVal=r})}async function ej(e,t){let a=B(e.childNodes).map(e=>ek(e,t));await Promise.all(a).then(()=>e)}async function ek(e,t){K(e,Element)&&(await eb(e,t),await ew(e,t),await ej(e,t))}let eN={};async function eS(e){let t=eN[e];if(null!=t)return t;let a=await fetch(e);return t={url:e,cssText:await a.text()},eN[e]=t,t}async function eI(e,t){let a=e.cssText,n=/url\(["']?([^"')]+)["']?\)/g;return Promise.all((a.match(/url\([^)]+\)/g)||[]).map(async r=>{let l=r.replace(n,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),ea(l,t.fetchRequestInit,e=>{let{result:t}=e;return a=a.replace(r,"url(".concat(t,")")),[r,t]})})).then(()=>a)}function eC(e){if(null==e)return[];let t=[],a=e.replace(/(\/\*[\s\S]*?\*\/)/gi,""),n=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){let e=n.exec(a);if(null===e)break;t.push(e[0])}a=a.replace(n,"");let r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,l=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=r.exec(a);if(null===e){if(null===(e=l.exec(a)))break;r.lastIndex=l.lastIndex}else l.lastIndex=r.lastIndex;t.push(e[0])}return t}async function eE(e,t){let a=[],n=[];return e.forEach(a=>{if("cssRules"in a)try{B(a.cssRules||[]).forEach((e,r)=>{if(e.type===CSSRule.IMPORT_RULE){let l=r+1,o=e.href,s=eS(o).then(e=>eI(e,t)).then(e=>eC(e).forEach(e=>{try{a.insertRule(e,e.startsWith("@import")?l+=1:a.cssRules.length)}catch(t){console.error("Error inserting rule from remote css",{rule:e,error:t})}})).catch(e=>{console.error("Error loading remote css",e.toString())});n.push(s)}})}catch(l){let r=e.find(e=>null==e.href)||document.styleSheets[0];null!=a.href&&n.push(eS(a.href).then(e=>eI(e,t)).then(e=>eC(e).forEach(e=>{r.insertRule(e,r.cssRules.length)})).catch(e=>{console.error("Error loading remote stylesheet",e)})),console.error("Error inlining remote css file",l)}}),Promise.all(n).then(()=>(e.forEach(e=>{if("cssRules"in e)try{B(e.cssRules||[]).forEach(e=>{a.push(e)})}catch(t){console.error("Error while reading CSS rules from ".concat(e.href),t)}}),a))}async function eV(e,t){if(null==e.ownerDocument)throw Error("Provided element is not within a Document");let a=B(e.ownerDocument.styleSheets);return(await eE(a,t)).filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>ex(e.style.getPropertyValue("src")))}function eM(e){return e.trim().replace(/["']/g,"")}async function eP(e,t){let a=await eV(e,t),n=function(e){let t=new Set;return!function e(a){(a.style.fontFamily||getComputedStyle(a).fontFamily).split(",").forEach(e=>{t.add(eM(e))}),Array.from(a.children).forEach(t=>{t instanceof HTMLElement&&e(t)})}(e),t}(e);return(await Promise.all(a.filter(e=>n.has(eM(e.style.fontFamily))).map(e=>{let a=e.parentStyleSheet?e.parentStyleSheet.href:null;return ey(e.cssText,a,t)}))).join("\n")}async function eA(e,t){let a=null!=t.fontEmbedCSS?t.fontEmbedCSS:t.skipFonts?null:await eP(e,t);if(a){let t=document.createElement("style"),n=document.createTextNode(a);t.appendChild(n),e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}}async function eT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{width:a,height:n}=H(e,t),r=await em(e,t,!0);return await eA(r,t),await ek(r,t),!function(e,t){let{style:a}=e;t.backgroundColor&&(a.backgroundColor=t.backgroundColor),t.width&&(a.width="".concat(t.width,"px")),t.height&&(a.height="".concat(t.height,"px"));let n=t.style;null!=n&&Object.keys(n).forEach(e=>{a[e]=n[e]})}(r,t),await G(r,a,n)}async function eR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{width:a,height:n}=H(e,t),r=await eT(e,t),l=await U(r),o=document.createElement("canvas"),s=o.getContext("2d"),i=t.pixelRatio||function(){let e,t;try{t=J.default}catch(e){}let a=t&&t.env?t.env.devicePixelRatio:null;return a&&Number.isNaN(e=parseInt(a,10))&&(e=1),e||window.devicePixelRatio||1}(),c=t.canvasWidth||a,d=t.canvasHeight||n;return o.width=c*i,o.height=d*i,!t.skipAutoScale&&(o.width>16384||o.height>16384)&&(o.width>16384&&o.height>16384?o.width>o.height?(o.height*=16384/o.width,o.width=16384):(o.width*=16384/o.height,o.height=16384):o.width>16384?(o.height*=16384/o.width,o.width=16384):(o.width*=16384/o.height,o.height=16384)),o.style.width="".concat(c),o.style.height="".concat(d),t.backgroundColor&&(s.fillStyle=t.backgroundColor,s.fillRect(0,0,o.width,o.height)),s.drawImage(l,0,0,o.width,o.height),o}async function eq(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await eR(e,t)).toDataURL()}let e_=!1;async function eL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto";if(!e_){e_=!0;try{let a=e.style.opacity,n=e.style.visibility;e.style.opacity="1",e.style.visibility="visible";let r=e.querySelectorAll("*"),l=[];r.forEach(e=>{let t=e.style.color,a=e.style.fill,n=e.style.background;if(l.push({elem:e,color:t,fill:a,bg:n}),e.style.color="#000000",("text"===e.tagName||"tspan"===e.tagName)&&(e.style.fill="#000000"),"SPAN"===e.tagName&&e.className.includes("inline-block")){var r;let t=null==(r=e.textContent)?void 0:r.trim();t&&/^\d+$/.test(t)&&(e.style.background="#f3f4f6",e.style.color="#000000")}}),await new Promise(e=>setTimeout(e,150)),e.dataset.export=t;let o=await eq(e,{pixelRatio:2,backgroundColor:"#ffffff",cacheBust:!0});e.style.opacity=a,e.style.visibility=n,l.forEach(e=>{let{elem:t,color:a,fill:n,bg:r}=e;t.style.color=a,t.style.fill=n,t.style.background=r});let s=document.createElement("a");s.href=o,s.download="ot-progression.png",s.click(),R.track("export_png",{page:"chord_progression",ok:!0})}catch(e){R.track("export_png",{page:"chord_progression",ok:!1,err:String(e)})}finally{e.removeAttribute("data-export"),e_=!1}}}var eJ=e.i(9976),eF=e.i(41749);let eB={info:"bg-blue-600",success:"bg-green-600",warning:"bg-orange-600"};function eD(e){let{message:n,type:r="info",ctaText:l,ctaHref:o,ctaPlace:s,onClose:i,duration:c=5e3}=e,{trackClick:d}=(0,eF.useCtaTracking)();(0,a.useEffect)(()=>{if(c>0){let e=setTimeout(i,c);return()=>clearTimeout(e)}},[c,i]);let u=(0,a.useCallback)(()=>{s&&d(s)},[s,d]),m=eB[r];return(0,t.jsx)("div",{className:"fixed bottom-20 sm:bottom-6 left-1/2 -translate-x-1/2 z-50 animate-slide-up max-w-md w-full mx-4",role:"alert","aria-live":"polite",children:(0,t.jsxs)("div",{className:"".concat(m," text-white rounded-lg shadow-2xl p-4 flex items-center justify-between gap-3"),children:[(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("p",{className:"text-sm font-medium",children:n})}),l&&o&&(0,t.jsx)("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 px-3 py-1.5 text-sm font-medium bg-white/20 hover:bg-white/30 rounded transition-colors",onClick:u,children:l}),(0,t.jsx)("button",{onClick:i,className:"flex-shrink-0 w-6 h-6 flex items-center justify-center hover:bg-white/20 rounded transition-colors","aria-label":"Close notification",children:"✕"})]})})}var ez=e.i(60158),eO=e.i(18566);let eH={plan:"free",notationStyle:"english"},eU=new Set(["7b9","7#9","7#11","7b13","7alt","13","M13","m13"]),eW=[{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"Major",commentJa:"明るく、ハッピーな響きの基本となるコード。",commentEn:"The fundamental chord for a bright and happy sound."},{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"m (minor)",commentJa:"少し切なく、落ち着いた響きの基本となるコード。",commentEn:"The fundamental chord for a slightly sad and calm sound."},{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"7",commentJa:"次のコードへ進みたくなるような、少し不安定でおしゃれな響き。",commentEn:"A slightly unstable and stylish sound that creates a sense of resolution to the next chord."},{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"maj7",commentJa:"明るく、洗練された都会的な響き。",commentEn:"A bright, sophisticated, and urban sound."},{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"m7",commentJa:"切なさの中に、おしゃれな雰囲気が加わった響き。",commentEn:"A sound that adds a stylish atmosphere to sadness."},{tier:"Free",categoryJa:"基本の飾り付け",categoryEn:"Essential Colors",quality:"sus4",commentJa:"メジャーでもマイナーでもない、解決を待つ浮遊感のある響き。",commentEn:"A sound with a floating feel, neither major nor minor, awaiting resolution."},{tier:"Free",categoryJa:"基本の飾り付け",categoryEn:"Essential Colors",quality:"sus2",commentJa:"sus4よりも、より明るく爽やかな浮遊感を持つ響き。",commentEn:"A sound with a brighter and fresher floating feel than sus4."},{tier:"Free",categoryJa:"基本の飾り付け",categoryEn:"Essential Colors",quality:"add9",commentJa:"通常のコードにキラキラした透明感を加える、現代ポップスの定番。",commentEn:"The go-to chord in modern pop, adding a sparkling transparency to a basic chord."},{tier:"Free",categoryJa:"基本の飾り付け",categoryEn:"Essential Colors",quality:"dim",commentJa:"不気味で緊張感のある響き。コードとコードを繋ぐ時に便利。",commentEn:"A spooky and tense sound, useful for connecting one chord to another."},{tier:"Pro",categoryJa:"✨ キラキラ・浮遊感",categoryEn:"Sparkle & Float",quality:"M9 (maj9)",commentJa:"ポップス、R&Bの王道おしゃれサウンド。",commentEn:"The quintessential stylish sound for Pop and R&B."},{tier:"Pro",categoryJa:"✨ キラキラ・浮遊感",categoryEn:"Sparkle & Float",quality:"6",commentJa:"maj7より少しレトロで温かい響き。",commentEn:"A slightly more retro and warmer sound than maj7."},{tier:"Pro",categoryJa:"✨ キラキラ・浮遊感",categoryEn:"Sparkle & Float",quality:"6/9",commentJa:"ジャズやフュージョンで多用される、明るく豊かな響き。",commentEn:"A bright and rich sound frequently used in Jazz and Fusion."},{tier:"Pro",categoryJa:"✨ キラキラ・浮遊感",categoryEn:"Sparkle & Float",quality:"add#11",commentJa:"現代的でドリーミーな、まさに「浮遊感」のあるサウンド。",commentEn:'A modern, dreamy sound that truly gives a "floating" feel.'},{tier:"Pro",categoryJa:"🌃 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"m9",commentJa:"m7をさらにスムーズで洗練させた響き。",commentEn:"An even smoother and more refined sound than m7."},{tier:"Pro",categoryJa:"🌃 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"m11",commentJa:"Lo-fi Hip HopやR&Bで定番の、少しアンニュイなサウンド。",commentEn:"A standard sound in Lo-fi Hip Hop and R&B, with a slightly melancholic vibe."},{tier:"Pro",categoryJa:"🌃 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"m7b5",commentJa:"マイナーキーのii-V-Iで必須。ジャズ、ボサノヴァへの入り口。",commentEn:"Essential for minor key ii-V-I progressions. Your gateway to Jazz and Bossa Nova."},{tier:"Pro",categoryJa:"🌃 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"mM7",commentJa:"映画音楽のような、ミステリアスでドラマチックな響き。",commentEn:"A mysterious and dramatic sound, reminiscent of a movie soundtrack."},{tier:"Pro",categoryJa:"🌃 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"m6",commentJa:"ジャズや映画音楽で耳にする、少しレトロでミステリアスな響き。",commentEn:"A slightly retro and mysterious sound, often heard in jazz and film scores."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7sus4",commentJa:"V7の前に置くことで、解決感を劇的に高めるプロの技。",commentEn:"A pro technique that dramatically enhances the feeling of resolution when placed before a V7 chord."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"aug",commentJa:"不安定で、次のコードへ進む推進力が強い。",commentEn:"An unstable sound with a strong drive to move to the next chord."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"dim7",commentJa:"経過コードとして非常に便利。緊張感を一気に高める。",commentEn:"Very useful as a passing chord to instantly increase tension."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7(#9)",commentJa:"ブルージーでロックな緊張感。",commentEn:"A bluesy and rock-oriented tension."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7(b9)",commentJa:"ジャズで多用される強い緊張感。",commentEn:"A strong tension frequently used in Jazz."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7(#5)",commentJa:"augと同じ。解決先を強く示す。",commentEn:"Same as augmented. Strongly indicates the point of resolution."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7(b13)",commentJa:"複雑でムーディーな緊張感。",commentEn:"A complex and moody tension."}],eG=e=>{let t=eW.filter(t=>t.tier===e),a={};return t.forEach(e=>{a[e.categoryJa]||(a[e.categoryJa]=[]),a[e.categoryJa].push(e)}),a},eK=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],eY=()=>(0,t.jsx)("span",{className:"absolute -top-1 -right-1 text-[10px]",title:"Pro専用",children:"👑"});function e$(e){let{plan:n="free",onConfirm:r,onBlock:l,onPreview:o}=e,s=(0,a.useMemo)(()=>({root:"C",family:"maj",seventh:"none",extMode:"add",ext:{},alt:{},sus:null,slash:null}),[]),[i,c]=(0,a.useState)(s),d={...eH,plan:n},[u,m]=(0,a.useState)(!1),{spec:h,warnings:p}=(0,a.useMemo)(()=>(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=JSON.parse(JSON.stringify(e)),r=[];return"dom"===n.family&&(n.seventh="7"),"free"===t.plan&&("tension"===n.extMode&&(n.ext={nine:!1,eleven:!1,thirteen:!1}),n.alt={},n.slash&&(n.slash=null)),"add"===n.extMode?n.ext.nine=n.ext.eleven=n.ext.thirteen=!1:n.ext.add9=n.ext.add11=n.ext.add13=!1,n.ext.thirteen&&(n.ext.nine=!0),"sus2"===n.sus&&"sus4"===e.sus&&(n.sus="sus4"),"sus4"===n.sus&&"sus2"===e.sus&&(n.sus="sus2"),n.ext.eleven&&("maj"===n.family&&(a.autoCorrect11th?(n.ext.eleven=!1,n.alt?n.alt.sharpEleven=!0:n.alt={sharpEleven:!0},r.push("11 → #11 に自動調整しました（メジャーではavoid音のため）。")):r.push("メジャーでの11は3度と濁ります。#11（Lydian）を検討してください。")),"dom"===n.family&&(a.autoCorrect11th?(n.ext.eleven=!1,n.alt?n.alt.sharpEleven=!0:n.alt={sharpEleven:!0},r.push("11 → #11 に自動調整しました（ドミナントでは3度と衝突するため）。")):r.push("ドミナントでの11は3度と衝突します。#11 または sus4 を検討してください。"))),"dom"!==n.family&&(n.alt={}),"maj7"===n.seventh&&n.sus&&(r.push("maj7 with sus is uncommon; use sus4(maj7) in advanced mode."),n.sus=null),"tension"!==n.extMode||["7","maj7","m7"].includes(n.seventh)||(n.ext={nine:!1,eleven:!1,thirteen:!1}),{spec:n,warnings:r}})(i,d),[i,d]),g=(0,a.useMemo)(()=>(function(e,t){let a=[e.root],n="maj"===e.family?"":"min"===e.family?"m":"dom"===e.family?"":"sus"===e.family?"sus":"dim"===e.family?"dim":"aug"===e.family?"aug":"5";a.push(n);let r="maj7"===e.seventh?"compact"===t.notationStyle?"M7":"maj7":"7"===e.seventh?"7":"m7"===e.seventh?"m7":"6"===e.seventh?"6":"m7b5"===e.seventh?"m7b5":"dim7"===e.seventh?"dim7":"";if(a.push(r),"tension"===e.extMode)e.ext.thirteen?a.push("13"):e.ext.eleven?a.push("11"):e.ext.nine&&a.push("9");else{let t=[e.ext.add9&&"add9",e.ext.add11&&"add11",e.ext.add13&&"add13"].filter(Boolean);t.length&&a.push("(".concat(t.join(","),")"))}let l=[e.alt.b9&&"b9",e.alt.s9&&"#9",e.alt.s11&&"#11",e.alt.b13&&"b13"].filter(Boolean).join("");return a.push(l),e.sus&&a.push(e.sus),e.slash&&a.push("/".concat(e.slash)),a.join("")})(h,d),[h,d]);(0,a.useEffect)(()=>{!u&&h.ext.eleven&&("maj"===h.family||"dom"===h.family)&&m(!0)},[h.ext.eleven,h.family,u]);let f=(0,a.useMemo)(()=>{console.log("🔍 ChordBuilder: Creating quality presets...");let e=eG("Free"),t=eG("Pro");console.log("🔍 Free qualities:",e),console.log("🔍 Pro qualities:",t),console.log("🔍 Total qualities in QUALITY_MASTER:",eW.length);let a=[];return Object.entries(e).forEach(e=>{let[t,n]=e;n.forEach(e=>{let n="m (minor)"===e.quality?"m":"Major"===e.quality?"M":"maj7"===e.quality?"M7":e.quality;a.push({label:n,apply:()=>{let t=x(e.quality);t&&c(t)},pro:!1,comment:e.commentJa,category:t})})}),"pro"===n&&Object.entries(t).forEach(e=>{let[t,n]=e;n.forEach(e=>{let n="M9 (maj9)"===e.quality?"M9":"m7b5"===e.quality?"m7b5":"mM7"===e.quality?"mM7":"m6"===e.quality?"m6":"7(#9)"===e.quality?"7(#9)":"7(b9)"===e.quality?"7(b9)":"7(#5)"===e.quality?"7(#5)":"7(b13)"===e.quality?"7(b13)":e.quality;a.push({label:n,apply:()=>{let t=x(e.quality);t&&c(t)},pro:!0,comment:e.commentJa,category:t})})}),a},[n]),x=e=>{let t={ext:{},alt:{},sus:null,slash:null};switch(e){case"Major":return{...t,root:"C",family:"maj",seventh:"none",extMode:"add"};case"m (minor)":return{...t,root:"C",family:"min",seventh:"none",extMode:"add"};case"7":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension"};case"maj7":return{...t,root:"C",family:"maj",seventh:"maj7",extMode:"add"};case"m7":return{...t,root:"C",family:"min",seventh:"m7",extMode:"add"};case"sus4":return{...t,root:"C",family:"sus",sus:"sus4",seventh:"none",extMode:"add"};case"sus2":return{...t,root:"C",family:"sus",sus:"sus2",seventh:"none",extMode:"add"};case"add9":return{...t,root:"C",family:"maj",seventh:"none",extMode:"add",ext:{add9:!0}};case"dim":return{...t,root:"C",family:"dim",seventh:"none",extMode:"add"};case"M9 (maj9)":return{...t,root:"C",family:"maj",seventh:"maj7",extMode:"add",ext:{add9:!0}};case"6":return{...t,root:"C",family:"maj",seventh:"6",extMode:"add"};case"6/9":return{...t,root:"C",family:"maj",seventh:"6",extMode:"add",ext:{add9:!0}};case"add#11":return{...t,root:"C",family:"maj",seventh:"none",extMode:"add",ext:{add11:!0},alt:{s11:!0}};case"m9":return{...t,root:"C",family:"min",seventh:"m7",extMode:"add",ext:{add9:!0}};case"m11":return{...t,root:"C",family:"min",seventh:"m7",extMode:"add",ext:{add9:!0,add11:!0}};case"m7b5":return{...t,root:"C",family:"min",seventh:"m7b5",extMode:"add"};case"mM7":return{...t,root:"C",family:"min",seventh:"maj7",extMode:"add"};case"m6":return{...t,root:"C",family:"min",seventh:"6",extMode:"add"};case"7sus4":return{...t,root:"C",family:"dom",seventh:"7",sus:"sus4",extMode:"tension"};case"aug":return{...t,root:"C",family:"aug",seventh:"none",extMode:"add"};case"dim7":return{...t,root:"C",family:"dim",seventh:"dim7",extMode:"add"};case"7(#9)":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension",alt:{sharp9:!0}};case"7(b9)":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension",alt:{flat9:!0}};case"7(#5)":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension",alt:{sharp5:!0}};case"7(b13)":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension",alt:{flat13:!0}};default:return null}},y=(e,a,r,o)=>(0,t.jsxs)("div",{className:"relative inline-block",children:[(0,t.jsx)("button",{className:"h-9 px-3 rounded border text-xs ".concat(a?"bg-[var(--brand-primary)] text-white":""," ").concat((null==o?void 0:o.locked)?"opacity-50":""),onClick:()=>{(null==o?void 0:o.disabled)||(null==o?void 0:o.locked)?(null==o?void 0:o.locked)&&(null==l||l("pro_quality",e)):r()},title:(null==o?void 0:o.locked)?"Proで解放":null==o?void 0:o.comment,"aria-disabled":(null==o?void 0:o.disabled)||(null==o?void 0:o.locked),onContextMenu:e=>{e.preventDefault(),null==o||o.comment},children:e}),(null==o?void 0:o.showProBadge)&&"free"===n&&(0,t.jsx)(eY,{})]},e);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs opacity-70 mb-0.5",children:"ルート"}),(0,t.jsx)("div",{className:"flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",children:eK.map(e=>y(e,h.root===e,()=>c(t=>({...t,root:e}))))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-xs opacity-70 mb-0.5",children:["クイック (","free"===n?f.filter(e=>!e.pro).length:f.length,"種類)"]}),(0,t.jsx)("div",{className:"flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",children:f.filter(e=>"free"!==n||!e.pro).map(e=>(0,t.jsx)("div",{className:"relative",children:y(e.label,!1,e.apply,{locked:!!e.locked,showProBadge:!!e.pro,comment:e.comment})},e.label))})]}),"free"===n?(0,t.jsxs)("details",{children:[(0,t.jsx)("summary",{className:"cursor-pointer text-sm",children:"高度な機能 (Pro) 👑"}),(0,t.jsx)("div",{className:"mt-3 space-y-3",children:(0,t.jsx)("div",{className:"text-sm opacity-70 p-4 bg-gray-50 rounded-lg",children:"Pro版では、より高度なコード品質をご利用いただけます。"})})]}):(0,t.jsxs)("details",{children:[(0,t.jsx)("summary",{className:"cursor-pointer text-sm",children:"高度な機能 (Pro)"}),(0,t.jsx)("div",{className:"mt-3 space-y-3",children:Object.entries(eG("Pro")).map(e=>{let[a,n]=e;return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs opacity-70 mb-0.5",children:a}),(0,t.jsx)("div",{className:"flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",children:n.map(e=>{let a="M9 (maj9)"===e.quality?"M9":"m7b5"===e.quality?"m7b5":"mM7"===e.quality?"mM7":"m6"===e.quality?"m6":"7(#9)"===e.quality?"7(#9)":"7(b9)"===e.quality?"7(b9)":"7(#5)"===e.quality?"7(#5)":"7(b13)"===e.quality?"7(b13)":e.quality;return(0,t.jsx)("div",{className:"relative",children:y(a,!1,()=>{let t=x(e.quality);t&&c(t)},{comment:e.commentJa})},e.quality)})})]},a)})})]}),p.length>0&&(0,t.jsx)("div",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:p[0]}),(0,t.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"プレビュー"}),(0,t.jsx)("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:g||"コードを選択してください"})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,t.jsxs)("button",{className:"flex items-center gap-1 rounded-lg bg-green-500 hover:bg-green-600 text-white px-4 py-2 text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>null==o?void 0:o(g),disabled:!g,children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M8 5v10l8-5-8-5z"})}),"再生"]}),(0,t.jsx)("button",{className:"rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",onClick:()=>c(s),children:"クリア"}),(0,t.jsx)("button",{className:"rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-2 text-sm font-medium transition-all transform hover:scale-105",onClick:()=>{let e=!!h.slash,t="";h.ext.thirteen?t="13":h.alt.b9?t="7b9":h.alt.s9?t="7#9":h.alt.s11?t="7#11":h.alt.b13?t="7b13":h.alt.alt&&(t="7alt"),function(e,t){let{isPro:a,hasSlash:n}=t;return!!a||!n&&!eU.has(e)}(t,{isPro:"pro"===n,hasSlash:e})?null==r||r(g,h):e?null==l||l("pro_slash"):null==l||l("pro_quality",t)},children:"追加"})]})]})]})}function eQ(){let e=(0,ez.useCtaMessages)(),u=(0,eO.usePathname)().startsWith("/ja"),m=(0,a.useRef)(null);(0,r.useRovingTabs)(m,{orientation:"horizontal"});let h=(0,a.useRef)(null);(0,r.useRovingTabs)(h,{orientation:"horizontal"});let p=(0,a.useRef)(null);(0,r.useRovingTabs)(p,{orientation:"horizontal"});let g=(0,a.useRef)(null),M=(0,a.useRef)(null),[P,q]=(0,a.useState)(()=>{let e=Array(12).fill("");return e[0]="C",e[1]="Am",e[2]="F",e[3]="G",e}),_=(0,a.useMemo)(()=>P.reduce((e,t,a)=>(t&&e.push(a),e),[]),[P]),J=(0,a.useMemo)(()=>_.map(e=>P[e]),[_,P]),F=(0,a.useMemo)(()=>{let e=P.findIndex(e=>!e);return -1===e?11:e},[P]),[B,D]=(0,a.useState)(0);(0,a.useEffect)(()=>{D(F)},[F]),(0,a.useMemo)(()=>["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],[]),(0,a.useMemo)(()=>[{label:"M",value:""},{label:"M7",value:"maj7"},{label:"7",value:"7"},{label:"6",value:"6"},{label:"add9",value:"add9"},{label:"sus4",value:"sus4"},{label:"sus2",value:"sus2"},{label:"m",value:"m"},{label:"m7",value:"m7"},{label:"dim",value:"dim"},{label:"m7b5",value:"m7b5"},{label:"aug",value:"aug"}],[]);let[z,O]=(0,a.useState)("C"),[H,U]=(0,a.useState)("M"),[W,G]=(0,a.useState)([]);(0,a.useMemo)(()=>[{label:"sus2",value:"sus2"},{label:"sus4",value:"sus4"},{label:"add9",value:"add9"},{label:"add11",value:"add11"},{label:"add13",value:"add13"}],[]);let[K,Y]=(0,a.useState)([]),[$,Q]=(0,a.useState)(""),[X,Z]=(0,a.useState)(null),[ee,et]=(0,a.useState)([]),[ea,en]=(0,a.useState)([]),[er,el]=(0,a.useState)(null),[eo,es]=(0,a.useState)([]),{keyCandidates:ei,selectedKey:ec,analyze:ed,selectKey:eu,scaleCandidates:em,selectedScale:eh,selectScale:ep,reset:eg}=(0,x.useAnalysisStore)(),[ef,ex]=(0,a.useState)("degrees"),[ey,ev]=(0,a.useState)(null),[eb,ew]=(0,a.useState)(null),[ej,ek]=(0,a.useState)(null),[eN,eS]=(0,a.useState)(null),eI=(0,a.useCallback)(()=>{ek(null),eS(null)},[]),eC=(0,a.useMemo)(()=>{let e=null==eh?void 0:eh.type,t=e?i.SCALE_INTERVALS[e]:null;return!t||7===t.length},[null==eh?void 0:eh.type]);(0,a.useEffect)(()=>{eC||"degrees"===ef||ex("degrees")},[eC]);let[eE,eV]=(0,a.useState)(null),eM=(0,a.useRef)(null),eP=(0,a.useRef)(null),eA=(0,a.useRef)(null),eT=(0,a.useRef)(null),[eR,eq]=(0,a.useState)(null),e_=(0,a.useRef)(null);(0,a.useRef)(null);let[eF,eB]=(0,a.useState)(!1),[eH,eU]=(0,a.useState)(120),eW=(0,a.useRef)(null),[eG,eK]=(0,a.useState)(-1),eY=(0,a.useCallback)((e,t)=>{q(a=>{if(e===t)return a;let n=a.slice(),r=n[e];return n[e]=n[t],n[t]=r,n})},[]),[eQ,eX]=(0,a.useState)(null),eZ=(0,a.useCallback)((e,t)=>{if(!P[t])return;e.stopPropagation();let a=e.touches[0];e_.current={index:t,startX:a.clientX,startY:a.clientY},eq(t),eX(null)},[P]),e0=(0,a.useCallback)((e,t)=>{if(null===e_.current||null===eR)return;let a=e.touches[0],n=document.elementFromPoint(a.clientX,a.clientY);for(;n&&!n.hasAttribute("data-slot-index");)n=n.parentElement;if(n){let e=parseInt(n.getAttribute("data-slot-index")||"-1");e>=0&&e!==eR&&eX(e)}},[eR]),e1=(0,a.useCallback)(e=>{null!==e_.current&&null!==eR&&null!==eQ&&eR!==eQ&&eY(eR,eQ),e_.current=null,eq(null),eX(null)},[eR,eQ,eY]),e2=(0,a.useRef)(!1),e7=(0,a.useCallback)(()=>{e2.current=!1,eW.current&&(clearInterval(eW.current),eW.current=null),eB(!1),eK(-1)},[]),e4=(0,a.useCallback)(async()=>{let e=P.map((e,t)=>({chord:e,index:t})).filter(e=>e.chord);if(0===e.length)return;e7(),await V.player.resume(),e2.current=!0,eB(!0),eK(0);let t=60/eH*1e3;for(let e=0;e<4;e++){if(!e2.current||(await new Promise(e=>setTimeout(e,t)),!e2.current))return;V.player.playNote(84,100)}let a=0,n=0,r=async()=>{if(!e2.current){eW.current&&(clearInterval(eW.current),eW.current=null);return}if(n%4==0){a>=e.length&&(a=0);let{chord:t,index:n}=e[a];eK(n),await tK(t),a++}else if(a>0&&a<=e.length){let{chord:t}=e[a-1];await tK(t)}n++};e2.current&&(await r(),e2.current&&(eW.current=setInterval(r,t),(0,R.track)("progression_play",{page:"chord_progression",bpm:eH,chordCount:e.length})))},[P,eH,e7]),e5=(0,a.useCallback)(()=>{eF?e7():e4()},[eF,e4,e7]);(0,a.useEffect)(()=>()=>{eW.current&&clearInterval(eW.current)},[]),(0,a.useEffect)(()=>{eF&&e7()},[P]);let e3=(0,a.useCallback)(e=>{q(t=>{let a=t.slice();return a[e]="",a})},[]),{isPro:e9}=(0,k.usePro)(),{sketch:e6,setSketch:e8}=(e=>{let[t,n]=(0,a.useState)(null),r=(0,a.useRef)(null);return(0,a.useEffect)(()=>{r.current&&window.clearTimeout(r.current),r.current=window.setTimeout(()=>{t&&(async()=>{let a=e?await T(t):A(t);a.ok||"limit_exceeded"!==a.reason?R.track("save_project",{page:"chord_progression"}):R.track("project_limit_warn",{page:"chord_progression"})})()},3e3)},[t]),{sketch:t,setSketch:n}})(e9),te=(0,a.useRef)(null),{sketches:tt,loadSketches:ta,deleteSketch:tn,saveSketch:tr}=L(),[tl,to]=(0,a.useState)(!1),[ts,ti]=(0,a.useState)(null),tc=(0,a.useRef)(null),[td,tu]=(0,a.useState)(""),[tm,th]=(0,a.useState)(!1),[tp,tg]=(0,a.useState)("C"),tf=(0,a.useRef)(null);(0,a.useEffect)(()=>{tl&&ta()},[tl,ta]),(0,a.useEffect)(()=>{let e=e=>{if(!tl)return;let t=tc.current;t&&!t.contains(e.target)&&to(!1)},t=e=>{"Escape"===e.key&&to(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[tl]),(0,a.useEffect)(()=>{if(!tm)return;let e=e=>{let t=tf.current;t&&!t.contains(e.target)&&th(!1)},t=e=>{"Escape"===e.key&&th(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[tm]);let[tx,ty]=(0,a.useState)(!1),[tv,tb]=(0,a.useState)(""),tw=(0,a.useMemo)(()=>J.length?J.join(" "):"Untitled ".concat(new Date().toLocaleString()),[J]),[tj,tk]=(0,a.useState)(null),tN=(0,a.useRef)(new Set);(0,a.useEffect)(()=>{let t=P.filter(e=>""!==e).length;9!==t||tN.current.has("limit_warn")?12!==t||tN.current.has("limit_block")||(tk({message:e.toast.limitBlock,type:"warning",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,R.trackToast)("limit_block",{page:"chord_progression",chordCount:t}),tN.current.add("limit_block")):(tk({message:e.toast.limitWarn,type:"info",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,R.trackToast)("limit_warn",{page:"chord_progression",chordCount:t}),tN.current.add("limit_warn"))},[P]);let[tS,tI]=(0,a.useState)(""),tC=async t=>{try{if(!M.current)return;tI(t.name||"Untitled Sketch"),await new Promise(e=>setTimeout(e,50));let a=M.current;a.style.opacity="1",a.style.visibility="visible",await new Promise(e=>setTimeout(e,200)),await eL(a,"auto"),a.style.opacity="0.0001",a.style.visibility="hidden",tI(""),(0,R.track)("export_png",{page:"chord_progression",source:"sketch",id:t.id}),tN.current.has("png_export")||(tk({message:e.toast.pngExport,type:"success",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"png_toast"}),tN.current.add("png_export"))}catch(e){console.error("Export failed:",e),tI("")}},tE=async()=>{try{if(!e9){let t=JSON.parse(localStorage.getItem("ot_sketches")||"[]");if(console.log("[DEBUG] doSaveSketch - isPro:",e9,"existing sketches:",t.length),t.length>=3){console.log("[DEBUG] Blocking save - limit reached"),ty(!1),tb(""),tk({message:e.toast.sketchLimit,type:"warning",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,R.trackToast)("limit_block",{page:"chord_progression",context:"sketch_limit"});return}}console.log("[DEBUG] Proceeding with save");let t=ec?s.PC_NAMES[ec.tonic]:eE?eE.tonic:"C",a=(null==eh?void 0:eh.type)||(ec?ec.mode:"Ionian"),n={name:(tv.trim()||tw).slice(0,48),schema:"sketch_v1",appVersion:"3.0.0",key:{tonic:t,scaleId:String(a)},capo:{fret:0,note:"Shaped"},progression:{items:J.map((e,t)=>({id:e,degree:"",quality:""}))},fretboardView:{mode:"names"===ef?"Names":"Degrees",guide:!!eb}},r=await tr(n);(0,R.track)("save_project",{page:"chord_progression",ok:null==r?void 0:r.ok}),ty(!1),tb("")}catch(e){}},[tV,tM]=(0,a.useState)(!1),[tP,tA]=(0,a.useState)(!1),[tT,tR]=(0,a.useState)(!1),[tq,t_]=(0,a.useTransition)(),[tL,tJ]=(0,a.useState)([]),[tF,tB]=(0,a.useState)([]),[tD,tz]=(0,a.useState)(null),tO=(0,a.useRef)(null),tH=(e,t,a)=>{let n=(0,o.noteToPc)(a);if(void 0===n||n<0||n>11)return;let r=t.map(e=>(0,o.romanToChordSymbol)(e,n,"Major"));q(e=>{let t=[...e],a=t.findIndex(e=>!e);return -1===a&&(a=0),r.forEach((e,n)=>{t[(a+n)%12]=e}),t}),D(e=>{let t=[...P];r.forEach((e,a)=>{let n=t.findIndex(e=>!e);if(-1===n)return 0;t[(n+a)%12]=e});let a=t.findIndex(e=>!e);return -1===a?0:a}),(0,R.track)("preset_inserted",{page:"chord_progression",preset:e}),th(!1)};(0,a.useEffect)(()=>{let e=ec||eE;if(!e)return;let t="number"==typeof e.tonic?s.PC_NAMES[e.tonic]:e.tonic,a="Major"===e.mode||"Minor"===e.mode?"Major"===e.mode?"major":"minor":e.mode;es(J.map(e=>f(e,t,a,{showQuality:!0,uppercase:!0})))},[ec,eE,J]),(0,a.useEffect)(()=>{if(!eE||0===eo.length)return void tJ([]);eE.mode,tJ(function(e,t){let a=e.map(E),n=[];for(let e of S){var r;for(let t of[e.seq,...null!=(r=e.variants)?r:[]].map(e=>e.map(E))){let r=t.length;for(let l=0;l+r<=a.length;l++){let o=!0;for(let e=0;e<r;e++)if(a[l+e]!==t[e]){o=!1;break}if(o){n.push({id:e.id,name:e.name,summary:e.tooltip,start:l,end:l+r});break}}}}return n.sort((e,t)=>t.end-t.start-(e.end-e.start)),function(e){let t=[];for(let a of e)t.some(e=>!(a.end<=e.start||e.end<=a.start))||t.push(a);return t}(n)}(eo,0))},[eo,eE]),(0,a.useEffect)(()=>{if(!eo||0===eo.length)return void tB([]);let e=eo.map(e=>{var t,a;let n=e.replace(/\s+/g,"").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);if(!n)return e.toUpperCase();let r=null!=(t=n[1])?t:"",l=(null!=(a=n[2])?a:"").toUpperCase();return"".concat(r).concat(l)}),t=null;try{t=o.detectCadence(e)}catch(e){}let a=(Array.isArray(t)?t:t?[t]:[]).map(e=>{var t,a;return"string"==typeof e?{type:e}:{type:null!=(t=null==e?void 0:e.type)?t:e,tail:null!=(a=null==e?void 0:e.tailRoman)?a:(null==e?void 0:e.pair)?{from:e.pair[0],to:e.pair[1]}:void 0}});if(e.length>=2){let t=e[e.length-1],n=e[0];a.some(e=>"perfect"===e.type)||"V"!==t||"I"!==n||a.push({type:"perfect",tail:{from:"V",to:"I"}}),a.some(e=>"deceptive"===e.type)||"V"!==t||"VI"!==n||a.push({type:"deceptive",tail:{from:"V",to:"vi"}})}tB(a)},[eo]);let tU=(0,a.useMemo)(()=>{if(!eo||0===eo.length)return null;let e=eo.map(e=>{var t,a;let n=e.replace(/\s+/g,"").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);if(!n)return e.toUpperCase();let r=null!=(t=n[1])?t:"",l=(null!=(a=n[2])?a:"").toUpperCase();return"".concat(r).concat(l)});if(e.length<2)return null;let t=e[0],a=e[e.length-1];return"V"===a&&"I"===t?{type:"perfect",tail:{from:"V",to:"I"}}:"V"===a&&"VI"===t?{type:"deceptive",tail:{from:"V",to:"vi"}}:"V"===a?{type:"half",tail:{from:void 0,to:"V"}}:null},[eo]);(0,a.useEffect)(()=>{let e=()=>{if(!eM.current||!eP.current||!eA.current)return;if(!(window.matchMedia&&window.matchMedia("(min-width: 1024px)").matches)){eP.current.style.minHeight="0px";return}let e=eP.current.style.minHeight;eP.current.style.minHeight="0px",eP.current.offsetHeight;let t=eM.current.getBoundingClientRect().top+window.scrollY,a=Math.max(0,Math.ceil(Math.max(eT.current?eT.current.getBoundingClientRect().bottom+window.scrollY:0,eA.current.getBoundingClientRect().top+window.scrollY)-t));Math.abs(a-parseFloat(e||"0"))>1&&(eP.current.style.minHeight="".concat(a,"px"))};requestAnimationFrame(e);let t=setTimeout(e,120),a=null,n=()=>{a&&clearTimeout(a),a=setTimeout(e,120)};window.addEventListener("resize",n),window.addEventListener("orientationchange",n),window.addEventListener("load",e);let r=null,l=null;if("undefined"!=typeof ResizeObserver&&eT.current){let t=null;(r=new ResizeObserver(()=>{t&&clearTimeout(t),t=setTimeout(e,100)})).observe(eT.current)}if("undefined"!=typeof ResizeObserver&&eA.current){let t=null;(l=new ResizeObserver(()=>{t&&clearTimeout(t),t=setTimeout(e,100)})).observe(eA.current)}return()=>{clearTimeout(t),a&&clearTimeout(a),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.removeEventListener("load",e),r&&r.disconnect(),l&&l.disconnect()}},[]),(0,a.useEffect)(()=>{eP.current&&window.matchMedia&&window.matchMedia("(min-width: 1024px)").matches&&requestAnimationFrame(()=>{let e=new Event("resize");window.dispatchEvent(e)})},[X,tV,J.length]),"M"===H||"".concat(z).concat(H),W.length&&W.join(" "),(0,a.useEffect)(()=>{try{let e=(te.current||(te.current=Math.random().toString(36).slice(2,10)),te.current),t=J.length?J.join(" ").slice(0,48):"Untitled ".concat(new Date().toLocaleString()),a=ec?s.PC_NAMES[ec.tonic]:eE?eE.tonic:"C",n=(null==eh?void 0:eh.type)||(ec?ec.mode:"Ionian");e8({id:e,name:t,createdAt:(null==e6?void 0:e6.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString(),schema:"sketch_v1",appVersion:"3.0.0",key:{tonic:a,scaleId:String(n)},capo:{fret:0,note:"Shaped"},progression:{items:J.map((e,t)=>({id:"".concat(t+1,"-").concat(e),degree:"",quality:""}))},fretboardView:{mode:"names"===ef?"Names":"Degrees",guide:!!eb}})}catch(e){}},[P,ef,eb,ec,eE,eh]);let[tW,tG]=(0,a.useState)(!1);(0,a.useEffect)(()=>{try{var e,t;let a="ontouchstart"in window||(null!=(t=null==(e=navigator)?void 0:e.maxTouchPoints)?t:0)>0;tG(!!a)}catch(e){tG(!1)}},[]);let tK=async e=>{try{await V.player.resume();let t=(0,eJ.chordToMidi)(e);t&&t.length>0&&V.player.playChord(t,"lightStrum",300)}catch(t){console.error("Failed to play chord:",e,t)}};return(0,t.jsxs)("main",{ref:g,className:"ot-page ot-stack","data-page":"find-key",children:[(0,t.jsxs)("section",{id:"progression",className:"ot-card prog-compact",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4 sm:gap-3 mb-1 sm:mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v,{className:"mb-0 text-left",children:"Build progression"}),(0,t.jsx)(y.default,{title:"Build Progression",text:u?"Choose Chordsからコードを選んでスロットに追加ボタンから追加してください。上部のプリセットからコード進行を選択して追加することもできます。":"Select chords from Choose Chords and add them using the slot add button. You can also select chord progressions from the presets at the top to add them."})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 relative",children:[(0,t.jsxs)("button",{type:"button",className:"btn-ghost btn-reset chip-pressable text-sm px-3 py-1 inline-flex items-center gap-1",title:"Reset progression",onClick:()=>{q(Array(12).fill("")),D(0),eg(),et([]),Z(null),ew(null),ev(null),ex("degrees")},children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M12 5V2L7 7l5 5V9c2.76 0 5 2.24 5 5a5 5 0 1 1-5-5z"})}),(0,t.jsx)("span",{children:"Reset"})]}),(0,t.jsxs)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs border",title:"Show sketches",onClick:()=>to(e=>!e),"aria-expanded":tl,children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h12v2H3v-2z"})}),"Sketches"]}),tl&&(0,t.jsx)("div",{ref:tc,className:"fixed right-4 top-20 z-[10000] w-[320px] max-h-[70vh] overflow-auto rounded-md border bg-white dark:bg-neutral-900 shadow-2xl p-2 space-y-2",children:0===tt.length?(0,t.jsx)("div",{className:"text-xs opacity-70 p-2",children:"No sketches yet"}):tt.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/10",children:[(0,t.jsx)("button",{className:"text-left text-sm flex-1 truncate",title:"".concat(e.name),onClick:()=>ti(e),children:e.name}),(0,t.jsx)("button",{className:"ot-btn-ghost text-xs",title:"Delete",onClick:t=>{t.stopPropagation(),tn(e.id),ta(),(0,R.track)("project_delete",{page:"chord_progression",id:e.id})},children:"🗑️"})]},e.id))}),(0,t.jsx)("div",{className:"w-4","aria-hidden":"true"}),(0,t.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",className:"chip-pressable text-sm px-3 py-1.5 inline-flex items-center gap-1.5 rounded-lg border",title:eF?"Stop playback":"Play progression",onClick:e5,disabled:0===J.length,style:{opacity:0===J.length?.5:1},children:eF?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})}),(0,t.jsx)("span",{children:"Stop"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})}),(0,t.jsx)("span",{children:"Play"})]})}),(0,t.jsxs)("div",{className:"inline-flex items-center gap-1.5",children:[(0,t.jsx)("label",{htmlFor:"bpm-input",className:"text-xs opacity-70",children:"BPM:"}),(0,t.jsx)("input",{id:"bpm-input",type:"number",min:"40",max:"240",value:eH,onChange:e=>eU(Math.max(40,Math.min(240,parseInt(e.target.value)||120))),className:"w-16 px-2 py-1 text-sm rounded border bg-transparent",disabled:eF})]})]}),(0,t.jsxs)("select",{className:"chip","aria-label":"Instrument",defaultValue:localStorage.getItem("ot-instrument")||"acoustic_guitar_steel",onChange:async e=>{let t=e.currentTarget.value;await V.player.setInstrument(t)},children:[(0,t.jsx)("option",{value:"acoustic_guitar_steel",children:"Acoustic Steel"}),(0,t.jsx)("option",{value:"acoustic_guitar_nylon",children:"Acoustic Nylon"}),(0,t.jsx)("option",{value:"electric_guitar_clean",children:"Electric Clean"}),(0,t.jsx)("option",{value:"distortion_guitar",children:"Distortion"}),(0,t.jsx)("option",{value:"overdriven_guitar",children:"Over Drive"}),(0,t.jsx)("option",{value:"electric_guitar_muted",children:"Muted"}),(0,t.jsx)("option",{value:"acoustic_grand_piano",children:"Piano"})]})]})]}),(0,t.jsx)("div",{className:"prog-slots mt-2 flex flex-wrap gap-1","aria-label":"Progression slots",children:Array.from({length:12}).map((e,a)=>{let n=!!P[a],r=a<8?0:(a-7)*.08,l="rgba(16,185,129,".concat(r.toFixed(2),")"),o=B===a,s=eG===a&&eF;return(0,t.jsxs)("div",{"data-slot-index":a,className:["inline-flex items-center justify-center rounded border text-xs select-none relative chip-pressable",n?"bg-black/5 dark:bg-white/10":"bg-transparent",o?"ring-2 ring-emerald-400/60":"",s?"ring-4 ring-blue-500/80 shadow-lg":"",eR===a?"opacity-50 scale-105":"",eQ===a?"ring-2 ring-blue-400":""].join(" "),style:{padding:"6px 10px",minWidth:72,minHeight:36,background:n?void 0:l,borderColor:"var(--line)",transition:"opacity 0.15s, transform 0.15s, box-shadow 0.15s",touchAction:n?"none":"auto"},onClick:()=>{n?tK(P[a]):D(a)},draggable:n,onDragStart:()=>eq(a),onDragOver:e=>e.preventDefault(),onDrop:()=>{null!==eR&&(eY(eR,a),eq(null))},onTouchStart:e=>eZ(e,a),onTouchMove:e=>e0(e,a),onTouchEnd:e1,children:[(0,t.jsx)("span",{className:"absolute left-1 top-1 text-[10px] opacity-70 select-none pointer-events-none",children:String(a+1)}),n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:P[a]}),(0,t.jsx)("button",{"aria-label":"Remove chord",className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-black/50 text-white text-[10px] leading-4 hover:bg-black/70",onClick:e=>{e.stopPropagation(),e3(a)},children:"×"})]}):null]},"slot-".concat(a))})})]}),(0,t.jsxs)("section",{id:"choose",ref:eT,className:"ot-card right-panel",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v,{className:"mb-0 text-left",children:"Choose chords"}),(0,t.jsx)(y.default,{title:"Choose Chords",text:u?"ルートとコードタイプを選んでください。追加ボタンでコード進行のスロットに追加できます。\nProプランの場合、より複雑なコードタイプを選ぶことができます。":"Select a root note and chord type. Use the Add button to add to chord progression slots.\nPro plan allows you to select more complex chord types."})]}),(0,t.jsxs)("button",{type:"button",className:"chip-pressable text-sm px-3 py-1 inline-flex items-center gap-1 rounded-lg border",title:"Load preset progression",onClick:()=>th(!0),children:[(0,t.jsx)("span",{children:"📋"}),(0,t.jsx)("span",{children:"Presets"})]})]}),(0,t.jsx)(e$,{plan:e9?"pro":"free",onPreview:async e=>{try{await V.player.resume();let t=(0,eJ.chordToMidi)(e);V.player.playChord(t,"lightStrum",300)}catch(e){}},onBlock:e=>{tA(!0)},onConfirm:e=>{q(t=>{let a=[...t],n=a.findIndex(e=>!e);return -1===n&&(n=0),a[n]=e,a}),D(e=>{let t=[...P].findIndex(e=>!e);return -1===t?0:t}),tR(!0)}}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)("button",{className:"w-full px-6 py-2 text-base rounded-lg font-semibold text-white transition-transform active:scale-[.98] active:translate-y-px focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300 ".concat(tq?"bg-rose-400/70 cursor-wait":"bg-rose-400 hover:bg-rose-500"),onClick:()=>{if(J.map(e=>{let t=e.match(/^([A-G](?:#|b)?)(.*)$/);return{root:(null==t?void 0:t[1])||e,quality:(null==t?void 0:t[2])||""}}).some(e=>j.some(t=>e.quality.includes(t)))&&!e9)return void window.alert("Advanced chords detected. Remove them or upgrade to Pro.");t_(()=>{Z((0,w.analyzeChordProgression)(J));let e=(0,o.rankKeys)(J);if(et(e.slice(0,4)),e.length>0){let t="Major"===e[0].mode?"major":"minor",a={tonic:e[0].label.split(" ")[0],mode:t};eV(a),es(J.map(e=>f(e,a.tonic,a.mode,{showQuality:!0,uppercase:!0})))}else en([]),eV(null),es([]);ed(J),setTimeout(()=>{let e=document.getElementById("result");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)})},disabled:tq,"aria-busy":tq,children:tq?(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,t.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4z"})]}),"Analyzing…"]}):"Analyze"})})]}),(0,t.jsxs)("section",{id:"result",ref:eA,className:"ot-card",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(v,{className:"text-left mb-0",children:"Result"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:()=>ty(!0),title:"Save sketch",children:[(0,t.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M17 3H5a2 2 0 0 0-2 2v14l4-4h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"})}),"Save"]})})]}),tx&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[10000]",role:"dialog","aria-modal":"true",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{ty(!1),tb("")}}),(0,t.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[420px]",children:[(0,t.jsx)("div",{className:"text-base font-semibold mb-2",children:"Save sketch"}),(0,t.jsx)("input",{type:"text",className:"chip px-2 py-2 text-sm w-full",placeholder:tw,value:tv,onChange:e=>tb(e.target.value),"aria-label":"Sketch name",autoFocus:!0}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-end gap-2",children:[(0,t.jsx)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:()=>{ty(!1),tb("")},children:"Cancel"}),(0,t.jsx)("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:tE,children:"OK"})]})]})]}),ts&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[10001]",role:"dialog","aria-modal":"true",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>ti(null)}),(0,t.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[320px]",children:[(0,t.jsx)("div",{className:"text-base font-semibold mb-3",children:ts.name}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>{try{var e,t;let a=Array(12).fill("");((null==ts||null==(e=ts.progression)?void 0:e.items)||[]).forEach((e,t)=>{t<12&&(a[t]=String((null==e?void 0:e.id)||""))}),q(a),D(-1===a.findIndex(e=>!e)?11:a.findIndex(e=>!e));try{ed(a.filter(Boolean))}catch(e){}let n=s.PC_NAMES.indexOf(ts.key.tonic);if(n>=0)try{null==eu||eu({tonic:n,mode:(null==(t=String(ts.key.scaleId||""))?void 0:t.toLowerCase().includes("aeolian"))||String(ts.key.scaleId||"").toLowerCase().includes("minor")?"Minor":"Major"})}catch(e){}(0,R.track)("open_project",{page:"chord_progression",id:ts.id}),to(!1),ti(null)}catch(e){}},children:"Edit"}),(0,t.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:async()=>{try{await tC(ts),ti(null)}catch(e){}},children:"Export"}),(0,t.jsx)("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>ti(null),children:"Cancel"})]})]})]}),(0,t.jsx)("div",{ref:M,"aria-hidden":!0,style:{position:"fixed",left:0,top:0,zIndex:9999,opacity:1e-4,pointerEvents:"none",width:800,height:600,background:"#ffffff",color:"#000000",padding:24,borderRadius:12,border:"2px solid #cbd5e1",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},children:(()=>{let e=tS||((null==tv?void 0:tv.trim())?tv:tw),a=ec?"".concat(s.PC_NAMES[ec.tonic]," ").concat(ec.mode):"-",n=J.join(" "),r=eh?(0,i.scaleTypeLabel)(eh.type):"-",o=(()=>{var e;let a=eh?eh.root:void 0,n=eh&&"number"==typeof a?(0,i.getScalePitchesById)(a,eh.type).map(e=>s.PC_NAMES[e]):[],r=eC?ef:"degrees",o=(()=>{let e=null==eh?void 0:eh.type;return e&&(e.toLowerCase().includes("aeolian")||e.toLowerCase().startsWith("min"))?"min":"maj"})();return(0,t.jsx)("div",{style:{marginTop:8,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",width:"100%"},children:(0,t.jsx)(l.default,{overlay:{viewMode:"sounding",capo:0,notes:n,chordNotes:null!=eb?eb:void 0,showScaleGhost:!!eb,display:r,scaleRootPc:"number"==typeof a?a:0,scaleType:null!=(e=null==eh?void 0:eh.type)?e:"Ionian",context:{chordRootPc:"number"==typeof a?a:0,quality:o}},onRequestForms:()=>{}})})})();return(0,t.jsxs)("div",{style:{background:"#ffffff",color:"#000000",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif",width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:"12px",padding:"8px"},children:[(0,t.jsx)("div",{style:{fontWeight:700,fontSize:24,color:"#000000",lineHeight:1.3},children:e}),(0,t.jsxs)("div",{style:{fontSize:18,color:"#000000",fontWeight:600},children:["Key: ",(0,t.jsx)("span",{style:{color:"#1e40af"},children:a})]}),(0,t.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Progression: ",(0,t.jsx)("span",{style:{color:"#1e40af"},children:n||"-"})]}),(0,t.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Scale: ",(0,t.jsx)("span",{style:{color:"#1e40af"},children:r})]}),(0,t.jsx)("div",{style:{flex:1,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",overflow:"hidden"},children:o})]})})()}),ei.length>0?(0,t.jsxs)("div",{className:"space-y-4",children:[ei.length>0&&J.length<8&&(0,t.jsxs)("div",{className:"text-xs px-3 py-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200",children:["⚠️ 精度向上のため、8コード以上の入力を推奨します（現在: ",J.length,"コード）"]}),(0,t.jsx)(b,{children:"Key"}),(0,t.jsx)("div",{className:"flex items-center justify-between gap-2",children:(0,t.jsx)("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Key candidates",children:ei.map((e,a)=>{let n=ec&&ec.tonic===e.tonic&&ec.mode===e.mode,r="".concat(s.PC_NAMES[e.tonic]," ").concat(e.mode),l=e.reasons.join("\n");return(0,t.jsxs)("button",{role:"tab","aria-selected":n,className:["chip chip--key",n?"chip--active":""].join(" "),title:"Why this key\n".concat(l),onClick:()=>eu({tonic:e.tonic,mode:e.mode}),"data-roving":"item",children:[r," ",Math.round(e.confidence),"%"]},"".concat(r,"-").concat(a))})})}),(0,t.jsxs)("div",{className:"result-block",children:[(0,t.jsx)(b,{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"Scale"}),(()=>{var e,a,n,r;let l=null!=(r=null!=(n=null==eh?void 0:eh.type)?n:null==em||null==(e=em[0])?void 0:e.type)?r:"Ionian",o=d.SCALE_CATALOG.find(e=>e.id===l);if(!o)return null;let c=(0,i.getScalePitchesById)(0,o.id).map(e=>s.PC_NAMES[e]).join(" ");return(0,t.jsx)(y.default,{title:o.display.en,className:"ml-1",linkHref:"/resources/glossary",linkLabel:"Glossary",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"Degrees:"})," ",o.degrees.join(" ")]}),(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"Notes in C:"})," ",c]}),(null==(a=o.info)?void 0:a.oneLiner)&&(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"About:"})," ",o.info.oneLiner]})]})})})()]})}),(0,t.jsx)("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Scale candidates",children:em.map((e,a)=>{let n=(0,i.normalizeScaleId)(e.type),r=(null==eh?void 0:eh.type)===n&&(null==eh?void 0:eh.root)===e.root,l="".concat(s.PC_NAMES[e.root]," ").concat((0,i.scaleTypeLabel)(n));return(0,t.jsxs)("button",{role:"tab","aria-selected":r,className:["chip chip--key",r?"chip--active":""].join(" "),onClick:()=>{ep(e),(0,R.track)("scale_pick",{page:"find-key",scale:e.type,key:s.PC_NAMES[e.root]})},"data-roving":"item",children:[l," ",Math.round(e.score),"%"]},"".concat(l,"-").concat(a))})})]})]}):(0,t.jsx)("div",{className:"text-sm opacity-70",children:"Click Analyze to see results."})]}),(0,t.jsxs)("section",{className:"ot-card mt-2",children:[(0,t.jsx)(v,{children:"Tools"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"result-block",children:[(0,t.jsx)(b,{right:(0,t.jsxs)("div",{ref:h,className:"flex items-center gap-2 bg-transparent shadow-none fretboard-toggle","aria-label":"Fretboard notation",role:"tablist",children:[(0,t.jsx)("button",{role:"tab","aria-selected":"degrees"===ef,tabIndex:"degrees"===ef?0:-1,className:["chip chip--key","degrees"===ef?"chip--active":""].join(" "),onClick:()=>ex("degrees"),"data-roving":"item",children:"Degrees"}),(0,t.jsx)("button",{role:"tab","aria-selected":"names"===ef,tabIndex:eC&&"names"===ef?0:-1,"aria-disabled":!eC,className:["chip chip--key","names"===ef?"chip--active":"",!eC?"chip--disabled":""].join(" "),onClick:()=>{eC&&ex("names")},"data-roving":"item",children:"Names"})]}),children:"Fretboard"}),(0,t.jsx)("div",{className:"fret-wrap",children:(0,t.jsx)("div",{className:"fret-inner",children:eh?(()=>{let e=eh.root,a=(0,i.getScalePitchesById)(e,eh.type).map(e=>s.PC_NAMES[e]),n=eC?ef:"degrees",r=(()=>{let e=null==eh?void 0:eh.type;return e&&(e.toLowerCase().includes("aeolian")||e.toLowerCase().startsWith("min"))?"min":"maj"})();return(0,t.jsx)(l.default,{overlay:{viewMode:"sounding",capo:0,notes:a,chordNotes:null!=eb?eb:void 0,showScaleGhost:!!eb,display:n,scaleRootPc:e,scaleType:eh.type,context:{chordRootPc:e,quality:r}},onRequestForms:(t,a)=>{var n;ek({at:t,rootPc:null!=(n=a.rootPc)?n:e,quality:a.quality})},formShape:eN})})():(0,t.jsx)("div",{className:"text-center text-sm opacity-50 py-8",children:"Click Analyze to see fretboard"})})})]}),(0,t.jsxs)("section",{className:"result-block space-y-2",children:[(0,t.jsx)(b,{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"Diatonic"}),(0,t.jsxs)(y.default,{className:"ml-1",title:"Diatonic chords",linkHref:"/resources/glossary",linkLabel:"Glossary",children:[(0,t.jsx)("p",{className:"text-sm",children:"Chords built only from the key’s scale tones (I–ii–iii–IV–V–vi–vii°)."}),(0,t.jsxs)("ul",{className:"mt-2 list-disc pl-5 space-y-1 text-sm",children:[(0,t.jsx)("li",{children:"Stable sound: everything stays inside the key."}),(0,t.jsx)("li",{children:"Use: begin inside → add color with a borrowed chord (iv, bVII, bVI)."}),(0,t.jsx)("li",{children:"Try: ii–V–I or IV–V–I for clear motion."})]}),(0,t.jsx)("h4",{className:"mt-3 font-medium",children:"Shaped vs. Sounding (Capo)"}),(0,t.jsxs)("ul",{className:"mt-1 list-disc pl-5 space-y-1 text-sm",children:[(0,t.jsx)("li",{children:"Shaped: labels show the shapes you fret after capo."}),(0,t.jsx)("li",{children:"Sounding: labels show the actual pitch you hear."})]})]})]})}),(0,t.jsx)(N.default,{selectedId:ey,onSelectId:e=>ev(e),onPick:async e=>{let{id:t,pcs:a,isRightClick:n}=e;if(n){var r,l;let e=x.useAnalysisStore.getState().selectedKey,a=x.useAnalysisStore.getState().selectedScale;if(!e||!a)return;let n=a.type,o=null!=(r=i.SCALE_INTERVALS[n])?r:[];if(7!==o.length){let e=(0,i.parentModeOf)(n);e&&(o=null!=(l=i.SCALE_INTERVALS[e])?l:[])}if(7!==o.length)return;let s=(0,c.diatonicTriads)({tonicPc:e.tonic,scaleIntervals:o})[parseInt(t.replace("open-",""))];if(!s)return;let d=(0,c.triadToChordSym)({rootPc:s.rootPc,quality:s.quality}),u=[...P];u[B]=d,q(u),B<11&&D(B+1),(0,R.track)("diatonic_pick",{page:"find-key",action:"right_click_add"});return}if(ey===t){ew(null),ev(null),eI();return}ew(a.map(e=>s.PC_NAMES[e])),ev(t),eI(),(0,R.track)("diatonic_pick",{page:"find-key"});try{await V.player.resume();let e=a.map(e=>60+e%12);V.player.playChord(e,"lightStrum",260)}catch(e){}}})]}),eC&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b,{children:"Roman"}),(0,t.jsx)("div",{ref:tO,className:"rounded-md border px-3 py-2","aria-live":"polite","data-testid":"roman-row",children:(0,t.jsx)("div",{className:"flex-1 overflow-x-auto whitespace-nowrap text-lg md:text-xl tracking-wide",children:0===eo.length?(0,t.jsx)("span",{children:"-"}):eo.map((e,n)=>(0,t.jsxs)(a.default.Fragment,{children:[(0,t.jsx)("span",{"data-idx":n,className:tD&&n>=tD.start&&n<=tD.end?"roman-mark":void 0,children:String(e||"").toUpperCase()}),n<eo.length-1?(0,t.jsx)("span",{"aria-hidden":!0,className:"mx-1",children:"–"}):null]},"rom-".concat(n)))})})]}),tL.length>0&&(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs opacity-70",children:"Patterns"}),(()=>{var e;let a=tL[0],n={"doo-wop":"dooWop",axis:"axis",canon:"canon","ii-V-I":"twoFiveOne",turnaround:"turnaround",andalusian:"andalusian",authentic:"authentic",plagal:"plagal",deceptive:"deceptive"},r=n[a.id]?{label:I[e=n[a.id]],summary:C[e]}:null,l=(null==r?void 0:r.label)||a.name.replace(/\(([^)]+)\)/g,(e,t)=>{let a=t.replace(/[ivx]+/g,e=>e.toUpperCase());return"(".concat(a,")")}).replace(/\(I–vi–IV–V\)/,"(I–VI–IV–V)"),o=(null==r?void 0:r.summary)||a.summary||a.name;return tD&&tD.start===a.start&&(tD.end,a.end),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:"text-sm leading-tight font-medium hover:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/50 rounded",title:o,onClick:()=>{tz(e=>e&&e.start===a.start&&e.end===a.end?null:{start:Math.max(0,a.start),end:Math.max(a.start,Math.min(eo.length-1,a.end))}),requestAnimationFrame(()=>{let e=tO.current;if(!e)return;let t=e.querySelector('[data-idx="'.concat(a.start,'"]'));t&&(e.scrollLeft=Math.max(0,t.offsetLeft-12))})},children:l},"".concat(a.id,"-0")),(0,t.jsx)(y.default,{ariaLabel:"".concat(l," – info"),text:"".concat(l,"\n\n").concat(o)})]})})()]}),(tF.length>0||tU)&&(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs opacity-70",children:"Cadence"}),(()=>{var e,a,n,r,l,o,s;let i=null!=(e=tF[0])?e:tU,c=null!=(a=null==i?void 0:i.type)?a:i,d=null!=(n=null==i?void 0:i.tail)?n:null==i?void 0:i.tailRoman,u=c?"perfect"===c?"Perfect (".concat(null!=(r=null==d?void 0:d.from)?r:"V"," → ").concat(null!=(l=null==d?void 0:d.to)?l:"I",")"):"deceptive"===c?"Deceptive (".concat(null!=(o=null==d?void 0:d.from)?o:"V"," → ").concat(null!=(s=null==d?void 0:d.to)?s:"vi",")"):"Half (".concat((null==d?void 0:d.from)?"".concat(d.from," → "):"… → ","V)"):"";return(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5 text-sm leading-tight",children:[(0,t.jsx)("span",{className:"font-medium",children:u}),(0,t.jsx)(y.default,{text:c?"perfect"===c?"Resolves to the Tonic: V → I. Feels fully resolved.":"deceptive"===c?"Surprises by avoiding I: V → vi (or similar).":"Phrase ends on the Dominant: … → V. Feels unresolved.":"No cadence detected."})]})})()]})]})]}),(0,t.jsx)("section",{className:"ot-card","aria-label":"Ad",children:(0,t.jsx)(n.default,{page:"chord_progression",format:"horizontal"})}),tm&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",style:{backdropFilter:"blur(4px)"},children:(0,t.jsxs)("div",{ref:tf,className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Load Preset"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"text-xs opacity-70 mb-1 block",children:"Key"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map(e=>(0,t.jsx)("button",{className:"chip ".concat(tp===e?"chip--active":""),onClick:()=>tg(e),children:e},e))})]}),(0,t.jsxs)("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-V-vi-IV",["Ⅰ","Ⅴ","Ⅵm","Ⅳ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Pop progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("ii-V-I",["Ⅱm","Ⅴ","Ⅰ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅱm–Ⅴ–Ⅰ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Jazz turnaround"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("12-bar-blues",["Ⅰ","Ⅰ","Ⅰ","Ⅰ","Ⅳ","Ⅳ","Ⅰ","Ⅰ","Ⅴ","Ⅳ","Ⅰ","Ⅴ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"12-bar Blues"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Classic blues form (all 12 slots)"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-II",["Ⅰ","Ⅱ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅱ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Simple two-chord progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bVII-IV",["Ⅰ","♭Ⅶ","Ⅳ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Rock progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("vi-IV-I-V",["Ⅵm","Ⅳ","Ⅰ","Ⅴ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Emotional / Ballad (I-V-vi-IVの逆回転)"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-vi-IV-V",["Ⅰ","Ⅵm","Ⅳ","Ⅴ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅵm–Ⅳ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"50's progression / Doo-wop"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-IV-V",["Ⅰ","Ⅳ","Ⅴ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Three-chord song / Rock classic"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("vi-ii-V-I",["Ⅵm","Ⅱm","Ⅴ","Ⅰ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅱm–Ⅴ–Ⅰ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Circle progression / Jazz standard"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bVII-bVI-bVII",["Ⅰ","♭Ⅶ","♭Ⅵ","♭Ⅶ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–♭Ⅵ–♭Ⅶ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Mixolydian vamp / Rock anthem"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-IVm-I-V",["Ⅰ","Ⅳm","Ⅰ","Ⅴ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳm–Ⅰ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Borrowed chord / Minor IV"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("vi-IV-I-III",["Ⅵm","Ⅳ","Ⅰ","Ⅲ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅲ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Andalusian cadence / Spanish feel"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bIII-bVII-IV",["Ⅰ","♭Ⅲ","♭Ⅶ","Ⅳ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅲ–♭Ⅶ–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Modal interchange / Epic progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-iii-IV-V",["Ⅰ","Ⅲm","Ⅳ","Ⅴ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅳ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Classic progression / Beatles style"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-V-vi-iii-IV-I-IV-V",["Ⅰ","Ⅴ","Ⅵm","Ⅲm","Ⅳ","Ⅰ","Ⅳ","Ⅴ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅲm–Ⅳ–Ⅰ–Ⅳ–Ⅴ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Pachelbel's Canon / Wedding classic"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bVI-bVII-I",["Ⅰ","♭Ⅵ","♭Ⅶ","Ⅰ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅵ–♭Ⅶ–Ⅰ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Power ballad / 80s rock"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("vi-V-IV-III",["Ⅵm","Ⅴ","Ⅳ","Ⅲ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅵm–Ⅴ–Ⅳ–Ⅲ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Descending progression / Melancholic"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-IV-bVII-IV",["Ⅰ","Ⅳ","♭Ⅶ","Ⅳ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅳ–♭Ⅶ–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Folk/Country vamp"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bVII-IV-I",["Ⅰ","♭Ⅶ","Ⅳ","Ⅰ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ–Ⅰ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Stadium anthem / Closing progression"})]}),(0,t.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-iii-vi-IV",["Ⅰ","Ⅲm","Ⅵm","Ⅳ"],tp),children:[(0,t.jsx)("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅵm–Ⅳ"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Smooth descent / R&B style"})]})]}),(0,t.jsx)("button",{className:"mt-4 w-full px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600",onClick:()=>th(!1),children:"Cancel"})]})}),tj&&(0,t.jsx)(eD,{message:tj.message,type:tj.type,ctaText:tj.ctaText,ctaHref:tj.ctaHref,ctaPlace:tj.ctaPlace,onClose:()=>tk(null)})]})}}]);