exports.id=498,exports.ids=[498],exports.modules={5303:()=>{},2945:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>en});var s=a(326),n=a(7577),r=a.n(n),o=a(3345),i=a(3079),l=a(2331),c=a(3894),d=a(3934),m=a(920);let u={0:0,2:1,4:2,5:3,7:4,9:5,11:6},h={0:0,2:1,3:2,5:3,7:4,8:5,10:6},p=["I","ii","iii","IV","V","vi","vii\xb0"],g=["i","ii\xb0","III","iv","v","VI","VII"];function x(e){return/maj7|M7/.test(e)}var y=a(2534);function f({children:e,className:t="",right:a,as:n="h2"}){return(0,s.jsxs)("div",{className:`mb-2 flex items-center gap-2 ${t}`,children:[s.jsx(n,{className:"text-xl md:text-2xl font-semibold tracking-tight text-foreground",children:e}),a?s.jsx("div",{className:"ml-auto",children:a}):null]})}function b({children:e,className:t="",right:a,as:n="h3"}){return(0,s.jsxs)("div",{className:`mb-1.5 flex items-center gap-2 ${t}`,children:[s.jsx(n,{className:"text-sm md:text-base font-semibold tracking-wide text-foreground",children:e}),a?s.jsx("div",{className:"ml-auto text-xs md:text-sm text-muted-foreground",children:a}):null]})}var v=a(6961),j=a(4666),w=a(8602),k=a(4552);let N=["6","m6","9","m9","11","M11","13","M13","7b5","7#5","7b9","7#9","7#11","7b13","7alt","dim7","m7b5","sus2","add9","add11","add13","6/9","aug","mM7","/bass"];var I=a(7639),C=a(2784);let S={dooWop:"Doo‑Wop (I–VI–IV–V)",axis:"Axis (I–V–vi–IV)",canon:"Canon (I–V–vi–iii–IV–I–IV–V)",twoFiveOne:"ii–V–I",turnaround:"Turnaround",andalusian:"Andalusian cadence",authentic:"Perfect cadence (V → I)",plagal:"Plagal cadence (IV → I)",deceptive:"Deceptive cadence (V → vi)"},M={dooWop:"’50s progression. Nostalgic loop: tonic → relative minor → subdominant → dominant. Try adding 7ths for color.",axis:"Modern pop staple. A catchy loop that feels forward yet stable. Swap to ii–V at the end for a stronger landing.",canon:"Pachelbel‑style ground. Persistent bass motion with rotating functions; great for variations and melodies.",twoFiveOne:"The classic run‑up then land. Link by guide tones (3rd↔7th). Works anywhere you want a clear resolution.",turnaround:"Short cycle that brings you back to the top (e.g., I–VI7–ii7–V7). Use at phrase ends or between sections.",andalusian:"Descending minor flavor (e.g., i–♭VII–♭VI–V). Adds drama; land clearly on the target chord.",authentic:"Strong homecoming: dominant pulls into tonic. Extend V with 7/9/13; keep the landing clean on I.",plagal:"Gentler IV → I resolution. Use to soften endings or after a bright Lydian moment.",deceptive:"Twist the expectation: V → vi instead of I. Keeps energy moving; return to I later for closure."};var V=a(8936);let P="ot_sketches",A=()=>JSON.parse(localStorage.getItem(P)||"[]"),R=e=>{let t=A().filter(t=>t.id!==e.id);return(t.unshift(e),t.length>3)?(localStorage.setItem(P,JSON.stringify(t.slice(0,3))),{ok:!1,reason:"limit_exceeded"}):(localStorage.setItem(P,JSON.stringify(t)),{ok:!0})},D=async e=>({ok:!0});var E=a(3683);let q=e=>{let[t,a]=(0,n.useState)(null),s=(0,n.useRef)(null),r=()=>{s.current&&window.clearTimeout(s.current),s.current=window.setTimeout(()=>{t&&(async()=>{let a=e?await D(t):R(t);!a.ok&&"reason"in a&&"limit_exceeded"===a.reason?E.j("project_limit_warn",{page:"chord_progression"}):E.j("save_project",{page:"chord_progression"})})()},3e3)};return(0,n.useEffect)(()=>{r()},[t]),{sketch:t,setSketch:a}};var z=a(8408);let T=()=>Math.random().toString(36).substr(2,9),_=(0,z.U)((e,t)=>({sketches:[],currentSketch:null,isLoading:!1,error:null,loadSketches:()=>{e({isLoading:!0,error:null});try{let t=A();e({sketches:t,isLoading:!1})}catch(t){e({error:"Failed to load sketches",isLoading:!1})}},saveSketch:async t=>{let a={...t,id:T(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(R(a).ok)return e({sketches:A(),currentSketch:a}),{ok:!0};try{await D(a);let t=A();return e({sketches:t,currentSketch:a}),{ok:!0}}catch(e){return{ok:!1,reason:"cloud_save_failed"}}},loadSketch:a=>{let s=t().sketches.find(e=>e.id===a);s&&e({currentSketch:s})},deleteSketch:a=>{let s=t().sketches.filter(e=>e.id!==a);localStorage.setItem("ot_sketches",JSON.stringify(s)),e({sketches:s}),t().currentSketch?.id===a&&e({currentSketch:null})},duplicateSketch:a=>{let s=t().sketches.find(e=>e.id===a);if(s){let t={...s,id:T(),name:`${s.name} Copy`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};R(t).ok&&e({sketches:A(),currentSketch:t})}},renameSketch:(a,s)=>{let n=t().sketches.map(e=>e.id===a?{...e,name:s,updatedAt:new Date().toISOString()}:e);if(localStorage.setItem("ot_sketches",JSON.stringify(n)),e({sketches:n}),t().currentSketch?.id===a){let a=t().currentSketch;a&&e({currentSketch:{...a,name:s,updatedAt:new Date().toISOString()}})}},startAutoSave:a=>setTimeout(()=>{let s=t();if(s.currentSketch?.id===a.id){let t={...a,updatedAt:new Date().toISOString()};R(t).ok&&e({sketches:A(),currentSketch:t})}},3e3),stopAutoSave:()=>{}}));var F=a(7546);let J=!1;async function B(e,t="auto"){if(!J){J=!0;try{let a=e.style.opacity,s=e.style.visibility;e.style.opacity="1",e.style.visibility="visible";let n=e.querySelectorAll("*"),r=[];n.forEach(e=>{let t=e.style.color,a=e.style.fill,s=e.style.background;if(r.push({elem:e,color:t,fill:a,bg:s}),e.style.color="#000000",("text"===e.tagName||"tspan"===e.tagName)&&(e.style.fill="#000000"),"SPAN"===e.tagName&&e.className.includes("inline-block")){let t=e.textContent?.trim();t&&/^\d+$/.test(t)&&(e.style.background="#f3f4f6",e.style.color="#000000")}}),await new Promise(e=>setTimeout(e,150)),e.dataset.export=t;let o=await (0,F.YM)(e,{pixelRatio:2,backgroundColor:"#ffffff",cacheBust:!0});e.style.opacity=a,e.style.visibility=s,r.forEach(({elem:e,color:t,fill:a,bg:s})=>{e.style.color=t,e.style.fill=a,e.style.background=s});let i=document.createElement("a");i.href=o,i.download="ot-progression.png",i.click(),E.j("export_png",{page:"chord_progression",ok:!0})}catch(e){E.j("export_png",{page:"chord_progression",ok:!1,err:String(e)})}finally{e.removeAttribute("data-export"),J=!1}}}var O=a(2586),U=a(2672);let $={info:"bg-blue-600",success:"bg-green-600",warning:"bg-orange-600"};function L({message:e,type:t="info",ctaText:a,ctaHref:r,ctaPlace:o,onClose:i,duration:l=5e3}){let{trackClick:c}=(0,U.Z)(),d=(0,n.useCallback)(()=>{o&&c(o)},[o,c]),m=$[t];return s.jsx("div",{className:"fixed bottom-20 sm:bottom-6 left-1/2 -translate-x-1/2 z-50 animate-slide-up max-w-md w-full mx-4",role:"alert","aria-live":"polite",children:(0,s.jsxs)("div",{className:`${m} text-white rounded-lg shadow-2xl p-4 flex items-center justify-between gap-3`,children:[s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx("p",{className:"text-sm font-medium",children:e})}),a&&r&&s.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 px-3 py-1.5 text-sm font-medium bg-white/20 hover:bg-white/30 rounded transition-colors",onClick:d,children:a}),s.jsx("button",{onClick:i,className:"flex-shrink-0 w-6 h-6 flex items-center justify-center hover:bg-white/20 rounded transition-colors","aria-label":"Close notification",children:"✕"})]})})}var H=a(5209),W=a(5047);let G={plan:"free",notationStyle:"english"},Z=new Set(["7b9","7#9","7#11","7b13","7alt","13","M13","m13"]),K=[{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"Major",commentJa:"雰囲気: 明るくポジティブ。物語の始まりやサビにふさわしい、安定感と幸福感に満ちた響きです。\n利用シーン: J-POP、ロック、フォーク、童謡など、あらゆる音楽の基本となるコード。楽曲の骨格を形成します。\n使ってみよう: 曲の最も盛り上がる部分や、リスナーに安心感を与えたい場面で使ってみよう。ここぞという時の主役になります。\n理論: 構成音はR-3-5。メジャースケール（イオニアン）上で完璧に調和し、ダイアトニックのI度、IV度、V度で登場します。",commentEn:"雰囲気: Bright and positive. A sound full of stability and happiness, perfect for the start of a story or a chorus.\n利用シーン: The fundamental chord in all music, from J-Pop and rock to folk. It forms the skeleton of a song.\n使ってみよう: Use it in the most climactic parts of a song or when you want to give the listener a sense of security.\n理論: Composed of R-3-5. It harmonizes perfectly with the Major (Ionian) scale and appears as the I, IV, and V chords."},{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"m (minor)",commentJa:"雰囲気: 少し切なく、落ち着いた雰囲気。喜びだけでなく、哀愁や内省的な感情を表現するのに最適です。\n利用シーン: バラード、ロック、R&Bなど、深みのある楽曲には欠かせない存在。メジャーとの対比が曲にドラマを生みます。\n使ってみよう: Aメロで静かに始めたい時や、サビ後のクールダウン、感情的な歌詞に乗せて使ってみましょう。\n理論: 構成音はR-b3-5。b3(短3度)の音が特徴です。ナチュラルマイナースケール（エオリアン）の基本コードになります。",commentEn:"雰囲気: Slightly sad and calm. Perfect for expressing not just joy, but also melancholy and introspection.\n利用シーン: Essential for deep songs like ballads, rock, and R&B. Its contrast with major chords creates drama.\n使ってみよう: Use it to start a verse quietly, to cool down after a chorus, or to accompany emotional lyrics.\n理論: Composed of R-b3-5. The b3rd is its key feature. It's the basic chord of the Natural Minor (Aeolian) scale."},{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"7",commentJa:"雰囲気: 少し不安定で、次へ進みたいという推進力を持つサウンド。ブルージーでおしゃれな緊張感が魅力です。\n利用シーン: ブルース、ジャズ、ファンク、ロックンロールの魂。楽曲にドライブ感と解決への期待感を与えます。\n使ってみよう: サビの直前（V7）に置いて、解決感を劇的に高めてみましょう。ブルース進行の主役としても活躍します。\n理論: 構成音はR-3-5-b7。ミクソリディアンスケール上で自然に発生。V7→Iという最強の進行（ドミナントモーション）を作ります。",commentEn:"雰囲気: A slightly unstable sound with a drive to move forward. Its bluesy, stylish tension is captivating.\n利用シーン: The soul of blues, jazz, and funk. It gives a song drive and anticipation for resolution.\n使ってみよう: Place it right before the chorus (as a V7) to dramatically enhance the feeling of resolution.\n理論: Composed of R-3-5-b7. It naturally occurs on the Mixolydian scale and creates the powerful V7→I progression (dominant motion)."},{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"maj7",commentJa:"雰囲気: 明るさの中に洗練された都会的な響きが同居。爽やかな風が吹くような、開放的でおしゃれなサウンドです。\n利用シーン: J-POP、R&B、ジャズ、ボサノヴァの定番。楽曲の始まりや終わりに使うと、余韻のある雰囲気を演出できます。\n使ってみよう: 明るい曲のトニックコード(I)をこれ(Imaj7)に変えてみましょう。一瞬でサウンドが洗練され、シティポップ模が生まれます。\n理論: 構成音はR-3-5-7。長7度の音が特徴です。メジャースケール（イオニアン）やリディアンスケールと相性抜群です。",commentEn:"雰囲気: A sophisticated, urban sound within a bright context. Open and stylish, like a fresh breeze.\n利用シーン: A staple in J-Pop, R&B, and jazz. Using it at the beginning or end of a song creates a lingering atmosphere.\n使ってみよう: Change the tonic chord (I) of a bright song to Imaj7. The sound will instantly become more refined.\n理論: Composed of R-3-5-7. The major 7th is its key feature. It pairs perfectly with the Major (Ionian) and Lydian scales."},{tier:"Free",categoryJa:"基本",categoryEn:"Basics",quality:"m7",commentJa:"雰囲気: マイナーの切なさに、ジャズやソウルの香りを加えた、少し大人びた響き。クールで落ち着いています。\n利用シーン: ジャズのスタンダードやR&B、ファンク、AORで頻繁に使われる、マイナーキーの基本的な和音です。\n使ってみよう: マイナーキーの曲で、トニックコード(Im)をこれ(Im7)に変えてみましょう。ただ暗いだけでない、知的な雰囲気に変わります。\n理論: 構成音はR-b3-5-b7。ナチュラルマイナー（エオリアン）やドリアンスケール上で発生します。",commentEn:"雰囲気: Adds a touch of jazz and soul to minor sadness, creating a mature, cool, and calm sound.\n利用シーン: The fundamental minor chord in jazz standards, R&B, and funk.\n使ってみよう: In a minor key song, change the tonic chord from Im to Im7. It will shift the mood from simply dark to something more intelligent.\n理論: Composed of R-b3-5-b7. It occurs on the Natural Minor (Aeolian) and Dorian scales."},{tier:"Free",categoryJa:"基本の飾り付け",categoryEn:"Essential Colors",quality:"sus4",commentJa:"雰囲気: メジャーでもマイナーでもない、解決を焦らす浮遊感。リスナーの期待感をグッと高める効果があります。\n利用シーン: ポップス、ロック、ファンクなどジャンルを問わず使われる。特にAメロからBメロへの繋ぎなどで効果的です。\n使ってみよう: V7の前に置き(V7sus4)、より劇的な解決感を演出してみましょう。アコギのストロークで使うと響きが豊かになります。\n理論: 3度の音を4度にした(R-4-5)コード。susはSuspended(吊るされた)の略で、3度への解決を待ち望んでいます。",commentEn:'雰囲気: A floating feel, neither major nor minor, that delays resolution and builds anticipation in the listener.\n利用シーン: Used across all genres. Especially effective for transitions, like from a verse to a bridge.\n使ってみよう: Place it before a V7 (as V7sus4) to create a more dramatic resolution. It sounds rich in acoustic strumming.\n理論: Replaces the 3rd with a 4th (R-4-5). "Sus" is short for Suspended, as it longs to resolve to the 3rd.'},{tier:"Free",categoryJa:"基本の飾り付け",categoryEn:"Essential Colors",quality:"sus2",commentJa:"雰囲気: sus4よりも、さらに明るく爽やかで、キラキラした浮遊感。若々しさや純粋さを感じさせます。\n利用シーン: J-POPやロックバラードのイントロやアルペジオで多用される。澄んだ響きがアコースティックギターによく合います。\n使ってみよう: メジャーコードの代わりに一瞬だけ使ってみましょう。サウンドに爽やかな風が吹き込み、単調さがなくなります。\n理論: 3度の音を2度にした(R-2-5)コード。ポップスではadd9に近い響きの飾り（embellishment）として使われます。",commentEn:"雰囲気: Brighter and fresher than sus4, with a sparkling floatiness that evokes youthfulness and purity.\n利用シーン: Often used in intros and arpeggios of J-Pop and rock ballads. Its clear sound suits acoustic guitars.\n使ってみよう: Briefly substitute it for a major chord. It will add a fresh breeze to your sound and break up monotony.\n理論: Replaces the 3rd with a 2nd (R-2-5). In pop, it's often used as an embellishment with a sound similar to add9."},{tier:"Free",categoryJa:"基本の飾り付け",categoryEn:"Essential Colors",quality:"add9",commentJa:"雰囲気: 通常のコードに、透明感や希望の光を一筋加える、感動的な響き。サウンドに広がりと彩りを与えます。\n利用シーン: 現代のポップス、ロック、バラードではなくてはならない存在。特にピアノやギターのアルペジオで美しい響きを生みます。\n使ってみよう: サビの最後のコードをこれに変えてみましょう。曲のエンディングに、感動的な余韻と広がりが生まれます。\n理論: メジャー(R-3-5)に9度の音を追加したコード。9度は2度と同じ音ですが、3度と共存しているのがポイントです。",commentEn:"雰囲気: An emotional sound that adds a layer of transparency and hope to a basic chord, creating spaciousness and color.\n利用シーン: An indispensable chord in modern pop, rock, and ballads. It sounds beautiful in piano or guitar arpeggios.\n使ってみよう: Change the last chord of the chorus to this one. It will create a moving, expansive finish to your song.\n理論: Adds a 9th note to a major triad (R-3-5-9). The 9th is the same note as the 2nd, but the key is its coexistence with the 3rd."},{tier:"Free",categoryJa:"基本の飾り付け",categoryEn:"Essential Colors",quality:"dim",commentJa:"雰囲気: 不気味で、聴き手を不安にさせるスリリングな響き。物語にサスペンスやミステリーの要素を加えます。\n利用シーン: ジャズやクラシックで、コードとコードを滑らかに繋ぐ「経過コード」として使われるのが定石です。\n使ってみよう: Bdimのような経過コードをCとAmの間に挟んでみましょう。ベースラインが滑らかになり、プロっぽい響きになります。\n理論: 構成音はR-b3-b5。不安定なトライトーン(b5)が強い緊張感を生み出します。",commentEn:'雰囲気: A spooky, thrilling sound that creates unease, adding an element of suspense or mystery to a story.\n利用シーン: A classic "passing chord" in jazz and classical music used to smoothly connect other chords.\n使ってみよう: Insert a passing chord like Bdim between C and Am. The bassline will become smoother and sound more professional.\n理論: Composed of R-b3-b5. Its unstable tritone interval (b5) generates strong tension.'},{tier:"Pro",categoryJa:"✨ キラキラ・浮遊感",categoryEn:"Sparkle & Float",quality:"M9 (maj9)",commentJa:"雰囲気: maj7をさらに進化させた、優雅で甘美、夢見心地な響き。ラグジュアリーな空間を演出します。\n利用シーン: R&B、ネオソウル、フュージョンの王道サウンド。これ一つで曲のおしゃれ度が格段にアップします。\n使ってみよう: 静かなバラードのトニックコード(Imaj7)をこれ(Imaj9)にしてみましょう。サウンドに深みと極上の甘さが加わります。\n理論: maj7(R-3-5-7)に9度の音を追加したコード。リディアンスケールとの相性は最高です。",commentEn:"雰囲気: An evolution of maj7, creating an elegant, sweet, and dreamy atmosphere. Evokes a sense of luxury.\n利用シーン: The quintessential sound of R&B, Neo-Soul, and Fusion. It instantly elevates the chicness of a song.\n使ってみよう: In a quiet ballad, change the tonic Imaj7 to Imaj9. It will add depth and a sublime sweetness to the sound.\n理論: Adds a 9th to a maj7 chord (R-3-5-7-9). It has a fantastic compatibility with the Lydian scale."},{tier:"Pro",categoryJa:"✨ キラキラ・浮遊感",categoryEn:"Sparkle & Float",quality:"6",commentJa:"雰囲気: maj7よりも少しだけ素朴で、温かくレトロな雰囲気。50-60年代のような、懐かしい響きです。\n利用シーン: 古き良き時代のジャズやポップス、ハワイアン音楽で多用される。サウンドを柔らかく、穏やかにします。\n使ってみよう: maj7の代わりに使ってみましょう。特に曲のエンディングで使うと、ハッピーエンドの映画のような、温かい余韻が残ります。\n理論: メジャー(R-3-5)に長6度の音を加えたコード。トニックコード(I)のバリエーションとして使えます。",commentEn:"雰囲気: A bit simpler and warmer than maj7, with a nostalgic, retro vibe like the 50s-60s.\n利用シーン: Frequently used in old-time jazz, pop, and Hawaiian music. It softens the sound and makes it gentle.\n使ってみよう: Use it instead of maj7. Especially at the end of a song, it leaves a warm afterglow, like a happy-ending movie.\n理論: Adds a major 6th to a major triad (R-3-5-6). It can be used as a variation of the tonic chord (I)."},{tier:"Pro",categoryJa:"✨ キラキラ・浮遊感",categoryEn:"Sparkle & Float",quality:"6/9",commentJa:"雰囲気: 6コードの温かさとadd9のキラキラ感を併せ持つ、非常に豊かでゴージャスな響き。\n利用シーン: ジャズピアノのエンディングなどで聴ける、幸福感に満ちたサウンド。フュージョンやAORでも使われます。\n使ってみよう: 曲の最後の最後、全ての音が消える直前のキメの和音として使ってみましょう。最高の多幸感を演出できます。\n理論: R-3-5に6度と9度の両方を加えた贅沢なコード。構成音が多く、豊かな倍音を生み出します。",commentEn:"雰囲気: Combines the warmth of a 6 chord with the sparkle of an add9, creating a rich, gorgeous, and happy sound.\n利用シーン: A blissful sound often heard at the end of jazz piano pieces, also used in Fusion and AOR.\n使ってみよう: Use it as the final, ultimate chord of a song right before everything fades to silence for maximum euphoria.\n理論: A luxurious chord adding both the 6th and 9th to a triad (R-3-5-6-9). Its many notes create rich overtones."},{tier:"Pro",categoryJa:"✨ キラキラ・浮遊感",categoryEn:"Sparkle & Float",quality:"add#11",commentJa:"雰囲気: 現代的でドリーミーな、まさに「浮遊感」のあるサウンド。宇宙的な広がりと神秘的な美しさを感じさせます。\n利用シーン: ニューエイジ、アンビエント、現代ジャズで使われる、未来感のあるサウンド。映画音楽やゲーム音楽でも効果的です。\n使ってみよう: 静かな曲のエンディングや、間奏のアクセントとして使ってみましょう。聴き手を別世界に連れて行く効果があります。\n理論: R-3-5に#11度（4度の半音上）を加えたコード。リディアンスケールとの相性が抜群です。",commentEn:'雰囲気: A modern, dreamy sound that truly gives a "floating" feel. Evokes cosmic expansiveness and mystical beauty.\n利用シーン: A futuristic sound used in New Age, Ambient, and modern jazz. Also effective in film and game music.\n使ってみよう: Use it at the end of quiet songs or as accent chords in interludes. It has the effect of transporting listeners to another world.\n理論: Adds a #11th (a semitone above the 4th) to R-3-5. It has an excellent compatibility with the Lydian scale.'},{tier:"Pro",categoryJa:"\uD83C\uDF03 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"m9",commentJa:"雰囲気: m7をさらにスムーズで洗練させた響き。大人の余裕と知的な魅力を感じさせます。\n利用シーン: ジャズ、フュージョン、AORの定番。特に都市的な雰囲気を演出したい時に威力を発揮します。\n使ってみよう: m7の代わりに使ってみましょう。サウンドがより洗練され、大人っぽい雰囲気になります。\n理論: m7(R-b3-5-b7)に9度の音を追加したコード。ドリアンスケールとの相性が抜群です。",commentEn:"雰囲気: An even smoother and more refined sound than m7. Evokes adult sophistication and intellectual charm.\n利用シーン: A staple in jazz, fusion, and AOR. Particularly effective when creating an urban atmosphere.\n使ってみよう: Use it instead of m7. The sound will become more refined and mature.\n理論: Adds a 9th to an m7 chord (R-b3-5-b7-9). It has an excellent compatibility with the Dorian scale."},{tier:"Pro",categoryJa:"\uD83C\uDF03 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"m11",commentJa:"雰囲気: Lo-fi Hip HopやR&Bで定番の、少しアンニュイなサウンド。都会の夜を思わせる大人の雰囲気です。\n利用シーン: 都市的な音楽、特にLo-fi、R&B、ネオソウルで多用される。落ち着いた夜の雰囲気を演出できます。\n使ってみよう: 静かな夜の曲や、大人の恋愛をテーマにした楽曲で使ってみましょう。深い感情を表現できます。\n理論: m7に11度を加えたコード。エオリアンスケールとの相性が良く、複雑な感情を表現します。",commentEn:"雰囲気: A standard sound in Lo-fi Hip Hop and R&B, with a slightly melancholic vibe. Evokes the atmosphere of urban nights.\n利用シーン: Frequently used in urban music, especially Lo-fi, R&B, and Neo-Soul. Can create a calm night atmosphere.\n使ってみよう: Use it in quiet night songs or songs about adult romance. It can express deep emotions.\n理論: Adds an 11th to an m7 chord. It pairs well with the Aeolian scale and expresses complex emotions."},{tier:"Pro",categoryJa:"\uD83C\uDF03 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"m7b5",commentJa:"雰囲気: ジャズの王道コード。少し不安定で、解決への期待感が強い、知的で洗練された響きです。\n利用シーン: ジャズスタンダードのIIm7b5として頻繁に使われる。特にマイナーキーの楽曲で重要な役割を果たします。\n使ってみよう: Dm7b5-G7-Cmのような進行で使ってみましょう。クラシックなジャズの雰囲気が演出できます。\n理論: R-b3-b5-b7の構成音。ロクリアンスケール上で発生し、強い解決感を生み出します。",commentEn:"雰囲気: A classic jazz chord. Slightly unstable with a strong anticipation for resolution, creating an intellectual and refined sound.\n利用シーン: Frequently used as IIm7b5 in jazz standards. Plays an important role especially in minor key songs.\n使ってみよう: Use it in progressions like Dm7b5-G7-Cm to create a classic jazz atmosphere.\n理論: Composed of R-b3-b5-b7. It occurs on the Locrian scale and creates a strong sense of resolution."},{tier:"Pro",categoryJa:"\uD83C\uDF03 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"mM7",commentJa:"雰囲気: マイナーの暗さとメジャー7の明るさが混在した、複雑で魅力的な響き。矛盾が生み出す美しさがあります。\n利用シーン: ジャズ、フュージョン、映画音楽で使われる、大人のサウンド。特に神秘的な雰囲気を演出したい時に効果的です。\n使ってみよう: 静かなバラードや、少し暗めの楽曲で使ってみましょう。独特の魅力が生まれます。\n理論: R-b3-5-7の構成音。ハーモニックマイナースケールの特徴的なコードです。",commentEn:"雰囲気: A complex and attractive sound that mixes the darkness of minor with the brightness of major 7. The beauty of contradiction.\n利用シーン: An adult sound used in jazz, fusion, and film music. Particularly effective when creating a mysterious atmosphere.\n使ってみよう: Use it in quiet ballads or slightly dark songs. It creates a unique charm.\n理論: Composed of R-b3-5-7. It's a characteristic chord of the Harmonic Minor scale."},{tier:"Pro",categoryJa:"\uD83C\uDF03 おしゃれ・都会的",categoryEn:"Stylish & Urban",quality:"m6",commentJa:"雰囲気: m7よりも少し明るく、懐かしさを感じさせる響き。レトロな魅力と現代的な洗練さを併せ持ちます。\n利用シーン: ジャズ、ボサノヴァ、アンビエントで使われる。特に落ち着いた雰囲気を演出したい時に効果的です。\n使ってみよう: 静かな夜の曲や、大人の雰囲気の楽曲で使ってみましょう。深い余韻が生まれます。\n理論: R-b3-5-6の構成音。ドリアンスケールとの相性が良く、安定感と動きのバランスが取れています。",commentEn:"雰囲気: A slightly brighter sound than m7, evoking a sense of nostalgia. Combines retro charm with modern sophistication.\n利用シーン: Used in jazz, bossa nova, and ambient music. Particularly effective when creating a calm atmosphere.\n使ってみよう: Use it in quiet night songs or songs with an adult atmosphere. It creates a deep afterglow.\n理論: Composed of R-b3-5-6. It pairs well with the Dorian scale and balances stability with movement."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7sus4",commentJa:"雰囲気: V7の前に置くことで、解決感を劇的に高めるプロの技。緊張感と解決感のコントラストが美しいです。\n利用シーン: ジャズ、ファンク、ロックで使われる高度なテクニック。特にドラマチックな効果を演出したい時に威力を発揮します。\n使ってみよう: C-F-G7sus4-G7のような進行で使ってみましょう。解決感がより劇的になります。\n理論: V7コードの3度を4度に置き換えたコード。sus4の浮遊感が解決への期待感を高めます。",commentEn:"雰囲気: A pro technique that dramatically enhances the feeling of resolution when placed before a V7 chord. The contrast between tension and resolution is beautiful.\n利用シーン: An advanced technique used in jazz, funk, and rock. Particularly effective when creating dramatic effects.\n使ってみよう: Use it in progressions like C-F-G7sus4-G7. The resolution will become more dramatic.\n理論: Replaces the 3rd of a V7 chord with a 4th. The floating feel of sus4 enhances anticipation for resolution."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"aug",commentJa:"雰囲気: 不安定で、次のコードへ進む推進力が強い。緊張感と動きのエネルギーを感じさせます。\n利用シーン: ジャズ、クラシック、映画音楽で使われる。特に緊張感を高めたい時に効果的です。\n使ってみよう: C-Caug-Fのような進行で使ってみましょう。ベースラインが滑らかになり、プロっぽい響きになります。\n理論: R-3-#5の構成音。増5度の音が強い緊張感を生み出し、解決への推進力を与えます。",commentEn:"雰囲気: An unstable sound with a strong drive to move to the next chord. Evokes tension and dynamic energy.\n利用シーン: Used in jazz, classical, and film music. Particularly effective when increasing tension.\n使ってみよう: Use it in progressions like C-Caug-F. The bassline will become smoother and sound more professional.\n理論: Composed of R-3-#5. The augmented 5th creates strong tension and provides drive toward resolution."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"dim7",commentJa:"雰囲気: 経過コードとして非常に便利。緊張感を一気に高める、プロのテクニックです。\n利用シーン: ジャズ、クラシック、映画音楽で頻繁に使われる。コードとコードを滑らかに繋ぐのに最適です。\n使ってみよう: C-Bdim7-Cmのような進行で使ってみましょう。ベースラインが滑らかになり、プロっぽい響きになります。\n理論: R-b3-b5-bb7の構成音。減7度の音が強い緊張感を生み出し、解決への期待感を高めます。",commentEn:"雰囲気: Very useful as a passing chord to instantly increase tension. A professional technique.\n利用シーン: Frequently used in jazz, classical, and film music. Perfect for smoothly connecting chords.\n使ってみよう: Use it in progressions like C-Bdim7-Cm. The bassline will become smoother and sound more professional.\n理論: Composed of R-b3-b5-bb7. The diminished 7th creates strong tension and enhances anticipation for resolution."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7(#9)",commentJa:"雰囲気: ブルージーでロックな緊張感。エネルギッシュで情熱的な響きが特徴です。\n利用シーン: ブルース、ロック、ファンクで多用される。特に激しい感情を表現したい時に効果的です。\n使ってみよう: C7(#9)-Fのような進行で使ってみましょう。ブルージーで情熱的な雰囲気が演出できます。\n理論: R-3-5-b7-#9の構成音。#9度の音がブルージーな緊張感を生み出します。",commentEn:"雰囲気: A bluesy and rock-oriented tension. Characterized by energetic and passionate sound.\n利用シーン: Frequently used in blues, rock, and funk. Particularly effective when expressing intense emotions.\n使ってみよう: Use it in progressions like C7(#9)-F. It can create a bluesy and passionate atmosphere.\n理論: Composed of R-3-5-b7-#9. The #9th creates a bluesy tension."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7(b9)",commentJa:"雰囲気: ジャズで多用される強い緊張感。知的で洗練された響きが特徴です。\n利用シーン: ジャズスタンダードで頻繁に使われる。特にマイナーキーの楽曲で重要な役割を果たします。\n使ってみよう: Dm7b5-G7(b9)-Cmのような進行で使ってみましょう。クラシックなジャズの雰囲気が演出できます。\n理論: R-3-5-b7-b9の構成音。b9度の音が強い緊張感を生み出し、解決への期待感を高めます。",commentEn:"雰囲気: A strong tension frequently used in Jazz. Characterized by an intellectual and refined sound.\n利用シーン: Frequently used in jazz standards. Plays an important role especially in minor key songs.\n使ってみよう: Use it in progressions like Dm7b5-G7(b9)-Cm. It can create a classic jazz atmosphere.\n理論: Composed of R-3-5-b7-b9. The b9th creates strong tension and enhances anticipation for resolution."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7(#5)",commentJa:"雰囲気: augと同じ。解決先を強く示す、エネルギッシュな響きです。\n利用シーン: ジャズ、ロック、ファンクで使われる。特に緊張感を高めたい時に効果的です。\n使ってみよう: C7(#5)-Fのような進行で使ってみましょう。解決感がより劇的になります。\n理論: R-3-#5-b7の構成音。増5度の音が強い緊張感を生み出し、解決への推進力を与えます。",commentEn:"雰囲気: Same as augmented. Strongly indicates the point of resolution with an energetic sound.\n利用シーン: Used in jazz, rock, and funk. Particularly effective when increasing tension.\n使ってみよう: Use it in progressions like C7(#5)-F. The resolution will become more dramatic.\n理論: Composed of R-3-#5-b7. The augmented 5th creates strong tension and provides drive toward resolution."},{tier:"Pro",categoryJa:"⚡️ 緊張感・スパイス",categoryEn:"Tension & Spice",quality:"7(b13)",commentJa:"雰囲気: 複雑でムーディーな緊張感。深みのある感情を表現するのに最適です。\n利用シーン: ジャズ、フュージョン、映画音楽で使われる。特に複雑な感情を表現したい時に効果的です。\n使ってみよう: C7(b13)-Fのような進行で使ってみましょう。深い余韻が生まれます。\n理論: R-3-5-b7-b13の構成音。b13度の音が複雑な緊張感を生み出します。",commentEn:"雰囲気: A complex and moody tension. Perfect for expressing deep emotions.\n利用シーン: Used in jazz, fusion, and film music. Particularly effective when expressing complex emotions.\n使ってみよう: Use it in progressions like C7(b13)-F. It creates a deep afterglow.\n理論: Composed of R-3-5-b7-b13. The b13th creates a complex tension."}],Y=e=>K.find(t=>t.quality===e),X=(e,t)=>{let a=Y(e);return a?"ja"===t?a.commentJa:a.commentEn:""},Q=e=>{let t=K.filter(t=>t.tier===e),a={};return t.forEach(e=>{a[e.categoryJa]||(a[e.categoryJa]=[]),a[e.categoryJa].push(e)}),a};function ee({title:e,body:t,isOpen:a,onClose:n}){if(!a)return null;let r=(e=>{let t=e.split("\n"),a=[],s="",n="";for(let e of t){let t=e.trim();if(t.includes(":")&&(t.startsWith("Vibe:")||t.startsWith("Usage:")||t.startsWith("Try:")||t.startsWith("Theory:")||t.startsWith("雰囲気:")||t.startsWith("利用シーン:")||t.startsWith("使ってみよう:")||t.startsWith("理論:"))){s&&n&&a.push({title:s,content:n.trim()});let e=t.indexOf(":");s=t.substring(0,e),n=t.substring(e+1).trim()}else t&&(n?n+="\n"+e:n=e)}return s&&n&&a.push({title:s,content:n.trim()}),a})(t);return s.jsx("div",{className:"fixed inset-0 z-50",onClick:n,children:s.jsx("div",{className:"absolute top-16 left-1/2 transform -translate-x-1/2",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 w-80 max-h-[60vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[s.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:e}),s.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),s.jsx("div",{className:"p-3 overflow-y-auto max-h-[50vh]",children:r.length>0?s.jsx("div",{className:"space-y-2",children:r.map((e,t)=>(0,s.jsxs)("div",{className:"space-y-[3px]",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-orange-500 font-bold text-[11px]",children:"•"}),s.jsx("h4",{className:"font-extrabold text-orange-500 text-[13px]",children:e.title})]}),s.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-xs leading-relaxed pl-4",children:e.content})]},t))}):s.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-xs",children:t})})]})})})}let et=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],ea=()=>s.jsx("span",{className:"absolute -top-1 -right-1 text-[10px]",title:"Pro専用",children:"\uD83D\uDC51"});function es({plan:e="free",onConfirm:t,onBlock:a,onPreview:r}){console.log("[debug] plan in ChordBuilder:",e),console.log("[debug] Slash On buttons should be disabled for plan:",e);let o=(0,n.useMemo)(()=>({root:"C",family:"maj",seventh:"none",extMode:"add",ext:{},alt:{},sus:null,slash:null}),[]),[i,l]=(0,n.useState)(o),c={...G,plan:e},[d,m]=(0,n.useState)(!1),[u,h]=(0,n.useState)(null),{spec:p,warnings:g}=(0,n.useMemo)(()=>(function(e,t,a={}){let s=JSON.parse(JSON.stringify(e)),n=[];return"dom"===s.family&&(s.seventh="7"),"free"===t.plan&&("tension"===s.extMode&&(s.ext={nine:!1,eleven:!1,thirteen:!1}),s.alt={},s.slash&&(s.slash=null)),"add"===s.extMode?s.ext.nine=s.ext.eleven=s.ext.thirteen=!1:s.ext.add9=s.ext.add11=s.ext.add13=!1,s.ext.thirteen&&(s.ext.nine=!0),"sus2"===s.sus&&"sus4"===e.sus&&(s.sus="sus4"),"sus4"===s.sus&&"sus2"===e.sus&&(s.sus="sus2"),s.ext.eleven&&("maj"===s.family&&(a.autoCorrect11th?(s.ext.eleven=!1,s.alt?s.alt.sharpEleven=!0:s.alt={sharpEleven:!0},n.push("11 → #11 に自動調整しました（メジャーではavoid音のため）。")):n.push("メジャーでの11は3度と濁ります。#11（Lydian）を検討してください。")),"dom"===s.family&&(a.autoCorrect11th?(s.ext.eleven=!1,s.alt?s.alt.sharpEleven=!0:s.alt={sharpEleven:!0},n.push("11 → #11 に自動調整しました（ドミナントでは3度と衝突するため）。")):n.push("ドミナントでの11は3度と衝突します。#11 または sus4 を検討してください。"))),"dom"!==s.family&&(s.alt={}),"maj7"===s.seventh&&s.sus&&(n.push("maj7 with sus is uncommon; use sus4(maj7) in advanced mode."),s.sus=null),"tension"!==s.extMode||["7","maj7","m7"].includes(s.seventh)||(s.ext={nine:!1,eleven:!1,thirteen:!1}),{spec:s,warnings:n}})(i,c),[i,c]),x=(0,n.useMemo)(()=>(function(e,t){let a=[e.root],s="maj"===e.family?"":"min"===e.family?"m":"dom"===e.family?"":"sus"===e.family?"sus":"dim"===e.family?"dim":"aug"===e.family?"aug":"5";a.push(s);let n="maj7"===e.seventh?"compact"===t.notationStyle?"M7":"maj7":"7"===e.seventh?"7":"m7"===e.seventh?"m7":"6"===e.seventh?"6":"m7b5"===e.seventh?"m7b5":"dim7"===e.seventh?"dim7":"";if(a.push(n),"tension"===e.extMode)e.ext.thirteen?a.push("13"):e.ext.eleven?a.push("11"):e.ext.nine&&a.push("9");else{let t=[e.ext.add9&&"add9",e.ext.add11&&"add11",e.ext.add13&&"add13"].filter(Boolean);t.length&&a.push(`(${t.join(",")})`)}let r=[e.alt.b9&&"b9",e.alt.s9&&"#9",e.alt.s11&&"#11",e.alt.b13&&"b13"].filter(Boolean).join("");return a.push(r),e.sus&&a.push(e.sus),e.slash&&a.push(`/${e.slash}`),a.join("")})(p,c),[p,c]),y=e=>l(t=>({...t,root:e})),f=e=>e?"none"===e.seventh&&"add"===e.extMode&&e.ext.add9?"add9":"none"===e.seventh&&"add"===e.extMode&&e.ext.add11?"add#11":"sus4"===e.sus?"sus4":"sus2"===e.sus?"sus2":"maj"===e.family&&"none"===e.seventh?"M":"min"===e.family&&"none"===e.seventh?"m":"maj"===e.family&&"maj7"===e.seventh?"M7":"min"===e.family&&"m7"===e.seventh?"m7":"dom"===e.family&&"7"===e.seventh?"7":"dim"===e.family&&"none"===e.seventh?"dim":"aug"===e.family&&"none"===e.seventh?"aug":"maj"===e.family&&"maj7"===e.seventh&&e.ext.add9?"M9":"min"===e.family&&"m7"===e.seventh&&e.ext.add9?"m9":"min"===e.family&&"m7"===e.seventh&&e.ext.add9&&e.ext.add11?"m11":"min"===e.family&&"m7b5"===e.seventh?"m7b5":"min"===e.family&&"maj7"===e.seventh?"mM7":"min"===e.family&&"6"===e.seventh?"m6":"maj"===e.family&&"6"===e.seventh?"6":"maj"===e.family&&"6"===e.seventh&&e.ext.add9?"6/9":"dom"===e.family&&"7"===e.seventh&&"sus4"===e.sus?"7sus4":"dim"===e.family&&"dim7"===e.seventh?"dim7":"dom"===e.family&&"7"===e.seventh&&e.alt.s9?"7(#9)":"dom"===e.family&&"7"===e.seventh&&e.alt.b9?"7(b9)":"dom"===e.family&&"7"===e.seventh&&e.alt.s11?"7(#5)":"dom"===e.family&&"7"===e.seventh&&e.alt.b13?"7(b13)":"":"",b=(0,n.useMemo)(()=>{console.log("\uD83D\uDD0D ChordBuilder: Creating quality presets...");let t=Q("Free"),s=Q("Pro");console.log("\uD83D\uDD0D Free qualities:",t),console.log("\uD83D\uDD0D Pro qualities:",s),console.log("\uD83D\uDD0D Total qualities in QUALITY_MASTER:",K.length);let n=[];return Object.entries(t).forEach(([e,t])=>{t.forEach(t=>{let a="m (minor)"===t.quality?"m":"Major"===t.quality?"M":"maj7"===t.quality?"M7":t.quality;n.push({label:a,apply:()=>{let e=v(t.quality);e&&l(e)},pro:!1,comment:X(t.quality,"en"),category:e})})}),Object.entries(s).forEach(([t,s])=>{s.forEach(s=>{let r="M9 (maj9)"===s.quality?"M9":"m7b5"===s.quality?"m7b5":"mM7"===s.quality?"mM7":"m6"===s.quality?"m6":"7(#9)"===s.quality?"7(#9)":"7(b9)"===s.quality?"7(b9)":"7(#5)"===s.quality?"7(#5)":"7(b13)"===s.quality?"7(b13)":s.quality;n.push({label:r,apply:()=>{if("free"===e){a?.("pro_quality",s.quality);return}let t=v(s.quality);t&&l(t)},pro:!0,comment:X(s.quality,"en"),category:t})})}),console.log("\uD83D\uDD0D Final presets count:",n.length,"Free count:",n.filter(e=>!e.pro).length,"Pro count:",n.filter(e=>e.pro).length),n},[l,e,a]),v=e=>{let t={ext:{},alt:{},sus:null,slash:null};switch(e){case"Major":return{...t,root:"C",family:"maj",seventh:"none",extMode:"add"};case"m (minor)":return{...t,root:"C",family:"min",seventh:"none",extMode:"add"};case"7":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension"};case"maj7":return{...t,root:"C",family:"maj",seventh:"maj7",extMode:"add"};case"m7":return{...t,root:"C",family:"min",seventh:"m7",extMode:"add"};case"sus4":return{...t,root:"C",family:"maj",seventh:"none",sus:"sus4",extMode:"add"};case"sus2":return{...t,root:"C",family:"maj",seventh:"none",sus:"sus2",extMode:"add"};case"add9":return{...t,root:"C",family:"maj",seventh:"none",extMode:"add",ext:{add9:!0}};case"dim":return{...t,root:"C",family:"dim",seventh:"none",extMode:"add"};case"M9 (maj9)":return{...t,root:"C",family:"maj",seventh:"maj7",extMode:"add",ext:{add9:!0}};case"6":return{...t,root:"C",family:"maj",seventh:"6",extMode:"add"};case"6/9":return{...t,root:"C",family:"maj",seventh:"6",extMode:"add",ext:{add9:!0}};case"add#11":return{...t,root:"C",family:"maj",seventh:"none",extMode:"add",ext:{add11:!0},alt:{s11:!0}};case"m9":return{...t,root:"C",family:"min",seventh:"m7",extMode:"add",ext:{add9:!0}};case"m11":return{...t,root:"C",family:"min",seventh:"m7",extMode:"add",ext:{add9:!0,add11:!0}};case"m7b5":return{...t,root:"C",family:"min",seventh:"m7b5",extMode:"add"};case"mM7":return{...t,root:"C",family:"min",seventh:"maj7",extMode:"add"};case"m6":return{...t,root:"C",family:"min",seventh:"6",extMode:"add"};case"7sus4":return{...t,root:"C",family:"dom",seventh:"7",sus:"sus4",extMode:"tension"};case"aug":return{...t,root:"C",family:"aug",seventh:"none",extMode:"add"};case"dim7":return{...t,root:"C",family:"dim",seventh:"dim7",extMode:"add"};case"7(#9)":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension",alt:{s9:!0}};case"7(b9)":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension",alt:{b9:!0}};case"7(#5)":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension",alt:{s11:!0}};case"7(b13)":return{...t,root:"C",family:"dom",seventh:"7",extMode:"tension",alt:{b13:!0}};default:return null}},j=(t,a,n,r)=>(0,s.jsxs)("div",{className:"relative inline-block",children:[(0,s.jsxs)("button",{className:`h-9 px-3 rounded border text-xs transition-all flex items-center gap-2 ${a?"bg-[var(--brand-primary)] text-white":r?.locked?"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400 border-gray-300 dark:border-gray-600 cursor-not-allowed hover:bg-gray-300 dark:hover:bg-gray-600":"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"}`,onClick:()=>{r?.disabled||r?.locked?r?.locked&&window.open("https://www.ototheory.com/ios-coming-soon","_blank"):n()},title:r?.locked?"Try Pro features on iOS!":void 0,"aria-disabled":r?.disabled||r?.locked,children:[s.jsx("span",{children:t}),r?.comment&&s.jsx("span",{className:"text-yellow-500 hover:text-yellow-600 transition-colors cursor-pointer",onClick:e=>{e.stopPropagation(),h({title:t,body:r.comment})},title:"Show quality info",children:s.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6A4.997 4.997 0 0 1 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"})})})]}),r?.showProBadge&&"free"===e&&s.jsx(ea,{})]},t);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("div",{className:"text-xs opacity-70 mb-0.5",children:"Root"}),s.jsx("div",{className:"flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",children:et.map(e=>j(e,p.root===e,()=>y(e)))})]}),(()=>{let e=b.filter(e=>!e.pro);return b.filter(e=>e.pro),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-xs opacity-70 mb-0.5",children:["Quality"," (",e.length," types)"]}),s.jsx("div",{className:"flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",children:e.map(e=>{let t=(i?f(i):null)===e.label;return s.jsx("div",{className:"relative",children:j(e.label,t,e.apply,{locked:!1,showProBadge:!1,comment:e.comment})},e.label)})})]})})(),(0,s.jsxs)("details",{children:[s.jsx("summary",{className:"cursor-pointer text-sm",children:"Advanced (Pro) \uD83D\uDC51"}),(0,s.jsxs)("div",{className:"mt-3 space-y-3",children:[(()=>{let t=Q("Pro");return["✨ Sparkle & Float","\uD83C\uDF03 Stylish & Urban","⚡️ Tension & Spice"].map(a=>{let n=t["✨ Sparkle & Float"===a?"✨ キラキラ・浮遊感":"\uD83C\uDF03 Stylish & Urban"===a?"\uD83C\uDF03 おしゃれ・都会的":"⚡️ Tension & Spice"===a?"⚡️ 緊張感・スパイス":a];return n?(0,s.jsxs)("div",{children:[s.jsx("div",{className:"text-xs opacity-70 mb-0.5",children:a}),s.jsx("div",{className:"flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",children:n.map(t=>{let a="M9 (maj9)"===t.quality?"M9":"m7b5"===t.quality?"m7b5":"mM7"===t.quality?"mM7":"m6"===t.quality?"m6":"7(#9)"===t.quality?"7(#9)":"7(b9)"===t.quality?"7(b9)":"7(#5)"===t.quality?"7(#5)":"7(b13)"===t.quality?"7(b13)":t.quality;return s.jsx("div",{className:"relative",children:j(a,!1,()=>{console.log("Pro quality clicked:",t.quality,"Plan:",e)},{comment:t.commentJa,locked:!0,showProBadge:!1})},t.quality)})})]},a):null})})(),(0,s.jsxs)("div",{className:"mt-3",children:[s.jsx("div",{className:"text-xs opacity-70 mb-0.5",children:"Slash (On)"}),(0,s.jsxs)("div",{className:"flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",children:[s.jsx("button",{className:`h-9 px-3 rounded border text-xs ${"free"===e?"bg-gray-400 text-gray-200 cursor-not-allowed opacity-60":"bg-orange-500 text-white hover:bg-orange-600"}`,onClick:()=>{if("free"===e){window.open("https://www.ototheory.com/ios-coming-soon","_blank");return}l({...i,slash:void 0})},disabled:"free"===e,title:"free"===e?"Try Pro features on iOS!":void 0,children:"Clear"}),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map(t=>s.jsx("button",{className:`h-9 px-3 rounded border text-xs ${"free"===e?"bg-gray-400 text-gray-200 cursor-not-allowed opacity-60":i?.slash===t?"bg-[var(--brand-primary)] text-white":"bg-gray-600 text-white hover:bg-gray-500"}`,onClick:()=>{if("free"===e){window.open("https://www.ototheory.com/ios-coming-soon","_blank");return}l({...i,slash:t})},disabled:"free"===e,title:"free"===e?"Try Pro features on iOS!":void 0,children:t},t))]})]})]})]}),"free"===e&&(0,s.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4 text-center",children:[s.jsx("div",{className:"text-sm font-medium mb-2",children:"\uD83D\uDCF1 Try Pro features on iOS!"}),s.jsx("div",{className:"text-xs opacity-70 mb-3",children:"Advanced chord qualities and Slash features are available in the iOS Pro version."}),s.jsx("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",onClick:()=>{window.open("https://www.ototheory.com/ios-coming-soon","_blank")},children:"Try iOS Version"})]}),g.length>0&&s.jsx("div",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:g[0]}),(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Preview"}),s.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white bg-white dark:bg-gray-700 px-3 py-1 rounded border",children:x||"Select a chord"})]}),(0,s.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,s.jsxs)("button",{className:"flex items-center gap-1 rounded-lg bg-green-500 hover:bg-green-600 text-white px-4 py-2 text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>r?.(x),disabled:!x,children:[s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{d:"M8 5v10l8-5-8-5z"})}),"Play"]}),s.jsx("button",{className:"rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",onClick:()=>l(o),children:"Clear"}),s.jsx("button",{className:"rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-2 text-sm font-medium transition-all transform hover:scale-105",onClick:()=>{let s=!!p.slash,n="";p.ext.thirteen?n="13":p.alt.b9?n="7b9":p.alt.s9?n="7#9":p.alt.s11?n="7#11":p.alt.b13?n="7b13":p.alt.alt&&(n="7alt"),function(e,t){let{isPro:a,hasSlash:s}=t;return!!a||!s&&!Z.has(e)}(n,{isPro:"pro"===e,hasSlash:s})?t?.(x,p):s?a?.("pro_slash"):a?.("pro_quality",n)},children:"Add"})]})]}),u&&s.jsx(ee,{title:u.title,body:u.body,isOpen:!0,onClose:()=>h(null)})]})}function en(){let e=(0,H.p)(),t=(0,W.usePathname)(),a=(0,W.useSearchParams)(),P=t.startsWith("/ja"),A=(0,n.useRef)(null);(0,i.H)(A,{orientation:"horizontal"});let R=(0,n.useRef)(null);(0,i.H)(R,{orientation:"horizontal"});let D=(0,n.useRef)(null);(0,i.H)(D,{orientation:"horizontal"});let z=(0,n.useRef)(null),T=(0,n.useRef)(null),[F,J]=(0,n.useState)(()=>{let e=Array(12).fill("");return e[0]="C",e[1]="Am",e[2]="F",e[3]="G",e}),U=(0,n.useMemo)(()=>F.reduce((e,t,a)=>(t&&e.push(a),e),[]),[F]),$=(0,n.useMemo)(()=>U.map(e=>F[e]),[U,F]);(0,n.useMemo)(()=>{let e=F.findIndex(e=>!e);return -1===e?11:e},[F]);let[G,Z]=(0,n.useState)(0);(0,n.useMemo)(()=>["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],[]),(0,n.useMemo)(()=>[{label:"M",value:""},{label:"M7",value:"maj7"},{label:"7",value:"7"},{label:"6",value:"6"},{label:"add9",value:"add9"},{label:"sus4",value:"sus4"},{label:"sus2",value:"sus2"},{label:"m",value:"m"},{label:"m7",value:"m7"},{label:"dim",value:"dim"},{label:"m7b5",value:"m7b5"},{label:"aug",value:"aug"}],[]);let[K,Y]=(0,n.useState)("C"),[X,Q]=(0,n.useState)("M"),[ee,et]=(0,n.useState)([]);(0,n.useMemo)(()=>[{label:"sus2",value:"sus2"},{label:"sus4",value:"sus4"},{label:"add9",value:"add9"},{label:"add11",value:"add11"},{label:"add13",value:"add13"}],[]);let[ea,en]=(0,n.useState)([]),[er,eo]=(0,n.useState)(""),[ei,el]=(0,n.useState)(null),[ec,ed]=(0,n.useState)([]),[em,eu]=(0,n.useState)([]),[eh,ep]=(0,n.useState)(null),[eg,ex]=(0,n.useState)([]),{keyCandidates:ey,selectedKey:ef,analyze:eb,selectKey:ev,scaleCandidates:ej,selectedScale:ew,selectScale:ek,reset:eN}=(0,y._)(),[eI,eC]=(0,n.useState)("degrees"),[eS,eM]=(0,n.useState)(null),[eV,eP]=(0,n.useState)(null),[eA,eR]=(0,n.useState)(null),[eD,eE]=(0,n.useState)(null),eq=(0,n.useCallback)(()=>{eR(null),eE(null)},[]),ez=e=>({Ionian:"major",Aeolian:"naturalMinor",Dorian:"dorian",Phrygian:"phrygian",Lydian:"lydian",Mixolydian:"mixolydian",Locrian:"locrian",MajorPentatonic:"majPent",MinorPentatonic:"minPent",Blues:"bluesMinor",HarmonicMinor:"harmonicMinor",MelodicMinor:"melodicMinor",DiminishedWH:"dimWholeHalf",DiminishedHW:"dimHalfWhole",Lydianb7:"lydianb7",Mixolydianb6:"mixolydianb6",PhrygianDominant:"phrygDominant",Altered:"altered",WholeTone:"wholeTone"})[e]||"major",eT=(0,n.useMemo)(()=>{let e=ew?.type,t=e?d.vb[e]:null;return!t||7===t.length},[ew?.type]),[e_,eF]=(0,n.useState)(null);(0,n.useRef)(null),(0,n.useRef)(null);let eJ=(0,n.useRef)(null),eB=(0,n.useRef)(null),[eO,eU]=(0,n.useState)(null),e$=(0,n.useRef)(null);(0,n.useRef)(null);let[eL,eH]=(0,n.useState)(!1),[eW,eG]=(0,n.useState)(120),eZ=(0,n.useRef)(null),[eK,eY]=(0,n.useState)(-1),eX=(0,n.useCallback)((e,t)=>{J(a=>{if(e===t)return a;let s=a.slice(),n=s[e];return s[e]=s[t],s[t]=n,s})},[]),[eQ,e0]=(0,n.useState)(null),e1=(0,n.useCallback)((e,t)=>{if(!F[t])return;e.stopPropagation();let a=e.touches[0];e$.current={index:t,startX:a.clientX,startY:a.clientY},eU(t),e0(null)},[F]),e7=(0,n.useCallback)((e,t)=>{if(null===e$.current||null===eO)return;let a=e.touches[0],s=document.elementFromPoint(a.clientX,a.clientY);for(;s&&!s.hasAttribute("data-slot-index");)s=s.parentElement;if(s){let e=parseInt(s.getAttribute("data-slot-index")||"-1");e>=0&&e!==eO&&e0(e)}},[eO]),e2=(0,n.useCallback)(e=>{null!==e$.current&&null!==eO&&null!==eQ&&eO!==eQ&&eX(eO,eQ),e$.current=null,eU(null),e0(null)},[eO,eQ,eX]),e5=(0,n.useRef)(!1),e3=(0,n.useCallback)(()=>{e5.current=!1,eZ.current&&(clearInterval(eZ.current),eZ.current=null),eH(!1),eY(-1)},[]),e4=(0,n.useCallback)(async()=>{let e=F.map((e,t)=>({chord:e,index:t})).filter(e=>e.chord);if(0===e.length)return;e3(),await V.h.resume(),e5.current=!0,eH(!0),eY(0);let t=60/eW*1e3;for(let e=0;e<4;e++){if(!e5.current||(await new Promise(e=>setTimeout(e,t)),!e5.current))return;V.h.playNote(84,100)}let a=0,s=0,n=async()=>{if(!e5.current){eZ.current&&(clearInterval(eZ.current),eZ.current=null);return}if(s%4==0){a>=e.length&&(a=0);let{chord:t,index:s}=e[a];eY(s),await tK(t),a++}else if(a>0&&a<=e.length){let{chord:t}=e[a-1];await tK(t)}s++};e5.current&&(await n(),e5.current&&(eZ.current=setInterval(n,t),(0,E.j)("progression_play",{page:"chord_progression",bpm:eW,chordCount:e.length})))},[F,eW,e3]),e9=(0,n.useCallback)(()=>{eL?e3():e4()},[eL,e4,e3]),e6=(0,n.useCallback)(e=>{J(t=>{let a=t.slice();return a[e]="",a})},[]),{isPro:e8}=(0,I.Z)();console.log("[debug] isPro in page:",e8);let{sketch:te,setSketch:tt}=q(e8);(0,n.useRef)(null);let{sketches:ta,loadSketches:ts,deleteSketch:tn,saveSketch:tr}=_(),[to,ti]=(0,n.useState)(!1),[tl,tc]=(0,n.useState)(null),td=(0,n.useRef)(null),[tm,tu]=(0,n.useState)(""),[th,tp]=(0,n.useState)(!1),[tg,tx]=(0,n.useState)("C"),ty=(0,n.useRef)(null),[tf,tb]=(0,n.useState)(!1),[tv,tj]=(0,n.useState)(""),tw=(0,n.useMemo)(()=>$.length?$.join(" "):`Untitled ${new Date().toLocaleString()}`,[$]),[tk,tN]=(0,n.useState)(null),tI=(0,n.useRef)(new Set),[tC,tS]=(0,n.useState)(""),tM=async t=>{try{if(!T.current)return;tS(t.name||"Untitled Sketch"),await new Promise(e=>setTimeout(e,50));let a=T.current;a.style.opacity="1",a.style.visibility="visible",await new Promise(e=>setTimeout(e,200)),await B(a,"auto"),a.style.opacity="0.0001",a.style.visibility="hidden",tS(""),(0,E.j)("export_png",{page:"chord_progression",source:"sketch",id:t.id}),tI.current.has("png_export")||(tN({message:e.toast.pngExport,type:"success",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"png_toast"}),tI.current.add("png_export"))}catch(e){console.error("Export failed:",e),tS("")}},tV=async()=>{try{if(!e8){let t=JSON.parse(localStorage.getItem("ot_sketches")||"[]");if(console.log("[DEBUG] doSaveSketch - isPro:",e8,"existing sketches:",t.length),t.length>=3){console.log("[DEBUG] Blocking save - limit reached"),tb(!1),tj(""),tN({message:e.toast.sketchLimit,type:"warning",ctaText:e.toast.ctaButton,ctaHref:"/ios-coming-soon",ctaPlace:"limit_toast"}),(0,E.EP)("limit_block",{page:"chord_progression",context:"sketch_limit"});return}}console.log("[DEBUG] Proceeding with save");let t=ef?c.T_[ef.tonic]:e_?e_.tonic:"C",a=ew?.type||(ef?ef.mode:"Ionian"),s={name:(tv.trim()||tw).slice(0,48),schema:"sketch_v1",appVersion:"3.0.0",key:{tonic:t,scaleId:String(a)},capo:{fret:0,note:"Shaped"},progression:{items:$.map((e,t)=>({id:e,degree:"",quality:""}))},fretboardView:{mode:"names"===eI?"Names":"Degrees",guide:!!eV}},n=await tr(s);(0,E.j)("save_project",{page:"chord_progression",ok:n?.ok}),tb(!1),tj("")}catch{}},[tP,tA]=(0,n.useState)(!1),[tR,tD]=(0,n.useState)(!1),[tE,tq]=(0,n.useState)(!1),[tz,tT]=(0,n.useTransition)(),[t_,tF]=(0,n.useState)([]),[tJ,tB]=(0,n.useState)([]),[tO,tU]=(0,n.useState)(null),t$=(0,n.useRef)(null),tL=e=>e.map(e=>{let t=e.match(/^([A-G](?:#|b)?)(.*)$/);return{root:t?.[1]||e,quality:t?.[2]||""}}),tH=(e,t,a)=>{let s=(0,c.Hl)(a);if(void 0===s||s<0||s>11)return;let n=t.map(e=>(0,c.O9)(e,s,"Major"));J(e=>{let t=[...e],a=t.findIndex(e=>!e);return -1===a&&(a=0),n.forEach((e,s)=>{t[(a+s)%12]=e}),t}),Z(e=>{let t=[...F];n.forEach((e,a)=>{let s=t.findIndex(e=>!e);if(-1===s)return 0;t[(s+a)%12]=e});let a=t.findIndex(e=>!e);return -1===a?0:a}),(0,E.j)("preset_inserted",{page:"chord_progression",preset:e}),tp(!1)},tW=(0,n.useMemo)(()=>{if(!eg||0===eg.length)return null;let e=eg.map(e=>{let t=e.replace(/\s+/g,"").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);if(!t)return e.toUpperCase();let a=t[1]??"",s=(t[2]??"").toUpperCase();return`${a}${s}`});if(e.length<2)return null;let t=e[0],a=e[e.length-1];return"V"===a&&"I"===t?{type:"perfect",tail:{from:"V",to:"I"}}:"V"===a&&"VI"===t?{type:"deceptive",tail:{from:"V",to:"vi"}}:"V"===a?{type:"half",tail:{from:void 0,to:"V"}}:null},[eg]);ee.length&&ee.join(" ");let[tG,tZ]=(0,n.useState)(!1),tK=async e=>{try{await V.h.resume();let t=(0,O.h)(e);t&&t.length>0&&V.h.playChord(t,"lightStrum",300)}catch(t){console.error("Failed to play chord:",e,t)}};return(0,s.jsxs)("main",{ref:z,className:"ot-page ot-stack","data-page":"find-key",children:[(0,s.jsxs)("section",{id:"progression",className:"ot-card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx(f,{className:"mb-0 text-left",children:P?"コード進行を作る":"Build progression"}),s.jsx(v.Z,{title:"Build Progression",text:P?"Choose Chordsからコードを選んでスロットに追加ボタンから追加してください。上部のプリセットからコード進行を選択して追加することもできます。":"Select chords from Choose Chords and add them using the slot add button. You can also select chord progressions from the presets at the top to add them."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("button",{type:"button",className:"chip text-sm px-4 py-2 inline-flex items-center gap-2",title:"Reset progression",onClick:()=>{J(Array(12).fill("")),Z(0),eN(),ed([]),el(null),eP(null),eM(null),eC("degrees")},children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:s.jsx("path",{d:"M12 5V2L7 7l5 5V9c2.76 0 5 2.24 5 5a5 5 0 1 1-5-5z"})}),s.jsx("span",{children:P?"リセット":"Reset"})]}),(0,s.jsxs)("button",{type:"button",className:"chip inline-flex items-center gap-2 px-4 py-2",title:"Show sketches",onClick:()=>ti(e=>!e),"aria-expanded":to,children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:s.jsx("path",{d:"M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h12v2H3v-2z"})}),P?"My進行":"Sketches"]}),to&&s.jsx("div",{ref:td,className:"fixed right-4 top-20 z-[10000] w-[320px] max-h-[70vh] overflow-auto rounded-md border bg-white dark:bg-neutral-900 shadow-2xl p-2 space-y-2",children:0===ta.length?s.jsx("div",{className:"text-xs opacity-70 p-2",children:P?"まだ進行がありません":"No sketches yet"}):ta.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/10",children:[s.jsx("button",{className:"text-left text-sm flex-1 truncate",title:`${e.name}`,onClick:()=>tc(e),children:e.name}),s.jsx("button",{className:"ot-btn-ghost text-xs",title:"Delete",onClick:t=>{t.stopPropagation(),tn(e.id),ts(),(0,E.j)("project_delete",{page:"chord_progression",id:e.id})},children:"\uD83D\uDDD1️"})]},e.id))}),s.jsx("div",{className:"w-4","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("button",{type:"button",className:"chip px-4 py-2 inline-flex items-center gap-2",title:eL?"Stop playback":"Play progression",onClick:e9,disabled:0===$.length,style:{opacity:0===$.length?.5:1},children:eL?(0,s.jsxs)(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})}),s.jsx("span",{children:P?"停止":"Stop"})]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M8 5v14l11-7z"})}),s.jsx("span",{children:P?"再生":"Play"})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("label",{htmlFor:"bpm-input",className:"text-sm font-medium",children:"BPM:"}),s.jsx("input",{id:"bpm-input",type:"number",min:"40",max:"240",value:eW,onChange:e=>eG(Math.max(40,Math.min(240,parseInt(e.target.value)||120))),className:"w-20 px-3 py-1 text-sm rounded-lg border bg-transparent",disabled:eL})]})]}),(0,s.jsxs)("select",{className:"chip px-4 py-2","aria-label":"Instrument",defaultValue:"acoustic_guitar_steel",onChange:async e=>{let t=e.currentTarget.value;await V.h.setInstrument(t)},children:[s.jsx("option",{value:"acoustic_guitar_steel",children:P?"アコースティックギター":"Acoustic Steel"}),s.jsx("option",{value:"acoustic_guitar_nylon",children:P?"クラシックギター":"Acoustic Nylon"}),s.jsx("option",{value:"electric_guitar_clean",children:P?"クリーントーン（エレキ）":"Electric Clean"}),s.jsx("option",{value:"distortion_guitar",children:P?"ディストーション":"Distortion"}),s.jsx("option",{value:"overdriven_guitar",children:P?"オーバードライブ":"Over Drive"}),s.jsx("option",{value:"electric_guitar_muted",children:P?"ミュート":"Muted"}),s.jsx("option",{value:"acoustic_grand_piano",children:P?"ピアノ":"Piano"})]})]})]}),s.jsx("div",{className:"prog-slots mt-6 flex flex-wrap gap-3","aria-label":"Progression slots",children:Array.from({length:12}).map((e,t)=>{let a=!!F[t],n=t<8?0:(t-7)*.08,r=`rgba(16,185,129,${n.toFixed(2)})`,o=G===t,i=eK===t&&eL;return(0,s.jsxs)("div",{"data-slot-index":t,className:["inline-flex items-center justify-center rounded-xl border text-sm select-none relative chip-pressable",a?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"bg-gray-50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700",o?"ring-2 ring-blue-400/60":"",i?"ring-4 ring-blue-500/80 shadow-lg":"",eO===t?"opacity-50 scale-105":"",eQ===t?"ring-2 ring-blue-400":""].join(" "),style:{padding:"12px 16px",minWidth:80,minHeight:48,background:a?void 0:r,transition:"all 0.2s ease",touchAction:a?"none":"auto"},onClick:()=>{a?tK(F[t]):Z(t)},draggable:a,onDragStart:()=>eU(t),onDragOver:e=>e.preventDefault(),onDrop:()=>{null!==eO&&(eX(eO,t),eU(null))},onTouchStart:e=>e1(e,t),onTouchMove:e=>e7(e,t),onTouchEnd:e2,children:[s.jsx("span",{className:"absolute left-2 top-2 text-xs opacity-60 select-none pointer-events-none font-medium",children:String(t+1)}),a?(0,s.jsxs)(s.Fragment,{children:[s.jsx("span",{children:F[t]}),s.jsx("button",{"aria-label":"Remove chord",className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-red-500 text-white text-xs leading-6 hover:bg-red-600 transition-colors",onClick:e=>{e.stopPropagation(),e6(t)},children:"\xd7"})]}):null]},`slot-${t}`)})})]}),(0,s.jsxs)("section",{id:"choose",ref:eB,className:"ot-card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx(f,{className:"mb-0 text-left",children:P?"コードを選ぶ":"Choose chords"}),s.jsx(v.Z,{title:"Choose Chords",text:P?"ルートとコードタイプを選んでください。追加ボタンでコード進行のスロットに追加できます。\nProプランの場合、より複雑なコードタイプを選ぶことができます。":"Select a root note and chord type. Use the Add button to add to chord progression slots.\nPro plan allows you to select more complex chord types."})]}),(0,s.jsxs)("button",{type:"button",className:"chip px-4 py-2 inline-flex items-center gap-2",title:"Load preset progression",onClick:()=>tp(!0),children:[s.jsx("span",{children:"\uD83D\uDCCB"}),s.jsx("span",{children:P?"プリセット":"Presets"})]})]}),s.jsx(es,{plan:(()=>{let e=a.get("plan");return"pro"===e||"free"===e?e:e8?"pro":"free"})(),onPreview:async e=>{try{await V.h.resume();let t=(0,O.h)(e);t&&V.h.playChord(t,"lightStrum",300)}catch{}},onBlock:(e,t)=>{"pro_quality"===e?alert(`「${t}」はPro機能です。

iOS版のOtoTheoryアプリでPro機能をお試しください！

App Storeでダウンロードできます。`):"pro_slash"===e&&alert("Slash機能はPro機能です。\n\niOS版のOtoTheoryアプリでPro機能をお試しください！\n\nApp Storeでダウンロードできます。")},onConfirm:e=>{J(t=>{let a=[...t],s=a.findIndex(e=>!e);return -1===s&&(s=0),a[s]=e,a}),Z(e=>{let t=[...F].findIndex(e=>!e);return -1===t?0:t}),tq(!0)}}),s.jsx("div",{className:"mt-6",children:s.jsx("button",{className:`w-full px-6 py-3 text-base rounded-xl font-semibold text-white transition-all duration-200 active:scale-[.98] active:translate-y-px focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 ${tz?"bg-gray-400 cursor-wait":"bg-blue-500 hover:bg-blue-600 shadow-lg"}`,onClick:()=>{(!tL($).some(e=>N.some(t=>e.quality.includes(t)))||e8)&&tT(()=>{el((0,k.w)($));let e=(0,c.EZ)($);if(ed(e.slice(0,4)),e.length>0){let t="Major"===e[0].mode?"major":"minor",a={tonic:e[0].label.split(" ")[0],mode:t};eF(a),ex($.map(e=>(function(e,t,a,s={}){let{showQuality:n=!0,accidentalsForNonDiatonic:r=!1}=s;if(!e||!t)return"";let o=(0,c.Hl)(t),i=e.split("/")[0].match(/^([A-G](?:#|b)?)(.*)$/i);if(!i)return e;let l=function(e){let t=(0,c.Hl)(e);return c.T_[t]??e}(i[1].toUpperCase()),d=i[2]||"",m=((0,c.Hl)(l)-o+12)%12,y="major"===a?p:g,f=("major"===a?u:h)[m];if(void 0!==f){let e=s.uppercase?["I","II","III","IV","V","VI","VII"][f]:y[f];return(s.uppercase&&("major"===a&&6===f||"minor"===a&&1===f)&&(e+="\xb0"),n)?x(d)?e+"M7":!(x(d)||/m7b5|ø|dim7/.test(d))&&(/(\b|[^a-zA-Z])7(?![b#0-9])/i.test(d)||/\bm7\b/i.test(d))?e+"7":e:e}if(r){let e="major"===a?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10];for(let t=0;t<e.length;t++){let a=e[t];if((a+1)%12===m)return"#"+y[t];if((a+11)%12===m)return"b"+y[t]}}return`(${l})`})(e,a.tonic,a.mode,{showQuality:!0,uppercase:!0})))}else eu([]),eF(null),ex([]);eb($),setTimeout(()=>{let e=document.getElementById("result");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)})},disabled:tz,"aria-busy":tz,children:tz?(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24","aria-hidden":"true",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4z"})]}),"Analyzing…"]}):P?"分析":"Analyze"})})]}),(0,s.jsxs)("section",{id:"result",ref:eJ,className:"ot-card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[s.jsx(f,{className:"text-left mb-0",children:P?"結果":"Result"}),s.jsx("div",{className:"flex items-center gap-3",children:(0,s.jsxs)("button",{type:"button",className:"chip px-4 py-2 inline-flex items-center gap-2",onClick:()=>tb(!0),title:"Save sketch",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:s.jsx("path",{d:"M17 3H5a2 2 0 0 0-2 2v14l4-4h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"})}),P?"保存":"Save"]})})]}),tf&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10000]",role:"dialog","aria-modal":"true",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{tb(!1),tj("")}}),(0,s.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[420px]",children:[s.jsx("div",{className:"text-base font-semibold mb-2",children:P?"スケッチを保存":"Save sketch"}),s.jsx("input",{type:"text",className:"chip px-2 py-2 text-sm w-full",placeholder:tw,value:tv,onChange:e=>tj(e.target.value),"aria-label":"Sketch name",autoFocus:!0}),(0,s.jsxs)("div",{className:"mt-3 flex items-center justify-end gap-2",children:[s.jsx("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:()=>{tb(!1),tj("")},children:P?"キャンセル":"Cancel"}),s.jsx("button",{type:"button",className:"chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",onClick:tV,children:"OK"})]})]})]}),tl&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[10001]",role:"dialog","aria-modal":"true",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>tc(null)}),(0,s.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[320px]",children:[s.jsx("div",{className:"text-base font-semibold mb-3",children:tl.name}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>{try{let e=Array(12).fill("");(tl?.progression?.items||[]).forEach((t,a)=>{a<12&&(e[a]=String(t?.id||""))}),J(e),Z(-1===e.findIndex(e=>!e)?11:e.findIndex(e=>!e));try{eb(e.filter(Boolean))}catch{}let t=c.T_.indexOf(tl.key.tonic);if(t>=0)try{ev?.({tonic:t,mode:String(tl.key.scaleId||"")?.toLowerCase().includes("aeolian")||String(tl.key.scaleId||"").toLowerCase().includes("minor")?"Minor":"Major"})}catch{}(0,E.j)("open_project",{page:"chord_progression",id:tl.id}),ti(!1),tc(null)}catch{}},children:P?"編集":"Edit"}),s.jsx("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:async()=>{try{await tM(tl),tc(null)}catch{}},children:P?"エクスポート":"Export"}),s.jsx("button",{type:"button",className:"w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",onClick:()=>tc(null),children:P?"キャンセル":"Cancel"})]})]})]}),s.jsx("div",{ref:T,"aria-hidden":!0,style:{position:"fixed",left:0,top:0,zIndex:9999,opacity:1e-4,pointerEvents:"none",width:800,height:600,background:"#ffffff",color:"#000000",padding:24,borderRadius:12,border:"2px solid #cbd5e1",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},children:(()=>{let e=tC||(tv?.trim()?tv:tw),t=ef?`${c.T_[ef.tonic]} ${ef.mode}`:"-",a=$.join(" "),n=ew?(0,d.hg)(ew.type):"-",r=(()=>{let e=ew?ew.root:void 0,t=ew&&"number"==typeof e?(0,d.p3)(e,ew.type).map(e=>c.T_[e]):[],a=(()=>{let e=ew?.type;return e&&(e.toLowerCase().includes("aeolian")||e.toLowerCase().startsWith("min"))?"min":"maj"})();return s.jsx("div",{style:{marginTop:8,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",width:"100%"},children:s.jsx(l.Z,{overlay:{viewMode:"sounding",capo:0,notes:t,chordNotes:eV??void 0,showScaleGhost:!!eV,display:eT?eI:"degrees",scaleRootPc:"number"==typeof e?e:0,scaleType:ew?.type??"Ionian",context:{chordRootPc:"number"==typeof e?e:0,quality:a}},onRequestForms:()=>{}})})})();return(0,s.jsxs)("div",{style:{background:"#ffffff",color:"#000000",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif",width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:"12px",padding:"8px"},children:[s.jsx("div",{style:{fontWeight:700,fontSize:24,color:"#000000",lineHeight:1.3},children:e}),(0,s.jsxs)("div",{style:{fontSize:18,color:"#000000",fontWeight:600},children:["Key: ",s.jsx("span",{style:{color:"#1e40af"},children:t})]}),(0,s.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Progression: ",s.jsx("span",{style:{color:"#1e40af"},children:a||"-"})]}),(0,s.jsxs)("div",{style:{fontSize:16,color:"#000000",fontWeight:500},children:["Scale: ",s.jsx("span",{style:{color:"#1e40af"},children:n})]}),s.jsx("div",{style:{flex:1,background:"#ffffff",border:"2px solid #cbd5e1",borderRadius:"8px",padding:"12px",overflow:"hidden"},children:r})]})})()}),ey.length>0?(0,s.jsxs)("div",{className:"space-y-4",children:[ey.length>0&&$.length<8&&(0,s.jsxs)("div",{className:"text-xs px-3 py-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200",children:["⚠️ 精度向上のため、8コード以上の入力を推奨します（現在: ",$.length,"コード）"]}),s.jsx(b,{children:P?"キー":"Key"}),s.jsx("div",{className:"flex items-center justify-between gap-2",children:s.jsx("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Key candidates",children:ey.map((e,t)=>{let a=ef&&ef.tonic===e.tonic&&ef.mode===e.mode,n="Major"===e.mode?c.T_[e.tonic]:`${c.T_[e.tonic]}m`,r=e.reasons.join("\n");return(0,s.jsxs)("button",{role:"tab","aria-selected":a,className:["chip","chip--key",a?"chip--active":""].join(" "),title:`Why this key
${r}`,onClick:()=>ev({tonic:e.tonic,mode:e.mode}),"data-roving":"item",children:[n," ",Math.round(e.confidence),"%"]},`${n}-${t}`)})})}),(0,s.jsxs)("div",{className:"result-block",children:[s.jsx(b,{children:P?"スケール":"Scale"}),s.jsx("div",{className:"chip-row mb-2",role:"tablist","aria-label":"Scale candidates",children:ej.map((e,t)=>{let a=(0,d.cm)(e.type),n=ew?.type===a&&ew?.root===e.root,r=ez(e.type),o=(0,j.qi)(r),i=`${c.T_[e.root]} ${o?(0,j.ED)(o,"en"):(0,d.hg)(a)}`;return(0,s.jsxs)("div",{className:"relative inline-block",children:[s.jsx("button",{role:"tab","aria-selected":n,className:["chip","chip--key",n?"chip--active":"","flex items-center gap-2"].join(" "),onClick:t=>{t.stopPropagation(),ek(e),(0,E.j)("scale_pick",{page:"find-key",scale:e.type,key:c.T_[e.root]})},"data-roving":"item",children:(0,s.jsxs)("span",{children:[i," ",Math.round(e.score),"%"]})}),o&&s.jsx("div",{className:"absolute -top-1 -right-1",children:s.jsx(v.Z,{title:(0,j.ED)(o,"en"),placement:"top",trigger:s.jsx("button",{type:"button",className:"w-6 h-6 rounded-full bg-amber-50/90 hover:bg-amber-100 ring-1 ring-amber-300/60 shadow-sm flex items-center justify-center","aria-label":"Scale info",children:s.jsx("svg",{className:"w-4 h-4 text-amber-500",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6A4.997 4.997 0 0 1 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"})})}),children:s.jsx(w.Z,{scaleId:r})})})]},`${i}-${t}`)})})]})]}):s.jsx("div",{className:"text-sm opacity-70",children:P?"分析をクリック":"Click Analyze to see results."})]}),(0,s.jsxs)("section",{className:"ot-card",children:[s.jsx(f,{children:P?"ツール":"Tools"}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"result-block",children:[s.jsx(b,{right:(0,s.jsxs)("div",{ref:R,className:"flex items-center gap-2 bg-transparent shadow-none fretboard-toggle","aria-label":"Fretboard notation",role:"tablist",children:[s.jsx("button",{role:"tab","aria-selected":"degrees"===eI,tabIndex:"degrees"===eI?0:-1,className:["chip","chip--key","degrees"===eI?"chip--active":""].join(" "),onClick:()=>eC("degrees"),"data-roving":"item",children:P?"度数":"Degrees"}),s.jsx("button",{role:"tab","aria-selected":"names"===eI,tabIndex:eT&&"names"===eI?0:-1,"aria-disabled":!eT,className:["chip","chip--key","names"===eI?"chip--active":"",eT?"":"chip--disabled"].join(" "),onClick:()=>{eT&&eC("names")},"data-roving":"item",children:P?"音名":"Names"})]}),children:P?"フレットボード":"Fretboard"}),s.jsx("div",{className:"fret-wrap",children:s.jsx("div",{className:"fret-inner",children:ew?(()=>{let e=ew.root,t=(0,d.p3)(e,ew.type).map(e=>c.T_[e]),a=(()=>{let e=ew?.type;return e&&(e.toLowerCase().includes("aeolian")||e.toLowerCase().startsWith("min"))?"min":"maj"})();return s.jsx(l.Z,{overlay:{viewMode:"sounding",capo:0,notes:t,chordNotes:eV??void 0,showScaleGhost:!!eV,display:eT?eI:"degrees",scaleRootPc:e,scaleType:ew.type,context:{chordRootPc:e,quality:a}},onRequestForms:(t,a)=>{eR({at:t,rootPc:a.rootPc??e,quality:a.quality})},formShape:eD})})():s.jsx("div",{className:"text-center text-sm opacity-50 py-8",children:P?"分析をクリックしてフレットボードを表示":"Click Analyze to see fretboard"})})})]}),(0,s.jsxs)("section",{className:"result-block space-y-2",children:[s.jsx(b,{children:(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[s.jsx("span",{children:P?"ダイアトニック":"Diatonic"}),(0,s.jsxs)(v.Z,{className:"ml-1",title:"Diatonic chords",linkHref:"/resources/glossary",linkLabel:"Glossary",children:[s.jsx("p",{className:"text-sm",children:"Chords built only from the key’s scale tones (I–ii–iii–IV–V–vi–vii\xb0)."}),(0,s.jsxs)("ul",{className:"mt-2 list-disc pl-5 space-y-1 text-sm",children:[s.jsx("li",{children:"Stable sound: everything stays inside the key."}),s.jsx("li",{children:"Use: begin inside → add color with a borrowed chord (iv, bVII, bVI)."}),s.jsx("li",{children:"Try: ii–V–I or IV–V–I for clear motion."})]}),s.jsx("h4",{className:"mt-3 font-medium",children:"Shaped vs. Sounding (Capo)"}),(0,s.jsxs)("ul",{className:"mt-1 list-disc pl-5 space-y-1 text-sm",children:[s.jsx("li",{children:"Shaped: labels show the shapes you fret after capo."}),s.jsx("li",{children:"Sounding: labels show the actual pitch you hear."})]})]})]})}),s.jsx(C.Z,{selectedId:eS,onSelectId:e=>eM(e),onPick:async({id:e,pcs:t,isRightClick:a})=>{if(a){let t=y._.getState().selectedKey,a=y._.getState().selectedScale;if(!t||!a)return;let s=a.type,n=d.vb[s]??[];if(7!==n.length){let e=(0,d.nZ)(s);e&&(n=d.vb[e]??[])}if(7!==n.length)return;let r=(0,m.Z)({tonicPc:t.tonic,scaleIntervals:n})[parseInt(e.replace("open-",""))];if(!r)return;let o=(0,m.Xs)({rootPc:r.rootPc,quality:r.quality}),i=[...F];i[G]=o,J(i),G<11&&Z(G+1),(0,E.j)("diatonic_pick",{page:"find-key",action:"right_click_add"});return}if(eS===e){eP(null),eM(null),eq();return}eP(t.map(e=>c.T_[e])),eM(e),eq(),(0,E.j)("diatonic_pick",{page:"find-key"});try{await V.h.resume();let e=t.map(e=>60+e%12);V.h.playChord(e,"lightStrum",260)}catch{}}})]}),eT&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(b,{children:P?"度数進行":"Roman"}),s.jsx("div",{ref:t$,className:"rounded-md border px-3 py-2","aria-live":"polite","data-testid":"roman-row",children:s.jsx("div",{className:"flex-1 overflow-x-auto whitespace-nowrap text-lg md:text-xl tracking-wide",children:0===eg.length?s.jsx("span",{children:"-"}):eg.map((e,t)=>(0,s.jsxs)(r().Fragment,{children:[s.jsx("span",{"data-idx":t,className:tO&&t>=tO.start&&t<=tO.end?"roman-mark":void 0,children:String(e||"").toUpperCase()}),t<eg.length-1?s.jsx("span",{"aria-hidden":!0,className:"mx-1",children:"–"}):null]},`rom-${t}`))})})]}),t_.length>0&&(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:"text-xs opacity-70",children:P?"パターン":"Patterns"}),(()=>{var e;let t=t_[0],a={"doo-wop":"dooWop",axis:"axis",canon:"canon","ii-V-I":"twoFiveOne",turnaround:"turnaround",andalusian:"andalusian",authentic:"authentic",plagal:"plagal",deceptive:"deceptive"},n=a[t.id]?{label:S[e=a[t.id]],summary:M[e]}:null,r=n?.label||t.name.replace(/\(([^)]+)\)/g,(e,t)=>{let a=t.replace(/[ivx]+/g,e=>e.toUpperCase());return`(${a})`}).replace(/\(I–vi–IV–V\)/,"(I–VI–IV–V)"),o=n?.summary||t.summary||t.name;return tO&&tO.start===t.start&&(tO.end,t.end),(0,s.jsxs)(s.Fragment,{children:[s.jsx("button",{type:"button",className:"text-sm leading-tight font-medium hover:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/50 rounded",title:o,onClick:()=>{tU(e=>e&&e.start===t.start&&e.end===t.end?null:{start:Math.max(0,t.start),end:Math.max(t.start,Math.min(eg.length-1,t.end))}),requestAnimationFrame(()=>{let e=t$.current;if(!e)return;let a=e.querySelector(`[data-idx="${t.start}"]`);a&&(e.scrollLeft=Math.max(0,a.offsetLeft-12))})},children:r},`${t.id}-0`),s.jsx(v.Z,{ariaLabel:`${r} – info`,text:`${r}

${o}`})]})})()]}),(tJ.length>0||tW)&&(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:"text-xs opacity-70",children:P?"カデンツ":"Cadence"}),(()=>{let e=tJ[0]??tW,t=e?.type??e,a=e?.tail??e?.tailRoman,n=t?"perfect"===t?`Perfect (${a?.from??"V"} → ${a?.to??"I"})`:"deceptive"===t?`Deceptive (${a?.from??"V"} → ${a?.to??"vi"})`:`Half (${a?.from?`${a.from} → `:"… → "}V)`:"";return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 text-sm leading-tight",children:[s.jsx("span",{className:"font-medium",children:n}),s.jsx(v.Z,{text:t?"perfect"===t?"Resolves to the Tonic: V → I. Feels fully resolved.":"deceptive"===t?"Surprises by avoiding I: V → vi (or similar).":"Phrase ends on the Dominant: … → V. Feels unresolved.":"No cadence detected."})]})})()]})]})]}),s.jsx("section",{className:"ot-card","aria-label":"Ad",children:s.jsx(o.default,{page:"chord_progression",format:"horizontal"})}),th&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",style:{backdropFilter:"blur(4px)"},children:(0,s.jsxs)("div",{ref:ty,className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:P?"プリセットを読み込み":"Load Preset"}),(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("label",{className:"text-xs opacity-70 mb-1 block",children:P?"キー":"Key"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map(e=>s.jsx("button",{className:`chip ${tg===e?"chip--active":""}`,onClick:()=>tx(e),children:e},e))})]}),(0,s.jsxs)("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-V-vi-IV",["Ⅰ","Ⅴ","Ⅵm","Ⅳ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅳ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Pop progression"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("ii-V-I",["Ⅱm","Ⅴ","Ⅰ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅱm–Ⅴ–Ⅰ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Jazz turnaround"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("12-bar-blues",["Ⅰ","Ⅰ","Ⅰ","Ⅰ","Ⅳ","Ⅳ","Ⅰ","Ⅰ","Ⅴ","Ⅳ","Ⅰ","Ⅴ"],tg),children:[s.jsx("div",{className:"font-medium",children:"12-bar Blues"}),s.jsx("div",{className:"text-xs opacity-70",children:"Classic blues form (all 12 slots)"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-II",["Ⅰ","Ⅱ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅱ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Simple two-chord progression"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bVII-IV",["Ⅰ","♭Ⅶ","Ⅳ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Rock progression"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("vi-IV-I-V",["Ⅵm","Ⅳ","Ⅰ","Ⅴ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅴ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Emotional / Ballad (I-V-vi-IVの逆回転)"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-vi-IV-V",["Ⅰ","Ⅵm","Ⅳ","Ⅴ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅵm–Ⅳ–Ⅴ"}),s.jsx("div",{className:"text-xs opacity-70",children:"50's progression / Doo-wop"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-IV-V",["Ⅰ","Ⅳ","Ⅴ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅳ–Ⅴ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Three-chord song / Rock classic"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("vi-ii-V-I",["Ⅵm","Ⅱm","Ⅴ","Ⅰ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅵm–Ⅱm–Ⅴ–Ⅰ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Circle progression / Jazz standard"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bVII-bVI-bVII",["Ⅰ","♭Ⅶ","♭Ⅵ","♭Ⅶ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–♭Ⅵ–♭Ⅶ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Mixolydian vamp / Rock anthem"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-IVm-I-V",["Ⅰ","Ⅳm","Ⅰ","Ⅴ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅳm–Ⅰ–Ⅴ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Borrowed chord / Minor IV"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("vi-IV-I-III",["Ⅵm","Ⅳ","Ⅰ","Ⅲ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅵm–Ⅳ–Ⅰ–Ⅲ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Andalusian cadence / Spanish feel"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bIII-bVII-IV",["Ⅰ","♭Ⅲ","♭Ⅶ","Ⅳ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅲ–♭Ⅶ–Ⅳ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Modal interchange / Epic progression"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-iii-IV-V",["Ⅰ","Ⅲm","Ⅳ","Ⅴ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅳ–Ⅴ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Classic progression / Beatles style"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-V-vi-iii-IV-I-IV-V",["Ⅰ","Ⅴ","Ⅵm","Ⅲm","Ⅳ","Ⅰ","Ⅳ","Ⅴ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅴ–Ⅵm–Ⅲm–Ⅳ–Ⅰ–Ⅳ–Ⅴ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Pachelbel's Canon / Wedding classic"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bVI-bVII-I",["Ⅰ","♭Ⅵ","♭Ⅶ","Ⅰ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅵ–♭Ⅶ–Ⅰ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Power ballad / 80s rock"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("vi-V-IV-III",["Ⅵm","Ⅴ","Ⅳ","Ⅲ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅵm–Ⅴ–Ⅳ–Ⅲ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Descending progression / Melancholic"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-IV-bVII-IV",["Ⅰ","Ⅳ","♭Ⅶ","Ⅳ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅳ–♭Ⅶ–Ⅳ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Folk/Country vamp"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-bVII-IV-I",["Ⅰ","♭Ⅶ","Ⅳ","Ⅰ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–♭Ⅶ–Ⅳ–Ⅰ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Stadium anthem / Closing progression"})]}),(0,s.jsxs)("button",{className:"w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>tH("I-iii-vi-IV",["Ⅰ","Ⅲm","Ⅵm","Ⅳ"],tg),children:[s.jsx("div",{className:"font-medium",children:"Ⅰ–Ⅲm–Ⅵm–Ⅳ"}),s.jsx("div",{className:"text-xs opacity-70",children:"Smooth descent / R&B style"})]})]}),s.jsx("button",{className:"mt-4 w-full px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600",onClick:()=>tp(!1),children:P?"キャンセル":"Cancel"})]})}),tk&&s.jsx(L,{message:tk.message,type:tk.type,ctaText:tk.ctaText,ctaHref:tk.ctaHref,ctaPlace:tk.ctaPlace,onClose:()=>tN(null)})]})}},2654:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>o,__esModule:()=>r,default:()=>i});var s=a(8570);let n=(0,s.createProxy)(String.raw`/Users/nh/App/OtoTheory/ototheory-web/src/app/chord-progression/page.tsx`),{__esModule:r,$$typeof:o}=n;n.default;let i=(0,s.createProxy)(String.raw`/Users/nh/App/OtoTheory/ototheory-web/src/app/chord-progression/page.tsx#default`)}};