(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/src/components/AdSlot.client.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>AdSlot
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ProProvider$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ProProvider.tsx [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
function AdSlot(param) {
    let { page, slot = "XXXXXXXXXX", format = "auto", style = {} } = param;
    _s();
    const { isPro } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ProProvider$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["usePro"])();
    const [mounted, setMounted] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [adLoaded, setAdLoaded] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "AdSlot.useEffect": ()=>{
            setMounted(true);
        }
    }["AdSlot.useEffect"], []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "AdSlot.useEffect": ()=>{
            if (!mounted || isPro) return;
            // AdSenseの広告をロード
            try {
                // @ts-ignore
                if (window.adsbygoogle && !adLoaded) {
                    // @ts-ignore
                    (window.adsbygoogle = window.adsbygoogle || []).push({});
                    setAdLoaded(true);
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])("ad_shown", {
                        page
                    });
                }
            } catch (error) {
                console.error("AdSense load error:", error);
            }
        }
    }["AdSlot.useEffect"], [
        mounted,
        isPro,
        page,
        adLoaded
    ]);
    if (isPro) {
        return null;
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        style: {
            minHeight: 110,
            ...style
        },
        "aria-label": "Advertisement",
        className: "ad-container",
        children: mounted ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("ins", {
            className: "adsbygoogle",
            style: {
                display: "block",
                ...style
            },
            "data-ad-client": "ca-pub-9662479821167655",
            "data-ad-slot": slot,
            "data-ad-format": format,
            "data-full-width-responsive": "true"
        }, void 0, false, {
            fileName: "[project]/src/components/AdSlot.client.tsx",
            lineNumber: 56,
            columnNumber: 9
        }, this) : null
    }, void 0, false, {
        fileName: "[project]/src/components/AdSlot.client.tsx",
        lineNumber: 50,
        columnNumber: 5
    }, this);
}
_s(AdSlot, "PEZSDA9xiOmw8rGpuR0uSztfAxw=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ProProvider$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["usePro"]
    ];
});
_c = AdSlot;
var _c;
__turbopack_context__.k.register(_c, "AdSlot");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/music-theory.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "analyzeChordProgression",
    ()=>analyzeChordProgression,
    "getDiatonicChordsFor",
    ()=>getDiatonicChordsFor
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$tonal$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/tonal/dist/index.mjs [app-client] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$key$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Key$3e$__ = __turbopack_context__.i("[project]/node_modules/@tonaljs/key/dist/index.mjs [app-client] (ecmascript) <export * as Key>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$note$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Note$3e$__ = __turbopack_context__.i("[project]/node_modules/@tonaljs/note/dist/index.mjs [app-client] (ecmascript) <export * as Note>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$scale$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Scale$3e$__ = __turbopack_context__.i("[project]/node_modules/@tonaljs/scale/dist/index.mjs [app-client] (ecmascript) <export * as Scale>");
;
const ALL_TONICS = [
    "C",
    "C#",
    "D",
    "Eb",
    "E",
    "F",
    "F#",
    "G",
    "Ab",
    "A",
    "Bb",
    "B"
];
// Phase E-5: Default section weights (based on musical importance)
const DEFAULT_SECTION_WEIGHTS = {
    Intro: 0.8,
    Verse: 1.0,
    PreChorus: 1.2,
    Chorus: 1.6,
    PostChorus: 1.3,
    Bridge: 0.9,
    Solo: 1.0,
    Interlude: 0.8,
    Outro: 0.9,
    Breakdown: 0.9,
    Custom: 1.0
};
const DEFAULT_WEIGHTS = {
    songHead: 1.2,
    songTail: 1.3,
    sectionEdge: 1.1
};
const SCALE_DEFS = {
    major: {
        id: "major",
        name: "Major Scale",
        tier: "free"
    },
    naturalMinor: {
        id: "naturalMinor",
        name: "Natural Minor Scale",
        tier: "free"
    },
    majorPent: {
        id: "majorPent",
        name: "Major Pentatonic",
        tier: "free"
    },
    minorPent: {
        id: "minorPent",
        name: "Minor Pentatonic",
        tier: "free"
    },
    blues: {
        id: "blues",
        name: "Blues Scale",
        tier: "free"
    },
    dorian: {
        id: "dorian",
        name: "Dorian Mode",
        tier: "pro"
    },
    mixolydian: {
        id: "mixolydian",
        name: "Mixolydian Mode",
        tier: "pro"
    },
    lydian: {
        id: "lydian",
        name: "Lydian Mode",
        tier: "pro"
    },
    harmonicMinor: {
        id: "harmonicMinor",
        name: "Harmonic Minor",
        tier: "pro"
    },
    melodicMinor: {
        id: "melodicMinor",
        name: "Melodic Minor",
        tier: "pro"
    }
};
function normalizeNote(input) {
    const n = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$note$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Note$3e$__["Note"].pitchClass(input);
    return n || input;
}
function parseChordToken(token) {
    if (!token) return null;
    // Remove bass/slash
    const [head] = token.split("/");
    const m = head.match(/^([A-Ga-g])([#b]?)(.*)$/);
    if (!m) return null;
    const root = normalizeNote((m[1] + m[2]).toUpperCase());
    const rest = (m[3] || "").toLowerCase();
    // Order matters: detect maj before generic m
    let triad = "maj";
    if (/(m7b5|ø|dim)/.test(rest)) triad = "dim";
    else if (/maj/.test(rest)) triad = "maj";
    else if (/(^|[^a-z])m(?!aj)/.test(rest)) triad = "min";
    else if (/sus|aug/.test(rest)) triad = "maj"; // treat as functional major
    else triad = "maj";
    const isDominantLike = /(^|[^a-z])7(?![a-z0-9])/.test(rest) || /7/.test(rest);
    return {
        raw: token,
        root,
        triad,
        isDominantLike
    };
}
function getDiatonicChords(key) {
    var _nk_natural;
    if (key.quality === "major") {
        const mk = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$key$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Key$3e$__["Key"].majorKey(key.tonic);
        return mk.chords || [];
    }
    const nk = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$key$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Key$3e$__["Key"].minorKey(key.tonic);
    return ((_nk_natural = nk.natural) === null || _nk_natural === void 0 ? void 0 : _nk_natural.chords) || nk.chords || [];
}
function isDiatonicMatch(chord, diatonic) {
    const target = chord.root + (chord.triad === "maj" ? "" : chord.triad === "min" ? "m" : "dim");
    return diatonic.includes(target);
}
function fifth(note) {
    const p = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$note$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Note$3e$__["Note"].transpose(note, "5P");
    return normalizeNote(p);
}
function flat(note) {
    const p = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$note$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Note$3e$__["Note"].transpose(note, "-1m");
    return normalizeNote(p);
}
function isSecondaryDominant(chord, key) {
    // very light-weight V/V detector: major triad (or 7) on degree 2's major? We'll approximate as fifth of fifth
    const v = fifth(key.tonic);
    const vOfV = fifth(v);
    return chord.root === vOfV && (chord.triad === "maj" || chord.isDominantLike);
}
function isSubdominantMinorOrbVII(chord, key) {
    if (key.quality !== "major") return false;
    const mk = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$key$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Key$3e$__["Key"].majorKey(key.tonic);
    const scale = mk.scale || [];
    const degree4 = scale[3];
    const degree7 = scale[6];
    const ivMinor = degree4 ? normalizeNote(degree4) : "";
    const bVII = degree7 ? normalizeNote(flat(degree7)) : "";
    const isIvMinor = chord.root === ivMinor && chord.triad === "min";
    const isB7 = chord.root === bVII && chord.triad === "maj";
    return !!(isIvMinor || isB7);
}
function scoreForKey(chords, key, weights) {
    const diatonic = getDiatonicChords(key);
    let reasons = [];
    // Phase E-5: Use provided weights or fall back to legacy position weights
    const W = weights || chords.map((_, i)=>i === 0 ? 1.2 : i === chords.length - 1 ? 1.3 : 1);
    const total = W.reduce((a, b)=>a + b, 0);
    let acc = 0;
    chords.forEach((ch, i)=>{
        const w = W[i];
        if (isDiatonicMatch(ch, diatonic)) {
            acc += w * 1.0; // 100%
        } else if (isSecondaryDominant(ch, key)) {
            acc += w * 0.9; // 85-95%
            reasons.push("Secondary dominant tolerated: ".concat(ch.raw));
        } else if (isSubdominantMinorOrbVII(ch, key)) {
            acc += w * 0.8; // 70-85%
            reasons.push("Borrowed chord tolerated: ".concat(ch.raw));
        } else {
            acc += w * 0.5; // potential modulation or out-of-key
        }
    });
    const confidence = Math.round(acc / total * 100);
    reasons.unshift("".concat(diatonic.length, " diatonic chords in ").concat(key.tonic, " ").concat(key.quality));
    return {
        score: confidence,
        reasons
    };
}
function recommendScales(topKey, chords) {
    const list = [
        SCALE_DEFS.major,
        SCALE_DEFS.naturalMinor,
        SCALE_DEFS.majorPent,
        SCALE_DEFS.minorPent,
        SCALE_DEFS.blues,
        SCALE_DEFS.dorian,
        SCALE_DEFS.mixolydian,
        SCALE_DEFS.lydian,
        SCALE_DEFS.harmonicMinor,
        SCALE_DEFS.melodicMinor
    ];
    // Build a set of chord roots to approximate note coverage
    const chordRoots = new Set(chords.map((c)=>c.root));
    const keyTonic = topKey.tonic;
    const scaleScores = list.map((sm)=>{
        const scaleName = sm.id === "major" ? "Major" : sm.id === "naturalMinor" ? "Natural Minor" : sm.id === "majorPent" ? "Major Pentatonic" : sm.id === "minorPent" ? "Minor Pentatonic" : sm.id === "blues" ? "Blues" : sm.id === "dorian" ? "Dorian" : sm.id === "mixolydian" ? "Mixolydian" : sm.id === "lydian" ? "Lydian" : sm.id === "harmonicMinor" ? "Harmonic Minor" : "Melodic Minor";
        const sc = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$scale$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Scale$3e$__["Scale"].get("".concat(keyTonic, " ").concat(scaleName));
        const noteSet = new Set((sc.notes || []).map(normalizeNote));
        const matches = Array.from(chordRoots).filter((r)=>noteSet.has(r)).length;
        const score = matches / Math.max(1, chordRoots.size);
        return {
            scale: sm,
            score
        };
    });
    scaleScores.sort((a, b)=>b.score - a.score);
    return scaleScores.slice(0, 5);
}
// Phase E-5: Compute weights for each chord based on sections
function computeWeights(chordCount, opts) {
    var _opts_weights, _opts_weights1, _opts_weights2, _opts_weights3;
    const W = new Array(chordCount).fill(1.0);
    const sections = opts.sections || [];
    var _opts_weights_section;
    const sectionWeights = {
        ...DEFAULT_SECTION_WEIGHTS,
        ...(_opts_weights_section = (_opts_weights = opts.weights) === null || _opts_weights === void 0 ? void 0 : _opts_weights.section) !== null && _opts_weights_section !== void 0 ? _opts_weights_section : {}
    };
    var _opts_weights_songHead;
    const songHead = (_opts_weights_songHead = (_opts_weights1 = opts.weights) === null || _opts_weights1 === void 0 ? void 0 : _opts_weights1.songHead) !== null && _opts_weights_songHead !== void 0 ? _opts_weights_songHead : DEFAULT_WEIGHTS.songHead;
    var _opts_weights_songTail;
    const songTail = (_opts_weights_songTail = (_opts_weights2 = opts.weights) === null || _opts_weights2 === void 0 ? void 0 : _opts_weights2.songTail) !== null && _opts_weights_songTail !== void 0 ? _opts_weights_songTail : DEFAULT_WEIGHTS.songTail;
    var _opts_weights_sectionEdge;
    const sectionEdge = (_opts_weights_sectionEdge = (_opts_weights3 = opts.weights) === null || _opts_weights3 === void 0 ? void 0 : _opts_weights3.sectionEdge) !== null && _opts_weights_sectionEdge !== void 0 ? _opts_weights_sectionEdge : DEFAULT_WEIGHTS.sectionEdge;
    // Apply section weights
    for (const s of sections){
        var _s_repeat;
        const repeat = (_s_repeat = s.repeat) !== null && _s_repeat !== void 0 ? _s_repeat : 1;
        var _s_weightMul, _ref;
        const base = ((_ref = (_s_weightMul = s.weightMul) !== null && _s_weightMul !== void 0 ? _s_weightMul : sectionWeights[s.name]) !== null && _ref !== void 0 ? _ref : 1.0) * Math.sqrt(repeat);
        for(let i = s.start; i <= s.end && i < chordCount; i++){
            W[i] *= base;
        }
        // Section edge bonus
        if (s.start < chordCount) W[s.start] *= sectionEdge;
        if (s.end < chordCount) W[s.end] *= sectionEdge;
    }
    // Song-level head/tail bonus (legacy compatibility)
    if (chordCount > 0) W[0] *= songHead;
    if (chordCount > 1) W[chordCount - 1] *= songTail;
    // Normalize (Σ W = 1)
    const sumW = W.reduce((a, b)=>a + b, 0) || 1;
    return W.map((w)=>w / sumW);
}
function analyzeChordProgression(rawTokens) {
    let opts = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : {};
    const chords = rawTokens.map((t)=>t.trim()).filter(Boolean).map(parseChordToken).filter((c)=>!!c);
    // Phase E-5: Compute weights with section awareness
    const weights = computeWeights(chords.length, opts);
    const candidates = [];
    for (const tonic of ALL_TONICS){
        for (const quality of [
            "major",
            "minor"
        ]){
            const { score, reasons } = scoreForKey(chords, {
                tonic: tonic,
                quality
            }, weights);
            candidates.push({
                key: {
                    tonic: tonic,
                    quality
                },
                confidence: score,
                reasons
            });
        }
    }
    candidates.sort((a, b)=>b.confidence - a.confidence);
    const keyCandidates = candidates.slice(0, 5); // v3.1: 3→5候補に拡張（iOS UI改善）
    const recommendedScales = recommendScales(keyCandidates[0].key, chords);
    // Phase E-5: Per-section analysis (optional)
    let perSection;
    if (opts.sections && opts.sections.length > 0) {
        perSection = opts.sections.map((sec)=>{
            const slice = rawTokens.slice(sec.start, Math.min(sec.end + 1, rawTokens.length));
            // Analyze section without section weights (just the chords themselves)
            const local = analyzeChordProgression(slice, {
                weights: {
                    songHead: 1.0,
                    songTail: 1.0
                }
            });
            return {
                section: sec,
                best: local.keyCandidates[0],
                ranking: local.keyCandidates
            };
        });
    }
    return {
        keyCandidates,
        recommendedScales,
        perSection
    };
}
function getDiatonicChordsFor(req) {
    const key = {
        tonic: req.tonic,
        quality: req.quality
    };
    const chords = getDiatonicChords(key);
    return {
        chords
    };
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/scaleCatalog.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Single Source of Truth for scale catalog (English-first)
__turbopack_context__.s([
    "SCALE_CATALOG",
    ()=>SCALE_CATALOG,
    "getScaleMask12",
    ()=>getScaleMask12,
    "isHeptatonic",
    ()=>isHeptatonic,
    "isPentOrBlues",
    ()=>isPentOrBlues,
    "listScales",
    ()=>listScales
]);
const SCALE_CATALOG = [
    // Use English names per Excel (avoid modal names for major/minor)
    {
        id: 'Ionian',
        display: {
            en: 'Major Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            '3',
            '4',
            '5',
            '6',
            '7'
        ],
        info: {
            oneLiner: 'Major scale; bright and stable.',
            examples: [
                {
                    title: 'Let It Be',
                    artist: 'The Beatles'
                },
                {
                    title: 'Do-Re-Mi',
                    artist: 'Richard Rodgers'
                }
            ]
        }
    },
    {
        id: 'Dorian',
        display: {
            en: 'Dorian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            '5',
            '6',
            'b7'
        ],
        info: {
            oneLiner: 'Minor with a natural 6th; cool, modal colour.',
            examples: [
                {
                    title: 'So What',
                    artist: 'Miles Davis'
                }
            ]
        }
    },
    {
        id: 'Phrygian',
        display: {
            en: 'Phrygian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            'b2',
            'b3',
            '4',
            '5',
            'b6',
            'b7'
        ],
        info: {
            oneLiner: 'Dark, Spanish/Arabic flavour with flat 2.'
        }
    },
    {
        id: 'Lydian',
        display: {
            en: 'Lydian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            '3',
            '#4',
            '5',
            '6',
            '7'
        ],
        info: {
            oneLiner: 'Dreamy major with raised 4th (♯4).',
            examples: [
                {
                    title: 'The Simpsons Theme',
                    artist: 'Danny Elfman'
                }
            ]
        }
    },
    {
        id: 'Mixolydian',
        display: {
            en: 'Mixolydian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            '3',
            '4',
            '5',
            '6',
            'b7'
        ],
        info: {
            oneLiner: 'Major with flat 7; dominant, bluesy feel.',
            examples: [
                {
                    title: 'Sweet Home Alabama',
                    artist: 'Lynyrd Skynyrd'
                }
            ]
        }
    },
    {
        id: 'Aeolian',
        display: {
            en: 'Natural Minor Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            '5',
            'b6',
            'b7'
        ],
        info: {
            oneLiner: 'Natural minor; sad or moody colour.',
            examples: [
                {
                    title: 'House of the Rising Sun',
                    artist: 'Traditional'
                }
            ]
        }
    },
    {
        id: 'Locrian',
        display: {
            en: 'Locrian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            'b2',
            'b3',
            '4',
            'b5',
            'b6',
            'b7'
        ],
        info: {
            oneLiner: 'Diminished 5th; unstable, rarely used as a key.'
        }
    },
    {
        id: 'MajorPentatonic',
        display: {
            en: 'Major Pentatonic'
        },
        group: 'Pentatonic',
        degrees: [
            '1',
            '2',
            '3',
            '5',
            '6'
        ],
        info: {
            oneLiner: 'Five-note, open and melodic; fits many chords.',
            examples: [
                {
                    title: 'My Girl',
                    artist: 'The Temptations'
                }
            ]
        }
    },
    {
        id: 'MinorPentatonic',
        display: {
            en: 'Minor Pentatonic'
        },
        group: 'Pentatonic',
        degrees: [
            '1',
            'b3',
            '4',
            '5',
            'b7'
        ],
        info: {
            oneLiner: 'Five-note minor staple for rock/blues solos.',
            examples: [
                {
                    title: 'Purple Haze',
                    artist: 'Jimi Hendrix'
                }
            ]
        }
    },
    {
        id: 'Blues',
        display: {
            en: 'Blues Scale (minor)'
        },
        group: 'Pentatonic',
        degrees: [
            '1',
            'b3',
            '4',
            'b5',
            '5',
            'b7'
        ],
        info: {
            oneLiner: 'Minor pentatonic plus blue note (♭5).',
            examples: [
                {
                    title: 'Smoke on the Water',
                    artist: 'Deep Purple'
                }
            ]
        }
    },
    {
        id: 'HarmonicMinor',
        display: {
            en: 'Harmonic Minor'
        },
        group: 'Minor',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            '5',
            'b6',
            '7'
        ],
        info: {
            oneLiner: 'Minor with raised 7th; exotic dominant pull.',
            examples: [
                {
                    title: 'Misirlou',
                    artist: 'Traditional'
                }
            ]
        }
    },
    {
        id: 'MelodicMinor',
        display: {
            en: 'Melodic Minor Scale'
        },
        group: 'Minor',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            '5',
            '6',
            '7'
        ],
        info: {
            oneLiner: 'Jazz minor (ascending); smooth minor/major blend.'
        }
    },
    // Diminished scales (symmetric) — added per Excel list
    {
        id: 'DiminishedWholeHalf',
        display: {
            en: 'Diminished Scale (Whole–Half)'
        },
        group: 'Other',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            'b5',
            'b6',
            '6',
            '7'
        ],
        info: {
            oneLiner: 'Symmetric 8-note (whole–half) scale; over dim7.'
        }
    },
    {
        id: 'DiminishedHalfWhole',
        display: {
            en: 'Diminished Scale (Half–Whole)'
        },
        group: 'Other',
        degrees: [
            '1',
            'b2',
            'b3',
            '3',
            '#4',
            '5',
            '6',
            'b7'
        ],
        info: {
            oneLiner: 'Symmetric 8-note (half–whole); over 7♭9 chords.'
        }
    }
];
// Dev helper: expose catalog for quick inspection in console (no filtering)
if ("TURBOPACK compile-time truthy", 1) {
    window.__SCALES_EN__ = SCALE_CATALOG;
}
function getScaleMask12(id) {
    const item = SCALE_CATALOG.find((s)=>s.id === id);
    if (!item) return Array(12).fill(0);
    const DEGREE_TO_SEMITONE = {
        '1': 0,
        'b2': 1,
        '2': 2,
        'b3': 3,
        '3': 4,
        '4': 5,
        '#4': 6,
        'b5': 6,
        '5': 7,
        '#5': 8,
        'b6': 8,
        '6': 9,
        'bb7': 9,
        'b7': 10,
        '7': 11
    };
    const mask = Array(12).fill(0);
    for (const d of item.degrees){
        const s = DEGREE_TO_SEMITONE[d];
        if (typeof s === 'number') mask[(s + 120) % 12] = 1;
    }
    return mask;
}
function listScales() {
    return SCALE_CATALOG.map((s)=>({
            id: s.id,
            label: s.display.en
        }));
}
const isHeptatonic = (scaleId)=>{
    const item = SCALE_CATALOG.find((s)=>s.id === scaleId);
    return item ? item.degrees.length === 7 : false;
};
const isPentOrBlues = (scaleId)=>{
    return scaleId === 'MajorPentatonic' || scaleId === 'MinorPentatonic' || scaleId === 'Blues';
};
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/scales.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "DEGREE_LABELS",
    ()=>DEGREE_LABELS,
    "DEGREE_TO_SEMITONE",
    ()=>DEGREE_TO_SEMITONE,
    "SCALE_INTERVALS",
    ()=>SCALE_INTERVALS,
    "degreeLabelFor",
    ()=>degreeLabelFor,
    "degreeRomanFor",
    ()=>degreeRomanFor,
    "getScalePitches",
    ()=>getScalePitches,
    "getScalePitchesById",
    ()=>getScalePitchesById,
    "normalizeScaleId",
    ()=>normalizeScaleId,
    "parentModeOf",
    ()=>parentModeOf,
    "romanDegreeLabelsForScale",
    ()=>romanDegreeLabelsForScale,
    "scaleTypeLabel",
    ()=>scaleTypeLabel
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scaleCatalog.ts [app-client] (ecmascript)");
;
const SCALE_INTERVALS = {
    Ionian: [
        0,
        2,
        4,
        5,
        7,
        9,
        11
    ],
    Dorian: [
        0,
        2,
        3,
        5,
        7,
        9,
        10
    ],
    Phrygian: [
        0,
        1,
        3,
        5,
        7,
        8,
        10
    ],
    Lydian: [
        0,
        2,
        4,
        6,
        7,
        9,
        11
    ],
    Mixolydian: [
        0,
        2,
        4,
        5,
        7,
        9,
        10
    ],
    Aeolian: [
        0,
        2,
        3,
        5,
        7,
        8,
        10
    ],
    Locrian: [
        0,
        1,
        3,
        5,
        6,
        8,
        10
    ],
    HarmonicMinor: [
        0,
        2,
        3,
        5,
        7,
        8,
        11
    ],
    MelodicMinor: [
        0,
        2,
        3,
        5,
        7,
        9,
        11
    ],
    MajorPentatonic: [
        0,
        2,
        4,
        7,
        9
    ],
    MinorPentatonic: [
        0,
        3,
        5,
        7,
        10
    ],
    Blues: [
        0,
        3,
        5,
        6,
        7,
        10
    ],
    DiminishedWholeHalf: [
        0,
        2,
        3,
        5,
        6,
        8,
        9,
        11
    ],
    DiminishedHalfWhole: [
        0,
        1,
        3,
        4,
        6,
        7,
        9,
        10
    ]
};
function getScalePitches(root, type) {
    // Prefer catalog-driven calculation when possible
    try {
        return getScalePitchesById(root, type);
    } catch (e) {}
    const ints = SCALE_INTERVALS[type];
    if (!ints || ints.length === 0) {
        throw new Error("Unknown scale id: ".concat(String(type)));
    }
    return ints.map((iv)=>(root + iv + 120) % 12);
}
function normalizeScaleId(id) {
    const aliases = {
        Major: 'Ionian',
        Minor: 'Aeolian'
    };
    const key = String(id);
    var _aliases_key, _ref;
    return (_ref = (_aliases_key = aliases[key]) !== null && _aliases_key !== void 0 ? _aliases_key : aliases[key[0].toUpperCase() + key.slice(1)]) !== null && _ref !== void 0 ? _ref : id;
}
function scaleTypeLabel(t) {
    // エイリアス吸収（防御的）
    const aliasToId = {
        Major: 'Ionian',
        Minor: 'Aeolian'
    };
    var _aliasToId_t;
    const id = (_aliasToId_t = aliasToId[t]) !== null && _aliasToId_t !== void 0 ? _aliasToId_t : t;
    const map = {
        Ionian: 'Major Scale',
        Dorian: 'Dorian',
        Phrygian: 'Phrygian',
        Lydian: 'Lydian',
        Mixolydian: 'Mixolydian',
        Aeolian: 'Natural Minor',
        Locrian: 'Locrian',
        HarmonicMinor: 'Harmonic Minor',
        MelodicMinor: 'Melodic Minor',
        MajorPentatonic: 'Major Pentatonic',
        MinorPentatonic: 'Minor Pentatonic'
    };
    // Mapを既定とし、未定義はカタログのdisplay.enを利用
    const short = map[id];
    if (short) return short;
    const cat = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === id);
    return ((cat === null || cat === void 0 ? void 0 : cat.display.en) || String(id)).replace(/\s*\(.*\)$/, '');
}
const DEGREE_LABELS = {
    Ionian: [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7"
    ],
    Dorian: [
        "1",
        "2",
        "♭3",
        "4",
        "5",
        "6",
        "♭7"
    ],
    Phrygian: [
        "1",
        "♭2",
        "♭3",
        "4",
        "5",
        "♭6",
        "♭7"
    ],
    Lydian: [
        "1",
        "2",
        "3",
        "♯4",
        "5",
        "6",
        "7"
    ],
    Mixolydian: [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "♭7"
    ],
    Aeolian: [
        "1",
        "2",
        "♭3",
        "4",
        "5",
        "♭6",
        "♭7"
    ],
    Locrian: [
        "1",
        "♭2",
        "♭3",
        "4",
        "♭5",
        "♭6",
        "♭7"
    ],
    HarmonicMinor: [
        "1",
        "2",
        "♭3",
        "4",
        "5",
        "♭6",
        "7"
    ],
    MelodicMinor: [
        "1",
        "2",
        "♭3",
        "4",
        "5",
        "6",
        "7"
    ],
    MajorPentatonic: [
        "1",
        "2",
        "3",
        "5",
        "6"
    ],
    MinorPentatonic: [
        "1",
        "♭3",
        "4",
        "5",
        "♭7"
    ],
    Blues: [
        "1",
        "♭3",
        "4",
        "♭5",
        "5",
        "♭7"
    ]
};
function degreeLabelFor(pc, root, type) {
    const iv = (pc - root + 120) % 12;
    // Prefer catalog degrees → semitone offsets
    const cat = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === type);
    var _SCALE_INTERVALS_type, _ref;
    const ivs = (_ref = cat ? cat.degrees.map((d)=>DEGREE_TO_SEMITONE[d]) : undefined) !== null && _ref !== void 0 ? _ref : (_SCALE_INTERVALS_type = SCALE_INTERVALS[type]) !== null && _SCALE_INTERVALS_type !== void 0 ? _SCALE_INTERVALS_type : [];
    const idx = ivs.indexOf(iv);
    if (idx === -1) return null;
    var _DEGREE_LABELS_type, _ref1;
    const labels = (_ref1 = cat === null || cat === void 0 ? void 0 : cat.degrees) !== null && _ref1 !== void 0 ? _ref1 : (_DEGREE_LABELS_type = DEGREE_LABELS[type]) !== null && _DEGREE_LABELS_type !== void 0 ? _DEGREE_LABELS_type : undefined;
    if (!labels) return null;
    var _labels_idx;
    return (_labels_idx = labels[idx]) !== null && _labels_idx !== void 0 ? _labels_idx : null;
}
// Convert a degree token like "1", "b2", "#4", "♭3" to Roman form (R, II, ♯IV, ♭III, etc.)
function degreeTokenToRoman(token) {
    const t = token.replace(/\s+/g, '').replace(/bb/g, '♭♭').replace(/b/g, '♭').replace(/##/g, '♯♯').replace(/#/g, '♯');
    // Extract accidentals and number
    const m = t.match(/^(♭|♯|♭♭|♯♯)?(\d)$/);
    if (!m) {
        // fallback: if already has Roman-like content, return as is
        return t;
    }
    var _m_;
    const acc = (_m_ = m[1]) !== null && _m_ !== void 0 ? _m_ : '';
    const n = m[2];
    const romanBase = {
        '1': 'R',
        '2': 'II',
        '3': 'III',
        '4': 'IV',
        '5': 'V',
        '6': 'VI',
        '7': 'VII'
    };
    var _romanBase_n;
    const base = (_romanBase_n = romanBase[n]) !== null && _romanBase_n !== void 0 ? _romanBase_n : n;
    return "".concat(acc).concat(base);
}
function degreeRomanFor(pc, root, type) {
    const iv = (pc - root + 120) % 12;
    const cat = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === type);
    var _SCALE_INTERVALS_type, _ref;
    const ivs = (_ref = cat ? cat.degrees.map((d)=>DEGREE_TO_SEMITONE[d]) : undefined) !== null && _ref !== void 0 ? _ref : (_SCALE_INTERVALS_type = SCALE_INTERVALS[type]) !== null && _SCALE_INTERVALS_type !== void 0 ? _SCALE_INTERVALS_type : [];
    const idx = ivs.indexOf(iv);
    if (idx === -1) return null;
    var _DEGREE_LABELS_type, _ref1;
    const labels = (_ref1 = cat === null || cat === void 0 ? void 0 : cat.degrees) !== null && _ref1 !== void 0 ? _ref1 : (_DEGREE_LABELS_type = DEGREE_LABELS[type]) !== null && _DEGREE_LABELS_type !== void 0 ? _DEGREE_LABELS_type : undefined;
    if (!labels) return null;
    var _labels_idx;
    const token = (_labels_idx = labels[idx]) !== null && _labels_idx !== void 0 ? _labels_idx : '';
    return degreeTokenToRoman(token);
}
function parentModeOf(t) {
    switch(t){
        case 'MajorPentatonic':
            return 'Ionian';
        case 'MinorPentatonic':
            return 'Aeolian';
        default:
            return null;
    }
}
// === Roman degree labels per scale type (vs Ionian baseline) ===
const IONIAN_INTERVALS = [
    0,
    2,
    4,
    5,
    7,
    9,
    11
];
const ROMAN_BASE = [
    'I',
    'II',
    'III',
    'IV',
    'V',
    'VI',
    'VII'
];
function romanDegreeLabelsForScale(scaleType) {
    const ints = SCALE_INTERVALS[scaleType];
    // Fallback for non-7-note scales
    if (!ints || ints.length !== 7) return [
        ...ROMAN_BASE
    ];
    return ints.map((semi, i)=>{
        const base = ROMAN_BASE[i];
        const diff = semi - IONIAN_INTERVALS[i];
        if (diff === 0) return base;
        if (diff > 0) return '#'.repeat(diff) + base;
        return 'b'.repeat(-diff) + base;
    });
}
const DEGREE_TO_SEMITONE = {
    '1': 0,
    'b2': 1,
    '2': 2,
    'b3': 3,
    '3': 4,
    '4': 5,
    '#4': 6,
    'b5': 6,
    '5': 7,
    '#5': 8,
    'b6': 8,
    '6': 9,
    'bb7': 9,
    'b7': 10,
    '7': 11
};
function getScalePitchesById(rootPc, id) {
    const s = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((x)=>x.id === id);
    if (!s) throw new Error("Scale not found in catalog: ".concat(String(id)));
    return s.degrees.map((d)=>(rootPc + DEGREE_TO_SEMITONE[d] + 120) % 12);
}
// Dev helper: expose minimal API for console checks
if ("TURBOPACK compile-time truthy", 1) {
    window.__SCALES_API__ = {
        getScalePitchesById
    };
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/components/Fretboard.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>Fretboard
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scaleCatalog.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/audio/player.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
const PITCHES12 = [
    'C',
    'C#',
    'D',
    'Eb',
    'E',
    'F',
    'F#',
    'G',
    'Ab',
    'A',
    'Bb',
    'B'
];
// --- Dot visuals (shared for Degrees/Names) ---
const DOT_PX_DESKTOP = 26;
const DOT_PX_MOBILE = 24;
const FONT_PX_DESKTOP = 14;
const FONT_PX_MOBILE = 13;
// Original palette（page base: show degree colours）
const COLOR_ROOT = "hsl(355 80% 60% / .95)"; // root
const COLOR_DEG3 = "hsl(205 90% 56% / .90)"; // 3rd
const COLOR_DEG5 = "hsl(150 65% 45% / .90)"; // 5th
const COLOR_DEG7 = "hsl(48 95% 55% / .92)"; // 7th
// Preview palette（suggested-scale overlay: chord vs others）
const COLOR_CHORD = "hsl(0 85% 55% / .95)"; // chord tones (red)
const COLOR_SCALE = "hsl(210 10% 72% / .70)"; // non-chord scale tones (gray)
const COLOR_OUT = "hsl(210 6% 38% / .30)";
const COLOR_GHOST = "hsl(210 12% 58% / .60)"; // unified ghost color (darker)
const LABEL_COLOR = "#0b0b0b";
const dotStyle = (bg, isMobile)=>{
    const size = isMobile ? DOT_PX_MOBILE : DOT_PX_DESKTOP;
    return {
        width: size,
        height: size,
        borderRadius: size,
        background: bg,
        color: LABEL_COLOR,
        fontWeight: 700,
        fontSize: isMobile ? FONT_PX_MOBILE : FONT_PX_DESKTOP,
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        transform: 'translate(-50%, -50%)',
        textShadow: '0 0 1px rgba(0,0,0,.55)',
        WebkitTextStroke: '0.3px rgba(255,255,255,.35)',
        userSelect: 'none'
    };
};
function colorForDegreeLabel(preview, lbl, isChordTone, isInScale, isRoot) {
    if (!isInScale) return COLOR_OUT;
    if (preview) {
        return isChordTone ? COLOR_CHORD : COLOR_SCALE;
    }
    if (isRoot) return COLOR_ROOT;
    if (!lbl) return COLOR_SCALE;
    const l = lbl.replace(/\s/g, "");
    if (l.includes("3")) return COLOR_DEG3;
    if (l.includes("5")) return COLOR_DEG5;
    if (l.includes("7")) return COLOR_DEG7;
    return COLOR_SCALE;
}
function ghostFromBaseColor(base) {
    let alpha = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 0.85;
    try {
        if (base.includes('/')) {
            return base.replace(/\/(.*?)\)/, "/ ".concat(alpha, ")"));
        }
        if (base.endsWith(')')) return base.replace(/\)$/, " / ".concat(alpha, ")"));
    } catch (e) {}
    return base;
}
function Fretboard(param) {
    let { strings = [
        'E',
        'B',
        'G',
        'D',
        'A',
        'E'
    ], frets = 15, dotPositions: _dotPositions = [
        3,
        5,
        7,
        9,
        12,
        15
    ], overlay = null, onRequestForms, formShape = null } = param;
    _s();
    const wrapRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    // SSRと初回クライアント描画の一致を保つため、初期値はfalse（デスクトップ想定）
    const [isMobile, setIsMobile] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [pressedCell, setPressedCell] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "Fretboard.useEffect": ()=>{
            const update = {
                "Fretboard.useEffect.update": ()=>{
                    try {
                        setIsMobile(window.innerWidth < 380);
                    } catch (e) {}
                }
            }["Fretboard.useEffect.update"];
            update();
            window.addEventListener('resize', update);
            return ({
                "Fretboard.useEffect": ()=>window.removeEventListener('resize', update)
            })["Fretboard.useEffect"];
        }
    }["Fretboard.useEffect"], []);
    // ScaleとChordを統合したoverlayオブジェクトを作成
    // 親から `overlay` が渡されている場合はそれを最優先（Find Key などの初期表示用）
    const overlayEff = overlay !== null && overlay !== void 0 ? overlay : null;
    // Layout constants
    const LEFT_GUTTER = 44; // px  // compact gutter (reduced)
    const SPACE_W = 28; // px  // standard fret min width
    const ROW_H = 28; // px
    const TOP_BAR_H = 32; // px
    const OPEN_GAP = 20; // px additional gap for open column (increased by +8px)
    const ZERO_COL_W = SPACE_W + OPEN_GAP; // widened open column
    const COLS = (f)=>"".concat(ZERO_COL_W, "px repeat(").concat(f, ", minmax(").concat(SPACE_W, "px, 1fr))");
    const NUT_WIDTH = 3; // px
    // --- Chord label long-press (for mouse/touch on the label only) ---
    const PRESS_MS = 400;
    const pressTimer = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const endPress = ()=>{
        if (pressTimer.current !== null) {
            clearTimeout(pressTimer.current);
            pressTimer.current = null;
        }
    };
    const startPress = (e, ctx)=>{
        if (!onRequestForms) return;
        // マウスの長押しは不要だが、統一して実装
        endPress();
        pressTimer.current = window.setTimeout(()=>{
            onRequestForms({
                x: e.clientX,
                y: e.clientY
            }, ctx);
        }, PRESS_MS);
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "Fretboard.useEffect": ()=>{}
    }["Fretboard.useEffect"], [
        frets,
        strings.length
    ]);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "rounded-lg border p-3 overflow-x-auto ot-fretboard ot-fb-compact",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "min-w-[640px]",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    ref: wrapRef,
                    className: "relative",
                    style: {
                        height: TOP_BAR_H + strings.length * ROW_H + 16
                    },
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "pointer-events-none absolute top-1 grid text-[12px] md:text-sm text-foreground/80",
                            style: {
                                gridTemplateColumns: COLS(frets),
                                height: TOP_BAR_H,
                                left: LEFT_GUTTER,
                                right: 0
                            },
                            children: Array.from({
                                length: frets + 1
                            }).map((_, col)=>{
                                const show = [
                                    0,
                                    1,
                                    3,
                                    5,
                                    7,
                                    9,
                                    12,
                                    15
                                ].includes(col);
                                if (!show) return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {}, col, false, {
                                    fileName: "[project]/src/components/Fretboard.tsx",
                                    lineNumber: 143,
                                    columnNumber: 33
                                }, this);
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-start justify-center",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "inline-block px-1 rounded bg-background/80",
                                        children: col
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/Fretboard.tsx",
                                        lineNumber: 146,
                                        columnNumber: 19
                                    }, this)
                                }, col, false, {
                                    fileName: "[project]/src/components/Fretboard.tsx",
                                    lineNumber: 145,
                                    columnNumber: 17
                                }, this);
                            })
                        }, void 0, false, {
                            fileName: "[project]/src/components/Fretboard.tsx",
                            lineNumber: 132,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "absolute select-none",
                            style: {
                                left: 0,
                                top: TOP_BAR_H,
                                width: LEFT_GUTTER,
                                height: strings.length * ROW_H,
                                display: 'grid',
                                gridTemplateRows: "repeat(".concat(strings.length, ", ").concat(ROW_H, "px)")
                            },
                            "aria-hidden": "true",
                            children: strings.map((s, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-center justify-center text-xs md:text-sm leading-none text-muted-foreground",
                                    children: s
                                }, "lbl-".concat(i), false, {
                                    fileName: "[project]/src/components/Fretboard.tsx",
                                    lineNumber: 166,
                                    columnNumber: 15
                                }, this))
                        }, void 0, false, {
                            fileName: "[project]/src/components/Fretboard.tsx",
                            lineNumber: 153,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "absolute right-0 bottom-0 grid",
                            style: {
                                top: TOP_BAR_H,
                                left: LEFT_GUTTER,
                                width: "calc(100% - ".concat(LEFT_GUTTER, "px)"),
                                gridTemplateColumns: COLS(frets),
                                gridTemplateRows: "repeat(".concat(strings.length, ", ").concat(ROW_H, "px)")
                            },
                            children: [
                                strings.map((s, rowIdx)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"].Fragment, {
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "relative",
                                                children: renderOpenMarker({
                                                    overlay: overlayEff,
                                                    strings,
                                                    rowIdx,
                                                    isMobile
                                                })
                                            }, "open-".concat(rowIdx), false, {
                                                fileName: "[project]/src/components/Fretboard.tsx",
                                                lineNumber: 175,
                                                columnNumber: 17
                                            }, this),
                                            Array.from({
                                                length: frets
                                            }).map((_, colIdx)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "relative ".concat(colIdx === 0 ? 'border-l border-transparent' : 'border-l border-black/10 dark:border-white/10', " ").concat(pressedCell && pressedCell.r === rowIdx && pressedCell.c === colIdx ? 'fb-pressed' : '', " cursor-pointer select-none"),
                                                    onClick: async ()=>{
                                                        // 空白やゴースト領域でもタップで単音を軽く試聴
                                                        const STRING_OPEN_MIDI = [
                                                            64,
                                                            59,
                                                            55,
                                                            50,
                                                            45,
                                                            40
                                                        ];
                                                        var _STRING_OPEN_MIDI_Math_min;
                                                        const baseMidi = (_STRING_OPEN_MIDI_Math_min = STRING_OPEN_MIDI[Math.min(rowIdx, STRING_OPEN_MIDI.length - 1)]) !== null && _STRING_OPEN_MIDI_Math_min !== void 0 ? _STRING_OPEN_MIDI_Math_min : 64;
                                                        const midi = baseMidi + (colIdx + 1);
                                                        // 短い押下エフェクト
                                                        setPressedCell((prev)=>{
                                                            var _prev_ver;
                                                            return {
                                                                r: rowIdx,
                                                                c: colIdx,
                                                                ver: ((_prev_ver = prev === null || prev === void 0 ? void 0 : prev.ver) !== null && _prev_ver !== void 0 ? _prev_ver : 0) + 1
                                                            };
                                                        });
                                                        var _pressedCell_ver;
                                                        const localVer = ((_pressedCell_ver = pressedCell === null || pressedCell === void 0 ? void 0 : pressedCell.ver) !== null && _pressedCell_ver !== void 0 ? _pressedCell_ver : 0) + 1;
                                                        window.setTimeout(()=>{
                                                            setPressedCell((cur)=>cur && cur.r === rowIdx && cur.c === colIdx && cur.ver === localVer ? null : cur);
                                                        }, 180);
                                                        try {
                                                            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].resume();
                                                            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].playNote(midi, 240);
                                                        } catch (e) {}
                                                    },
                                                    children: renderMarker({
                                                        overlay: overlayEff,
                                                        strings,
                                                        rowIdx,
                                                        colIdx,
                                                        isMobile
                                                    })
                                                }, "c-".concat(rowIdx, "-").concat(colIdx), false, {
                                                    fileName: "[project]/src/components/Fretboard.tsx",
                                                    lineNumber: 177,
                                                    columnNumber: 19
                                                }, this))
                                        ]
                                    }, "row-".concat(rowIdx), true, {
                                        fileName: "[project]/src/components/Fretboard.tsx",
                                        lineNumber: 173,
                                        columnNumber: 15
                                    }, this)),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    "aria-hidden": true,
                                    className: "absolute pointer-events-none z-[20] bg-black/60 dark:bg-white/70",
                                    style: {
                                        left: ZERO_COL_W - NUT_WIDTH / 2,
                                        top: 0,
                                        bottom: 0,
                                        width: NUT_WIDTH,
                                        borderRadius: 2
                                    }
                                }, void 0, false, {
                                    fileName: "[project]/src/components/Fretboard.tsx",
                                    lineNumber: 200,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/components/Fretboard.tsx",
                            lineNumber: 171,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/components/Fretboard.tsx",
                    lineNumber: 129,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 128,
                columnNumber: 7
            }, this),
            formShape && renderFormOverlay({
                formShape,
                LEFT_GUTTER,
                TOP_BAR_H,
                SPACE_W,
                ROW_H
            })
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/Fretboard.tsx",
        lineNumber: 127,
        columnNumber: 5
    }, this);
}
_s(Fretboard, "DMNe3dCq92xAWrlC32GPrEj/SU0=");
_c = Fretboard;
const pitchIndexMap = {
    C: 0,
    "C#": 1,
    Db: 1,
    D: 2,
    "D#": 3,
    Eb: 3,
    E: 4,
    F: 5,
    "F#": 6,
    Gb: 6,
    G: 7,
    "G#": 8,
    Ab: 8,
    A: 9,
    "A#": 10,
    Bb: 10,
    B: 11
};
const pitchIndex = (note)=>{
    var _pitchIndexMap_note;
    return (_pitchIndexMap_note = pitchIndexMap[note]) !== null && _pitchIndexMap_note !== void 0 ? _pitchIndexMap_note : 0;
};
// Fallback degree label map (chromatic → degree text)
function fallbackDegreeLabel(notePc, rootPc) {
    const d = (notePc - rootPc + 12) % 12;
    const arr = [
        "1",
        "b2",
        "2",
        "b3",
        "3",
        "4",
        "#4",
        "5",
        "b6",
        "6",
        "b7",
        "7"
    ];
    return arr[d];
}
function renderMarker(param) {
    let { overlay, strings, rowIdx, colIdx, isMobile } = param;
    if (!overlay) return null;
    var _overlay_chordNotes, _ref;
    const chordNotes = (_ref = (_overlay_chordNotes = overlay.chordNotes) !== null && _overlay_chordNotes !== void 0 ? _overlay_chordNotes : overlay.notes) !== null && _ref !== void 0 ? _ref : [];
    var _chordNotes_length;
    const hasChord = ((_chordNotes_length = chordNotes === null || chordNotes === void 0 ? void 0 : chordNotes.length) !== null && _chordNotes_length !== void 0 ? _chordNotes_length : 0) > 0;
    var _chordNotes_;
    const chordRootIdx = hasChord ? pitchIndex((_chordNotes_ = chordNotes[0]) !== null && _chordNotes_ !== void 0 ? _chordNotes_ : "C") : 0;
    const set = new Set((chordNotes || []).map((note)=>pitchIndex(note !== null && note !== void 0 ? note : "C")));
    var _strings_rowIdx;
    const openPc = pitchIndex((_strings_rowIdx = strings[rowIdx]) !== null && _strings_rowIdx !== void 0 ? _strings_rowIdx : "E");
    // Shaped: treat capo as new nut → subtract capo semitones
    // column index 0 represents fret 1 (fret 0 = open is not drawn as a column)
    const fretN = colIdx + 1;
    const spc = (openPc + fretN) % 12; // shapedは廃止・常にsounding
    // 実音のMIDI（弦の実チューニング＋フレット数）
    const STRING_OPEN_MIDI = [
        64,
        59,
        55,
        50,
        45,
        40
    ]; // E4, B3, G3, D3, A2, E2 (high -> low)
    var _STRING_OPEN_MIDI_Math_min;
    const baseMidi = (_STRING_OPEN_MIDI_Math_min = STRING_OPEN_MIDI[Math.min(rowIdx, STRING_OPEN_MIDI.length - 1)]) !== null && _STRING_OPEN_MIDI_Math_min !== void 0 ? _STRING_OPEN_MIDI_Math_min : 64;
    const midi = baseMidi + fretN;
    // scale-aware style & label
    const scaleRoot = overlay.scaleRootPc;
    const scaleType = overlay.scaleType;
    const inScale = (()=>{
        if (typeof scaleRoot !== 'number' || !scaleType) return true;
        const iv = (spc - scaleRoot + 120) % 12;
        const ivs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getScalePitches"])(scaleRoot, overlay.scaleType).map((v)=>(v - scaleRoot + 120) % 12);
        return ivs.includes(iv);
    })();
    var _chordNotes_length1;
    // Optionally draw scale ghost when in scale and not a chord tone
    const hasChordOverlay = ((_chordNotes_length1 = chordNotes === null || chordNotes === void 0 ? void 0 : chordNotes.length) !== null && _chordNotes_length1 !== void 0 ? _chordNotes_length1 : 0) > 0;
    var _overlay_showScaleGhost;
    const drawGhost = ((_overlay_showScaleGhost = overlay.showScaleGhost) !== null && _overlay_showScaleGhost !== void 0 ? _overlay_showScaleGhost : true) && hasChordOverlay && inScale && !set.has(spc);
    // Draw chord tone if provided
    const drawChord = set.has(spc);
    const drawScaleMain = !hasChordOverlay && inScale;
    if (!drawGhost && !drawChord && !drawScaleMain) return null;
    const iv = typeof scaleRoot === 'number' ? (spc - scaleRoot + 120) % 12 : 0;
    const isRoot = iv === 0;
    const isChordTone = set.has(spc) || [
        0,
        4,
        7,
        10,
        11
    ].includes(iv); // root/3/5/7 as baseline
    var _degreeLabelFor;
    const degreeLbl = !inScale || typeof scaleRoot !== 'number' || !scaleType ? null : (_degreeLabelFor = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["degreeLabelFor"])(spc, scaleRoot, overlay.scaleType)) !== null && _degreeLabelFor !== void 0 ? _degreeLabelFor : null;
    const baseColor = colorForDegreeLabel(false, degreeLbl, isChordTone, inScale, isRoot);
    const showDegrees = overlay.display === 'degrees';
    const fallbackRoot = typeof scaleRoot === 'number' ? scaleRoot : chordRootIdx;
    var _degreeRomanFor, _ref1;
    const label = showDegrees ? (_ref1 = (_degreeRomanFor = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["degreeRomanFor"])(spc, fallbackRoot, overlay.scaleType)) !== null && _degreeRomanFor !== void 0 ? _degreeRomanFor : degreeLbl) !== null && _ref1 !== void 0 ? _ref1 : fallbackDegreeLabel(spc, fallbackRoot) : PITCHES12[spc];
    const dense = (()=>{
        var _def_degrees;
        const def = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === overlay.scaleType);
        var _def_degrees_length;
        return ((_def_degrees_length = def === null || def === void 0 ? void 0 : (_def_degrees = def.degrees) === null || _def_degrees === void 0 ? void 0 : _def_degrees.length) !== null && _def_degrees_length !== void 0 ? _def_degrees_length : 0) > 7;
    })();
    const fretLabel = colIdx + 1;
    const stringNumber = rowIdx + 1;
    const ariaLabel = "string ".concat(stringNumber, ", fret ").concat(fretLabel, ", ").concat(label === '1' ? 'root' : label);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "absolute inset-0",
        "aria-live": "polite",
        children: [
            drawGhost && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "absolute left-1/2 top-1/2 fret-dot--ghost".concat(dense ? ' ghost--dense' : ''),
                style: {
                    color: ghostFromBaseColor(baseColor)
                },
                "aria-hidden": true
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 279,
                columnNumber: 9
            }, this),
            drawScaleMain && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: async ()=>{
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].resume();
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].playNote(midi);
                },
                style: dotStyle(baseColor, isMobile),
                className: "absolute left-1/2 top-1/2 fret-dot fret-dot--main",
                "aria-label": ariaLabel,
                children: label
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 282,
                columnNumber: 9
            }, this),
            drawChord && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: async ()=>{
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].resume();
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].playNote(midi);
                },
                style: dotStyle(baseColor, isMobile),
                className: "absolute left-1/2 top-1/2 fret-dot fret-dot--main fret-dot--chord",
                "aria-label": ariaLabel,
                children: label
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 293,
                columnNumber: 9
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/Fretboard.tsx",
        lineNumber: 277,
        columnNumber: 5
    }, this);
}
function renderOpenMarker(param) {
    let { overlay, strings, rowIdx, isMobile } = param;
    if (!overlay) return null;
    var _overlay_chordNotes, _ref;
    const chordNotes = (_ref = (_overlay_chordNotes = overlay.chordNotes) !== null && _overlay_chordNotes !== void 0 ? _overlay_chordNotes : overlay.notes) !== null && _ref !== void 0 ? _ref : [];
    var _chordNotes_length;
    const hasChord = ((_chordNotes_length = chordNotes === null || chordNotes === void 0 ? void 0 : chordNotes.length) !== null && _chordNotes_length !== void 0 ? _chordNotes_length : 0) > 0;
    var _chordNotes_;
    const tonicIdx = hasChord ? pitchIndex((_chordNotes_ = chordNotes[0]) !== null && _chordNotes_ !== void 0 ? _chordNotes_ : "C") : 0;
    const set = new Set((chordNotes || []).map((note)=>pitchIndex(note !== null && note !== void 0 ? note : "C")));
    var _strings_rowIdx;
    const openPc = pitchIndex((_strings_rowIdx = strings[rowIdx]) !== null && _strings_rowIdx !== void 0 ? _strings_rowIdx : "E");
    const spcSounding = openPc; // open = fret 0 sounding
    const spc = spcSounding; // shapedは廃止・常にsounding
    // 実音のMIDI（弦の実チューニングの開放音）
    const STRING_OPEN_MIDI = [
        64,
        59,
        55,
        50,
        45,
        40
    ];
    var _STRING_OPEN_MIDI_Math_min;
    const midi = (_STRING_OPEN_MIDI_Math_min = STRING_OPEN_MIDI[Math.min(rowIdx, STRING_OPEN_MIDI.length - 1)]) !== null && _STRING_OPEN_MIDI_Math_min !== void 0 ? _STRING_OPEN_MIDI_Math_min : 64;
    const scaleRoot = overlay.scaleRootPc;
    const scaleType = overlay.scaleType;
    const inScale = (()=>{
        if (typeof scaleRoot !== 'number' || !scaleType) return true;
        const iv = (spc - scaleRoot + 120) % 12;
        const ivs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getScalePitches"])(scaleRoot, overlay.scaleType).map((v)=>(v - scaleRoot + 120) % 12);
        return ivs.includes(iv);
    })();
    var _chordNotes_length1;
    const hasChordOverlay = ((_chordNotes_length1 = chordNotes === null || chordNotes === void 0 ? void 0 : chordNotes.length) !== null && _chordNotes_length1 !== void 0 ? _chordNotes_length1 : 0) > 0;
    var _overlay_showScaleGhost;
    const drawGhost = ((_overlay_showScaleGhost = overlay.showScaleGhost) !== null && _overlay_showScaleGhost !== void 0 ? _overlay_showScaleGhost : true) && hasChordOverlay && inScale && !set.has(spc);
    const drawChord = set.has(spc);
    const drawScaleMain = !hasChordOverlay && inScale;
    if (!drawGhost && !drawChord && !drawScaleMain) return null;
    const iv = typeof scaleRoot === 'number' ? (spc - scaleRoot + 120) % 12 : 0;
    const isRoot = iv === 0;
    const isChordTone = [
        0,
        4,
        7,
        10,
        11
    ].includes(iv) && inScale;
    var _degreeLabelFor;
    const degreeLbl = !inScale || typeof scaleRoot !== 'number' || !scaleType ? null : (_degreeLabelFor = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["degreeLabelFor"])(spc, scaleRoot, overlay.scaleType)) !== null && _degreeLabelFor !== void 0 ? _degreeLabelFor : null;
    const bg = colorForDegreeLabel(false, degreeLbl, isChordTone, inScale, isRoot);
    const showDegrees = overlay.display === 'degrees';
    var _degreeRomanFor, _ref1;
    const label = showDegrees ? (_ref1 = (_degreeRomanFor = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["degreeRomanFor"])(spc, tonicIdx, overlay.scaleType)) !== null && _degreeRomanFor !== void 0 ? _degreeRomanFor : degreeLbl) !== null && _ref1 !== void 0 ? _ref1 : fallbackDegreeLabel(spc, tonicIdx) : PITCHES12[spc];
    const dense = (()=>{
        var _def_degrees;
        const def = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === overlay.scaleType);
        var _def_degrees_length;
        return ((_def_degrees_length = def === null || def === void 0 ? void 0 : (_def_degrees = def.degrees) === null || _def_degrees === void 0 ? void 0 : _def_degrees.length) !== null && _def_degrees_length !== void 0 ? _def_degrees_length : 0) > 7;
    })();
    const stringNumber = rowIdx + 1;
    const ariaLabel = "string ".concat(stringNumber, ", fret 0, ").concat(label === '1' ? 'root' : label);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "absolute inset-0",
        children: [
            drawGhost && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "absolute left-1/2 top-1/2 fret-dot--ghost".concat(dense ? ' ghost--dense' : ''),
                style: {
                    color: COLOR_GHOST
                },
                "aria-hidden": true
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 347,
                columnNumber: 9
            }, this),
            drawScaleMain && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: async ()=>{
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].resume();
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].playNote(midi);
                },
                style: dotStyle(bg, isMobile),
                className: "absolute left-1/2 top-1/2 fret-dot fret-dot--main",
                "aria-label": ariaLabel,
                children: label
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 350,
                columnNumber: 9
            }, this),
            drawChord && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: async ()=>{
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].resume();
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].playNote(midi);
                },
                style: dotStyle(bg, isMobile),
                className: "absolute left-1/2 top-1/2 fret-dot fret-dot--main fret-dot--chord",
                "aria-label": ariaLabel,
                children: label
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 361,
                columnNumber: 9
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/Fretboard.tsx",
        lineNumber: 345,
        columnNumber: 5
    }, this);
}
function renderFormOverlay(param) {
    let { formShape, LEFT_GUTTER, TOP_BAR_H, SPACE_W, ROW_H } = param;
    return formShape.dots.map((dot, idx)=>{
        const degree = dot.deg === '1' ? 'root' : dot.deg.replace(/b/g, 'flat ').replace(/#/g, 'sharp ');
        const ariaLabel = "string ".concat(dot.string, ", fret ").concat(dot.fret, ", ").concat(degree);
        const left = "calc(".concat(LEFT_GUTTER, "px + ").concat(dot.fret * SPACE_W, "px)");
        const top = "calc(".concat(TOP_BAR_H, "px + ").concat((dot.string - 0.5) * ROW_H, "px)");
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "absolute",
            role: "img",
            "aria-label": ariaLabel,
            style: {
                left,
                top,
                transform: 'translate(-50%, -50%)'
            },
            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "fret-dot--form",
                "aria-hidden": true
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 393,
                columnNumber: 9
            }, this)
        }, "form-".concat(idx), false, {
            fileName: "[project]/src/components/Fretboard.tsx",
            lineNumber: 386,
            columnNumber: 7
        }, this);
    });
}
var _c;
__turbopack_context__.k.register(_c, "Fretboard");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/state/overlay.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "OverlayProvider",
    ()=>OverlayProvider,
    "useOverlay",
    ()=>useOverlay
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-client] (ecmascript)");
var _s = __turbopack_context__.k.signature(), _s1 = __turbopack_context__.k.signature();
;
;
const OverlayContext = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createContext"])(null);
const OverlayProvider = (param)=>{
    let { children } = param;
    _s();
    const [viewMode, setViewMode] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])('Degrees');
    const [scale, setScale] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [chord, setChord] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const shownOnceRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const setChordFromUser = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "OverlayProvider.useCallback[setChordFromUser]": (c)=>{
            setChord({
                "OverlayProvider.useCallback[setChordFromUser]": (prev)=>{
                    if (!shownOnceRef.current && !prev && c) {
                        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"]('overlay_shown', {
                            page: 'chord_progression',
                            control: 'chord'
                        });
                        shownOnceRef.current = true;
                    }
                    return c;
                }
            }["OverlayProvider.useCallback[setChordFromUser]"]);
        }
    }["OverlayProvider.useCallback[setChordFromUser]"], []);
    const resetChord = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "OverlayProvider.useCallback[resetChord]": ()=>{
            setChord(null);
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"]('overlay_reset', {
                page: 'chord_progression'
            });
        }
    }["OverlayProvider.useCallback[resetChord]"], []);
    const contextValue = {
        viewMode,
        scale,
        chord,
        setViewMode: (m)=>{
            if (m !== viewMode) {
                setViewMode(m);
                __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"]('fb_toggle', {
                    page: 'chord_progression',
                    value: m
                });
            }
        },
        setScale,
        setChordFromUser,
        resetChord,
        // aliases
        setScaleLayer: (s)=>setScale(s),
        resetChordLayer: ()=>resetChord()
    };
    return /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"].createElement(OverlayContext.Provider, {
        value: contextValue
    }, children);
};
_s(OverlayProvider, "XgE2T+zvy18DOv7oKJAINzvWb2A=");
_c = OverlayProvider;
const useOverlay = (selector)=>{
    _s1();
    const ctx = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useContext"])(OverlayContext);
    if (!ctx) {
        // Provider未設置時でもクラッシュさせないフェイルセーフ
        const fallback = {
            viewMode: 'Degrees',
            scale: null,
            chord: null,
            setViewMode: ()=>{},
            setScale: ()=>{},
            setChordFromUser: ()=>{},
            resetChord: ()=>{},
            setScaleLayer: ()=>{},
            resetChordLayer: ()=>{}
        };
        return selector ? selector(fallback) : fallback;
    }
    return selector ? selector(ctx) : ctx;
};
_s1(useOverlay, "/dMy7t63NXD4eYACoT93CePwGrg=");
var _c;
__turbopack_context__.k.register(_c, "OverlayProvider");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/music/constants.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * 音楽理論の共通定数
 */ /** ピッチクラスの名前（0=C, 1=C#, ..., 11=B） */ __turbopack_context__.s([
    "DEFAULT_MIDI_OCTAVE",
    ()=>DEFAULT_MIDI_OCTAVE,
    "PC_NAMES",
    ()=>PC_NAMES,
    "PITCH_CLASS_COUNT",
    ()=>PITCH_CLASS_COUNT,
    "mod12",
    ()=>mod12,
    "nameToPc",
    ()=>nameToPc,
    "pcToName",
    ()=>pcToName
]);
const PC_NAMES = [
    'C',
    'C#',
    'D',
    'Eb',
    'E',
    'F',
    'F#',
    'G',
    'Ab',
    'A',
    'Bb',
    'B'
];
const PITCH_CLASS_COUNT = 12;
const DEFAULT_MIDI_OCTAVE = 60;
function mod12(pc) {
    return (pc % 12 + 12) % 12;
}
function pcToName(pc) {
    return PC_NAMES[mod12(pc)];
}
function nameToPc(name) {
    const index = PC_NAMES.indexOf(name);
    return index >= 0 ? index : -1;
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/theory.ts [app-client] (ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

// PITCHESは lib/music/constants.ts に移行しました
__turbopack_context__.s([
    "DEG_QUAL_MAJOR",
    ()=>DEG_QUAL_MAJOR,
    "DEG_QUAL_MINOR",
    ()=>DEG_QUAL_MINOR,
    "QUALITY_ALIASES",
    ()=>QUALITY_ALIASES,
    "QUALITY_TONES",
    ()=>QUALITY_TONES,
    "SCALESETS",
    ()=>SCALESETS,
    "classifyChord",
    ()=>classifyChord,
    "detectCadence",
    ()=>detectCadence,
    "formatRomanForDisplay",
    ()=>formatRomanForDisplay,
    "getRecommendedScalesForQuality",
    ()=>getRecommendedScalesForQuality,
    "noteToPc",
    ()=>noteToPc,
    "parseChord",
    ()=>parseChord,
    "pcToNoteName",
    ()=>pcToNoteName,
    "rankKeys",
    ()=>rankKeys,
    "rankScales",
    ()=>rankScales,
    "resolveQuality",
    ()=>resolveQuality,
    "romanToChordSymbol",
    ()=>romanToChordSymbol,
    "scoreKeyCandidates",
    ()=>scoreKeyCandidates,
    "transpose",
    ()=>transpose
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-client] (ecmascript)");
;
;
const SCALESETS = {
    ionian: [
        0,
        2,
        4,
        5,
        7,
        9,
        11
    ],
    dorian: [
        0,
        2,
        3,
        5,
        7,
        9,
        10
    ],
    phrygian: [
        0,
        1,
        3,
        5,
        7,
        8,
        10
    ],
    lydian: [
        0,
        2,
        4,
        6,
        7,
        9,
        11
    ],
    mixolydian: [
        0,
        2,
        4,
        5,
        7,
        9,
        10
    ],
    aeolian: [
        0,
        2,
        3,
        5,
        7,
        8,
        10
    ],
    locrian: [
        0,
        1,
        3,
        5,
        6,
        8,
        10
    ],
    locrianNat2: [
        0,
        2,
        3,
        5,
        6,
        8,
        10
    ],
    majPent: [
        0,
        2,
        4,
        7,
        9
    ],
    minPent: [
        0,
        3,
        5,
        7,
        10
    ],
    bluesMin: [
        0,
        3,
        5,
        6,
        7,
        10
    ],
    dimWholeHalf: [
        0,
        2,
        3,
        5,
        6,
        8,
        9,
        11
    ],
    dimHalfWhole: [
        0,
        1,
        3,
        4,
        6,
        7,
        9,
        10
    ],
    altered: [
        0,
        1,
        3,
        4,
        6,
        8,
        10
    ]
};
const QUALITY_ALIASES = {
    // Major family
    'maj': 'M',
    'major': 'M',
    '': 'M',
    'maj7': 'M7',
    'M7': 'M7',
    'Δ': 'M7',
    'Δ7': 'M7',
    'maj9': 'M9',
    'M9': 'M9',
    'Δ9': 'M9',
    'maj11': 'M11',
    'M11': 'M11',
    'maj13': 'M13',
    'M13': 'M13',
    // Minor family
    'min': 'm',
    'mi': 'm',
    '-': 'm',
    'min7': 'm7',
    'mi7': 'm7',
    '-7': 'm7',
    'min9': 'm9',
    'mi9': 'm9',
    'min11': 'm11',
    'mi11': 'm11',
    'min13': 'm13',
    'mi13': 'm13',
    'mM7': 'mMaj7',
    'mMaj7': 'mMaj7',
    'minMaj7': 'mMaj7',
    // Diminished family
    'dim': 'dim',
    '°': 'dim',
    'o': 'dim',
    'dim7': 'dim7',
    '°7': 'dim7',
    'o7': 'dim7',
    'm7b5': 'm7b5',
    'm7♭5': 'm7b5',
    'ø': 'm7b5',
    'ø7': 'm7b5',
    // Augmented family
    'aug': 'aug',
    '+': 'aug',
    'aug7': '7#5',
    '7#5': '7#5',
    '7+5': '7#5',
    '7♯5': '7#5',
    // Suspended
    'sus2': 'sus2',
    'sus4': 'sus4',
    'sus': 'sus4',
    '7sus4': '7sus4',
    '7sus': '7sus4',
    // Sixth chords
    '6': '6',
    'm6': 'm6',
    'min6': 'm6',
    '6/9': '6/9',
    '69': '6/9',
    // Altered/extensions
    '7b5': '7b5',
    '7♭5': '7b5',
    '7-5': '7b5',
    '7b9': '7b9',
    '7♭9': '7b9',
    '7-9': '7b9',
    '7#9': '7#9',
    '7♯9': '7#9',
    '7+9': '7#9',
    '7b13': '7b13',
    '7♭13': '7b13',
    '7#11': '7#11',
    '7♯11': '7#11',
    '7(9)': '9',
    '7(11)': '11',
    '7(13)': '13',
    'm7(9)': 'm9',
    'm7(11)': 'm11',
    'M7(9)': 'M9',
    'M7(13)': 'M13',
    '7alt': '7alt',
    '7altered': '7alt'
};
function resolveQuality(qual) {
    var _QUALITY_ALIASES_qual;
    return (_QUALITY_ALIASES_qual = QUALITY_ALIASES[qual]) !== null && _QUALITY_ALIASES_qual !== void 0 ? _QUALITY_ALIASES_qual : qual;
}
const QUALITY_TONES = {
    // Basic triads (Core)
    M: [
        0,
        4,
        7
    ],
    m: [
        0,
        3,
        7
    ],
    aug: [
        0,
        4,
        8
    ],
    dim: [
        0,
        3,
        6
    ],
    // Suspended (Core)
    sus2: [
        0,
        2,
        7
    ],
    sus4: [
        0,
        5,
        7
    ],
    // Sixth chords (Core)
    "6": [
        0,
        4,
        7,
        9
    ],
    m6: [
        0,
        3,
        7,
        9
    ],
    "6/9": [
        0,
        4,
        7,
        9,
        14
    ],
    // Seventh chords (Core)
    "7": [
        0,
        4,
        7,
        10
    ],
    M7: [
        0,
        4,
        7,
        11
    ],
    m7: [
        0,
        3,
        7,
        10
    ],
    dim7: [
        0,
        3,
        6,
        9
    ],
    m7b5: [
        0,
        3,
        6,
        10
    ],
    mMaj7: [
        0,
        3,
        7,
        11
    ],
    // Ninth chords (Core)
    "9": [
        0,
        4,
        7,
        10,
        14
    ],
    M9: [
        0,
        4,
        7,
        11,
        14
    ],
    m9: [
        0,
        3,
        7,
        10,
        14
    ],
    add9: [
        0,
        4,
        7,
        14
    ],
    madd9: [
        0,
        3,
        7,
        14
    ],
    // Extended chords (Advanced)
    "11": [
        0,
        4,
        7,
        10,
        14,
        17
    ],
    M11: [
        0,
        4,
        7,
        11,
        14,
        17
    ],
    m11: [
        0,
        3,
        7,
        10,
        14,
        17
    ],
    "13": [
        0,
        4,
        7,
        10,
        14,
        21
    ],
    M13: [
        0,
        4,
        7,
        11,
        14,
        21
    ],
    m13: [
        0,
        3,
        7,
        10,
        14,
        21
    ],
    // Altered/Sus7 (Core & Advanced)
    "7sus4": [
        0,
        5,
        7,
        10
    ],
    "7b5": [
        0,
        4,
        6,
        10
    ],
    "7#5": [
        0,
        4,
        8,
        10
    ],
    "7b9": [
        0,
        4,
        7,
        10,
        13
    ],
    "7#9": [
        0,
        4,
        7,
        10,
        15
    ],
    "7#11": [
        0,
        4,
        7,
        10,
        18
    ],
    "7b13": [
        0,
        4,
        7,
        10,
        20
    ],
    "7alt": [
        0,
        4,
        7,
        10,
        13,
        15,
        18
    ]
};
const noteToPc = (n)=>{
    const i = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"].indexOf(n);
    if (i >= 0) return i;
    const flatMap = {
        Db: "C#",
        Gb: "F#",
        Ab: "G#",
        Bb: "A#",
        Eb: "D#",
        Cb: "B",
        Fb: "E"
    };
    var _flatMap_n;
    const up = (_flatMap_n = flatMap[n]) !== null && _flatMap_n !== void 0 ? _flatMap_n : n;
    return __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"].indexOf(up);
};
function pcToNoteName(pc, keyRoot, mode) {
    if (keyRoot === undefined) {
        // キー情報がない場合は♭優先（Chord Libraryと同じ）
        const flatPreferred = [
            "C",
            "C#",
            "D",
            "Eb",
            "E",
            "F",
            "F#",
            "G",
            "Ab",
            "A",
            "Bb",
            "B"
        ];
        return flatPreferred[pc];
    }
    // ♯系キーと♭系キーを判定
    const sharpKeys = [
        7,
        2,
        9,
        4,
        11,
        6,
        1
    ]; // G, D, A, E, B, F#, C#
    const flatKeys = [
        5,
        10,
        3,
        8,
        1,
        6,
        11
    ]; // F, Bb, Eb, Ab, Db, Gb, Cb
    const isSharpKey = sharpKeys.includes(keyRoot);
    if (isSharpKey) {
        // ♯系キー: C, C#, D, D#, E, F, F#, G, G#, A, A#, B
        const sharpNames = [
            "C",
            "C#",
            "D",
            "D#",
            "E",
            "F",
            "F#",
            "G",
            "G#",
            "A",
            "A#",
            "B"
        ];
        return sharpNames[pc];
    } else {
        // ♭系キー（またはC): C, Db, D, Eb, E, F, Gb, G, Ab, A, Bb, B
        const flatNames = [
            "C",
            "Db",
            "D",
            "Eb",
            "E",
            "F",
            "Gb",
            "G",
            "Ab",
            "A",
            "Bb",
            "B"
        ];
        return flatNames[pc];
    }
}
const transpose = (pc, by)=>(pc + by + 12) % 12;
function parseChord(sym) {
    const slash = sym.split("/");
    const main = slash[0];
    const m = main.match(/^([A-G](#|b)?)(.*)$/);
    if (!m) throw new Error("bad chord: " + sym);
    const root = noteToPc(m[1]);
    const rawQual = (m[3] || "").trim() || "";
    const qual = resolveQuality(rawQual || "M"); // エイリアス正規化を通す
    var _QUALITY_TONES_qual;
    const tonesRel = (_QUALITY_TONES_qual = QUALITY_TONES[qual]) !== null && _QUALITY_TONES_qual !== void 0 ? _QUALITY_TONES_qual : QUALITY_TONES.M;
    const tones = tonesRel.map((iv)=>transpose(root, iv % 12)); // mod12で正規化
    const bass = slash[1] ? noteToPc(slash[1]) : undefined;
    return {
        root,
        qual,
        bass,
        tones
    };
}
const DEG_QUAL_MAJOR = {
    0: [
        "M",
        "M7"
    ],
    2: [
        "m",
        "m7"
    ],
    4: [
        "m",
        "m7"
    ],
    5: [
        "M",
        "M7"
    ],
    7: [
        "M",
        "7"
    ],
    9: [
        "m",
        "m7"
    ],
    11: [
        "dim",
        "m7b5"
    ]
};
const DEG_QUAL_MINOR = {
    0: [
        "m",
        "m7"
    ],
    2: [
        "dim",
        "m7b5"
    ],
    3: [
        "M",
        "M7"
    ],
    5: [
        "m",
        "m7"
    ],
    7: [
        "m",
        "7",
        "M",
        "7"
    ],
    8: [
        "M",
        "M7"
    ],
    10: [
        "M",
        "7"
    ]
};
function rankKeys(chords) {
    const parsed = chords.map(parseChord);
    const candidates = [];
    for(let r = 0; r < 12; r++)candidates.push({
        root: r,
        mode: "Major"
    }, {
        root: r,
        mode: "Minor"
    });
    const maxPerChord = 3;
    const bonuses = 3;
    const denom = parsed.length * maxPerChord + bonuses;
    const res = candidates.map((param)=>{
        let { root, mode } = param;
        const table = mode === "Major" ? DEG_QUAL_MAJOR : DEG_QUAL_MINOR;
        let s = 0;
        parsed.forEach((c, idx)=>{
            const deg = (c.root - root + 12) % 12;
            const expected = table[deg];
            if (expected) {
                if (expected.includes(c.qual)) s += 3;
                else s += 2;
            } else {
                const scale = mode === "Major" ? SCALESETS.ionian : SCALESETS.aeolian;
                const inScale = c.tones.every((t)=>scale.includes((t - root + 12) % 12));
                if (inScale) s += 1;
            }
            if (idx > 0) {
                const prevDeg = (parsed[idx - 1].root - root + 12) % 12;
                // 五度下行（循環）を一般的に評価: a→b が完全5度下行（-7半音＝+5半音）
                const fifthsDown = (prevDeg - deg + 12) % 12 === 7;
                if (fifthsDown) s += 1; // 五度下行ボーナス（ii→V, V→I, vi→ii, etc.）
            }
        });
        const firstDeg = (parsed[0].root - root + 12) % 12;
        if (mode === "Major" && (firstDeg === 0 || firstDeg === 9)) s += 2;
        if (mode === "Minor" && (firstDeg === 0 || firstDeg === 3)) s += 2;
        const pct = Math.round(s / Math.max(denom, 1) * 100);
        const label = "".concat(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"][root], " ").concat(mode);
        return {
            keyRoot: root,
            mode,
            label,
            score: s,
            pct
        };
    });
    return res.sort((a, b)=>b.score - a.score);
}
function getRecommendedScalesForQuality(quality) {
    const q = resolveQuality(quality);
    switch(q){
        case 'm7b5':
            return [
                {
                    name: "Locrian ♮2",
                    scaleKey: "locrianNat2"
                },
                {
                    name: "Locrian",
                    scaleKey: "locrian"
                }
            ];
        case 'dim':
        case 'dim7':
            return [
                {
                    name: "Diminished (W-H)",
                    scaleKey: "dimWholeHalf"
                }
            ];
        case '7b9':
            return [
                {
                    name: "Diminished (H-W)",
                    scaleKey: "dimHalfWhole"
                },
                {
                    name: "Mixolydian ♭9♭13",
                    scaleKey: "altered"
                } // 近似
            ];
        case '7alt':
            return [
                {
                    name: "Altered",
                    scaleKey: "altered"
                }
            ];
        case '7':
            return [
                {
                    name: "Mixolydian",
                    scaleKey: "mixolydian"
                },
                {
                    name: "Lydian Dominant (Mixolydian ♯11)",
                    scaleKey: "lydian"
                },
                {
                    name: "Altered",
                    scaleKey: "altered"
                }
            ];
        default:
            return [];
    }
}
function rankScales(chords, baseKey) {
    const tones = Array.from(new Set(chords.map(parseChord).flatMap((c)=>c.tones)));
    const root = baseKey.root;
    const defs = baseKey.mode === "Major" ? [
        [
            "Major Scale",
            "ionian"
        ],
        [
            "Major Pentatonic",
            "majPent"
        ],
        [
            "Mixolydian Mode",
            "mixolydian"
        ],
        [
            "Lydian Mode",
            "lydian"
        ]
    ] : [
        [
            "Minor Scale",
            "aeolian"
        ],
        [
            "Minor Pentatonic",
            "minPent"
        ],
        [
            "Dorian Mode",
            "dorian"
        ],
        [
            "Phrygian Mode",
            "phrygian"
        ],
        [
            "Blues (min)",
            "bluesMin"
        ]
    ];
    return defs.map((param)=>{
        let [disp, key] = param;
        const set = SCALESETS[key].map((iv)=>transpose(root, iv));
        const cover = tones.filter((t)=>set.includes(t)).length;
        const pct = Math.round(100 * cover / Math.max(tones.length, 1));
        return {
            keyRoot: root,
            name: disp,
            label: "".concat(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"][root], " ").concat(disp),
            pct,
            set
        };
    }).sort((a, b)=>b.pct - a.pct);
}
const DEGREE_MAP_MAJOR = {
    0: "I",
    2: "II",
    4: "III",
    5: "IV",
    7: "V",
    9: "VI",
    11: "VII"
};
const DEGREE_MAP_MINOR = {
    0: "i",
    2: "ii",
    3: "III",
    5: "iv",
    7: "v",
    8: "VI",
    10: "VII"
};
function scoreKeyCandidates(prog) {
    const ranked = rankKeys(prog);
    const top = ranked.slice(0, 5); // v3.1: 3→5候補に拡張（iOS UI改善）
    return top.map((r)=>{
        const key = {
            tonic: r.keyRoot,
            mode: r.mode
        };
        const cad = detectCadence(prog, key);
        const reasons = [];
        if (cad === "perfect") reasons.push("Cadence: V→I");
        if (cad === "deceptive") reasons.push("Cadence: V→vi");
        if (cad === "half") reasons.push("Cadence: …→V");
        reasons.unshift("diatonic fit ".concat(r.pct, "%"));
        return {
            tonic: r.keyRoot,
            mode: r.mode,
            confidence: r.pct,
            reasons
        };
    });
}
function classifyChord(chord, key) {
    const diatonic = (()=>{
        const tonicName = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"][key.tonic];
        if (key.mode === "Major") {
            var _this;
            const mk = ((_this = Key) === null || _this === void 0 ? void 0 : _this.majorKey) ? Key.majorKey(tonicName) : null;
            return (mk === null || mk === void 0 ? void 0 : mk.chords) || [];
        } else {
            var _this1, _nk_natural;
            const nk = ((_this1 = Key) === null || _this1 === void 0 ? void 0 : _this1.minorKey) ? Key.minorKey(tonicName) : null;
            return (nk === null || nk === void 0 ? void 0 : (_nk_natural = nk.natural) === null || _nk_natural === void 0 ? void 0 : _nk_natural.chords) || (nk === null || nk === void 0 ? void 0 : nk.chords) || [];
        }
    })();
    const target = chord.root + (chord.triad === "maj" ? "" : chord.triad === "min" ? "m" : "dim");
    if (diatonic.includes(target)) return "diatonic";
    // secondary dominant: X7 targeting a diatonic
    const isDomLike = chord.triad === "maj" || chord.isDominantLike;
    if (isDomLike) {
        for(let r = 0; r < 12; r++){
            const deg = (r - key.tonic + 12) % 12;
            const table = key.mode === "Major" ? DEG_QUAL_MAJOR : DEG_QUAL_MINOR;
            if (table[deg]) {
                const fifth = transpose(r, 7);
                if (chord.root === fifth) return "secondary";
            }
        }
    }
    // simple borrowed detection in major: iv, bVII, bVI roots
    if (key.mode === "Major") {
        const deg = (chord.root - key.tonic + 12) % 12;
        if (deg === 5 && chord.triad === "min") return "borrowed"; // iv
        if (deg === 10 || deg === 8) return "borrowed"; // bVII, bVI
    }
    return "outside";
}
function detectCadence(prog, key) {
    if (prog.length < 2) return null;
    const last = parseChord(prog[prog.length - 1]);
    const prev = parseChord(prog[prog.length - 2]);
    const degLast = (last.root - key.tonic + 12) % 12;
    const degPrev = (prev.root - key.tonic + 12) % 12;
    if (degPrev === 7 && degLast === 0) return "perfect"; // V→I
    if (degPrev === 7 && degLast === 9) return "deceptive"; // V→vi
    if (degLast === 7) return "half"; // …→V
    return null;
}
// --- Roman Numeral to Chord Symbol Conversion ---
// Roman numeral mapping: Roman表記から度数（0-11）と明示的品質を解析
const ROMAN_MAP = {
    'Ⅰ': {
        offset: 0
    },
    'ⅰ': {
        offset: 0
    },
    'Ⅱ': {
        offset: 2
    },
    'ⅱ': {
        offset: 2
    },
    '♭Ⅱ': {
        offset: 1
    },
    '♭ⅱ': {
        offset: 1
    },
    'Ⅲ': {
        offset: 4
    },
    'ⅲ': {
        offset: 4
    },
    '♭Ⅲ': {
        offset: 3
    },
    '♭ⅲ': {
        offset: 3
    },
    'Ⅳ': {
        offset: 5
    },
    'ⅳ': {
        offset: 5
    },
    '♯Ⅳ': {
        offset: 6
    },
    '♯ⅳ': {
        offset: 6
    },
    'Ⅴ': {
        offset: 7
    },
    'ⅴ': {
        offset: 7
    },
    '♭Ⅵ': {
        offset: 8
    },
    '♭ⅵ': {
        offset: 8
    },
    'Ⅵ': {
        offset: 9
    },
    'ⅵ': {
        offset: 9
    },
    '♭Ⅶ': {
        offset: 10
    },
    '♭ⅶ': {
        offset: 10
    },
    'Ⅶ': {
        offset: 11
    },
    'ⅶ': {
        offset: 11
    }
};
/**
 * parseRomanNumeral: Roman numeral表記から度数と明示的品質を分離
 * 例: "Ⅱm7" → {deg: 2, explicitQual: "m7"}
 *     "Ⅴ" → {deg: 7, explicitQual: null}
 *     "♭Ⅶ" → {deg: 10, explicitQual: null}
 */ function parseRomanNumeral(roman) {
    // Roman表記の本体と接尾辞を分離
    // 例: "Ⅱm7" → base="Ⅱ", suffix="m7"
    let base = roman;
    let suffix = "";
    // Roman表記のパターンをチェック
    for (const [romanKey, { offset }] of Object.entries(ROMAN_MAP)){
        if (roman.startsWith(romanKey)) {
            base = romanKey;
            suffix = roman.slice(romanKey.length).trim();
            return {
                deg: offset,
                explicitQual: suffix || null
            };
        }
    }
    // マッチしない場合はエラー（または警告）
    console.warn("Unknown Roman numeral: ".concat(roman));
    return {
        deg: 0,
        explicitQual: null
    }; // デフォルトは I（tonic）
}
/**
 * defaultQualityForDegree: 度数とモードに基づいてダイアトニック品質を返す
 * 例: Major key の deg=2 → "m"（ii）
 *     Major key の deg=11 → "dim"（vii°）
 */ function defaultQualityForDegree(deg, mode) {
    const table = mode === "Major" ? DEG_QUAL_MAJOR : DEG_QUAL_MINOR;
    const candidates = table[deg];
    if (!candidates || candidates.length === 0) {
        // ダイアトニックにない度数（借用和音など）は空（Major triad）をデフォルトに
        return "";
    }
    // 第1候補（三和音）を返す
    return candidates[0];
}
function romanToChordSymbol(roman, keyRoot, mode) {
    const { deg, explicitQual } = parseRomanNumeral(roman);
    // 明示的品質がない場合、ダイアトニック品質を補完
    const quality = explicitQual !== null ? explicitQual : defaultQualityForDegree(deg, mode);
    // ルート音を計算（キーの調号に応じて♯/♭を選択）
    const rootPc = (keyRoot + deg) % 12;
    const rootName = pcToNoteName(rootPc, keyRoot, mode);
    // コードシンボルを組み立て
    return "".concat(rootName).concat(quality);
}
function formatRomanForDisplay(degree, quality, mode, keyRoot) {
    // 度数をdiatonic度数にマッピング（0,2,4,5,7,9,11 のみ）
    const diatonicDegrees = {
        0: 1,
        2: 2,
        4: 3,
        5: 4,
        7: 5,
        9: 6,
        11: 7
    };
    const romanNum = diatonicDegrees[degree];
    if (!romanNum) {
        // 非ダイアトニック度数（借用和音など）は変化記号付きで表示
        if (degree === 1) return '♭Ⅱ' + quality; // ♭II
        if (degree === 3) return '♭Ⅲ' + quality; // ♭III
        if (degree === 6) return '♯Ⅳ' + quality; // #IV
        if (degree === 8) return '♭Ⅵ' + quality; // ♭VI
        if (degree === 10) return '♭Ⅶ' + quality; // ♭VII
        return '?'; // 不明
    }
    // 品質から大文字/小文字を決定
    const isMinor = quality.startsWith('m') && !quality.startsWith('maj');
    const isDim = quality.includes('dim') || quality.includes('°') || quality === 'm7b5' || quality === 'ø';
    // ダイアトニック品質を参照して大文字/小文字を決定
    const table = mode === "Major" ? DEG_QUAL_MAJOR : DEG_QUAL_MINOR;
    const expectedQuals = table[degree];
    const isDiatonicMinor = expectedQuals === null || expectedQuals === void 0 ? void 0 : expectedQuals.some((q)=>q === 'm' || q === 'm7');
    const isDiatonicDim = expectedQuals === null || expectedQuals === void 0 ? void 0 : expectedQuals.some((q)=>q === 'dim' || q === 'm7b5');
    // Roman数字の基本形
    const romanNumerals = [
        'I',
        'II',
        'III',
        'IV',
        'V',
        'VI',
        'VII'
    ];
    let romanBase = romanNumerals[romanNum - 1];
    // SSOT準拠: I, ii, iii, IV, V, vi, vii°
    // Major key: I, ii, iii, IV, V, vi, vii°
    // Minor key: i, ii°, III, iv, v/V, VI, VII
    if (mode === "Major") {
        // I, IV, V は大文字、ii, iii, vi は小文字、vii° は小文字+°
        if ([
            1,
            4,
            5
        ].includes(romanNum) && !isMinor && !isDim) {
            romanBase = romanBase; // 大文字のまま
        } else if (isDim || isDiatonicDim) {
            romanBase = romanBase.toLowerCase() + '°'; // vii°
        } else {
            romanBase = romanBase.toLowerCase(); // ii, iii, vi
        }
    } else {
        // Minor key: i, ii°, III, iv, v/V, VI, VII
        if ([
            3,
            6,
            7
        ].includes(romanNum) && !isMinor && !isDim) {
            romanBase = romanBase; // III, VI, VII は大文字
        } else if (romanNum === 5) {
            // v と V の両方あり（harmonic minor の V）
            romanBase = isMinor ? 'v' : 'V';
        } else if (isDim || isDiatonicDim) {
            romanBase = romanBase.toLowerCase() + '°'; // ii°
        } else {
            romanBase = romanBase.toLowerCase(); // i, iv
        }
    }
    // 7thなどの拡張を追加（dim以外）
    let extension = '';
    if (!isDim && quality && quality !== 'm' && quality !== '') {
        // 7, M7, m7, sus4などをそのまま付加
        extension = quality.replace('m', '').replace('M', 'maj'); // m7 → 7, M7 → maj7
        if (isMinor && extension.startsWith('7')) {
            // マイナーコードの場合、m7 → 7 と表示（既に小文字で示されているため）
            extension = extension;
        }
    }
    return romanBase + extension;
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/analysis/scoreScales.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "scoreScales",
    ()=>scoreScales
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/src/lib/theory.ts [app-client] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-client] (ecmascript)");
;
;
const CANDIDATE_TYPES_MAJOR = [
    "Ionian",
    "Lydian",
    "Mixolydian",
    "MajorPentatonic"
];
const CANDIDATE_TYPES_MINOR = [
    "Aeolian",
    "Dorian",
    "Phrygian",
    "HarmonicMinor",
    "MelodicMinor",
    "MinorPentatonic"
];
function uniq(arr) {
    return Array.from(new Set(arr));
}
function scoreScales(prog, key) {
    const types = key.mode === "Major" ? CANDIDATE_TYPES_MAJOR : CANDIDATE_TYPES_MINOR;
    const chordPcs = uniq(prog.flatMap((ch)=>{
        const p = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["parseChord"])(ch);
        const thirds = p.qual.includes("m") ? 3 : 4;
        const sevenths = p.qual.includes("7") ? p.qual.includes("M7") ? 11 : 10 : null;
        const pcs = [
            p.root % 12,
            (p.root + thirds) % 12,
            (p.root + 7) % 12
        ];
        if (sevenths !== null) pcs.push((p.root + sevenths) % 12);
        return pcs;
    }));
    const hasV7 = prog.some((ch)=>/7\b/.test(ch));
    return types.map((type)=>{
        const scale = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getScalePitches"])(key.root, type);
        const hit = chordPcs.filter((pc)=>scale.includes(pc)).length;
        const cover = hit / Math.max(1, chordPcs.length);
        // ---- bonuses (max total 0.05) ----
        let bonus = 0;
        if (key.mode === "Major" && type === "Ionian") bonus += 0.02;
        if (key.mode === "Minor" && type === "Aeolian") bonus += 0.02;
        if (hasV7 && (type === "HarmonicMinor" || type === "MelodicMinor")) bonus += 0.03;
        const raw = Math.min(1, cover + bonus);
        const score = Math.round(raw * 100);
        return {
            root: key.root,
            type,
            score
        };
    }).sort((a, b)=>b.score - a.score);
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/roman.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "progressionToRoman",
    ()=>progressionToRoman,
    "romanizeChord",
    ()=>romanizeChord
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/src/lib/theory.ts [app-client] (ecmascript) <locals>");
;
;
const ROMAN_UPPER = [
    "I",
    "II",
    "III",
    "IV",
    "V",
    "VI",
    "VII"
];
function baseRomanFromDegreeLabel(lbl) {
    if (!lbl) return "I";
    const n = Number(lbl.replace(/[♭#]/g, ""));
    const idx = isFinite(n) ? Math.max(1, Math.min(7, n)) - 1 : 0;
    return ROMAN_UPPER[idx];
}
function qualitySuffix(qual) {
    return /7/.test(qual) ? "7" : "";
}
function diminishedSymbol(qual) {
    return /dim|o/.test(qual) ? "°" : "";
}
function romanizeChord(chord, tonicPc, scaleType) {
    const { root, qual } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["parseChord"])(chord);
    var _parentModeOf;
    const effectiveType = (_parentModeOf = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["parentModeOf"])(scaleType)) !== null && _parentModeOf !== void 0 ? _parentModeOf : scaleType;
    // try exact degree label first
    let lbl = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["degreeLabelFor"])(root, tonicPc, effectiveType);
    let accidental = (lbl === null || lbl === void 0 ? void 0 : lbl.startsWith("♭")) ? "♭" : (lbl === null || lbl === void 0 ? void 0 : lbl.startsWith("#")) ? "♯" : "";
    // if null, try ±1 semitone nearest mapping
    if (!lbl) {
        const pcs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getScalePitches"])(tonicPc, effectiveType); // absolute pcs
        const minus = (root + 12 - 1) % 12;
        const plus = (root + 1) % 12;
        const idxMinus = pcs.indexOf(minus);
        const idxPlus = pcs.indexOf(plus);
        if (idxMinus !== -1) {
            lbl = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["degreeLabelFor"])(minus, tonicPc, effectiveType); // e.g., "3"
            accidental = "♭";
        } else if (idxPlus !== -1) {
            lbl = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["degreeLabelFor"])(plus, tonicPc, effectiveType);
            accidental = "♯";
        }
    }
    const base = baseRomanFromDegreeLabel(lbl);
    const sym = diminishedSymbol(qual);
    const suf = qualitySuffix(qual);
    return "".concat(accidental).concat(base).concat(sym).concat(suf);
}
function progressionToRoman(chords, tonicPc, scaleType) {
    return chords.map((c)=>romanizeChord(c, tonicPc, scaleType));
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/theory/diatonic.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "diatonicTriads",
    ()=>diatonicTriads,
    "romanOfTriad",
    ()=>romanOfTriad,
    "triadToChordSym",
    ()=>triadToChordSym
]);
function diatonicTriads(param) {
    let { tonicPc, scaleIntervals } = param;
    const pcs = scaleIntervals.map((iv)=>(tonicPc + iv + 120) % 12);
    const triads = [];
    for(let i = 0; i < 7; i++){
        const deg = i % 7;
        const r = pcs[deg];
        const t = pcs[(deg + 2) % 7];
        const f = pcs[(deg + 4) % 7];
        const q = qualityOfTriad(r, t, f);
        triads.push({
            degree: i + 1,
            rootPc: r,
            pcs: [
                r,
                t,
                f
            ],
            quality: q
        });
    }
    return triads;
}
function qualityOfTriad(r, t, f) {
    // intervals from root in semitones (mod 12)
    const third = (t - r + 12) % 12;
    const fifth = (f - r + 12) % 12;
    if (third === 4 && fifth === 7) return 'maj';
    if (third === 3 && fifth === 7) return 'min';
    if (third === 3 && fifth === 6) return 'dim';
    if (third === 4 && fifth === 8) return 'aug';
    // fallback: closest common qualities
    if (fifth === 6) return 'dim';
    if (fifth === 8) return 'aug';
    return third < 4 ? 'min' : 'maj';
}
const ROMAN_UP = [
    "I",
    "II",
    "III",
    "IV",
    "V",
    "VI",
    "VII"
];
function romanOfTriad(degree, quality, opts) {
    const base = ROMAN_UP[degree - 1];
    var _opts_case;
    const mode = (_opts_case = opts === null || opts === void 0 ? void 0 : opts.case) !== null && _opts_case !== void 0 ? _opts_case : 'upper';
    if (mode === 'upper') {
        // Always uppercase; add dimin./aug symbols
        if (quality === 'dim') return base + '°';
        if (quality === 'aug') return base + '+';
        return base;
    }
    // case: 'quality' → major uppercase, minor lowercase, diminished lowercase+°
    if (quality === 'min') return base.toLowerCase();
    if (quality === 'dim') return base.toLowerCase() + '°';
    if (quality === 'aug') return base + '+';
    return base; // maj
}
// Convert a triad (rootPc + quality) to a simple chord symbol (e.g., C, Cm, Cdim, C+)
const PC_TO_NAME = [
    'C',
    'C#',
    'D',
    'Eb',
    'E',
    'F',
    'F#',
    'G',
    'Ab',
    'A',
    'Bb',
    'B'
];
function triadToChordSym(t) {
    const root = PC_TO_NAME[t.rootPc % 12];
    if (t.quality === 'maj') return root;
    if (t.quality === 'min') return root + 'm';
    if (t.quality === 'dim') return root + 'dim';
    return root + '+'; // aug
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/capo/recommend.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Capo recommendation utilities
// Heuristic scoring favoring open-string friendly shapes
__turbopack_context__.s([
    "classifyScaleFlavor",
    ()=>classifyScaleFlavor,
    "recommendCapos",
    ()=>recommendCapos,
    "transposeDown",
    ()=>transposeDown
]);
function classifyScaleFlavor(scaleType) {
    const maj = [
        'Major',
        'Ionian',
        'Lydian',
        'Mixolydian',
        'Major Pentatonic'
    ];
    const t = scaleType.toLowerCase();
    for (const s of maj)if (t.includes(s.toLowerCase())) return 'majorish';
    return 'minorish';
}
// Open-chord ease per family (I..VII)
const MAJOR_FAMILY_SCORES = {
    C: [
        3,
        3,
        3,
        1,
        3,
        3,
        0
    ],
    G: [
        3,
        3,
        1,
        3,
        3,
        3,
        0
    ],
    D: [
        3,
        3,
        1,
        3,
        3,
        1,
        0
    ],
    A: [
        3,
        1,
        1,
        3,
        2,
        1,
        0
    ],
    E: [
        3,
        1,
        0,
        3,
        1,
        1,
        0
    ]
};
const MINOR_FAMILY_SCORES = {
    Am: [
        3,
        0,
        3,
        3,
        3,
        1,
        3
    ],
    Em: [
        3,
        0,
        3,
        3,
        1,
        3,
        3
    ],
    Dm: [
        3,
        0,
        1,
        0,
        3,
        0,
        3
    ]
};
function fretWeight(n) {
    if (n <= 5) return 1.0;
    if (n <= 7) return 0.92;
    if (n <= 9) return 0.82;
    return 0.7;
}
function transposeDown(pc, n) {
    return ((pc - n) % 12 + 12) % 12;
}
const NATURAL_NAME = {
    0: 'C',
    1: 'C#',
    2: 'D',
    3: 'Eb',
    4: 'E',
    5: 'F',
    6: 'F#',
    7: 'G',
    8: 'Ab',
    9: 'A',
    10: 'Bb',
    11: 'B'
};
function recommendCapos(key, scale) {
    let topN = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : 3, opts = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : {};
    var _opts_includeOpen;
    const includeOpen = (_opts_includeOpen = opts.includeOpen) !== null && _opts_includeOpen !== void 0 ? _opts_includeOpen : true;
    const flavor = classifyScaleFlavor(scale.type);
    const picks = [];
    for(let n = 0; n <= 11; n++){
        if (!includeOpen && n === 0) continue;
        const shapedPc = transposeDown(key.tonic, n);
        const name = NATURAL_NAME[shapedPc];
        if (flavor === 'majorish') {
            const famMap = {
                C: 'C',
                G: 'G',
                D: 'D',
                A: 'A',
                E: 'E'
            };
            const fam = famMap[name];
            if (!fam) continue;
            const base = MAJOR_FAMILY_SCORES[fam].reduce((a, b)=>a + b, 0);
            const bonus = MAJOR_FAMILY_SCORES[fam][0] >= 2 && MAJOR_FAMILY_SCORES[fam][3] >= 2 && MAJOR_FAMILY_SCORES[fam][4] >= 2 ? 2 : 0;
            const score = (base + bonus) * fretWeight(n);
            picks.push({
                capo: n,
                playAs: fam,
                score,
                reasons: [
                    "I–IV–V ".concat(bonus ? '◎' : '○'),
                    "open ".concat(base, "/16"),
                    n === 0 ? 'open' : "capo ".concat(n)
                ]
            });
        } else {
            const famMap = {
                A: 'Am',
                E: 'Em',
                D: 'Dm'
            };
            const fam = famMap[name];
            if (!fam) continue;
            const base = MINOR_FAMILY_SCORES[fam].reduce((a, b)=>a + b, 0);
            const bonus = MINOR_FAMILY_SCORES[fam][0] >= 2 && MINOR_FAMILY_SCORES[fam][3] >= 2 ? 2 : 0;
            const score = (base + bonus) * fretWeight(n);
            picks.push({
                capo: n,
                playAs: fam,
                score,
                reasons: [
                    "i–iv ".concat(bonus ? '◎' : '○'),
                    "open ".concat(base, "/16"),
                    n === 0 ? 'open' : "capo ".concat(n)
                ]
            });
        }
    }
    return picks.sort((a, b)=>b.score - a.score).slice(0, topN);
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/store/analysisStore.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useAnalysisStore",
    ()=>useAnalysisStore
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zustand$2f$esm$2f$react$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zustand/esm/react.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/src/lib/theory.ts [app-client] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$analysis$2f$scoreScales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/analysis/scoreScales.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$roman$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/roman.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/diatonic.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/capo/recommend.ts [app-client] (ecmascript)");
;
;
;
;
;
;
;
const useAnalysisStore = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zustand$2f$esm$2f$react$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["create"])((set, get)=>({
        keyCandidates: [],
        capo: null,
        viewMode: "sounding",
        scaleCandidates: [],
        selectedScale: null,
        romanTokens: [],
        romanText: "",
        diatonic: null,
        recommendedCapos: [],
        analyze: (prog)=>{
            set((state)=>{
                const cands = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["scoreKeyCandidates"])(prog);
                // 既存選択がある場合でも、トップ候補と±4pt以上差があればトップへ切替（誤維持防止）
                const top = cands[0];
                const keep = state.selectedKey && cands.find((c)=>c.tonic === state.selectedKey.tonic && c.mode === state.selectedKey.mode);
                const shouldKeep = (()=>{
                    if (!keep || !top) return false;
                    const diff = Math.abs((keep.confidence || 0) - (top.confidence || 0));
                    return diff < 4; // 近差のみ維持
                })();
                const nextSel = shouldKeep && state.selectedKey ? state.selectedKey : top ? {
                    tonic: top.tonic,
                    mode: top.mode
                } : undefined;
                const sc = nextSel ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$analysis$2f$scoreScales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["scoreScales"])(prog, {
                    root: nextSel.tonic,
                    mode: nextSel.mode
                }) : [];
                var _sc_;
                const selScale = (_sc_ = sc[0]) !== null && _sc_ !== void 0 ? _sc_ : null;
                const romanTokens = nextSel && selScale ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$roman$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["progressionToRoman"])(prog, nextSel.tonic, selScale.type) : [];
                const diatonic = (()=>{
                    if (!nextSel || !selScale) return null;
                    const tonic = nextSel.tonic;
                    let st = selScale.type;
                    var _SCALE_INTERVALS_st;
                    let intervals = (_SCALE_INTERVALS_st = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st]) !== null && _SCALE_INTERVALS_st !== void 0 ? _SCALE_INTERVALS_st : [];
                    if (intervals.length < 7) {
                        const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                        if (parent) {
                            st = parent;
                            var _SCALE_INTERVALS_parent;
                            intervals = (_SCALE_INTERVALS_parent = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent]) !== null && _SCALE_INTERVALS_parent !== void 0 ? _SCALE_INTERVALS_parent : [];
                        }
                    }
                    if (!intervals.length) return null;
                    const triads = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                        tonicPc: tonic,
                        scaleIntervals: intervals
                    });
                    const romans = triads.map((t)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["romanOfTriad"])(t.degree, t.quality, {
                            case: 'upper'
                        }));
                    return {
                        triads,
                        romans
                    };
                })();
                const recommendedCapos = nextSel && selScale ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["recommendCapos"])({
                    tonic: nextSel.tonic,
                    mode: nextSel.mode
                }, {
                    type: selScale.type
                }, 3, {
                    includeOpen: false
                }) : [];
                return {
                    keyCandidates: cands,
                    selectedKey: nextSel,
                    scaleCandidates: sc,
                    selectedScale: selScale,
                    lastProg: prog,
                    romanTokens,
                    romanText: romanTokens.join(" – "),
                    diatonic,
                    recommendedCapos
                };
            });
        },
        selectKey: (key)=>set((state)=>{
                var _state_lastProg;
                const prog = (_state_lastProg = state.lastProg) !== null && _state_lastProg !== void 0 ? _state_lastProg : [];
                const sc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$analysis$2f$scoreScales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["scoreScales"])(prog, {
                    root: key.tonic,
                    mode: key.mode
                });
                var _sc_;
                const selScale = (_sc_ = sc[0]) !== null && _sc_ !== void 0 ? _sc_ : null;
                const romanTokens = selScale ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$roman$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["progressionToRoman"])(prog, key.tonic, selScale.type) : [];
                const diatonic = (()=>{
                    if (!selScale) return null;
                    let st = selScale.type;
                    var _SCALE_INTERVALS_st;
                    let intervals = (_SCALE_INTERVALS_st = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st]) !== null && _SCALE_INTERVALS_st !== void 0 ? _SCALE_INTERVALS_st : [];
                    if (intervals.length < 7) {
                        const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                        if (parent) {
                            st = parent;
                            var _SCALE_INTERVALS_parent;
                            intervals = (_SCALE_INTERVALS_parent = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent]) !== null && _SCALE_INTERVALS_parent !== void 0 ? _SCALE_INTERVALS_parent : [];
                        }
                    }
                    if (!intervals.length) return null;
                    const triads = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                        tonicPc: key.tonic,
                        scaleIntervals: intervals
                    });
                    const romans = triads.map((t)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["romanOfTriad"])(t.degree, t.quality, {
                            case: 'upper'
                        }));
                    return {
                        triads,
                        romans
                    };
                })();
                const recommendedCapos = selScale ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["recommendCapos"])({
                    tonic: key.tonic,
                    mode: key.mode
                }, {
                    type: selScale.type
                }, 3, {
                    includeOpen: false
                }) : [];
                return {
                    selectedKey: key,
                    scaleCandidates: sc,
                    selectedScale: selScale,
                    romanTokens,
                    romanText: romanTokens.join(" – "),
                    diatonic,
                    recommendedCapos
                };
            }),
        selectScale: (s)=>set((state)=>{
                var _state_lastProg;
                const prog = (_state_lastProg = state.lastProg) !== null && _state_lastProg !== void 0 ? _state_lastProg : [];
                const key = state.selectedKey;
                const tokens = prog.length && key ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$roman$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["progressionToRoman"])(prog, key.tonic, s.type) : [];
                const diatonic = (()=>{
                    if (!key) return null;
                    let st = s.type;
                    var _SCALE_INTERVALS_st;
                    let intervals = (_SCALE_INTERVALS_st = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st]) !== null && _SCALE_INTERVALS_st !== void 0 ? _SCALE_INTERVALS_st : [];
                    if (intervals.length < 7) {
                        const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                        if (parent) {
                            st = parent;
                            var _SCALE_INTERVALS_parent;
                            intervals = (_SCALE_INTERVALS_parent = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent]) !== null && _SCALE_INTERVALS_parent !== void 0 ? _SCALE_INTERVALS_parent : [];
                        }
                    }
                    if (!intervals.length) return null;
                    const triads = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                        tonicPc: key.tonic,
                        scaleIntervals: intervals
                    });
                    const romans = triads.map((t)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["romanOfTriad"])(t.degree, t.quality, {
                            case: 'upper'
                        }));
                    return {
                        triads,
                        romans
                    };
                })();
                const recommendedCapos = key ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["recommendCapos"])({
                    tonic: key.tonic,
                    mode: key.mode
                }, {
                    type: s.type
                }, 3, {
                    includeOpen: false
                }) : [];
                return {
                    selectedScale: s,
                    romanTokens: tokens,
                    romanText: tokens.join(" – "),
                    diatonic,
                    recommendedCapos
                };
            }),
        chooseCapo: (option)=>set({
                capo: {
                    capo: option.capo,
                    shapedKey: option.shapedKey
                }
            }),
        setViewMode: (v)=>set({
                viewMode: v
            }),
        reset: ()=>set({
                keyCandidates: [],
                selectedKey: undefined,
                analysis: undefined,
                capo: null,
                viewMode: "sounding",
                scaleCandidates: [],
                selectedScale: null,
                lastProg: []
            })
    }));
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/theory/capo.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Simple capo advisor based on friendly open-chord shapes
// PITCHESは lib/music/constants.ts に統一
__turbopack_context__.s([
    "PITCHES",
    ()=>PITCHES,
    "suggestCapoOptions",
    ()=>suggestCapoOptions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-client] (ecmascript)");
;
const PITCHES = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"];
const SHAPES_MAJOR = [
    {
        key: 'C',
        label: 'C',
        weight: 1.0
    },
    {
        key: 'G',
        label: 'G',
        weight: 1.0
    },
    {
        key: 'D',
        label: 'D',
        weight: 0.95
    },
    {
        key: 'A',
        label: 'A',
        weight: 0.9
    },
    {
        key: 'E',
        label: 'E',
        weight: 0.9
    }
];
const SHAPES_MINOR = [
    {
        key: 'A',
        label: 'Am',
        weight: 1.0
    },
    {
        key: 'E',
        label: 'Em',
        weight: 1.0
    },
    {
        key: 'D',
        label: 'Dm',
        weight: 0.8
    }
];
function idx(p) {
    const n = p.replace('♭', 'b').replace('＃', '#');
    const map = {
        'Db': 'C#',
        'D#': 'Eb',
        'Gb': 'F#',
        'G#': 'Ab',
        'A#': 'Bb'
    };
    const canon = map[n] || n;
    return __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"].indexOf(canon);
}
const dist = (from, to)=>(to - from + 12) % 12;
function suggestCapoOptions(target) {
    const targetIdx = idx(target.tonic);
    const shapes = target.mode === 'minor' ? SHAPES_MINOR : SHAPES_MAJOR;
    const options = shapes.map((s)=>{
        const capo = dist(idx(s.key), targetIdx);
        const capoPenalty = capo <= 2 ? 0 : capo <= 4 ? 0.1 : capo <= 6 ? 0.25 : 0.4;
        const score = s.weight - capoPenalty;
        const notes = [];
        if (capo <= 2) notes.push('Low position');
        if (capo >= 6) notes.push('Higher position (thinner tone)');
        if (/^(E|A|C|G)/.test(s.label)) notes.push('Many open strings');
        return {
            capo,
            shapedKey: target.mode === 'minor' ? s.label : s.label,
            sounding: {
                tonic: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"][targetIdx],
                mode: target.mode
            },
            score,
            notes
        };
    }).sort((a, b)=>b.score - a.score);
    const picked = [];
    for (const o of options)if (!picked.some((p)=>p.capo === o.capo)) picked.push(o);
    return picked.slice(0, 3);
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/components/DiatonicCapoTable.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>DiatonicCapoTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/store/analysisStore.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/diatonic.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/capo/recommend.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$capo$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/capo.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
function DiatonicCapoTable(param) {
    let { onPick, selectedId, onSelectId } = param;
    _s();
    const selectedKey = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useAnalysisStore"])({
        "DiatonicCapoTable.useAnalysisStore[selectedKey]": (s)=>s.selectedKey
    }["DiatonicCapoTable.useAnalysisStore[selectedKey]"]);
    const selectedScale = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useAnalysisStore"])({
        "DiatonicCapoTable.useAnalysisStore[selectedScale]": (s)=>s.selectedScale
    }["DiatonicCapoTable.useAnalysisStore[selectedScale]"]);
    var _selectedScale_type;
    const degreeLabels = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["romanDegreeLabelsForScale"])((_selectedScale_type = selectedScale === null || selectedScale === void 0 ? void 0 : selectedScale.type) !== null && _selectedScale_type !== void 0 ? _selectedScale_type : 'Ionian');
    const toFancy = (s)=>s.replaceAll('b', '♭').replaceAll('#', '♯');
    const cellBase = "px-2 py-1 text-center border rounded-[var(--chip-br)]";
    const cellNeutral = "border-neutral-300 dark:border-neutral-700";
    const cellOpen = "bg-emerald-50 border-emerald-200 text-emerald-900 dark:bg-emerald-800/25 dark:border-emerald-700 dark:text-emerald-100";
    // Mobile long-press support
    const longPressTimerRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const longPressTriggeredRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const handleTouchStart = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "DiatonicCapoTable.useCallback[handleTouchStart]": (i, sym, pcs)=>{
            longPressTriggeredRef.current = false;
            longPressTimerRef.current = setTimeout({
                "DiatonicCapoTable.useCallback[handleTouchStart]": ()=>{
                    longPressTriggeredRef.current = true;
                    const confirmed = window.confirm('Add "'.concat(sym, '" to progression?'));
                    if (confirmed) {
                        const id = "open-".concat(i);
                        onSelectId === null || onSelectId === void 0 ? void 0 : onSelectId(id);
                        onPick === null || onPick === void 0 ? void 0 : onPick({
                            id,
                            row: 'open',
                            degree: i,
                            pcs,
                            capo: 0,
                            isRightClick: true
                        });
                    }
                }
            }["DiatonicCapoTable.useCallback[handleTouchStart]"], 500); // 500ms long press
        }
    }["DiatonicCapoTable.useCallback[handleTouchStart]"], [
        onPick,
        onSelectId
    ]);
    const handleTouchEnd = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "DiatonicCapoTable.useCallback[handleTouchEnd]": ()=>{
            if (longPressTimerRef.current) {
                clearTimeout(longPressTimerRef.current);
                longPressTimerRef.current = null;
            }
        }
    }["DiatonicCapoTable.useCallback[handleTouchEnd]"], []);
    const openCells = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"].useMemo({
        "DiatonicCapoTable.useMemo[openCells]": ()=>{
            if (!selectedKey || !selectedScale) return Array(7).fill({
                sym: '—',
                pcs: []
            });
            let st = selectedScale.type;
            var _SCALE_INTERVALS_st;
            let ivs = (_SCALE_INTERVALS_st = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st]) !== null && _SCALE_INTERVALS_st !== void 0 ? _SCALE_INTERVALS_st : [];
            if (ivs.length !== 7) {
                const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                var _SCALE_INTERVALS_parent;
                if (parent) ivs = (_SCALE_INTERVALS_parent = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent]) !== null && _SCALE_INTERVALS_parent !== void 0 ? _SCALE_INTERVALS_parent : [];
            }
            if (ivs.length !== 7) return Array(7).fill({
                sym: '—',
                pcs: []
            });
            const tris = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                tonicPc: selectedKey.tonic,
                scaleIntervals: ivs
            });
            return tris.map({
                "DiatonicCapoTable.useMemo[openCells]": (t)=>({
                        sym: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["triadToChordSym"])({
                            rootPc: t.rootPc,
                            quality: t.quality
                        }),
                        pcs: t.pcs
                    })
            }["DiatonicCapoTable.useMemo[openCells]"]);
        }
    }["DiatonicCapoTable.useMemo[openCells]"], [
        selectedKey,
        selectedScale
    ]);
    const capoRows = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"].useMemo({
        "DiatonicCapoTable.useMemo[capoRows]": ()=>{
            if (!selectedKey || !selectedScale) return [];
            const modeLabel = selectedKey.mode === 'Major' || selectedKey.mode === 'Minor' ? selectedKey.mode : selectedKey.mode === 'major' ? 'Major' : 'Minor';
            const picks = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["recommendCapos"])({
                tonic: selectedKey.tonic,
                mode: modeLabel
            }, {
                type: selectedScale.type
            }, 3, {
                includeOpen: true
            });
            const nonZero = picks.filter({
                "DiatonicCapoTable.useMemo[capoRows].nonZero": (p)=>p.capo !== 0
            }["DiatonicCapoTable.useMemo[capoRows].nonZero"]).sort({
                "DiatonicCapoTable.useMemo[capoRows].nonZero": (a, b)=>a.capo - b.capo
            }["DiatonicCapoTable.useMemo[capoRows].nonZero"]).slice(0, 2);
            return nonZero.map({
                "DiatonicCapoTable.useMemo[capoRows]": (p)=>{
                    const playAs = p.playAs; // e.g., G or Am
                    const isMinor = /m$/.test(playAs);
                    const name = isMinor ? playAs.replace(/m$/, '') : playAs;
                    const pc = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$capo$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PITCHES"].indexOf(name);
                    let st = selectedScale.type;
                    var _SCALE_INTERVALS_st;
                    let ivs = (_SCALE_INTERVALS_st = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st]) !== null && _SCALE_INTERVALS_st !== void 0 ? _SCALE_INTERVALS_st : [];
                    if (ivs.length !== 7) {
                        const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                        var _SCALE_INTERVALS_parent;
                        if (parent) ivs = (_SCALE_INTERVALS_parent = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent]) !== null && _SCALE_INTERVALS_parent !== void 0 ? _SCALE_INTERVALS_parent : [];
                    }
                    const tris = ivs.length === 7 ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                        tonicPc: pc,
                        scaleIntervals: ivs
                    }) : [];
                    const cells = (tris.length ? tris : Array(7).fill(null)).map({
                        "DiatonicCapoTable.useMemo[capoRows].cells": (t)=>t ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["triadToChordSym"])({
                                rootPc: t.rootPc,
                                quality: t.quality
                            }) : '—'
                    }["DiatonicCapoTable.useMemo[capoRows].cells"]);
                    const cellsPcs = (tris.length ? tris : Array(7).fill(null)).map({
                        "DiatonicCapoTable.useMemo[capoRows].cellsPcs": (t)=>t ? t.pcs : []
                    }["DiatonicCapoTable.useMemo[capoRows].cellsPcs"]);
                    return {
                        capo: p.capo,
                        label: "Capo ".concat(p.capo),
                        cells,
                        cellsPcs,
                        tooltip: "Play as ".concat(playAs).concat(p.reasons && p.reasons.length ? ' · ' + p.reasons.join(' · ') : '')
                    };
                }
            }["DiatonicCapoTable.useMemo[capoRows]"]);
        }
    }["DiatonicCapoTable.useMemo[capoRows]"], [
        selectedKey,
        selectedScale
    ]);
    const header = degreeLabels.map(toFancy);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "overflow-x-auto capo-compact capo-compact--tight",
        "aria-live": "polite",
        "aria-labelledby": "diatonic-title",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("table", {
            className: "w-full border-separate rounded-xl border text-sm md:text-[0.95rem]",
            style: {
                borderSpacing: '6px'
            },
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("colgroup", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("col", {
                            className: "w-12 sm:w-14 md:w-18"
                        }, void 0, false, {
                            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                            lineNumber: 85,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("col", {
                            span: 7
                        }, void 0, false, {
                            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                            lineNumber: 86,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                    lineNumber: 84,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("thead", {
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("tr", {
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("th", {
                                scope: "col",
                                className: "px-1 py-0 text-center text-sm font-medium border-none bg-transparent rounded-none"
                            }, void 0, false, {
                                fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                lineNumber: 90,
                                columnNumber: 13
                            }, this),
                            header.map((d, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("th", {
                                    scope: "col",
                                    className: "px-1 py-0 text-center text-sm font-medium border-none bg-transparent rounded-none",
                                    children: d
                                }, "hdr-".concat(i), false, {
                                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                    lineNumber: 92,
                                    columnNumber: 15
                                }, this))
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                        lineNumber: 89,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                    lineNumber: 88,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("tbody", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("tr", {
                            "data-row": "open",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("th", {
                                    scope: "row",
                                    className: "px-1 py-0 text-center text-xs font-normal border-none bg-transparent rounded-none text-foreground/70",
                                    title: "Open (no capo)",
                                    children: "Open"
                                }, void 0, false, {
                                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                    lineNumber: 98,
                                    columnNumber: 13
                                }, this),
                                openCells.map((c, i)=>// cell id unique: open-<degreeIndex>
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("td", {
                                        className: [
                                            cellBase,
                                            cellOpen,
                                            onPick ? 'cursor-pointer select-none tapfx' : '',
                                            selectedId === "open-".concat(i) ? 'ring-2 ring-emerald-400/60 dia-cell--active' : 'dia-cell--idle'
                                        ].join(' '),
                                        onClick: (e)=>{
                                            if (e.button === 2) return; // 右クリックは無視
                                            if (longPressTriggeredRef.current) {
                                                longPressTriggeredRef.current = false;
                                                return;
                                            } // 長押し後のクリックを無視
                                            const id = "open-".concat(i);
                                            onSelectId === null || onSelectId === void 0 ? void 0 : onSelectId(id);
                                            onPick === null || onPick === void 0 ? void 0 : onPick({
                                                id,
                                                row: 'open',
                                                degree: i,
                                                pcs: c.pcs,
                                                capo: 0
                                            });
                                        },
                                        onContextMenu: (e)=>{
                                            e.preventDefault();
                                            e.stopPropagation();
                                            const confirmed = window.confirm('Add "'.concat(c.sym, '" to progression?'));
                                            if (confirmed) {
                                                const id = "open-".concat(i);
                                                onSelectId === null || onSelectId === void 0 ? void 0 : onSelectId(id);
                                                onPick === null || onPick === void 0 ? void 0 : onPick({
                                                    id,
                                                    row: 'open',
                                                    degree: i,
                                                    pcs: c.pcs,
                                                    capo: 0,
                                                    isRightClick: true
                                                });
                                            }
                                        },
                                        onTouchStart: ()=>handleTouchStart(i, c.sym, c.pcs),
                                        onTouchEnd: handleTouchEnd,
                                        onTouchCancel: handleTouchEnd,
                                        role: onPick ? 'button' : undefined,
                                        "aria-label": onPick ? "Open ".concat(c.sym) : undefined,
                                        "aria-pressed": selectedId === "open-".concat(i),
                                        children: c.sym
                                    }, "open-".concat(i), false, {
                                        fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                        lineNumber: 101,
                                        columnNumber: 15
                                    }, this))
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                            lineNumber: 97,
                            columnNumber: 11
                        }, this),
                        capoRows.map((r)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("tr", {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("th", {
                                        scope: "row",
                                        className: "px-1 py-0 text-center text-xs font-normal border-none bg-transparent rounded-none text-foreground/70",
                                        title: r.tooltip,
                                        children: r.label
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                        lineNumber: 130,
                                        columnNumber: 15
                                    }, this),
                                    r.cells.map((c, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("td", {
                                            className: [
                                                cellBase,
                                                cellNeutral,
                                                'opacity-65 cursor-default pointer-events-none',
                                                selectedId === "capo".concat(r.capo, "-").concat(i) ? 'dia-cell--active' : 'dia-cell--idle'
                                            ].join(' '),
                                            role: "button",
                                            tabIndex: -1,
                                            "aria-disabled": "true",
                                            "aria-label": "".concat(r.label, " ").concat(c),
                                            children: c
                                        }, "capo-".concat(r.capo, "-").concat(i), false, {
                                            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                            lineNumber: 132,
                                            columnNumber: 17
                                        }, this))
                                ]
                            }, "capo-".concat(r.capo), true, {
                                fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                lineNumber: 129,
                                columnNumber: 13
                            }, this))
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                    lineNumber: 96,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
            lineNumber: 83,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/src/components/DiatonicCapoTable.tsx",
        lineNumber: 82,
        columnNumber: 5
    }, this);
}
_s(DiatonicCapoTable, "bxUbkdD1C3EFB1VKRkd9XzVp5lE=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useAnalysisStore"],
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useAnalysisStore"]
    ];
});
_c = DiatonicCapoTable;
var _c;
__turbopack_context__.k.register(_c, "DiatonicCapoTable");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/hooks/useRovingTabs.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useRovingTabs",
    ()=>useRovingTabs
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var _s = __turbopack_context__.k.signature();
"use client";
;
function useRovingTabs(root) {
    let options = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : {};
    _s();
    const { itemSelector = '[role="tab"],[data-roving="item"]', orientation = "horizontal", includeHomeEnd = true } = options;
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "useRovingTabs.useEffect": ()=>{
            const el = root.current;
            if (!el) return;
            const getItems = {
                "useRovingTabs.useEffect.getItems": ()=>Array.from(el.querySelectorAll(itemSelector)).filter({
                        "useRovingTabs.useEffect.getItems": (node)=>!node.hasAttribute("disabled")
                    }["useRovingTabs.useEffect.getItems"])
            }["useRovingTabs.useEffect.getItems"];
            const setTabIndex = {
                "useRovingTabs.useEffect.setTabIndex": (items, idx)=>{
                    items.forEach({
                        "useRovingTabs.useEffect.setTabIndex": (node, i)=>node.tabIndex = i === idx ? 0 : -1
                    }["useRovingTabs.useEffect.setTabIndex"]);
                }
            }["useRovingTabs.useEffect.setTabIndex"];
            const applyInitial = {
                "useRovingTabs.useEffect.applyInitial": ()=>{
                    const items = getItems();
                    if (!items.length) return;
                    let index = items.findIndex({
                        "useRovingTabs.useEffect.applyInitial.index": (node)=>node.getAttribute("aria-selected") === "true" || node.tabIndex === 0 || node === document.activeElement
                    }["useRovingTabs.useEffect.applyInitial.index"]);
                    if (index < 0) index = 0;
                    setTabIndex(items, index);
                }
            }["useRovingTabs.useEffect.applyInitial"];
            applyInitial();
            const onKey = {
                "useRovingTabs.useEffect.onKey": (event)=>{
                    const items = getItems();
                    if (!items.length) return;
                    const currentIndex = items.indexOf(document.activeElement);
                    if (currentIndex < 0) return;
                    const { key } = event;
                    const horizontal = orientation === "horizontal" || orientation === "both";
                    const vertical = orientation === "vertical" || orientation === "both";
                    let nextIndex = -1;
                    if (horizontal && key === "ArrowRight") nextIndex = (currentIndex + 1) % items.length;
                    if (horizontal && key === "ArrowLeft") nextIndex = (currentIndex - 1 + items.length) % items.length;
                    if (vertical && key === "ArrowDown") nextIndex = (currentIndex + 1) % items.length;
                    if (vertical && key === "ArrowUp") nextIndex = (currentIndex - 1 + items.length) % items.length;
                    if (nextIndex >= 0) {
                        event.preventDefault();
                        setTabIndex(items, nextIndex);
                        items[nextIndex].focus({
                            preventScroll: true
                        });
                        return;
                    }
                    if (includeHomeEnd && key === "Home") {
                        event.preventDefault();
                        setTabIndex(items, 0);
                        items[0].focus({
                            preventScroll: true
                        });
                        return;
                    }
                    if (includeHomeEnd && key === "End") {
                        event.preventDefault();
                        const last = items.length - 1;
                        setTabIndex(items, last);
                        items[last].focus({
                            preventScroll: true
                        });
                    }
                }
            }["useRovingTabs.useEffect.onKey"];
            el.addEventListener("keydown", onKey);
            return ({
                "useRovingTabs.useEffect": ()=>{
                    el.removeEventListener("keydown", onKey);
                }
            })["useRovingTabs.useEffect"];
        }
    }["useRovingTabs.useEffect"], [
        root,
        itemSelector,
        orientation,
        includeHomeEnd
    ]);
}
_s(useRovingTabs, "OD7bBpZva5O2jO+Puf00hKivP7c=");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/components/ui/InfoDot.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>InfoDot
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2d$dom$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react-dom/index.js [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
function InfoDot(param) {
    let { text, title, children, className = "", linkHref, linkLabel = "Learn more", ariaLabel = "More info", icon = 'info' } = param;
    _s();
    const [open, setOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const ref = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const btnRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [coords, setCoords] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])({
        left: 0,
        top: 0,
        maxW: 320
    });
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "InfoDot.useEffect": ()=>{
            const onDoc = {
                "InfoDot.useEffect.onDoc": (e)=>{
                    if (ref.current && !ref.current.contains(e.target)) setOpen(false);
                }
            }["InfoDot.useEffect.onDoc"];
            const onEsc = {
                "InfoDot.useEffect.onEsc": (e)=>{
                    if (e.key === "Escape") setOpen(false);
                }
            }["InfoDot.useEffect.onEsc"];
            document.addEventListener("click", onDoc);
            document.addEventListener("keydown", onEsc);
            return ({
                "InfoDot.useEffect": ()=>{
                    document.removeEventListener("click", onDoc);
                    document.removeEventListener("keydown", onEsc);
                }
            })["InfoDot.useEffect"];
        }
    }["InfoDot.useEffect"], []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useLayoutEffect"])({
        "InfoDot.useLayoutEffect": ()=>{
            if (!open) return;
            const update = {
                "InfoDot.useLayoutEffect.update": ()=>{
                    if (!btnRef.current) return;
                    const r = btnRef.current.getBoundingClientRect();
                    const maxW = Math.min(Math.floor(window.innerWidth * 0.9), 360);
                    const left = Math.min(window.innerWidth - 8 - maxW, Math.max(8, Math.round(r.right - maxW)));
                    const top = Math.min(window.innerHeight - 8 - 120, Math.round(r.bottom + 6));
                    setCoords({
                        left,
                        top,
                        maxW
                    });
                }
            }["InfoDot.useLayoutEffect.update"];
            update();
            window.addEventListener("resize", update);
            window.addEventListener("scroll", update, true);
            return ({
                "InfoDot.useLayoutEffect": ()=>{
                    window.removeEventListener("resize", update);
                    window.removeEventListener("scroll", update, true);
                }
            })["InfoDot.useLayoutEffect"];
        }
    }["InfoDot.useLayoutEffect"], [
        open
    ]);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: "relative inline-flex items-center ".concat(className),
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                ref: btnRef,
                type: "button",
                className: "info-dot",
                "aria-label": ariaLabel,
                onClick: ()=>setOpen((o)=>!o),
                children: icon === 'graduation' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                    className: "w-3 h-3",
                    viewBox: "0 0 24 24",
                    fill: "currentColor",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                        d: "M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"
                    }, void 0, false, {
                        fileName: "[project]/src/components/ui/InfoDot.tsx",
                        lineNumber: 68,
                        columnNumber: 13
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/src/components/ui/InfoDot.tsx",
                    lineNumber: 67,
                    columnNumber: 11
                }, this) : 'i'
            }, void 0, false, {
                fileName: "[project]/src/components/ui/InfoDot.tsx",
                lineNumber: 65,
                columnNumber: 7
            }, this),
            open && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2d$dom$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createPortal"])(/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                role: "dialog",
                className: "info-card",
                style: {
                    position: "fixed",
                    zIndex: 60,
                    left: "".concat(coords.left, "px"),
                    top: "".concat(coords.top, "px"),
                    maxWidth: "".concat(coords.maxW, "px")
                },
                children: [
                    title && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "font-medium mb-1",
                        children: title
                    }, void 0, false, {
                        fileName: "[project]/src/components/ui/InfoDot.tsx",
                        lineNumber: 87,
                        columnNumber: 23
                    }, this),
                    children ? children : (text !== null && text !== void 0 ? text : "").split("\n").map((line, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            children: line
                        }, i, false, {
                            fileName: "[project]/src/components/ui/InfoDot.tsx",
                            lineNumber: 91,
                            columnNumber: 57
                        }, this)),
                    linkHref && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "mt-2 text-right",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("a", {
                            href: linkHref,
                            className: "underline text-[12px] opacity-80",
                            children: linkLabel
                        }, void 0, false, {
                            fileName: "[project]/src/components/ui/InfoDot.tsx",
                            lineNumber: 95,
                            columnNumber: 17
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/src/components/ui/InfoDot.tsx",
                        lineNumber: 94,
                        columnNumber: 15
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ui/InfoDot.tsx",
                lineNumber: 76,
                columnNumber: 11
            }, this), document.body)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/ui/InfoDot.tsx",
        lineNumber: 64,
        columnNumber: 5
    }, this);
}
_s(InfoDot, "TTqQXTuvBeqYPWUW6S5TG1Y0Sio=");
_c = InfoDot;
var _c;
__turbopack_context__.k.register(_c, "InfoDot");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/scaleSuggestions.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "suggestScalesForChord",
    ()=>suggestScalesForChord
]);
function suggestScalesForChord(quality) {
    switch(quality){
        case 'maj':
        case 'maj7':
            return {
                scales: [
                    'Ionian',
                    'Lydian'
                ],
                why: [
                    'maj_ionian',
                    'maj_lydian'
                ]
            };
        case 'min':
        case 'm7':
            return {
                scales: [
                    'Aeolian',
                    'Dorian',
                    'Phrygian'
                ],
                why: [
                    'min_aeolian',
                    'min_dorian',
                    'min_phrygian'
                ]
            };
        case 'dom7':
        case '7':
            return {
                scales: [
                    'Mixolydian',
                    'Altered'
                ],
                why: [
                    'dom_mixolydian',
                    'dom_altered'
                ]
            };
        case 'm7b5':
            return {
                scales: [
                    'Locrian',
                    'DiminishedWholeHalf'
                ],
                why: [
                    'm7b5_locrian',
                    'dim_wh'
                ]
            };
        case 'dim':
            return {
                scales: [
                    'DiminishedWholeHalf',
                    'Locrian'
                ],
                why: [
                    'dim_wh',
                    'm7b5_locrian'
                ]
            };
    }
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/components/ScaleTable.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "ScaleTable",
    ()=>ScaleTable,
    "default",
    ()=>__TURBOPACK__default__export__
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleSuggestions$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scaleSuggestions.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/audio/player.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/hooks/useRovingTabs.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
function ScaleTable(param) {
    let { chordQuality, rootPc, onPreviewScale, onResetPreview, openGlossary, activeScaleId } = param;
    _s();
    const { scales } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleSuggestions$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["suggestScalesForChord"])(chordQuality);
    const listRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"])(listRef, {
        orientation: "horizontal"
    });
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "ot-scale-table",
        "data-testid": "scale-chips",
        "aria-label": "Suggested scales",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("details", {
            className: "rounded border p-2 bg-background/40",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("summary", {
                    className: "text-sm cursor-pointer select-none",
                    children: "Suggested scales for this chord"
                }, void 0, false, {
                    fileName: "[project]/src/components/ScaleTable.tsx",
                    lineNumber: 26,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "mt-2 flex items-center justify-between gap-2",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            role: "tablist",
                            "aria-label": "Preview scale",
                            className: "flex flex-wrap gap-2",
                            ref: listRef,
                            children: scales.map((id, idx)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "inline-flex items-center gap-1",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            role: "tab",
                                            className: [
                                                "chip",
                                                activeScaleId === id ? "chip--active" : ""
                                            ].join(" "),
                                            onClick: ()=>{
                                                onPreviewScale(id);
                                                (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('overlay_shown', {
                                                    control: 'scale',
                                                    scaleId: id
                                                });
                                                void playArpShort(rootPc, id);
                                            },
                                            "aria-describedby": "why-".concat(id),
                                            "data-roving": "item",
                                            children: labelFor(id, chordQuality, idx)
                                        }, void 0, false, {
                                            fileName: "[project]/src/components/ScaleTable.tsx",
                                            lineNumber: 31,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            type: "button",
                                            className: "inline-flex items-center justify-center w-5 h-5 rounded-full text-xs opacity-60 hover:opacity-100 hover:bg-black/5 dark:hover:bg-white/10 transition-opacity",
                                            onClick: ()=>openGlossary(id),
                                            "aria-label": "Learn more about ".concat(id),
                                            title: "Learn more in Glossary",
                                            children: "ⓘ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/components/ScaleTable.tsx",
                                            lineNumber: 39,
                                            columnNumber: 15
                                        }, this)
                                    ]
                                }, id, true, {
                                    fileName: "[project]/src/components/ScaleTable.tsx",
                                    lineNumber: 30,
                                    columnNumber: 13
                                }, this))
                        }, void 0, false, {
                            fileName: "[project]/src/components/ScaleTable.tsx",
                            lineNumber: 28,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                            className: "btn-ghost text-xs ml-auto",
                            onClick: onResetPreview,
                            children: "Reset"
                        }, void 0, false, {
                            fileName: "[project]/src/components/ScaleTable.tsx",
                            lineNumber: 51,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/components/ScaleTable.tsx",
                    lineNumber: 27,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "mt-2 flex flex-wrap gap-x-4 gap-y-1 items-center text-xs opacity-80",
                    children: scales.map((id)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                            id: "why-".concat(id),
                            children: getWhyText(id)
                        }, "why-".concat(id), false, {
                            fileName: "[project]/src/components/ScaleTable.tsx",
                            lineNumber: 55,
                            columnNumber: 13
                        }, this))
                }, void 0, false, {
                    fileName: "[project]/src/components/ScaleTable.tsx",
                    lineNumber: 53,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/src/components/ScaleTable.tsx",
            lineNumber: 25,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/src/components/ScaleTable.tsx",
        lineNumber: 23,
        columnNumber: 5
    }, this);
}
_s(ScaleTable, "ofILwxQgWm9Y9ZelhvRELBiNhjc=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"]
    ];
});
_c = ScaleTable;
// 短いアルペジオ（上昇→下降パターン）
async function playArpShort(rootPc, scaleId) {
    try {
        // @ts-ignore SSOT API exposed in window
        const api = window.__SCALES_API__;
        if (!(api === null || api === void 0 ? void 0 : api.getScalePitchesById)) return;
        const pcs = api.getScalePitchesById(rootPc, scaleId);
        const steps = pcs.slice(0, Math.min(5, pcs.length)); // 最大5音
        const ascending = steps.slice();
        const descending = steps.slice().reverse().slice(1); // ルート音は重複させない
        const pattern = [
            ...ascending,
            ...descending
        ];
        const dur = 100; // 各音100ms
        await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].resume();
        for (const pc of pattern){
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].playNote(60 + pc, dur);
            await wait(dur);
        }
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('scale_arpeggio_play', {
            page: 'find-chords',
            scaleId,
            rootPc
        });
    } catch (e) {}
}
function wait(ms) {
    return new Promise((r)=>setTimeout(r, ms));
}
function getWhyText(scaleId) {
    const map = {
        Ionian: 'maj_ionian',
        Lydian: 'maj_lydian',
        Aeolian: 'min_aeolian',
        Dorian: 'min_dorian',
        Phrygian: 'min_phrygian',
        Mixolydian: 'dom_mixolydian',
        Locrian: 'm7b5_locrian',
        DiminishedWholeHalf: 'dim_wh',
        Altered: 'dom_altered',
        HarmonicMinor: 'min_harmonic',
        MelodicMinor: 'min_melodic',
        WholeTone: 'dom_wholetone'
    };
    const t = {
        maj_ionian: "Foundation for major chords – fits all diatonic tones",
        maj_lydian: "Bright color with raised 4th (#11) – jazz/modern sound",
        maj_mixolydian: "Dominant-like major – contains the b7 for blues flavor",
        min_aeolian: "Natural minor foundation – matches all minor scale tones",
        min_dorian: "Brighter minor with natural 6th – popular in jazz and funk",
        min_phrygian: "Dark minor with flat 2nd – Spanish/flamenco character",
        min_harmonic: "Dramatic minor with raised 7th – classical and exotic sound",
        min_melodic: "Jazz minor – ascending melodic scale with natural 6th and 7th",
        dom_mixolydian: "Perfect for dominant 7th – contains the b7 tension",
        dom_altered: "Maximum tension – all alterations (b9, #9, #11, b13)",
        dom_wholetone: "Symmetrical whole-tone pattern – dreamy, unresolved quality",
        m7b5_locrian: "Outlines half-diminished chord – starts on the 7th degree",
        dim_wh: "Symmetrical whole-half pattern – creates tension over diminished chords"
    };
    return t[map[scaleId]] || '';
}
function labelFor(id, q, idx) {
    if (q === 'maj' || q === 'maj7') {
        if (idx === 0) return 'Ionian (Major Scale)';
        if (idx === 1) return 'Lydian (#4 Color)';
    }
    if (q === 'min' || q === 'm7') {
        if (idx === 0) return 'Aeolian (Natural Minor)';
        if (idx === 1) return 'Dorian (Bright Minor)';
        if (idx === 2) return 'Phrygian (Dark Minor)';
    }
    if (q === 'dom7' || q === '7') {
        if (idx === 0) return 'Mixolydian (Dominant)';
        if (idx === 1) return 'Altered (Tension)';
    }
    if (q === 'm7b5') {
        if (idx === 0) return 'Locrian (Half-Dim)';
        if (idx === 1) return 'Whole–Half Dim';
    }
    if (q === 'dim') {
        if (idx === 0) return 'Whole–Half Dim';
        if (idx === 1) return 'Locrian';
    }
    return id;
}
const __TURBOPACK__default__export__ = ScaleTable;
var _c;
__turbopack_context__.k.register(_c, "ScaleTable");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/components/ChordFormsPopover.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "ChordFormsPopover",
    ()=>ChordFormsPopover,
    "default",
    ()=>__TURBOPACK__default__export__
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2d$dom$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react-dom/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/hooks/useRovingTabs.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/audio/player.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
function ChordFormsPopover(param) {
    let { at, quality, rootPc, onPick, onClose, page = "analyze" } = param;
    _s();
    const ref = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const closeRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(onClose);
    closeRef.current = onClose;
    const sentOpenRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const pickedRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const buttonsRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"])(buttonsRef, {
        orientation: "horizontal"
    });
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ChordFormsPopover.useEffect": ()=>{
            var _ref_current;
            if (!sentOpenRef.current) {
                sentOpenRef.current = true;
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["trackOverlayShown"])({
                    control: "forms",
                    open: true,
                    page
                });
            }
            const firstButton = (_ref_current = ref.current) === null || _ref_current === void 0 ? void 0 : _ref_current.querySelector("button");
            firstButton === null || firstButton === void 0 ? void 0 : firstButton.focus({
                preventScroll: true
            });
            function onKey(e) {
                if (e.key === "Escape") closeRef.current();
            }
            function onClickOutside(e) {
                if (!ref.current) return;
                if (!ref.current.contains(e.target)) closeRef.current();
            }
            document.addEventListener("keydown", onKey);
            document.addEventListener("mousedown", onClickOutside);
            return ({
                "ChordFormsPopover.useEffect": ()=>{
                    document.removeEventListener("keydown", onKey);
                    document.removeEventListener("mousedown", onClickOutside);
                }
            })["ChordFormsPopover.useEffect"];
        }
    }["ChordFormsPopover.useEffect"], [
        page
    ]);
    const style = {
        position: "fixed",
        left: at.x,
        top: at.y,
        zIndex: 2147483647,
        pointerEvents: "auto"
    };
    const choose = (kind)=>{
        if (pickedRef.current) return;
        pickedRef.current = true;
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["trackOverlayShown"])({
            control: "forms",
            value: kind,
            page
        });
        onPick(kind);
        onClose();
    };
    const playFormPreview = async (kind)=>{
        try {
            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].resume();
            // 基本的な3和音を再生（ルート、3度、5度）
            const intervals = quality === 'maj' ? [
                0,
                4,
                7
            ] : [
                0,
                3,
                7
            ];
            const midis = intervals.map((iv)=>60 + rootPc + iv);
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].playChord(midis, 'lightStrum', 300);
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('play_chord', {
                page,
                source: 'form_preview',
                kind
            });
        } catch (e) {}
    };
    const node = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        role: "dialog",
        "aria-modal": "true",
        "aria-label": "Chord forms",
        ref: ref,
        style: style,
        className: "ot-pop",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex items-center justify-between mb-2",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "ot-h3",
                        style: {
                            margin: 0
                        },
                        children: "Chord Forms"
                    }, void 0, false, {
                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                        lineNumber: 90,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                        type: "button",
                        onClick: onClose,
                        className: "text-xs opacity-60 hover:opacity-100 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/10",
                        "aria-label": "Close",
                        children: "✕"
                    }, void 0, false, {
                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                        lineNumber: 93,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                lineNumber: 89,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                className: "text-xs opacity-70 mb-3",
                children: [
                    "Select a fingering pattern for ",
                    quality === 'maj' ? 'major' : 'minor',
                    " chord"
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                lineNumber: 102,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex flex-col gap-2",
                ref: buttonsRef,
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center gap-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                "data-roving": "item",
                                onClick: ()=>choose("open"),
                                className: "flex-1 px-3 py-2 rounded border text-left hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "font-medium",
                                        children: "Open Position"
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                        lineNumber: 113,
                                        columnNumber: 13
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "text-xs opacity-70",
                                        children: "Uses open strings"
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                        lineNumber: 114,
                                        columnNumber: 13
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                lineNumber: 107,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                onClick: ()=>playFormPreview("open"),
                                className: "w-8 h-8 flex items-center justify-center rounded border hover:bg-black/5 dark:hover:bg-white/10 transition-colors",
                                "aria-label": "Preview open position",
                                title: "Preview sound",
                                children: "▶"
                            }, void 0, false, {
                                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                lineNumber: 116,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                        lineNumber: 106,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center gap-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                "data-roving": "item",
                                onClick: ()=>choose("barreE"),
                                className: "flex-1 px-3 py-2 rounded border text-left hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "font-medium",
                                        children: "Barre (E-shape)"
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                        lineNumber: 133,
                                        columnNumber: 13
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "text-xs opacity-70",
                                        children: "6th string root"
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                        lineNumber: 134,
                                        columnNumber: 13
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                lineNumber: 127,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                onClick: ()=>playFormPreview("barreE"),
                                className: "w-8 h-8 flex items-center justify-center rounded border hover:bg-black/5 dark:hover:bg-white/10 transition-colors",
                                "aria-label": "Preview E-shape barre",
                                title: "Preview sound",
                                children: "▶"
                            }, void 0, false, {
                                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                lineNumber: 136,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                        lineNumber: 126,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center gap-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                "data-roving": "item",
                                onClick: ()=>choose("barreA"),
                                className: "flex-1 px-3 py-2 rounded border text-left hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "font-medium",
                                        children: "Barre (A-shape)"
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                        lineNumber: 153,
                                        columnNumber: 13
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "text-xs opacity-70",
                                        children: "5th string root"
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                        lineNumber: 154,
                                        columnNumber: 13
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                lineNumber: 147,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                onClick: ()=>playFormPreview("barreA"),
                                className: "w-8 h-8 flex items-center justify-center rounded border hover:bg-black/5 dark:hover:bg-white/10 transition-colors",
                                "aria-label": "Preview A-shape barre",
                                title: "Preview sound",
                                children: "▶"
                            }, void 0, false, {
                                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                                lineNumber: 156,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/ChordFormsPopover.tsx",
                        lineNumber: 146,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                lineNumber: 105,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                className: "ot-hint mt-3",
                children: "Right-click or long-press a chord to open."
            }, void 0, false, {
                fileName: "[project]/src/components/ChordFormsPopover.tsx",
                lineNumber: 167,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/ChordFormsPopover.tsx",
        lineNumber: 81,
        columnNumber: 5
    }, this);
    if (typeof document !== "undefined") {
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2d$dom$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createPortal"])(node, document.body);
    }
    return node;
}
_s(ChordFormsPopover, "0MiuDYfMHvMMtmeTOKzdxBY78Nk=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"]
    ];
});
_c = ChordFormsPopover;
const __TURBOPACK__default__export__ = ChordFormsPopover;
var _c;
__turbopack_context__.k.register(_c, "ChordFormsPopover");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/chordForms.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildForm",
    ()=>buildForm,
    "getOpenShapeE",
    ()=>getOpenShapeE,
    "makeBarreAShape",
    ()=>makeBarreAShape,
    "makeBarreEShape",
    ()=>makeBarreEShape
]);
const OPEN_E_PC = 4; // E
const OPEN_A_PC = 9; // A
function mod12(n) {
    return (n % 12 + 12) % 12;
}
function nearestBarreFretForRoot(openPc, targetPc) {
    const tgt = mod12(targetPc);
    for(let f = 1; f <= 12; f++){
        if (mod12(openPc + f) === tgt) return f;
    }
    return 1;
}
function getOpenShapeE(quality, rootPc) {
    const dots = quality === 'maj' ? [
        {
            string: 6,
            fret: 0,
            deg: '1'
        },
        {
            string: 5,
            fret: 2,
            deg: '5'
        },
        {
            string: 4,
            fret: 2,
            deg: '1'
        },
        {
            string: 3,
            fret: 1,
            deg: '3'
        },
        {
            string: 2,
            fret: 0,
            deg: '5'
        },
        {
            string: 1,
            fret: 0,
            deg: '1'
        }
    ] : [
        {
            string: 6,
            fret: 0,
            deg: '1'
        },
        {
            string: 5,
            fret: 2,
            deg: '5'
        },
        {
            string: 4,
            fret: 2,
            deg: '1'
        },
        {
            string: 3,
            fret: 0,
            deg: 'b3'
        },
        {
            string: 2,
            fret: 0,
            deg: '5'
        },
        {
            string: 1,
            fret: 0,
            deg: '1'
        }
    ];
    return {
        kind: 'open',
        quality,
        rootPc,
        rootString: 6,
        dots
    };
}
function makeBarreEShape(quality, rootPc) {
    const f = nearestBarreFretForRoot(OPEN_E_PC, rootPc);
    const dots = [
        {
            string: 6,
            fret: f,
            deg: '1'
        },
        {
            string: 5,
            fret: f + 2,
            deg: '5'
        },
        {
            string: 4,
            fret: f + 2,
            deg: '1'
        },
        {
            string: 3,
            fret: quality === 'maj' ? f + 1 : f,
            deg: quality === 'maj' ? '3' : 'b3'
        },
        {
            string: 2,
            fret: f,
            deg: '5'
        },
        {
            string: 1,
            fret: f,
            deg: '1'
        }
    ];
    return {
        kind: 'barreE',
        quality,
        rootPc,
        rootString: 6,
        dots,
        barre: {
            stringFrom: 6,
            fret: f
        }
    };
}
function makeBarreAShape(quality, rootPc) {
    const f = nearestBarreFretForRoot(OPEN_A_PC, rootPc);
    const dots = [
        {
            string: 5,
            fret: f,
            deg: '1'
        },
        {
            string: 4,
            fret: f + 2,
            deg: '5'
        },
        {
            string: 3,
            fret: quality === 'maj' ? f + 2 : f,
            deg: quality === 'maj' ? '3' : 'b3'
        },
        {
            string: 2,
            fret: f + 2,
            deg: '1'
        },
        {
            string: 1,
            fret: f,
            deg: '5'
        }
    ];
    return {
        kind: 'barreA',
        quality,
        rootPc,
        rootString: 5,
        dots,
        barre: {
            stringFrom: 5,
            fret: f
        }
    };
}
function buildForm(kind, quality, rootPc) {
    if (kind === 'open') return getOpenShapeE(quality, rootPc);
    if (kind === 'barreE') return makeBarreEShape(quality, rootPc);
    return makeBarreAShape(quality, rootPc);
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/chords/substitute.refactored.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * 代理コード（Substitute Chords）推奨ロジック（リファクタリング版）
 * 
 * 各ダイアトニックコードに対して、機能的に類似した代理コード候補を提示
 */ __turbopack_context__.s([
    "getSubstitutes",
    ()=>getSubstitutes
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-client] (ecmascript)");
;
/**
 * Major keyにおける各度数の代理コード定義
 */ const MAJOR_KEY_SUBSTITUTES = {
    // I (Tonic)
    1: (param)=>{
        let { rootPc } = param;
        return [
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "maj7"),
                reason: "Richer tonic sound with major 7th",
                examples: [
                    "The Girl from Ipanema",
                    "Fly Me to the Moon"
                ]
            },
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "6"),
                reason: "Jazz tonic with added 6th",
                examples: [
                    "All the Things You Are",
                    "Autumn Leaves"
                ]
            },
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["mod12"])(rootPc + 9)), "m"),
                reason: "Relative minor shares the same notes",
                examples: [
                    "Let It Be",
                    "No Woman No Cry"
                ]
            }
        ];
    },
    // ii (Subdominant)
    2: (param)=>{
        let { rootPc, key } = param;
        return [
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "m7"),
                reason: "Jazz ii with minor 7th",
                examples: [
                    "Autumn Leaves",
                    "Fly Me to the Moon"
                ]
            },
            {
                chord: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["mod12"])(key.tonic + 5)),
                reason: "IV chord shares subdominant function",
                examples: [
                    "Let It Be",
                    "Hey Jude"
                ]
            }
        ];
    },
    // IV (Subdominant)
    4: (param)=>{
        let { rootPc, key } = param;
        return [
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "maj7"),
                reason: "Lydian color with major 7th",
                examples: [
                    "The Girl from Ipanema",
                    "Dreams (Fleetwood Mac)"
                ]
            },
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["mod12"])(key.tonic + 2)), "m"),
                reason: "ii chord shares subdominant function",
                examples: [
                    "Autumn Leaves",
                    "Fly Me to the Moon"
                ]
            },
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "m"),
                reason: "Borrowed minor IV for color",
                examples: [
                    "Yesterday",
                    "Creep"
                ]
            }
        ];
    },
    // V (Dominant)
    5: (param)=>{
        let { rootPc, key } = param;
        return [
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "7"),
                reason: "Dominant 7th creates strong tension",
                examples: [
                    "Sweet Home Alabama",
                    "Twist and Shout"
                ]
            },
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "sus4"),
                reason: "Suspended 4th delays resolution",
                examples: [
                    "Pinball Wizard",
                    "The Edge of Glory"
                ]
            },
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["mod12"])(key.tonic + 11)), "dim"),
                reason: "vii° shares dominant function",
                examples: [
                    "Girl from Ipanema",
                    "Michelle"
                ]
            }
        ];
    },
    // vi (Tonic)
    6: (param)=>{
        let { rootPc, key } = param;
        return [
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "m7"),
                reason: "Jazz minor with added 7th",
                examples: [
                    "Stairway to Heaven",
                    "Hotel California"
                ]
            },
            {
                chord: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(key.tonic),
                reason: "Relative major shares the same notes",
                examples: [
                    "Let It Be",
                    "Hey Jude"
                ]
            }
        ];
    }
};
/**
 * Minor keyにおける各度数の代理コード定義
 */ const MINOR_KEY_SUBSTITUTES = {
    // i (Tonic)
    1: (param)=>{
        let { rootPc } = param;
        return [
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "m7"),
                reason: "Natural minor 7th",
                examples: [
                    "Stairway to Heaven",
                    "Smooth"
                ]
            },
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "m6"),
                reason: "Minor 6th for Dorian color",
                examples: [
                    "Scarborough Fair",
                    "So What"
                ]
            },
            {
                chord: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["mod12"])(rootPc + 3)),
                reason: "Relative major (bIII) shares notes",
                examples: [
                    "Stairway to Heaven",
                    "All Along the Watchtower"
                ]
            }
        ];
    },
    // iv (Subdominant)
    4: (param)=>{
        let { rootPc } = param;
        return [
            {
                chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "m7"),
                reason: "Minor 7th for subdominant color",
                examples: [
                    "Light My Fire",
                    "Losing My Religion"
                ]
            }
        ];
    },
    // v or V (Dominant)
    5: (param)=>{
        let { rootPc, quality } = param;
        if (quality === 'min') {
            return [
                {
                    chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "7"),
                    reason: "Raised 3rd (V7) for stronger resolution",
                    examples: [
                        "Stairway to Heaven",
                        "House of the Rising Sun"
                    ]
                }
            ];
        } else {
            return [
                {
                    chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "7"),
                    reason: "Dominant 7th for tension",
                    examples: [
                        "Smooth",
                        "Black Magic Woman"
                    ]
                }
            ];
        }
    }
};
/**
 * 汎用的な代理コード（度数が定義されていない場合）
 */ function getGenericSubstitutes(context) {
    const { rootPc, quality } = context;
    const subs = [];
    if (quality === 'maj') {
        subs.push({
            chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "maj7"),
            reason: "Added major 7th for richer sound"
        });
    } else if (quality === 'min') {
        subs.push({
            chord: "".concat((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["pcToName"])(rootPc), "m7"),
            reason: "Added minor 7th for jazz flavor"
        });
    }
    return subs;
}
function getSubstitutes(context) {
    const { degree, key } = context;
    const isMajorKey = key.mode === 'Major';
    // 辞書から適切なルールを取得
    const substitutesMap = isMajorKey ? MAJOR_KEY_SUBSTITUTES : MINOR_KEY_SUBSTITUTES;
    const rule = substitutesMap[degree];
    let substitutes;
    if (rule) {
        substitutes = rule(context);
    } else {
        // 定義されていない度数には汎用ルールを適用
        substitutes = getGenericSubstitutes(context);
    }
    // 最大3つまで
    return substitutes.slice(0, 3);
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/lib/music/chordParser.ts [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * コード記号のパースとMIDI音への変換
 */ __turbopack_context__.s([
    "chordToMidi",
    ()=>chordToMidi,
    "parseChordSymbol",
    ()=>parseChordSymbol
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-client] (ecmascript)");
;
function parseChordSymbol(symbol) {
    // ルート音とクオリティを分離
    const match = symbol.match(/^([A-G](?:#|b)?)(.*)$/);
    if (!match) return null;
    const root = match[1];
    const quality = (match[2] || '').toLowerCase();
    const rootPc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["nameToPc"])(root);
    if (rootPc < 0) return null;
    const intervals = getIntervalsForQuality(quality, symbol);
    return {
        rootPc,
        quality,
        intervals
    };
}
/**
 * クオリティ文字列からインターバルを取得
 */ function getIntervalsForQuality(quality, originalSymbol) {
    // 基本トライアド
    let base;
    // マイナーコードの判定（"m" があるが "maj" ではない）
    if (/(^|[^a-z])m(?!aj)/.test(quality)) {
        base = [
            0,
            3,
            7
        ]; // Minor
    } else if (/dim|°/.test(quality)) {
        return [
            0,
            3,
            6
        ]; // Diminished
    } else if (/aug|\+/.test(quality)) {
        return [
            0,
            4,
            8
        ]; // Augmented
    } else {
        base = [
            0,
            4,
            7
        ]; // Major (default)
    }
    // 7thコードの処理
    if (/maj7|M7/.test(originalSymbol)) {
        return [
            ...base,
            11
        ]; // Major 7th
    } else if (/7/.test(quality)) {
        return [
            ...base,
            10
        ]; // Dominant 7th
    }
    // 6thコードの処理
    if (/6/.test(quality)) {
        return [
            ...base.slice(0, 3),
            9
        ]; // 6th
    }
    // Suspendedコードの処理
    if (/sus4/.test(quality)) {
        return [
            0,
            5,
            7
        ]; // sus4
    } else if (/sus2/.test(quality)) {
        return [
            0,
            2,
            7
        ]; // sus2
    }
    // 9thコードの処理（簡易版）
    if (/9/.test(quality)) {
        return [
            ...base,
            10,
            14
        ]; // Add 9th (2 octaves up)
    }
    return base;
}
function chordToMidi(symbol) {
    let octave = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["DEFAULT_MIDI_OCTAVE"];
    const parsed = parseChordSymbol(symbol);
    if (!parsed) return null;
    const base = octave + parsed.rootPc;
    return parsed.intervals.map((interval)=>base + interval);
}
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/components/SubstituteCard.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "SubstituteCard",
    ()=>SubstituteCard,
    "default",
    ()=>__TURBOPACK__default__export__
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2f$substitute$2e$refactored$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/chords/substitute.refactored.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/audio/player.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/hooks/useRovingTabs.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$chordParser$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/chordParser.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
function SubstituteCard(param) {
    let { rootPc, quality, degree, keyContext, onAdd, page = 'find-chords' } = param;
    _s();
    const listRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"])(listRef, {
        orientation: "horizontal"
    });
    // コンテキストをメモ化
    const context = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "SubstituteCard.useMemo[context]": ()=>({
                rootPc,
                quality,
                degree,
                key: keyContext
            })
    }["SubstituteCard.useMemo[context]"], [
        rootPc,
        quality,
        degree,
        keyContext
    ]);
    // 代理コード候補を計算
    const substitutes = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "SubstituteCard.useMemo[substitutes]": ()=>{
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2f$substitute$2e$refactored$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getSubstitutes"])(context);
        }
    }["SubstituteCard.useMemo[substitutes]"], [
        context
    ]);
    // Telemetry: 表示時に1回だけ送信
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "SubstituteCard.useEffect": ()=>{
            if (substitutes.length > 0) {
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('substitute_shown', {
                    page,
                    rootPc,
                    quality,
                    degree,
                    count: substitutes.length
                });
            }
        }
    }["SubstituteCard.useEffect"], [
        substitutes,
        page,
        rootPc,
        quality,
        degree
    ]);
    // 試聴機能
    const playSubstitute = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "SubstituteCard.useCallback[playSubstitute]": async (sub)=>{
            try {
                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].resume();
                const midis = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$chordParser$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["chordToMidi"])(sub.chord);
                if (!midis || midis.length === 0) {
                    console.warn("Failed to parse chord: ".concat(sub.chord));
                    return;
                }
                __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["player"].playChord(midis, 'lightStrum', 300);
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('play_chord', {
                    page,
                    source: 'substitute_preview',
                    chord: sub.chord
                });
            } catch (error) {
                console.error('Failed to play substitute chord:', error);
            }
        }
    }["SubstituteCard.useCallback[playSubstitute]"], [
        page
    ]);
    // 追加機能
    const handleAdd = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "SubstituteCard.useCallback[handleAdd]": (sub)=>{
            if (onAdd) {
                onAdd(sub.chord);
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('substitute_add', {
                    page,
                    rootPc,
                    originalQuality: quality,
                    substituteChord: sub.chord
                });
            }
        }
    }["SubstituteCard.useCallback[handleAdd]"], [
        onAdd,
        page,
        rootPc,
        quality
    ]);
    // 代理コードがない場合は非表示
    if (substitutes.length === 0) {
        return null;
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("details", {
        className: "rounded border p-2 bg-background/40 mt-2",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("summary", {
                className: "text-sm cursor-pointer select-none font-medium",
                children: [
                    "Substitute Chords (",
                    substitutes.length,
                    ")"
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/SubstituteCard.tsx",
                lineNumber: 98,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "mt-2",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "text-xs opacity-70 mb-3 px-1",
                        children: "Alternative chords with similar harmonic function"
                    }, void 0, false, {
                        fileName: "[project]/src/components/SubstituteCard.tsx",
                        lineNumber: 102,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-2",
                        ref: listRef,
                        children: substitutes.map((sub, idx)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(SubstituteChordItem, {
                                substitute: sub,
                                onPlay: playSubstitute,
                                onAdd: onAdd ? handleAdd : undefined
                            }, "".concat(sub.chord, "-").concat(idx), false, {
                                fileName: "[project]/src/components/SubstituteCard.tsx",
                                lineNumber: 107,
                                columnNumber: 13
                            }, this))
                    }, void 0, false, {
                        fileName: "[project]/src/components/SubstituteCard.tsx",
                        lineNumber: 105,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/SubstituteCard.tsx",
                lineNumber: 101,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/SubstituteCard.tsx",
        lineNumber: 97,
        columnNumber: 5
    }, this);
}
_s(SubstituteCard, "rRjgXqgiQpDGtNVNAb6eomZB/2M=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"]
    ];
});
_c = SubstituteCard;
function SubstituteChordItem(param) {
    let { substitute, onPlay, onAdd } = param;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "rounded border p-2 bg-white dark:bg-neutral-900/50 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex items-start justify-between gap-2 mb-1",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex-1",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "font-medium text-base",
                                children: substitute.chord
                            }, void 0, false, {
                                fileName: "[project]/src/components/SubstituteCard.tsx",
                                lineNumber: 134,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "text-sm opacity-80 mt-0.5",
                                children: substitute.reason
                            }, void 0, false, {
                                fileName: "[project]/src/components/SubstituteCard.tsx",
                                lineNumber: 135,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/SubstituteCard.tsx",
                        lineNumber: 133,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center gap-1",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                onClick: ()=>onPlay(substitute),
                                className: "w-8 h-8 flex items-center justify-center rounded border hover:bg-black/5 dark:hover:bg-white/10 transition-colors",
                                "aria-label": "Preview ".concat(substitute.chord),
                                title: "Preview sound",
                                "data-roving": "item",
                                children: "▶"
                            }, void 0, false, {
                                fileName: "[project]/src/components/SubstituteCard.tsx",
                                lineNumber: 138,
                                columnNumber: 11
                            }, this),
                            onAdd && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                onClick: ()=>onAdd(substitute),
                                className: "px-2 py-1 text-xs rounded border bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300 hover:bg-emerald-100 dark:hover:bg-emerald-900/50 transition-colors",
                                "aria-label": "Add ".concat(substitute.chord, " to progression"),
                                title: "Add to progression",
                                children: "+ Add"
                            }, void 0, false, {
                                fileName: "[project]/src/components/SubstituteCard.tsx",
                                lineNumber: 149,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/SubstituteCard.tsx",
                        lineNumber: 137,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/SubstituteCard.tsx",
                lineNumber: 132,
                columnNumber: 7
            }, this),
            substitute.examples && substitute.examples.length > 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "text-xs opacity-60 mt-1 flex items-center gap-1",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                        className: "opacity-70",
                        children: "Examples:"
                    }, void 0, false, {
                        fileName: "[project]/src/components/SubstituteCard.tsx",
                        lineNumber: 163,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                        children: substitute.examples.join(' · ')
                    }, void 0, false, {
                        fileName: "[project]/src/components/SubstituteCard.tsx",
                        lineNumber: 164,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/SubstituteCard.tsx",
                lineNumber: 162,
                columnNumber: 9
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/SubstituteCard.tsx",
        lineNumber: 131,
        columnNumber: 5
    }, this);
}
_c1 = SubstituteChordItem;
const __TURBOPACK__default__export__ = SubstituteCard;
var _c, _c1;
__turbopack_context__.k.register(_c, "SubstituteCard");
__turbopack_context__.k.register(_c1, "SubstituteChordItem");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/src/app/find-chords/page.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>FindChordsPage
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$AdSlot$2e$client$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/AdSlot.client.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2d$theory$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music-theory.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$Fretboard$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/Fretboard.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$state$2f$overlay$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/state/overlay.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$DiatonicCapoTable$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/DiatonicCapoTable.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/hooks/useRovingTabs.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/InfoDot.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/store/analysisStore.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scaleCatalog.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ScaleTable$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ScaleTable.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ChordFormsPopover$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ChordFormsPopover.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chordForms$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/chordForms.ts [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$SubstituteCard$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/SubstituteCard.tsx [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
function FindChordsPage() {
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Suspense"], {
        fallback: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "ot-page",
            children: "Loading..."
        }, void 0, false, {
            fileName: "[project]/src/app/find-chords/page.tsx",
            lineNumber: 24,
            columnNumber: 25
        }, void 0),
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(FindChordsContent, {}, void 0, false, {
            fileName: "[project]/src/app/find-chords/page.tsx",
            lineNumber: 25,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/src/app/find-chords/page.tsx",
        lineNumber: 24,
        columnNumber: 5
    }, this);
}
_c = FindChordsPage;
function FindChordsContent() {
    _s();
    const params = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useSearchParams"])();
    const KEY_OPTIONS = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "FindChordsContent.useMemo[KEY_OPTIONS]": ()=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"]
    }["FindChordsContent.useMemo[KEY_OPTIONS]"], []);
    const UI_SCALES = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SCALE_CATALOG"]; // SSOT カタログ
    const [keyTonic, setKeyTonic] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(params.get('key') || 'C');
    const initialMode = params.get('mode') === 'minor' ? 'Aeolian' : 'Ionian';
    const [selScaleId, setSelScaleId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(initialMode);
    const isHept = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "FindChordsContent.useMemo[isHept]": ()=>{
            const def = UI_SCALES.find({
                "FindChordsContent.useMemo[isHept].def": (s)=>s.id === selScaleId
            }["FindChordsContent.useMemo[isHept].def"]);
            var _def_degrees_length;
            return ((_def_degrees_length = def === null || def === void 0 ? void 0 : def.degrees.length) !== null && _def_degrees_length !== void 0 ? _def_degrees_length : 7) === 7;
        }
    }["FindChordsContent.useMemo[isHept]"], [
        selScaleId
    ]);
    const diatonic = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "FindChordsContent.useMemo[diatonic]": ()=>{
            const sel = UI_SCALES.find({
                "FindChordsContent.useMemo[diatonic].sel": (s)=>s.id === selScaleId
            }["FindChordsContent.useMemo[diatonic].sel"]);
            const sevenNote = sel.degrees.length === 7;
            if (!sevenNote) return [];
            const quality = sel.id === 'Aeolian' ? 'minor' : 'major';
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2d$theory$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getDiatonicChordsFor"])({
                tonic: keyTonic,
                quality,
                scale: sel.id
            }).chords;
        }
    }["FindChordsContent.useMemo[diatonic]"], [
        keyTonic,
        selScaleId
    ]);
    const mode = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "FindChordsContent.useMemo[mode]": ()=>selScaleId === 'Aeolian' ? 'minor' : 'major'
    }["FindChordsContent.useMemo[mode]"], [
        selScaleId
    ]);
    const keyRowRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"])(keyRowRef, {
        orientation: "horizontal"
    });
    const fbToggleRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"])(fbToggleRef, {
        orientation: "horizontal"
    });
    const [display, setDisplay] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])('degrees');
    const [fbCapo, setFbCapo] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(0);
    const [overlayNotes, setOverlayNotes] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [previewScaleId, setPreviewScaleId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [selectedCellId, setSelectedCellId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [lastPickedPcs, setLastPickedPcs] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [formsPop, setFormsPop] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [formShape, setFormShape] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const resetForms = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "FindChordsContent.useCallback[resetForms]": ()=>{
            setFormsPop(null);
            setFormShape(null);
        }
    }["FindChordsContent.useCallback[resetForms]"], []);
    // Debug quick-check: ensure overlay wiring is correct
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "FindChordsContent.useEffect": ()=>{}
    }["FindChordsContent.useEffect"], [
        display,
        overlayNotes
    ]);
    const { selectKey } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useAnalysisStore"])();
    // auto-refresh; no manual "Show Chords" button
    const onPickKey = (k)=>{
        setKeyTonic(k);
        const q = selScaleId === 'Aeolian' ? 'minor' : 'major';
        const modeLabel = q === 'major' ? 'Major' : 'Minor';
        const tonicPc = KEY_OPTIONS.indexOf(k);
        selectKey({
            tonic: tonicPc,
            mode: modeLabel
        });
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('key_pick', {
            page: 'find-chords',
            key: k,
            mode: modeLabel
        });
        // local-only; store scale is not required here
        void refreshDiatonicAndOverlay();
    };
    const onPickScale = (id)=>{
        setSelScaleId(id);
        const tonicPc = KEY_OPTIONS.indexOf(keyTonic);
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('scale_pick', {
            page: 'find-chords',
            scale: id,
            key: keyTonic
        });
        void refreshDiatonicAndOverlay();
    };
    async function refreshDiatonicAndOverlay() {
        // Recompute store to refresh diatonic/capo table and set a base overlay
        const tonicPc = KEY_OPTIONS.indexOf(keyTonic);
        const uiScale = selScaleId === 'Aeolian' ? 'minor' : 'major';
        const modeLabel = uiScale === 'major' ? 'Major' : 'Minor';
        selectKey({
            tonic: tonicPc,
            mode: modeLabel
        });
        // local-only; store scale is not required here
        // base view: show only page scale; no chord overlay yet
        setOverlayNotes(null);
    }
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "FindChordsContent.useEffect": ()=>{
            // 初期表示でも現在のKey/Scaleに合わせてベースを反映
            void refreshDiatonicAndOverlay();
        // eslint-disable-next-line react-hooks/exhaustive-deps
        }
    }["FindChordsContent.useEffect"], []);
    const scaleRootPc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "FindChordsContent.useMemo[scaleRootPc]": ()=>KEY_OPTIONS.indexOf(keyTonic)
    }["FindChordsContent.useMemo[scaleRootPc]"], [
        keyTonic
    ]);
    const scaleTypeForUI = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useMemo"])({
        "FindChordsContent.useMemo[scaleTypeForUI]": ()=>selScaleId
    }["FindChordsContent.useMemo[scaleTypeForUI]"], [
        selScaleId
    ]);
    const scaleNotesForCurrentKey = ()=>{
        const pcs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getScalePitchesById"])(scaleRootPc, scaleTypeForUI);
        return pcs.map((pc)=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"][pc]);
    };
    // Reset overlay to current scale and clear selection
    const resetToScale = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "FindChordsContent.useCallback[resetToScale]": ()=>{
            setDisplay('degrees');
            setFbCapo(0);
            setOverlayNotes(null);
            setPreviewScaleId(null);
            setSelectedCellId(null);
            setLastPickedPcs(null);
            resetForms();
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('overlay_reset', {
                page: 'find-chords',
                scale: selScaleId,
                key: keyTonic
            });
        }
    }["FindChordsContent.useCallback[resetToScale]"], [
        scaleRootPc,
        scaleTypeForUI,
        resetForms
    ]);
    // Esc key to reset back to scale view
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "FindChordsContent.useEffect": ()=>{
            const h = {
                "FindChordsContent.useEffect.h": (e)=>{
                    if (e.key === 'Escape') resetToScale();
                }
            }["FindChordsContent.useEffect.h"];
            window.addEventListener('keydown', h);
            return ({
                "FindChordsContent.useEffect": ()=>window.removeEventListener('keydown', h)
            })["FindChordsContent.useEffect"];
        }
    }["FindChordsContent.useEffect"], [
        resetToScale
    ]);
    // ---- chord tone helper (minimal triad/7th) ----
    const P = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"];
    const idxNote = (n)=>P.indexOf(n);
    const shift = (n, semi)=>P[(idxNote(n) + semi + 120) % 12];
    function tonesFor(sym) {
        const m = (sym || '').trim().match(/^([A-G](?:#|b)?)(.*)$/);
        if (!m) return [];
        const root = m[1];
        const q = (m[2] || '').trim();
        let iv = [
            0,
            4,
            7
        ];
        if (/^m(?!aj)/.test(q)) iv = [
            0,
            3,
            7
        ];
        if (/dim|o/.test(q)) iv = [
            0,
            3,
            6
        ];
        if (/aug|\+/.test(q)) iv = [
            0,
            4,
            8
        ];
        if (/m7b5/.test(q)) iv = [
            0,
            3,
            6,
            10
        ];
        else if (/maj7|M7/.test(q)) iv = Array.from(new Set([
            ...iv,
            11
        ]));
        else if (/m7/.test(q)) iv = Array.from(new Set([
            ...iv,
            10
        ]));
        else if (/7/.test(q)) iv = Array.from(new Set([
            ...iv,
            10
        ]));
        return iv.map((semi)=>shift(root, semi));
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$state$2f$overlay$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["OverlayProvider"], {
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("main", {
            className: "ot-page ot-stack",
            "data-page": "find-chords",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                    className: "sr-only",
                    children: "Find Chords"
                }, void 0, false, {
                    fileName: "[project]/src/app/find-chords/page.tsx",
                    lineNumber: 157,
                    columnNumber: 7
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                    className: "ot-card",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                            className: "ot-h2",
                            children: "Select Key & Scale"
                        }, void 0, false, {
                            fileName: "[project]/src/app/find-chords/page.tsx",
                            lineNumber: 160,
                            columnNumber: 9
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mt-3 grid sm:grid-cols-2 gap-3",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                            className: "block text-sm mb-1",
                                            children: "Key"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 163,
                                            columnNumber: 11
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex flex-col gap-2",
                                            role: "tablist",
                                            "aria-label": "Select key",
                                            ref: keyRowRef,
                                            children: [
                                                [
                                                    "C",
                                                    "C#",
                                                    "D",
                                                    "Eb",
                                                    "E",
                                                    "F"
                                                ],
                                                [
                                                    "F#",
                                                    "G",
                                                    "Ab",
                                                    "A",
                                                    "Bb",
                                                    "B"
                                                ]
                                            ].map((row, ri)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    ref: ri === 0 ? keyRowRef : undefined,
                                                    className: "flex flex-wrap gap-2",
                                                    children: row.map((k)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            role: "tab",
                                                            "aria-selected": keyTonic === k,
                                                            tabIndex: keyTonic === k ? 0 : -1,
                                                            className: [
                                                                "chip",
                                                                "chip--key",
                                                                keyTonic === k ? "chip--active" : ""
                                                            ].join(" "),
                                                            "data-roving": "item",
                                                            onClick: ()=>{
                                                                onPickKey(k);
                                                            },
                                                            title: "Key ".concat(k),
                                                            children: k
                                                        }, k, false, {
                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                            lineNumber: 168,
                                                            columnNumber: 19
                                                        }, this))
                                                }, "krow-".concat(ri), false, {
                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                    lineNumber: 166,
                                                    columnNumber: 15
                                                }, this))
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 164,
                                            columnNumber: 11
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                    lineNumber: 162,
                                    columnNumber: 9
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                            htmlFor: "scale",
                                            className: "block text-sm mb-1",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    children: "Scale"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                    lineNumber: 185,
                                                    columnNumber: 13
                                                }, this),
                                                (()=>{
                                                    var _cur_info, _cur_info_examples, _cur_info1;
                                                    const cur = UI_SCALES.find((s)=>s.id === selScaleId);
                                                    const notesInC = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["getScalePitchesById"])(0, cur.id).map((pc)=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"][pc]).join(' ');
                                                    const defaultAbout = "".concat(cur.group, " scale — ").concat(cur.degrees.length, "-note pattern.");
                                                    var _cur_info_oneLiner;
                                                    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                                        title: cur.display.en,
                                                        className: "ml-2",
                                                        linkHref: "/resources/glossary",
                                                        linkLabel: "Glossary",
                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            className: "text-sm",
                                                            children: [
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "mb-1",
                                                                    children: [
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("b", {
                                                                            children: "Degrees:"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                                            lineNumber: 193,
                                                                            columnNumber: 43
                                                                        }, this),
                                                                        " ",
                                                                        cur.degrees.join(' ')
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                                    lineNumber: 193,
                                                                    columnNumber: 21
                                                                }, this),
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "mb-1",
                                                                    children: [
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("b", {
                                                                            children: "Notes in C:"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                                            lineNumber: 194,
                                                                            columnNumber: 43
                                                                        }, this),
                                                                        " ",
                                                                        notesInC
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                                    lineNumber: 194,
                                                                    columnNumber: 21
                                                                }, this),
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "mb-1",
                                                                    children: [
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("b", {
                                                                            children: "About:"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                                            lineNumber: 195,
                                                                            columnNumber: 43
                                                                        }, this),
                                                                        " ",
                                                                        (_cur_info_oneLiner = (_cur_info = cur.info) === null || _cur_info === void 0 ? void 0 : _cur_info.oneLiner) !== null && _cur_info_oneLiner !== void 0 ? _cur_info_oneLiner : defaultAbout
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                                    lineNumber: 195,
                                                                    columnNumber: 21
                                                                }, this),
                                                                !!((_cur_info1 = cur.info) === null || _cur_info1 === void 0 ? void 0 : (_cur_info_examples = _cur_info1.examples) === null || _cur_info_examples === void 0 ? void 0 : _cur_info_examples.length) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "mt-2",
                                                                    children: [
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("b", {
                                                                            className: "text-xs",
                                                                            children: "Song examples"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                                            lineNumber: 198,
                                                                            columnNumber: 25
                                                                        }, this),
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("ul", {
                                                                            className: "text-xs mt-1 space-y-1",
                                                                            children: cur.info.examples.map((e, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                                                    children: [
                                                                                        e.url ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("a", {
                                                                                            href: e.url,
                                                                                            target: "_blank",
                                                                                            rel: "noreferrer",
                                                                                            children: e.title
                                                                                        }, void 0, false, {
                                                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                                                            lineNumber: 202,
                                                                                            columnNumber: 40
                                                                                        }, this) : e.title,
                                                                                        e.artist ? " — ".concat(e.artist) : '',
                                                                                        e.cue ? " (".concat(e.cue, ")") : ''
                                                                                    ]
                                                                                }, i, true, {
                                                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                                                    lineNumber: 201,
                                                                                    columnNumber: 29
                                                                                }, this))
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                                            lineNumber: 199,
                                                                            columnNumber: 25
                                                                        }, this)
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                                    lineNumber: 197,
                                                                    columnNumber: 23
                                                                }, this)
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                            lineNumber: 192,
                                                            columnNumber: 19
                                                        }, this)
                                                    }, void 0, false, {
                                                        fileName: "[project]/src/app/find-chords/page.tsx",
                                                        lineNumber: 191,
                                                        columnNumber: 17
                                                    }, this);
                                                })()
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 184,
                                            columnNumber: 11
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("select", {
                                            id: "scale",
                                            name: "scale",
                                            className: "w-full rounded border px-3 py-2 text-sm bg-transparent",
                                            value: selScaleId,
                                            onChange: (e)=>onPickScale(e.target.value),
                                            children: UI_SCALES.map((s)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("option", {
                                                    value: s.id,
                                                    children: s.display.en
                                                }, s.id, false, {
                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                    lineNumber: 222,
                                                    columnNumber: 15
                                                }, this))
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 214,
                                            columnNumber: 11
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                    lineNumber: 183,
                                    columnNumber: 9
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/app/find-chords/page.tsx",
                            lineNumber: 161,
                            columnNumber: 9
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/app/find-chords/page.tsx",
                    lineNumber: 159,
                    columnNumber: 7
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                    className: "ot-card",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                            className: "ot-h2",
                            children: "Result"
                        }, void 0, false, {
                            fileName: "[project]/src/app/find-chords/page.tsx",
                            lineNumber: 230,
                            columnNumber: 9
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "ot-stack",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                            className: "ot-h3 flex items-center gap-2",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    children: "Diatonic"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                    lineNumber: 233,
                                                    columnNumber: 59
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                                    title: "Diatonic chords",
                                                    linkHref: "/resources/glossary",
                                                    linkLabel: "Glossary",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "text-sm",
                                                            children: "Chords built only from the key’s scale tones (I–ii–iii–IV–V–vi–vii°)."
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                            lineNumber: 235,
                                                            columnNumber: 17
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "text-sm mt-2",
                                                            children: "Capo rows show the shapes you fret. The sounding chord tones on the fretboard are the same as the Open row."
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                            lineNumber: 236,
                                                            columnNumber: 17
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "text-xs mt-1",
                                                            children: "See details in Reference → Capo & Shapes"
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                            lineNumber: 237,
                                                            columnNumber: 17
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                    lineNumber: 234,
                                                    columnNumber: 15
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 233,
                                            columnNumber: 13
                                        }, this),
                                        !isHept && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-xs text-foreground/70 mt-1",
                                            children: "This scale is not heptatonic; Roman numerals are hidden. Diatonic suggestions are limited to the Open row."
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 241,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            "data-testid": isHept ? undefined : "diatonic-open-only",
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$DiatonicCapoTable$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                                selectedId: selectedCellId,
                                                onSelectId: (id)=>{
                                                    // 再クリック（同じセル）は状態を変えない（プレビューはResetを使用）
                                                    if (selectedCellId === id) {
                                                        return;
                                                    }
                                                    setSelectedCellId(id);
                                                },
                                                onPick: (param)=>{
                                                    let { pcs } = param;
                                                    const mainNotes = pcs.map((pc)=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["PC_NAMES"][pc]);
                                                    setOverlayNotes(mainNotes);
                                                    setLastPickedPcs(pcs);
                                                    resetForms();
                                                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["track"])('diatonic_pick', {
                                                        page: 'find-chords',
                                                        id: selectedCellId,
                                                        scale: selScaleId,
                                                        key: keyTonic
                                                    });
                                                }
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/find-chords/page.tsx",
                                                lineNumber: 246,
                                                columnNumber: 13
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 245,
                                            columnNumber: 13
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                    lineNumber: 232,
                                    columnNumber: 11
                                }, this),
                                selectedCellId && lastPickedPcs && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-2",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ScaleTable$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                        chordQuality: detectQualityFromPcs(lastPickedPcs),
                                        rootPc: scaleRootPc,
                                        onPreviewScale: (id)=>{
                                            setPreviewScaleId(id);
                                        },
                                        onResetPreview: ()=>{
                                            setPreviewScaleId(null);
                                            resetToScale();
                                        },
                                        openGlossary: (id)=>{
                                            try {
                                                window.open('/resources/glossary', '_blank');
                                            } catch (e) {}
                                        },
                                        activeScaleId: previewScaleId
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/find-chords/page.tsx",
                                        lineNumber: 262,
                                        columnNumber: 15
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                    lineNumber: 261,
                                    columnNumber: 13
                                }, this),
                                selectedCellId && lastPickedPcs && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$SubstituteCard$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                    rootPc: scaleRootPc,
                                    quality: detectQualityFromPcs(lastPickedPcs),
                                    degree: (()=>{
                                        // セルIDから度数を取得 (例: "open-0" → 1, "open-1" → 2)
                                        const parts = selectedCellId.split('-');
                                        return parseInt(parts[1] || '0', 10) + 1;
                                    })(),
                                    keyContext: {
                                        tonic: KEY_OPTIONS.indexOf(keyTonic),
                                        mode: selScaleId === 'Aeolian' ? 'Minor' : 'Major'
                                    },
                                    page: "find-chords"
                                }, void 0, false, {
                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                    lineNumber: 274,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                            className: "ot-h3 flex items-center justify-between",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    children: "Fretboard"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                    lineNumber: 291,
                                                    columnNumber: 15
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    ref: fbToggleRef,
                                                    className: "flex items-center gap-2",
                                                    role: "tablist",
                                                    "aria-orientation": "horizontal",
                                                    "aria-label": "Fretboard notation",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            role: "tab",
                                                            "aria-selected": display === 'degrees',
                                                            tabIndex: display === 'degrees' ? 0 : -1,
                                                            className: [
                                                                "chip",
                                                                display === 'degrees' ? "chip--on" : ""
                                                            ].join(" "),
                                                            "data-roving": "item",
                                                            onClick: ()=>{
                                                                resetForms();
                                                                setDisplay('degrees');
                                                            },
                                                            children: "Degrees"
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                            lineNumber: 293,
                                                            columnNumber: 15
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            role: "tab",
                                                            "aria-selected": display === 'names',
                                                            tabIndex: display === 'names' ? 0 : -1,
                                                            className: [
                                                                "chip",
                                                                display === 'names' ? "chip--on" : ""
                                                            ].join(" "),
                                                            "data-roving": "item",
                                                            onClick: ()=>{
                                                                resetForms();
                                                                setDisplay('names');
                                                            },
                                                            children: "Names"
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                            lineNumber: 294,
                                                            columnNumber: 15
                                                        }, this),
                                                        selectedCellId && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            role: "tab",
                                                            "aria-selected": false,
                                                            tabIndex: -1,
                                                            className: "chip",
                                                            onClick: resetToScale,
                                                            "aria-label": "Reset",
                                                            children: "Reset"
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                                            lineNumber: 296,
                                                            columnNumber: 17
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                                    lineNumber: 292,
                                                    columnNumber: 15
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 290,
                                            columnNumber: 13
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$Fretboard$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                            overlay: {
                                                viewMode: 'sounding',
                                                capo: fbCapo,
                                                display: display,
                                                scaleRootPc: scaleRootPc,
                                                scaleType: previewScaleId !== null && previewScaleId !== void 0 ? previewScaleId : scaleTypeForUI,
                                                showScaleGhost: Boolean(selectedCellId),
                                                chordNotes: overlayNotes !== null && overlayNotes !== void 0 ? overlayNotes : undefined,
                                                context: {
                                                    chordRootPc: lastPickedPcs && lastPickedPcs.length ? lastPickedPcs[0] : undefined,
                                                    quality: (()=>{
                                                        const pcs = lastPickedPcs !== null && lastPickedPcs !== void 0 ? lastPickedPcs : [];
                                                        const q = detectQualityFromPcs(pcs.length ? pcs : [
                                                            scaleRootPc
                                                        ]);
                                                        return q === 'min' ? 'min' : 'maj';
                                                    })()
                                                }
                                            },
                                            onRequestForms: (at, ctx)=>{
                                                setFormsPop({
                                                    at,
                                                    rootPc: ctx.rootPc,
                                                    quality: ctx.quality
                                                });
                                            },
                                            formShape: formShape
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/find-chords/page.tsx",
                                            lineNumber: 300,
                                            columnNumber: 13
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/find-chords/page.tsx",
                                    lineNumber: 289,
                                    columnNumber: 11
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/app/find-chords/page.tsx",
                            lineNumber: 231,
                            columnNumber: 9
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/app/find-chords/page.tsx",
                    lineNumber: 229,
                    columnNumber: 7
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                    className: "ot-card ad-placeholder",
                    "aria-label": "Ad",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$AdSlot$2e$client$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                        page: "find_chords",
                        format: "horizontal"
                    }, void 0, false, {
                        fileName: "[project]/src/app/find-chords/page.tsx",
                        lineNumber: 329,
                        columnNumber: 9
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/src/app/find-chords/page.tsx",
                    lineNumber: 328,
                    columnNumber: 7
                }, this),
                formsPop && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ChordFormsPopover$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["ChordFormsPopover"], {
                    at: formsPop.at,
                    quality: formsPop.quality,
                    rootPc: formsPop.rootPc,
                    page: "find-chords",
                    onPick: (kind)=>{
                        const shape = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chordForms$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["buildForm"])(kind, formsPop.quality, formsPop.rootPc);
                        setFormShape(shape);
                    },
                    onClose: ()=>setFormsPop(null)
                }, void 0, false, {
                    fileName: "[project]/src/app/find-chords/page.tsx",
                    lineNumber: 332,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/src/app/find-chords/page.tsx",
            lineNumber: 156,
            columnNumber: 5
        }, this)
    }, void 0, false, {
        fileName: "[project]/src/app/find-chords/page.tsx",
        lineNumber: 155,
        columnNumber: 5
    }, this);
}
_s(FindChordsContent, "BoNsCFwc6jSXGZ7xjt6Y4zDWxTI=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useSearchParams"],
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"],
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRovingTabs"],
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useAnalysisStore"]
    ];
});
_c1 = FindChordsContent;
// --- helpers ---
function detectQualityFromPcs(pcs) {
    const set = new Set(pcs.map((x)=>(x - pcs[0] + 12) % 12));
    // simple triad/7th checks (relative to first pc as root)
    if (set.has(0) && set.has(4) && set.has(7)) return 'maj';
    if (set.has(0) && set.has(3) && set.has(7)) return 'min';
    if (set.has(0) && set.has(3) && set.has(6)) return 'dim';
    if (set.has(0) && set.has(4) && set.has(7) && set.has(10)) return 'dom7';
    if (set.has(0) && set.has(3) && set.has(6) && set.has(10)) return 'm7b5';
    return 'maj';
}
var _c, _c1;
__turbopack_context__.k.register(_c, "FindChordsPage");
__turbopack_context__.k.register(_c1, "FindChordsContent");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
]);

//# sourceMappingURL=src_98485911._.js.map