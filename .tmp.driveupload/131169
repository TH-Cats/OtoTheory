{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/lib/i18n/messages.ts"],"sourcesContent":["export const messages = {\n  en: {\n    nav: {\n      chordProgression: 'Chord Progression',\n      findChords: '„Ç≥„Éº„Éâ„ÇíÊé¢„Åô',\n      chordLibrary: '„Ç≥„Éº„ÉâËæûÂÖ∏',\n      resources: 'Resources',\n    },\n    actions: { analyze: 'Analyze' },\n    chordLibrary: {\n      title: 'Chord Library',\n      sub: '',\n      quality: '„Ç≥„Éº„Éâ„Çø„Ç§„Éó:',\n      showAdvanced: 'Show Advanced',\n      hideAdvanced: 'Hide Advanced',\n      display: 'Display:',\n      finger: 'Finger',\n      roman: 'Intervals',\n      note: 'Note',\n      tip: 'Tip: Forms with √ó on 1st or 6th string should not be strummed there, or lightly muted with your fretting hand.',\n      // UX simplified: value props & help\n      benefits: [\n        'Chord forms that inspire composition and arranging',\n        'Visual learning: see chord tones/intervals at a glance',\n        'Try fast: play/arp with one click',\n      ],\n      // Interactive cards for detailed explanations\n      cards: [\n        {\n          title: 'üéØ How to Use',\n          description: 'Simply select a root note and chord type to display various chord forms. Switch between detailed information using \"Finger\", \"Intervals\", and \"Note Names\" buttons.',\n        },\n        {\n          title: 'üéµ Practical Chord Forms',\n          description: 'Carefully selected forms useful for composition and arranging, including open chords, 6/5/4 string roots, and triads (high/mid range). Quickly compare forms that fit your song\\'s flow.',\n        },\n        {\n          title: 'üëÅÔ∏è Visualization & Audio Preview',\n          description: 'Shows chord tones and intervals in the top-left. Visualize on the fretboard using \"Intervals\" and \"Note Names\" buttons. Preview audio with Play/Arp and save to chord progression slots with right-click.',\n        },\n      ],\n      tryNow: '',\n      detailsSummary: 'Open details (How to use ¬∑ Visuals ¬∑ More)',\n      info: {\n        fingerHelp: '1 Index, 2 Middle, 3 Ring, 4 Pinky, T Thumb',\n        romanHelp: 'Intervals view (Root=1, Major 3rd=3, Minor 7th=b7, etc.)',\n        noteHelp: 'Shows actual note names on the fretboard',\n      },\n      details: {\n        how: {\n          title: 'How to Use',\n          bullets: [\n            'Select a root and a quality',\n            'Use buttons to show Finger / Intervals / Note names',\n          ],\n        },\n        forms: {\n          title: 'Practical Forms',\n          bullets: [\n            'Open, root on 6/5/4 strings, Triad (upper/middle)',\n            'Quickly compare forms that fit your song',\n          ],\n        },\n        visual: {\n          title: 'Visual Learning',\n          bullets: [\n            'Chord tones and intervals shown at top-left',\n            'Use Intervals/Note Names to visualize on fretboard',\n          ],\n        },\n        more: {\n          title: 'More',\n          bullets: [\n            'Play/Arp to hear voicing; right-click to add to progression slots',\n          ],\n        },\n      },\n    },\n    chordBuilder: {\n      proOnlyToast: 'Pro only: This chord type can\\'t be added. Get iOS Pro for unlimited + MIDI.',\n      proOnlyToastCta: 'Get Pro',\n      eleventhWarning: '11 clashes with the 3rd on maj/dom. Consider #11 or sus4.',\n    },\n  },\n  ja: {\n    nav: {\n      chordProgression: '„Ç≥„Éº„ÉâÈÄ≤Ë°å',\n      findChords: '„Ç≥„Éº„Éâ„ÇíÊé¢„Åô',\n      chordLibrary: '„Ç≥„Éº„ÉâËæûÂÖ∏',\n      resources: 'ÂèÇËÄÉ',\n    },\n    actions: { analyze: 'ÂàÜÊûê' },\n    chordLibrary: {\n      title: 'Chord Library',\n      sub: '',\n      quality: '„Ç≥„Éº„Éâ„Çø„Ç§„Éó:',\n      showAdvanced: 'È´òÂ∫¶„Å™„Éï„Ç©„Éº„É†„ÇíË°®Á§∫',\n      hideAdvanced: 'È´òÂ∫¶„Å™„Éï„Ç©„Éº„É†„ÇíÈö†„Åô',\n      display: 'Ë°®Á§∫:',\n      finger: 'ÊåáÁï™Âè∑',\n      roman: 'Â∫¶Êï∞',\n      note: 'Èü≥Âêç',\n      tip: '„Éí„É≥„ÉàÔºö1Âº¶„Åæ„Åü„ÅØ6Âº¶„Å´√ó„Åå‰ªò„Åè„Éï„Ç©„Éº„É†„ÅØ„ÄÅ„Åù„ÅÆÂº¶„ÇíÂºæ„Åã„Å™„ÅÑ„Åã„ÄÅÂ∑¶Êâã„ÅßËªΩ„Åè„Éü„É•„Éº„Éà„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',\n      // UXÁ∞°Á¥†Âåñ: ‰æ°ÂÄ§Ë®¥Ê±Ç„Å®„Éò„É´„Éó\n      benefits: [\n        '‰ΩúÊõ≤„ÇÑ„Ç¢„É¨„É≥„Ç∏„ÅÆ„Éí„É≥„Éà„Å´„Å™„Çã„Éï„Ç©„Éº„É†„ÇíÁ¥π‰ªã',\n        'Ë¶ñË¶ö„ÅßÁêÜËß£: ÊßãÊàêÈü≥/Â∫¶Êï∞„Çí‰∏ÄÁõÆ„ÅßÁ¢∫Ë™ç',\n        '„Åô„ÅêË©¶„Åõ„Çã: „ÉØ„É≥„ÇØ„É™„ÉÉ„ÇØ„ÅßÂÜçÁîü„Éª„Ç¢„É´„Éö„Ç∏„Ç™',\n      ],\n      // „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Ç´„Éº„ÉâÔºàË©≥Á¥∞Ë™¨ÊòéÁî®Ôºâ\n      cards: [\n        {\n          title: 'üéØ ‰Ωø„ÅÑÊñπ',\n          description: '„É´„Éº„ÉàÈü≥„Å®„Ç≥„Éº„Éâ„Çø„Ç§„Éó„ÇíÈÅ∏Êäû„Åô„Çã„Å†„Åë„Åß„ÄÅÊßò„ÄÖ„Å™„Ç≥„Éº„Éâ„Éï„Ç©„Éº„É†„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ„ÄåÊåá„Äç„ÄåÂ∫¶Êï∞„Äç„ÄåÈü≥Âêç„Äç„Éú„Çø„É≥„ÅßË©≥Á¥∞ÊÉÖÂ†±„ÇíÂàá„ÇäÊõø„Åà„Çâ„Çå„Åæ„Åô„ÄÇ',\n        },\n        {\n          title: 'üéµ ÂÆüÁî®ÁöÑ„Å™„Ç≥„Éº„Éâ„Éï„Ç©„Éº„É†',\n          description: '„Ç™„Éº„Éó„É≥„Ç≥„Éº„Éâ„ÄÅ6/5/4Âº¶„É´„Éº„Éà„ÄÅ„Éà„É©„Ç§„Ç¢„ÉâÔºàÈ´ò/‰∏≠ÂüüÔºâ„Å™„Å©„ÄÅ‰ΩúÊõ≤„ÇÑ„Ç¢„É¨„É≥„Ç∏„Å´ÂΩπÁ´ã„Å§„Éï„Ç©„Éº„É†„ÇíÂé≥ÈÅ∏„ÄÇÊõ≤„ÅÆÊµÅ„Çå„Å´Âêà„ÅÜ„Éï„Ç©„Éº„É†„ÇíÁ¥†Êó©„ÅèÊØîËºÉ„Åß„Åç„Åæ„Åô„ÄÇ',\n        },\n        {\n          title: 'üëÅÔ∏è Ë¶ñË¶öÂåñ„Å®Èü≥„ÅÆÁ¢∫Ë™ç',\n          description: 'Â∑¶‰∏ä„Å´ÊßãÊàêÈü≥„Å®Â∫¶Êï∞„ÇíË°®Á§∫„ÄÇ„ÄåÂ∫¶Êï∞„Äç„ÄåÈü≥Âêç„Äç„Éú„Çø„É≥„Åß„Éï„É¨„ÉÉ„Éà‰∏ä„Å´ÂèØË¶ñÂåñ„Åß„Åç„Åæ„Åô„ÄÇPlay/Arp„ÅßÈü≥„ÇíÁ¢∫Ë™ç„Åó„ÄÅÂè≥„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç≥„Éº„ÉâÈÄ≤Ë°å„Çπ„É≠„ÉÉ„Éà„Å∏‰øùÂ≠ò„Åß„Åç„Åæ„Åô„ÄÇ',\n        },\n      ],\n      tryNow: '',\n      detailsSummary: 'Ë©≥„Åó„ÅÑË™¨Êòé„ÇíÈñã„ÅèÔºà‰Ωø„ÅÑÊñπ„ÉªË¶ñË¶öÂåñ„Éª„Åù„ÅÆ‰ªñÔºâ',\n      info: {\n        fingerHelp: '‚ë†‰∫∫Â∑Æ„ÅóÊåá ‚ë°‰∏≠Êåá ‚ë¢Ëñ¨Êåá ‚ë£Â∞èÊåá TË¶™Êåá',\n        romanHelp: 'Â∫¶Êï∞Ë°®Á§∫Ôºà„É´„Éº„Éà=1„ÄÅÈï∑3Â∫¶=3„ÄÅÁü≠7Â∫¶=b7 „Å™„Å©Ôºâ',\n        noteHelp: '„Éï„É¨„ÉÉ„Éà„Éú„Éº„Éâ‰∏ä„ÅÆÂÆüÈöõ„ÅÆÈü≥Âêç„ÇíË°®Á§∫„Åó„Åæ„Åô',\n      },\n      details: {\n        how: {\n          title: '‰Ωø„ÅÑÊñπ',\n          bullets: [\n            '„É´„Éº„ÉàÈü≥„Å®„Ç≥„Éº„Éâ„Çø„Ç§„Éó„ÇíÈÅ∏„Å∂„Å†„Åë',\n            'Êåá/Â∫¶Êï∞/Èü≥Âêç„ÅØ„Éú„Çø„É≥„ÅßÁ¢∫Ë™ç',\n          ],\n        },\n        forms: {\n          title: 'ÂÆüÁî®„Éï„Ç©„Éº„É†',\n          bullets: [\n            '„Ç™„Éº„Éó„É≥„ÄÅ6/5/4Âº¶„É´„Éº„Éà„ÄÅ„Éà„É©„Ç§„Ç¢„ÉâÔºàÈ´ò/‰∏≠ÂüüÔºâ„ÇíË°®Á§∫',\n            'Êõ≤„ÅÆÊµÅ„Çå„Å´Âêà„ÅÜ„Éï„Ç©„Éº„É†„ÇíÁ¥†Êó©„ÅèÊØîËºÉ„Åß„Åç„Åæ„Åô',\n          ],\n        },\n        visual: {\n          title: 'Ë¶ñË¶öÁöÑ„Å´ÁêÜËß£',\n          bullets: [\n            'Â∑¶‰∏ä„Å´ÊßãÊàêÈü≥„Å®Â∫¶Êï∞„ÇíË°®Á§∫',\n            '„ÄåÂ∫¶Êï∞„Äç„ÄåÈü≥Âêç„Äç„Éú„Çø„É≥„Åß„Éï„É¨„ÉÉ„Éà‰∏ä„Å´ÂèØË¶ñÂåñ',\n          ],\n        },\n        more: {\n          title: '„Åù„ÅÆ‰ªñ',\n          bullets: [\n            'Play/Arp„ÅßÈü≥„ÇíÁ¢∫Ë™ç„ÄÅÂè≥„ÇØ„É™„ÉÉ„ÇØ„ÅßÈÄ≤Ë°å„Çπ„É≠„ÉÉ„Éà„Å∏‰øùÂ≠ò',\n          ],\n        },\n      },\n    },\n    chordBuilder: {\n      proOnlyToast: 'ProÂ∞ÇÁî®Ôºö„Åì„ÅÆ„Ç≥„Éº„Éâ„Çø„Ç§„Éó„ÅØËøΩÂä†„Åß„Åç„Åæ„Åõ„Çì„ÄÇiOS Pro„ÅßÁÑ°Âà∂ÈôêÔºãMIDIÂá∫Âäõ„ÄÇ',\n      proOnlyToastCta: 'Pro„ÇíÂÖ•Êâã',\n      eleventhWarning: '11„ÅØmaj/dom„Åß„ÅØ3rd„Å®Ë°ùÁ™Å„Åó„Åå„Å°„ÄÇ#11„Åæ„Åü„ÅØsus4„ÇíÊ§úË®é',\n    },\n  },\n} as const;\n\nexport type Locale = keyof typeof messages;\n\n"],"names":[],"mappings":";;;;AAAO,MAAM,WAAW;IACtB,IAAI;QACF,KAAK;YACH,kBAAkB;YAClB,YAAY;YACZ,cAAc;YACd,WAAW;QACb;QACA,SAAS;YAAE,SAAS;QAAU;QAC9B,cAAc;YACZ,OAAO;YACP,KAAK;YACL,SAAS;YACT,cAAc;YACd,cAAc;YACd,SAAS;YACT,QAAQ;YACR,OAAO;YACP,MAAM;YACN,KAAK;YACL,oCAAoC;YACpC,UAAU;gBACR;gBACA;gBACA;aACD;YACD,8CAA8C;YAC9C,OAAO;gBACL;oBACE,OAAO;oBACP,aAAa;gBACf;gBACA;oBACE,OAAO;oBACP,aAAa;gBACf;gBACA;oBACE,OAAO;oBACP,aAAa;gBACf;aACD;YACD,QAAQ;YACR,gBAAgB;YAChB,MAAM;gBACJ,YAAY;gBACZ,WAAW;gBACX,UAAU;YACZ;YACA,SAAS;gBACP,KAAK;oBACH,OAAO;oBACP,SAAS;wBACP;wBACA;qBACD;gBACH;gBACA,OAAO;oBACL,OAAO;oBACP,SAAS;wBACP;wBACA;qBACD;gBACH;gBACA,QAAQ;oBACN,OAAO;oBACP,SAAS;wBACP;wBACA;qBACD;gBACH;gBACA,MAAM;oBACJ,OAAO;oBACP,SAAS;wBACP;qBACD;gBACH;YACF;QACF;QACA,cAAc;YACZ,cAAc;YACd,iBAAiB;YACjB,iBAAiB;QACnB;IACF;IACA,IAAI;QACF,KAAK;YACH,kBAAkB;YAClB,YAAY;YACZ,cAAc;YACd,WAAW;QACb;QACA,SAAS;YAAE,SAAS;QAAK;QACzB,cAAc;YACZ,OAAO;YACP,KAAK;YACL,SAAS;YACT,cAAc;YACd,cAAc;YACd,SAAS;YACT,QAAQ;YACR,OAAO;YACP,MAAM;YACN,KAAK;YACL,kBAAkB;YAClB,UAAU;gBACR;gBACA;gBACA;aACD;YACD,qBAAqB;YACrB,OAAO;gBACL;oBACE,OAAO;oBACP,aAAa;gBACf;gBACA;oBACE,OAAO;oBACP,aAAa;gBACf;gBACA;oBACE,OAAO;oBACP,aAAa;gBACf;aACD;YACD,QAAQ;YACR,gBAAgB;YAChB,MAAM;gBACJ,YAAY;gBACZ,WAAW;gBACX,UAAU;YACZ;YACA,SAAS;gBACP,KAAK;oBACH,OAAO;oBACP,SAAS;wBACP;wBACA;qBACD;gBACH;gBACA,OAAO;oBACL,OAAO;oBACP,SAAS;wBACP;wBACA;qBACD;gBACH;gBACA,QAAQ;oBACN,OAAO;oBACP,SAAS;wBACP;wBACA;qBACD;gBACH;gBACA,MAAM;oBACJ,OAAO;oBACP,SAAS;wBACP;qBACD;gBACH;YACF;QACF;QACA,cAAc;YACZ,cAAc;YACd,iBAAiB;YACjB,iBAAiB;QACnB;IACF;AACF","debugId":null}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/Nav.tsx"],"sourcesContent":["\"use client\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { messages, type Locale } from \"@/lib/i18n/messages\";\n\nexport default function Nav() {\n  const pathname = usePathname();\n  // M3.5: Analyze (Èå≤Èü≥) „É°„Éã„É•„ÉºÊí§Âéª\n  const isJa = pathname?.startsWith('/ja');\n  const base = isJa ? '/ja' : '';\n  const locale: Locale = isJa ? 'ja' : 'en';\n  const t = messages[locale];\n  const links = [\n    { href: `${base}/chord-progression`, label: t.nav.chordProgression, aria: \"Build Chord Progressions\" },\n    { href: `${base}/find-chords`, label: t.nav.findChords, aria: \"Find Chord\" },\n    { href: `${base}/chord-library`, label: t.nav.chordLibrary, aria: \"Chord Library\" },\n    { href: `${base}/resources`, label: t.nav.resources, aria: \"Resources\" },\n  ];\n  const isActive = (href: string) => pathname?.startsWith(href);\n\n  return (\n    <nav className=\"hidden sm:flex text-sm ml-6 sm:ml-14 md:ml-20 gap-5 sm:gap-10\">\n      {links.map((l) => (\n        <div key={l.href} className=\"relative\">\n          <Link prefetch href={l.href} aria-label={l.aria} className=\"hover:underline whitespace-pre md:whitespace-nowrap\">\n            {l.href === `${base}/chord-progression` ? (\n              <>\n                <span className=\"block leading-none md:inline\">{isJa ? '„Ç≥„Éº„Éâ' : 'Chord'} </span>\n                <span className=\"block leading-tight md:inline\">{isJa ? 'ÈÄ≤Ë°å' : 'Progression'}</span>\n              </>\n            ) : l.href === `${base}/find-chords` ? (\n              <>\n                <span className=\"block leading-none md:inline\">{isJa ? '„Ç≥„Éº„Éâ„Çí' : 'Find '}</span>\n                <span className=\"block leading-tight md:inline\">{isJa ? 'Êé¢„Åô' : 'Chords'}</span>\n              </>\n            ) : l.href === `${base}/chord-library` ? (\n              <>\n                <span className=\"block leading-none md:inline\">{isJa ? '„Ç≥„Éº„Éâ' : 'Chord '}</span>\n                <span className=\"block leading-tight md:inline\">{isJa ? 'ËæûÂÖ∏' : 'Library'}</span>\n              </>\n            ) : (\n              l.label\n            )}\n          </Link>\n          {isActive(l.href) ? (\n            <span className=\"absolute left-1/2 -translate-x-1/2 -bottom-2 w-1.5 h-1.5 rounded-full bg-[var(--brand-primary)]\" />\n          ) : null}\n        </div>\n      ))}\n    </nav>\n  );\n}\n\n\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;AAHA;;;;AAKe,SAAS;;IACtB,MAAM,WAAW,IAAA,oJAAW;IAC5B,4BAA4B;IAC5B,MAAM,OAAO,qBAAA,+BAAA,SAAU,UAAU,CAAC;IAClC,MAAM,OAAO,OAAO,QAAQ;IAC5B,MAAM,SAAiB,OAAO,OAAO;IACrC,MAAM,IAAI,6IAAQ,CAAC,OAAO;IAC1B,MAAM,QAAQ;QACZ;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAqB,OAAO,EAAE,GAAG,CAAC,gBAAgB;YAAE,MAAM;QAA2B;QACrG;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAe,OAAO,EAAE,GAAG,CAAC,UAAU;YAAE,MAAM;QAAa;QAC3E;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAiB,OAAO,EAAE,GAAG,CAAC,YAAY;YAAE,MAAM;QAAgB;QAClF;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAa,OAAO,EAAE,GAAG,CAAC,SAAS;YAAE,MAAM;QAAY;KACxE;IACD,MAAM,WAAW,CAAC,OAAiB,qBAAA,+BAAA,SAAU,UAAU,CAAC;IAExD,qBACE,6LAAC;QAAI,WAAU;kBACZ,MAAM,GAAG,CAAC,CAAC,kBACV,6LAAC;gBAAiB,WAAU;;kCAC1B,6LAAC,0KAAI;wBAAC,QAAQ;wBAAC,MAAM,EAAE,IAAI;wBAAE,cAAY,EAAE,IAAI;wBAAE,WAAU;kCACxD,EAAE,IAAI,KAAK,AAAC,GAAO,OAAL,MAAK,sCAClB;;8CACE,6LAAC;oCAAK,WAAU;;wCAAgC,OAAO,QAAQ;wCAAQ;;;;;;;8CACvE,6LAAC;oCAAK,WAAU;8CAAiC,OAAO,OAAO;;;;;;;2CAE/D,EAAE,IAAI,KAAK,AAAC,GAAO,OAAL,MAAK,gCACrB;;8CACE,6LAAC;oCAAK,WAAU;8CAAgC,OAAO,SAAS;;;;;;8CAChE,6LAAC;oCAAK,WAAU;8CAAiC,OAAO,OAAO;;;;;;;2CAE/D,EAAE,IAAI,KAAK,AAAC,GAAO,OAAL,MAAK,kCACrB;;8CACE,6LAAC;oCAAK,WAAU;8CAAgC,OAAO,QAAQ;;;;;;8CAC/D,6LAAC;oCAAK,WAAU;8CAAiC,OAAO,OAAO;;;;;;;2CAGjE,EAAE,KAAK;;;;;;oBAGV,SAAS,EAAE,IAAI,kBACd,6LAAC;wBAAK,WAAU;;;;;+BACd;;eAvBI,EAAE,IAAI;;;;;;;;;;AA4BxB;GA9CwB;;QACL,oJAAW;;;KADN","debugId":null}},
    {"offset": {"line": 342, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/MobileNav.tsx"],"sourcesContent":["\"use client\";\nimport { useState } from \"react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { messages, type Locale } from \"@/lib/i18n/messages\";\nimport { Bars3Icon, XMarkIcon } from \"@heroicons/react/24/outline\";\n\nexport default function MobileNav() {\n  const [isOpen, setIsOpen] = useState(false);\n  const pathname = usePathname();\n  const isJa = pathname?.startsWith('/ja');\n  const base = isJa ? '/ja' : '';\n  const locale: Locale = isJa ? 'ja' : 'en';\n  const t = messages[locale];\n  \n  const links = [\n    { href: `${base}/chord-progression`, label: t.nav.chordProgression, aria: \"Build Chord Progressions\" },\n    { href: `${base}/find-chords`, label: t.nav.findChords, aria: \"Find Chord\" },\n    { href: `${base}/chord-library`, label: t.nav.chordLibrary, aria: \"Chord Library\" },\n    { href: `${base}/resources`, label: t.nav.resources, aria: \"Resources\" },\n  ];\n  \n  const isActive = (href: string) => pathname?.startsWith(href);\n\n  return (\n    <>\n      {/* Mobile menu button */}\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"sm:hidden p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100\"\n        aria-label=\"Toggle navigation menu\"\n      >\n        {isOpen ? (\n          <XMarkIcon className=\"h-6 w-6\" />\n        ) : (\n          <Bars3Icon className=\"h-6 w-6\" />\n        )}\n      </button>\n\n      {/* Mobile menu overlay */}\n      {isOpen && (\n        <div className=\"fixed inset-0 z-50 sm:hidden\">\n          <div className=\"fixed inset-0 bg-black bg-opacity-50\" onClick={() => setIsOpen(false)} />\n          <div className=\"fixed top-0 right-0 h-full w-64 bg-white dark:bg-gray-900 shadow-xl\">\n            <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Menu</h2>\n              <button\n                onClick={() => setIsOpen(false)}\n                className=\"p-2 rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100\"\n                aria-label=\"Close navigation menu\"\n              >\n                <XMarkIcon className=\"h-6 w-6\" />\n              </button>\n            </div>\n            <nav className=\"p-4 space-y-4\">\n              {links.map((l) => (\n                <Link\n                  key={l.href}\n                  href={l.href}\n                  onClick={() => setIsOpen(false)}\n                  className={`block px-3 py-2 rounded-md text-base font-medium transition-colors ${\n                    isActive(l.href)\n                      ? 'bg-[var(--brand-primary)] text-white'\n                      : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'\n                  }`}\n                  aria-label={l.aria}\n                >\n                  {l.label}\n                </Link>\n              ))}\n            </nav>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AAAA;;;AALA;;;;;;AAOe,SAAS;;IACtB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,WAAW,IAAA,oJAAW;IAC5B,MAAM,OAAO,qBAAA,+BAAA,SAAU,UAAU,CAAC;IAClC,MAAM,OAAO,OAAO,QAAQ;IAC5B,MAAM,SAAiB,OAAO,OAAO;IACrC,MAAM,IAAI,6IAAQ,CAAC,OAAO;IAE1B,MAAM,QAAQ;QACZ;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAqB,OAAO,EAAE,GAAG,CAAC,gBAAgB;YAAE,MAAM;QAA2B;QACrG;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAe,OAAO,EAAE,GAAG,CAAC,UAAU;YAAE,MAAM;QAAa;QAC3E;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAiB,OAAO,EAAE,GAAG,CAAC,YAAY;YAAE,MAAM;QAAgB;QAClF;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAa,OAAO,EAAE,GAAG,CAAC,SAAS;YAAE,MAAM;QAAY;KACxE;IAED,MAAM,WAAW,CAAC,OAAiB,qBAAA,+BAAA,SAAU,UAAU,CAAC;IAExD,qBACE;;0BAEE,6LAAC;gBACC,SAAS,IAAM,UAAU,CAAC;gBAC1B,WAAU;gBACV,cAAW;0BAEV,uBACC,6LAAC,iOAAS;oBAAC,WAAU;;;;;yCAErB,6LAAC,iOAAS;oBAAC,WAAU;;;;;;;;;;;YAKxB,wBACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;wBAAuC,SAAS,IAAM,UAAU;;;;;;kCAC/E,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAG,WAAU;kDAAsD;;;;;;kDACpE,6LAAC;wCACC,SAAS,IAAM,UAAU;wCACzB,WAAU;wCACV,cAAW;kDAEX,cAAA,6LAAC,iOAAS;4CAAC,WAAU;;;;;;;;;;;;;;;;;0CAGzB,6LAAC;gCAAI,WAAU;0CACZ,MAAM,GAAG,CAAC,CAAC,kBACV,6LAAC,0KAAI;wCAEH,MAAM,EAAE,IAAI;wCACZ,SAAS,IAAM,UAAU;wCACzB,WAAW,AAAC,sEAIX,OAHC,SAAS,EAAE,IAAI,IACX,yCACA;wCAEN,cAAY,EAAE,IAAI;kDAEjB,EAAE,KAAK;uCAVH,EAAE,IAAI;;;;;;;;;;;;;;;;;;;;;;;;AAmB7B;GArEwB;;QAEL,oJAAW;;;KAFN","debugId":null}},
    {"offset": {"line": 511, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/lib/constants/cta.ts"],"sourcesContent":["// M3.5: CTA related constants\n\nexport const APP_STORE_URL = 'https://apps.apple.com/app/ototheory';\n\nexport const CTA_MESSAGES = {\n  header: 'Get iOS App',\n  sticky: {\n    title: 'Get Pro features on iOS',\n    subtitle: 'MIDI ‚Ä¢ Sections ‚Ä¢ Unlimited',\n    button: 'Get App',\n  },\n  footer: {\n    title: 'Get the full experience on iOS',\n    button: 'Download on App Store',\n    features: '‚Ä¢ Pro features: MIDI export, Section editing, Unlimited sketches',\n  },\n  toast: {\n    limitWarn: '8+ chords recommended for better accuracy. Want unlimited? Get iOS Pro!',\n    limitBlock: '12 chord limit reached (Web Lite). Upgrade to iOS Pro for unlimited!',\n    sketchLimit: '3 sketch limit reached! Delete a sketch or upgrade to iOS Pro for unlimited sketches.',\n    pngExport: 'PNG exported! Want MIDI export? Get iOS Pro for full DAW integration!',\n    ctaButton: 'Get Pro',\n  },\n} as const;\n\nexport type CtaMessages = typeof CTA_MESSAGES;\n\n\nexport const APPLE_ICON_PATH =\n  'M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z';\n\n\n"],"names":[],"mappings":"AAAA,8BAA8B;;;;;;;;;AAEvB,MAAM,gBAAgB;AAEtB,MAAM,eAAe;IAC1B,QAAQ;IACR,QAAQ;QACN,OAAO;QACP,UAAU;QACV,QAAQ;IACV;IACA,QAAQ;QACN,OAAO;QACP,QAAQ;QACR,UAAU;IACZ;IACA,OAAO;QACL,WAAW;QACX,YAAY;QACZ,aAAa;QACb,WAAW;QACX,WAAW;IACb;AACF;AAKO,MAAM,kBACX","debugId":null}},
    {"offset": {"line": 549, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/ui/AppleIcon.tsx"],"sourcesContent":["import { APPLE_ICON_PATH } from '@/lib/constants/cta';\n\ninterface AppleIconProps {\n  className?: string;\n  size?: number | string;\n}\n\nexport default function AppleIcon({ className = 'w-4 h-4', size }: AppleIconProps) {\n  const sizeStyle = size ? { width: size, height: size } : undefined;\n  \n  return (\n    <svg\n      className={className}\n      style={sizeStyle}\n      fill=\"currentColor\"\n      viewBox=\"0 0 384 512\"\n      aria-hidden=\"true\"\n    >\n      <path d={APPLE_ICON_PATH} />\n    </svg>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;;AAAA;;;AAOe,SAAS,UAAU,KAA+C;QAA/C,EAAE,YAAY,SAAS,EAAE,IAAI,EAAkB,GAA/C;IAChC,MAAM,YAAY,OAAO;QAAE,OAAO;QAAM,QAAQ;IAAK,IAAI;IAEzD,qBACE,6LAAC;QACC,WAAW;QACX,OAAO;QACP,MAAK;QACL,SAAQ;QACR,eAAY;kBAEZ,cAAA,6LAAC;YAAK,GAAG,oJAAe;;;;;;;;;;;AAG9B;KAdwB","debugId":null}},
    {"offset": {"line": 592, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/lib/constants/cta.ja.ts"],"sourcesContent":["export const CTA_MESSAGES_JA = {\n  header: 'iOSÁâà„ÇíÂÖ•Êâã',\n  sticky: {\n    title: 'iOS„ÅßProÊ©üËÉΩ„Çí‰Ωø„ÅÜ',\n    subtitle: 'MIDI„Éª„Çª„ÇØ„Ç∑„Éß„É≥Á∑®ÈõÜ„ÉªÁÑ°Âà∂Èôê‰øùÂ≠ò',\n    button: '„Ç¢„Éó„É™„ÇíÂÖ•Êâã',\n  },\n  footer: {\n    title: 'iOS„ÅßÂÖ®Ê©üËÉΩ„Çí‰ΩìÈ®ì',\n    button: 'App Store„ÅßÂÖ•Êâã',\n    features: '‚Ä¢ ProÊ©üËÉΩÔºöMIDIÊõ∏„ÅçÂá∫„Åó„Éª„Çª„ÇØ„Ç∑„Éß„É≥Á∑®ÈõÜ„ÉªÁÑ°Âà∂Èôê‰øùÂ≠ò',\n  },\n  toast: {\n    limitWarn: 'Á≤æÂ∫¶Âêë‰∏ä„ÅÆ„Åü„ÇÅ8„Ç≥„Éº„Éâ‰ª•‰∏ä„ÇíÊé®Â•®„ÄÇÁÑ°Âà∂Èôê„ÅØiOS Pro„Å∏',\n    limitBlock: 'ÔºàWeb LiteÔºâ12„Ç≥„Éº„Éâ„ÅÆ‰∏äÈôê„Å´ÈÅî„Åó„Åæ„Åó„Åü„ÄÇiOS Pro„Å™„ÇâÁÑ°Âà∂Èôê„Åß„Åô„ÄÇ',\n    sketchLimit: '„Çπ„Ç±„ÉÉ„ÉÅ„ÅØ3‰ª∂„Åæ„Åß„Åß„Åô„ÄÇÂâäÈô§„Åô„Çã„Åã„ÄÅiOS Pro„ÅßÁÑ°Âà∂Èôê„Å´„ÄÇ',\n    pngExport: 'PNG„ÇíÊõ∏„ÅçÂá∫„Åó„Åæ„Åó„Åü„ÄÇMIDIÊõ∏„ÅçÂá∫„Åó„ÅØiOS Pro„Åß‚ÄîDAW„Å®ÂÆåÂÖ®ÈÄ£Êê∫„ÄÇ',\n    ctaButton: 'ProÁâà„Å∏',\n  },\n} as const;\n\n\n\n"],"names":[],"mappings":";;;;AAAO,MAAM,kBAAkB;IAC7B,QAAQ;IACR,QAAQ;QACN,OAAO;QACP,UAAU;QACV,QAAQ;IACV;IACA,QAAQ;QACN,OAAO;QACP,QAAQ;QACR,UAAU;IACZ;IACA,OAAO;QACL,WAAW;QACX,YAAY;QACZ,aAAa;QACb,WAAW;QACX,WAAW;IACb;AACF","debugId":null}},
    {"offset": {"line": 623, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/hooks/useCtaMessages.ts"],"sourcesContent":["\"use client\";\nimport { usePathname } from \"next/navigation\";\nimport { CTA_MESSAGES, type CtaMessages } from \"@/lib/constants/cta\";\nimport { CTA_MESSAGES_JA } from \"@/lib/constants/cta.ja\";\n\nexport function useCtaMessages(): CtaMessages {\n  const pathname = usePathname() || \"/\";\n  const isJa = pathname.startsWith('/ja');\n  return isJa ? (CTA_MESSAGES_JA as unknown as CtaMessages) : CTA_MESSAGES;\n}\n\n\n\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;AAHA;;;;AAKO,SAAS;;IACd,MAAM,WAAW,IAAA,oJAAW,OAAM;IAClC,MAAM,OAAO,SAAS,UAAU,CAAC;IACjC,OAAO,OAAQ,0JAAe,GAA8B,iJAAY;AAC1E;GAJgB;;QACG,oJAAW","debugId":null}},
    {"offset": {"line": 653, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/HeaderCta.client.tsx"],"sourcesContent":["\"use client\";\nimport Link from 'next/link';\nimport AppleIcon from '@/components/ui/AppleIcon';\nimport { useCtaMessages } from '@/hooks/useCtaMessages';\n\n/**\n * M3.5: Header CTA component (desktop only)\n * Displays iOS Coming Soon link in the header navigation\n */\nexport default function HeaderCta() {\n  const CTA_MESSAGES = useCtaMessages();\n  return (\n    <Link\n      href=\"/ios-coming-soon\"\n      className=\"hidden sm:flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium bg-gradient-to-r from-purple-600 to-blue-600 hover:opacity-90 text-white rounded-md transition-opacity relative\"\n    >\n      <AppleIcon className=\"w-3.5 h-3.5\" />\n      <span>{CTA_MESSAGES.header}</span>\n      <span className=\"ml-1 px-1.5 py-0.5 text-[10px] font-bold bg-yellow-400 text-black rounded\">\n        Soon\n      </span>\n    </Link>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;AAHA;;;;AASe,SAAS;;IACtB,MAAM,eAAe,IAAA,mJAAc;IACnC,qBACE,6LAAC,0KAAI;QACH,MAAK;QACL,WAAU;;0BAEV,6LAAC,mJAAS;gBAAC,WAAU;;;;;;0BACrB,6LAAC;0BAAM,aAAa,MAAM;;;;;;0BAC1B,6LAAC;gBAAK,WAAU;0BAA4E;;;;;;;;;;;;AAKlG;GAdwB;;QACD,mJAAc;;;KADb","debugId":null}},
    {"offset": {"line": 718, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/LangToggle.tsx"],"sourcesContent":["\"use client\";\nimport { usePathname } from \"next/navigation\";\nimport Link from \"next/link\";\n\nexport default function LangToggle() {\n  const pathname = usePathname() || \"/\";\n  const isJa = pathname.startsWith(\"/ja\");\n  const target = isJa\n    ? pathname.replace(/^\\/ja(\\/|$)/, \"/\")\n    : `/ja${pathname === \"/\" ? \"\" : pathname}`;\n  return (\n    <Link\n      href={target}\n      aria-label={isJa ? \"Switch to English\" : \"Êó•Êú¨Ë™û„Å´Âàá„ÇäÊõø„Åà\"}\n      className=\"inline-flex items-center justify-center px-2 py-1 text-xs rounded border border-black/10 dark:border-white/10 hover:bg-black/5 dark:hover:bg-white/5\"\n    >\n      {isJa ? \"EN\" : \"JA\"}\n    </Link>\n  );\n}\n\n\n\n"],"names":[],"mappings":";;;;;AACA;AACA;;;AAFA;;;AAIe,SAAS;;IACtB,MAAM,WAAW,IAAA,oJAAW,OAAM;IAClC,MAAM,OAAO,SAAS,UAAU,CAAC;IACjC,MAAM,SAAS,OACX,SAAS,OAAO,CAAC,eAAe,OAChC,AAAC,MAAsC,OAAjC,aAAa,MAAM,KAAK;IAClC,qBACE,6LAAC,0KAAI;QACH,MAAM;QACN,cAAY,OAAO,sBAAsB;QACzC,WAAU;kBAET,OAAO,OAAO;;;;;;AAGrB;GAfwB;;QACL,oJAAW;;;KADN","debugId":null}},
    {"offset": {"line": 761, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/Header.client.tsx"],"sourcesContent":["\"use client\";\nimport Link from \"next/link\";\nimport Image from \"next/image\";\nimport { usePathname } from \"next/navigation\";\nimport Nav from \"@/components/Nav\";\nimport MobileNav from \"@/components/MobileNav\";\nimport HeaderCta from \"@/components/HeaderCta.client\";\nimport LangToggle from \"@/components/LangToggle\";\n\nexport default function Header() {\n  const pathname = usePathname();\n  const isJa = pathname?.startsWith('/ja');\n  const homeHref = isJa ? '/ja' : '/';\n\n  return (\n    <header className=\"border-b border-black/10 dark:border-white/10\">\n      <div className=\"container flex items-center justify-between h-16 sm:h-20 md:h-24\">\n        <Link href={homeHref} className=\"flex items-center gap-2 flex-shrink-0\">\n          {/* Light mode logo - hidden in dark mode */}\n          <Image \n            src=\"/logo/logo-horizontal-light.png\" \n            alt=\"OtoTheory\" \n            width={280} \n            height={84}\n            className=\"h-12 sm:h-16 md:h-20 w-auto dark:hidden max-w-[200px] sm:max-w-[240px] md:max-w-none\"\n            priority\n          />\n          {/* Dark mode logo - hidden in light mode */}\n          <Image \n            src=\"/logo/logo-horizontal.png\" \n            alt=\"OtoTheory\" \n            width={280} \n            height={84}\n            className=\"h-12 sm:h-16 md:h-20 w-auto hidden dark:block max-w-[200px] sm:max-w-[240px] md:max-w-none\"\n            priority\n          />\n        </Link>\n        <div className=\"flex items-center gap-2 sm:gap-4\">\n          <Nav />\n          <MobileNav />\n          <HeaderCta />\n          <LangToggle />\n        </div>\n      </div>\n    </header>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAPA;;;;;;;;AASe,SAAS;;IACtB,MAAM,WAAW,IAAA,oJAAW;IAC5B,MAAM,OAAO,qBAAA,+BAAA,SAAU,UAAU,CAAC;IAClC,MAAM,WAAW,OAAO,QAAQ;IAEhC,qBACE,6LAAC;QAAO,WAAU;kBAChB,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC,0KAAI;oBAAC,MAAM;oBAAU,WAAU;;sCAE9B,6LAAC,2IAAK;4BACJ,KAAI;4BACJ,KAAI;4BACJ,OAAO;4BACP,QAAQ;4BACR,WAAU;4BACV,QAAQ;;;;;;sCAGV,6LAAC,2IAAK;4BACJ,KAAI;4BACJ,KAAI;4BACJ,OAAO;4BACP,QAAQ;4BACR,WAAU;4BACV,QAAQ;;;;;;;;;;;;8BAGZ,6LAAC;oBAAI,WAAU;;sCACb,6LAAC,uIAAG;;;;;sCACJ,6LAAC,6IAAS;;;;;sCACV,6LAAC,uJAAS;;;;;sCACV,6LAAC,8IAAU;;;;;;;;;;;;;;;;;;;;;;AAKrB;GArCwB;;QACL,oJAAW;;;KADN","debugId":null}},
    {"offset": {"line": 883, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/ProProvider.tsx"],"sourcesContent":["\"use client\";\nimport React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\n\ntype Ctx = { isPro: boolean; upgrade: () => void; downgrade: () => void };\nconst ProCtx = createContext<Ctx | null>(null);\n\nexport const ProProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  // Start from SSR-safe false, then hydrate from localStorage\n  const [isPro, setIsPro] = useState(false);\n  useEffect(() => {\n    try { setIsPro(window.localStorage.getItem(\"isPro\") === \"1\"); } catch {}\n  }, []);\n  const upgrade = () => { try { window.localStorage.setItem(\"isPro\", \"1\"); } catch {}; setIsPro(true); };\n  const downgrade = () => { try { window.localStorage.setItem(\"isPro\", \"0\"); } catch {}; setIsPro(false); };\n  const value = useMemo(() => ({ isPro, upgrade, downgrade }), [isPro]);\n  return <ProCtx.Provider value={value}>{children}</ProCtx.Provider>;\n};\n\nexport const usePro = () => {\n  const ctx = useContext(ProCtx);\n  if (!ctx) throw new Error(\"usePro must be used inside ProProvider\");\n  return ctx;\n};\n\n\n"],"names":[],"mappings":";;;;;;;AACA;;;AADA;;AAIA,MAAM,uBAAS,IAAA,8KAAa,EAAa;AAElC,MAAM,cAAuD;QAAC,EAAE,QAAQ,EAAE;;IAC/E,4DAA4D;IAC5D,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,IAAA,0KAAS;iCAAC;YACR,IAAI;gBAAE,SAAS,OAAO,YAAY,CAAC,OAAO,CAAC,aAAa;YAAM,EAAE,UAAM,CAAC;QACzE;gCAAG,EAAE;IACL,MAAM,UAAU;QAAQ,IAAI;YAAE,OAAO,YAAY,CAAC,OAAO,CAAC,SAAS;QAAM,EAAE,UAAM,CAAC;;QAAG,SAAS;IAAO;IACrG,MAAM,YAAY;QAAQ,IAAI;YAAE,OAAO,YAAY,CAAC,OAAO,CAAC,SAAS;QAAM,EAAE,UAAM,CAAC;;QAAG,SAAS;IAAQ;IACxG,MAAM,QAAQ,IAAA,wKAAO;sCAAC,IAAM,CAAC;gBAAE;gBAAO;gBAAS;YAAU,CAAC;qCAAG;QAAC;KAAM;IACpE,qBAAO,6LAAC,OAAO,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AACzC;GAVa;KAAA;AAYN,MAAM,SAAS;;IACpB,MAAM,MAAM,IAAA,2KAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT;IAJa","debugId":null}},
    {"offset": {"line": 958, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/lib/telemetry.ts"],"sourcesContent":["export type ToastKind = \"limit_warn\" | \"limit_block\" | \"undo\" | \"low_conf\";\n\nexport type OverlayTelemetry = {\n  control: string;\n  open?: boolean;\n  value?: string | number;\n  page?: string;\n};\n\nexport type CtaPlace = \"header\" | \"sticky\" | \"limit_toast\" | \"png_toast\" | \"qr\";\n\nexport type OtEvent =\n  | \"page_view\"\n  | \"scale_pick\"\n  | \"key_pick\"\n  | \"diatonic_pick\"\n  | \"overlay_reset\"\n  | \"fb_toggle\"\n  | \"overlay_shown\"\n  | \"play_note\"\n  | \"play_chord\"\n  | \"progression_play\"\n  | \"export_png\"\n  | \"save_project\"\n  | \"open_project\"\n  | \"project_delete\"\n  | \"preset_inserted\"\n  | \"instrument_change\"\n  | \"project_limit_warn\"\n  | \"audio_record_start\"\n  | \"audio_record_stop\"\n  | \"audio_analyze_ok\"\n  | \"audio_playback_last_take\"\n  | \"audio_analyze_conf\"\n  | \"audio_analyze_err\"\n  | \"toast_shown\"\n  | \"audio_unlock_try\"\n  | \"audio_unlock_ok\"\n  | \"audio_unlock_err\"\n  | \"ad_shown\"\n  | \"scale_arpeggio_play\"\n  | \"chord_form_shown\"\n  | \"substitute_shown\"\n  | \"substitute_add\"\n  | \"cta_appstore_click\";\n\ntype TelemetryPayload =\n  | { ev: \"toast_shown\"; kind: ToastKind }\n  | { ev: \"overlay_shown\"; control: string; open?: boolean; value?: string | number; page?: string }\n  | { ev: \"ad_shown\"; page: string }\n  | { ev: \"audio_unlock_try\" }\n  | { ev: \"audio_unlock_ok\" }\n  | { ev: \"audio_unlock_err\"; message: string }\n  | { ev: OtEvent; [key: string]: unknown };\n\n// ‰∫åÈáçÁô∫ÁÅ´ÂØæÁ≠ñÁî®„ÅÆ„Ç≠„É•„Éº\nlet eventQueue: Set<string> = new Set();\n\n// „Éö„Éº„Ç∏ÂêçÊ≠£Ë¶èÂåñ„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàÊóßÂêç ‚Üí Êñ∞Âêç„ÄÅ‰∫íÊèõÊÄßÁ¢∫‰øù„ÅÆ„Åü„ÇÅ90Êó•Á®ãÂ∫¶‰øùÊåÅÔºâ\nconst PAGE_NAME_MAP: Record<string, string> = {\n  \"progression\": \"chord_progression\",\n  \"find-key\": \"chord_progression\",\n  \"find-key-scale\": \"chord_progression\",\n  \"find-chord\": \"find_chords\",\n  \"analyze\": \"melody_solo_analyze\",\n};\n\n// „Éö„Éº„Ç∏ÂêçÊ≠£Ë¶èÂåñÈñ¢Êï∞\nconst normalizePageName = (page: string): string => {\n  return PAGE_NAME_MAP[page] || page;\n};\n\nexport function track(ev: OtEvent, payload: Record<string, unknown> = {}) {\n  const base: Record<string, unknown> = {\n    page: normalizePageName(payload.page as string || \"analyze\"), // payload„ÅßÊåáÂÆö„Åå„Å™„ÅÑÂ†¥Âêà„ÅØanalyze„ÄÅÊ≠£Ë¶èÂåñÈÅ©Áî®\n    keyPc: (typeof window!==\"undefined\" && (window as any).__OT_STATE__?.keyPc) ?? undefined,\n    scaleId: (typeof window!==\"undefined\" && (window as any).__OT_STATE__?.scaleId) ?? undefined,\n    page_language: (typeof window!==\"undefined\" && window.location?.pathname?.startsWith?.(\"/ja\")) ? \"ja\" : \"en\",\n    ts: Date.now(),\n  };\n  const rec: Record<string, unknown> = { ev, ...base, ...payload };\n\n  // ‰∫åÈáçÁô∫ÁÅ´ÂØæÁ≠ñÔºàÂêåtickÂêåÂêç„ÅØ1Âõû„ÅÆ„ÅøÔºâ\n  const eventKey = `${ev}:${performance.now().toFixed(0)}`;\n  if (eventQueue.has(eventKey)) return;\n  eventQueue.add(eventKey);\n  setTimeout(() => eventQueue.delete(eventKey), 0);\n\n  try {\n    if (typeof navigator !== \"undefined\" && \"sendBeacon\" in navigator) {\n      const blob = new Blob([JSON.stringify(rec)], { type: \"application/json\" });\n      (navigator as any).sendBeacon?.(\"/api/telemetry\", blob);\n    } else if (typeof fetch !== \"undefined\") {\n      fetch(\"/api/telemetry\", {\n        method: \"POST\",\n        body: JSON.stringify(rec),\n        headers: { \"content-type\": \"application/json\" },\n        keepalive: true,\n      }).catch(() => {});\n    }\n  } catch {}\n  try {\n    if (typeof localStorage !== \"undefined\" && localStorage.getItem(\"ot-debug-telemetry\") === \"1\") {\n      console.log(\"[ototelem]\", rec);\n    } else {\n      console.debug?.(\"[ototelem]\", rec);\n    }\n  } catch {}\n}\n\nexport function trackToast(kind: ToastKind, extra: Record<string, unknown> = {}) {\n  track(\"toast_shown\", { kind, ...extra });\n}\n\nexport function trackOverlayShown(payload: OverlayTelemetry) {\n  track(\"overlay_shown\", payload);\n}\n\n// M3.5: Web‚ÜíiOSÈÄÅÂÆ¢Ë®àÊ∏¨\nexport function trackCtaClick(place: CtaPlace, extra: Record<string, unknown> = {}) {\n  track(\"cta_appstore_click\", { place, ...extra });\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;AAuDA,cAAc;AACd,IAAI,aAA0B,IAAI;AAElC,wCAAwC;AACxC,MAAM,gBAAwC;IAC5C,eAAe;IACf,YAAY;IACZ,kBAAkB;IAClB,cAAc;IACd,WAAW;AACb;AAEA,YAAY;AACZ,MAAM,oBAAoB,CAAC;IACzB,OAAO,aAAa,CAAC,KAAK,IAAI;AAChC;AAEO,SAAS,MAAM,EAAW;QAAE,UAAA,iEAAmC,CAAC;QAG5B,eACE,gBACM,sCAAA,2BAAA;QAFxC,MACE;IAHX,MAAM,OAAgC;QACpC,MAAM,kBAAkB,QAAQ,IAAI,IAAc;QAClD,OAAO,CAAA,OAAC,aAAgB,iBAAe,gBAAA,AAAC,OAAe,YAAY,cAA5B,oCAAA,cAA8B,KAAK,eAAnE,kBAAA,OAAwE;QAC/E,SAAS,CAAA,QAAC,aAAgB,iBAAe,iBAAA,AAAC,OAAe,YAAY,cAA5B,qCAAA,eAA8B,OAAO,eAArE,mBAAA,QAA0E;QACnF,eAAe,AAAC,aAAgB,iBAAe,mBAAA,OAAO,QAAQ,cAAf,wCAAA,4BAAA,iBAAiB,QAAQ,cAAzB,iDAAA,uCAAA,0BAA2B,UAAU,cAArC,2DAAA,0CAAA,2BAAwC,UAAU,OAAO;QACxG,IAAI,KAAK,GAAG;IACd;IACA,MAAM,MAA+B;QAAE;QAAI,GAAG,IAAI;QAAE,GAAG,OAAO;IAAC;IAE/D,uBAAuB;IACvB,MAAM,WAAW,AAAC,GAAQ,OAAN,IAAG,KAAgC,OAA7B,YAAY,GAAG,GAAG,OAAO,CAAC;IACpD,IAAI,WAAW,GAAG,CAAC,WAAW;IAC9B,WAAW,GAAG,CAAC;IACf,WAAW,IAAM,WAAW,MAAM,CAAC,WAAW;IAE9C,IAAI;QACF,IAAI,OAAO,cAAc,eAAe,gBAAgB,WAAW;gBAEjE,aAAA;YADA,MAAM,OAAO,IAAI,KAAK;gBAAC,KAAK,SAAS,CAAC;aAAK,EAAE;gBAAE,MAAM;YAAmB;aACxE,cAAA,CAAA,QAAC,WAAkB,UAAU,cAA7B,kCAAA,iBAAA,OAAgC,kBAAkB;QACpD,OAAO,IAAI,OAAO,UAAU,aAAa;YACvC,MAAM,kBAAkB;gBACtB,QAAQ;gBACR,MAAM,KAAK,SAAS,CAAC;gBACrB,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,WAAW;YACb,GAAG,KAAK,CAAC,KAAO;QAClB;IACF,EAAE,UAAM,CAAC;IACT,IAAI;QACF,IAAI,OAAO,iBAAiB,eAAe,aAAa,OAAO,CAAC,0BAA0B,KAAK;YAC7F,QAAQ,GAAG,CAAC,cAAc;QAC5B,OAAO;gBACL,gBAAA;aAAA,iBAAA,CAAA,WAAA,SAAQ,KAAK,cAAb,qCAAA,oBAAA,UAAgB,cAAc;QAChC;IACF,EAAE,UAAM,CAAC;AACX;AAEO,SAAS,WAAW,IAAe;QAAE,QAAA,iEAAiC,CAAC;IAC5E,MAAM,eAAe;QAAE;QAAM,GAAG,KAAK;IAAC;AACxC;AAEO,SAAS,kBAAkB,OAAyB;IACzD,MAAM,iBAAiB;AACzB;AAGO,SAAS,cAAc,KAAe;QAAE,QAAA,iEAAiC,CAAC;IAC/E,MAAM,sBAAsB;QAAE;QAAO,GAAG,KAAK;IAAC;AAChD","debugId":null}},
    {"offset": {"line": 1056, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/lib/audio/voices.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport const MAX_VOICES = 6;\nexport const ATTACK_SEC = 0.005;\nexport const RELEASE_SEC = 0.12;\nexport const STRUM_STEP_SEC = 0.02;\n\ntype Voice = {\n  source: OscillatorNode;\n  gain: GainNode;\n  stopAt: number;\n};\n\nconst voices: Voice[] = [];\n\ntype VoiceMode = \"sine\" | \"triangle\" | \"pluck\";\nlet VOICE_MODE: VoiceMode = \"pluck\"; // „ÇÆ„Çø„ÉºÈ¢®„Éó„É©„ÉÉ„ÇØ„ÇíÊó¢ÂÆö\nexport function setVoiceMode(mode: VoiceMode){ VOICE_MODE = mode; }\nexport function getVoiceMode(): VoiceMode { return VOICE_MODE; }\n\nfunction midiToHz(midi: number){\n  return 440 * Math.pow(2, (midi - 69) / 12);\n}\n\nfunction cleanupVoice(voice: Voice){\n  try { voice.source.onended = null; } catch {}\n  try { voice.source.disconnect(); } catch {}\n  try { voice.gain.disconnect(); } catch {}\n}\n\nfunction voiceSteal(startAt: number){\n  if (voices.length < MAX_VOICES) return;\n  voices.sort((a, b) => a.stopAt - b.stopAt);\n  const victim = voices.shift();\n  if (!victim) return;\n  try { victim.source.stop(startAt); } catch {}\n  cleanupVoice(victim);\n}\n\nfunction registerVoice(ctx: AudioContext, voice: Voice){\n  voices.push(voice);\n  voice.source.onended = () => {\n    const idx = voices.indexOf(voice);\n    if (idx >= 0) voices.splice(idx, 1);\n    cleanupVoice(voice);\n  };\n}\n\nfunction playPluckVoice(\n  ctx: AudioContext,\n  master: GainNode,\n  freqHz: number,\n  startAt: number,\n  holdSec: number,\n  peak: number,\n){\n  const period = Math.max(1/880, Math.min(1/55, 1/Math.max(1, freqHz)));\n  const noiseDur = Math.min(0.025, Math.max(0.008, ATTACK_SEC * 2));\n  const stopAt = startAt + Math.max(RELEASE_SEC + 0.02, holdSec + 0.02);\n\n  const noise = ctx.createBufferSource();\n  const buf = ctx.createBuffer(1, Math.max(1, Math.floor(ctx.sampleRate * noiseDur)), ctx.sampleRate);\n  const ch0 = buf.getChannelData(0);\n  for (let i=0;i<ch0.length;i++) ch0[i] = (Math.random()*2-1);\n  noise.buffer = buf;\n  noise.start(startAt);\n  noise.stop(startAt + noiseDur);\n\n  const delay = ctx.createDelay();\n  delay.delayTime.setValueAtTime(period, startAt);\n  const feedback = ctx.createGain();\n  feedback.gain.setValueAtTime(0.82, startAt); // ÊÆãÈüøÊÑüÔºà„ÉÄ„É≥„Éî„É≥„Ç∞ÂâçÔºâ\n  const damp = ctx.createBiquadFilter();\n  damp.type = \"lowpass\";\n  damp.frequency.setValueAtTime(Math.min(6000, Math.max(1200, freqHz*6)), startAt);\n  damp.Q.setValueAtTime(0.5, startAt);\n\n  // Âá∫ÂäõÁî®„Ç®„É≥„Éô„É≠„Éº„Éó\n  const outGain = ctx.createGain();\n  const attackEnd = startAt + ATTACK_SEC;\n  const sustainEnd = startAt + Math.max(RELEASE_SEC, holdSec);\n  const releaseStart = Math.max(attackEnd, sustainEnd - RELEASE_SEC);\n  outGain.gain.setValueAtTime(0, startAt);\n  outGain.gain.linearRampToValueAtTime(Math.max(0.0001, peak), attackEnd);\n  outGain.gain.setValueAtTime(Math.max(0.0001, peak), releaseStart);\n  outGain.gain.linearRampToValueAtTime(0.0001, sustainEnd);\n\n  // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„É´„Éº„ÉóÔºàKarplus‚ÄìStrong„ÅÆÁ∞°ÊòìËøë‰ººÔºâ\n  noise.connect(damp);\n  damp.connect(delay);\n  delay.connect(feedback).connect(damp);\n  delay.connect(outGain).connect(master);\n\n  // Áñë‰ºº„Ç™„Ç∑„É¨„Éº„Çø„Å®„Åó„Å¶Êâ±„ÅÜ„Åü„ÇÅ„ÅÆ„ÉÄ„Éü„ÉºOscillatorNodeÔºàÁÆ°ÁêÜÁî®Ôºâ\n  const dummyOsc = ctx.createOscillator();\n  try { dummyOsc.connect(ctx.destination); } catch {}\n  dummyOsc.start(startAt);\n  dummyOsc.stop(stopAt);\n\n  registerVoice(ctx, { source: dummyOsc, gain: outGain, stopAt: sustainEnd });\n}\n\nexport function playVoice(\n  ctx: AudioContext,\n  master: GainNode,\n  midi: number,\n  startAt: number,\n  holdSec: number,\n  peak: number = 1,\n){\n  voiceSteal(startAt);\n  const freqHz = midiToHz(midi);\n  if (VOICE_MODE === \"pluck\") {\n    playPluckVoice(ctx, master, freqHz, startAt, holdSec, peak);\n    return;\n  }\n  const osc = ctx.createOscillator();\n  const gain = ctx.createGain();\n  osc.type = (VOICE_MODE === \"triangle\") ? \"triangle\" : \"sine\";\n  osc.frequency.value = freqHz;\n\n  const attackEnd = startAt + ATTACK_SEC;\n  const sustainEnd = startAt + Math.max(RELEASE_SEC, holdSec);\n  const releaseStart = Math.max(attackEnd, sustainEnd - RELEASE_SEC);\n\n  gain.gain.setValueAtTime(0, startAt);\n  gain.gain.linearRampToValueAtTime(Math.max(0.0001, peak), attackEnd);\n  gain.gain.setValueAtTime(Math.max(0.0001, peak), releaseStart);\n  gain.gain.linearRampToValueAtTime(0.0001, sustainEnd);\n\n  osc.connect(gain).connect(master);\n  osc.start(startAt);\n  osc.stop(sustainEnd + 0.01);\n\n  registerVoice(ctx, { source: osc, gain, stopAt: sustainEnd });\n}\n\nexport function playNote(\n  ctx: AudioContext,\n  master: GainNode,\n  midi: number,\n  holdSec: number,\n){\n  const startAt = ctx.currentTime;\n  // ÂçòÈü≥„ÅØ„ÇÑ„ÇÑÊéß„Åà„ÇÅ„ÅÆ„Éî„Éº„ÇØ\n  playVoice(ctx, master, midi, startAt, holdSec, 0.7);\n}\n\nexport function playChord(\n  ctx: AudioContext,\n  master: GainNode,\n  midis: number[],\n  holdSec: number,\n  strumStepSec: number,\n){\n  const base = ctx.currentTime;\n  const n = Math.max(1, Math.min(midis.length, MAX_VOICES));\n  // ÂêåÊôÇÁô∫Èü≥Êï∞„Å´Âøú„Åò„Å¶„Éî„Éº„ÇØ„ÇíÊ≠£Ë¶èÂåñÔºàÊ≠™„ÅøÈò≤Ê≠¢Ôºâ\n  const perVoicePeak = Math.max(0.22, Math.min(0.42, 0.95 / Math.sqrt(n)));\n  midis.forEach((midi, index) => {\n    const startAt = base + Math.max(0, strumStepSec) * index;\n    playVoice(ctx, master, midi, startAt, holdSec, perVoicePeak);\n  });\n}\n\nexport function stopAll(ctx: AudioContext){\n  voices.splice(0).forEach(voice => {\n    try { voice.source.stop(ctx.currentTime); } catch {}\n    cleanupVoice(voice);\n  });\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1226, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/lib/audio/player.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { track } from \"../telemetry\";\nimport {\n  playNote as playVoiceNote,\n  playChord as playVoiceChord,\n  STRUM_STEP_SEC,\n} from \"./voices\";\nimport Soundfont from \"soundfont-player\";\ntype SoundfontName =\n  | \"acoustic_guitar_nylon\"\n  | \"acoustic_guitar_steel\"\n  | \"electric_guitar_clean\"\n  | \"electric_guitar_jazz\"\n  | \"electric_guitar_muted\"\n  | \"overdriven_guitar\"\n  | \"distortion_guitar\"\n  | \"acoustic_grand_piano\";\n\ntype PlayerState = { enabled: boolean; volume: number };\nexport type PlayStyle = \"hit\" | \"lightStrum\";\n\nconst isBrowser = typeof window !== \"undefined\";\nfunction midiToHz(midi: number){ return 440 * Math.pow(2, (midi - 69) / 12); }\n\ntype Sub = (s: PlayerState) => void;\n\nexport type AudioPlayer = {\n  resume(): Promise<void>;\n  toggleEnabled(next?: boolean): Promise<void>;\n  setVolume(v: number): void;\n  getState(): PlayerState;\n  subscribe(cb: Sub): () => void;\n  playNote(midi: number, durMs?: number): void;\n  playChord(midis: number[], style?: PlayStyle, durMs?: number): void;\n  setInstrument(name: SoundfontName): Promise<void>;\n  getInstrument(): SoundfontName;\n};\n\nfunction createNoop(): AudioPlayer {\n  const s: PlayerState = { enabled: false, volume: 0.8 };\n  return {\n    async resume(){},\n    async toggleEnabled(){},\n    setVolume(){},\n    getState(){ return s; },\n    subscribe(){ return () => {}; },\n    playNote(){},\n    playChord(){},\n  };\n}\n\nexport const player: AudioPlayer = isBrowser ? (() => {\n  // lazy context / graph\n  let ctx: AudioContext | null = null;\n  let master: GainNode | null = null;\n  let sfGuitar: any | null = null;\n  const VALID_INSTR: Set<string> = new Set([\n    \"acoustic_guitar_nylon\",\n    \"acoustic_guitar_steel\",\n    \"electric_guitar_clean\",\n    \"electric_guitar_jazz\",\n    \"electric_guitar_muted\",\n    \"overdriven_guitar\",\n    \"distortion_guitar\",\n    \"acoustic_grand_piano\",\n  ]);\n  let currentInstr: SoundfontName = (() => {\n    try {\n      const saved = (typeof localStorage !== \"undefined\" ? localStorage.getItem(\"ot-instrument\") : null) as SoundfontName | null;\n      return (saved && VALID_INSTR.has(saved)) ? saved : \"acoustic_guitar_steel\";\n    } catch { return \"acoustic_guitar_steel\" as const; }\n  })();\n  const storedEnabled = (typeof localStorage !== \"undefined\") ? localStorage.getItem(\"ot-audio-enabled\") : null;\n  const storedVolume = (typeof localStorage !== \"undefined\") ? localStorage.getItem(\"ot-audio-volume\") : null;\n  const state: PlayerState = {\n    enabled: storedEnabled === null ? true : storedEnabled === \"true\",\n    volume: storedVolume ? Number(storedVolume) : 0.8,\n  };\n  const subs = new Set<Sub>();\n\n  function notify(){ subs.forEach(f => f(state)); }\n  function ensureCtx(){\n    if (!ctx) {\n      const AC: any = (window as any).AudioContext || (window as any).webkitAudioContext;\n      ctx = new AC();\n      master = ctx.createGain();\n      master!.gain.value = state.enabled ? state.volume : 0;\n      master!.connect(ctx.destination);\n      // do not resume automatically here; must happen after user gesture\n    }\n    return ctx!;\n  }\n\n  function setMasterVolume(){\n    if (!ctx || !master) return;\n    master.gain.cancelScheduledValues(ctx.currentTime);\n    master.gain.setValueAtTime(master.gain.value, ctx.currentTime);\n    master.gain.linearRampToValueAtTime(state.enabled ? state.volume : 0, ctx.currentTime + 0.02);\n  }\n\n  async function resume(){\n    const c = ensureCtx();\n    if (c.state === \"suspended\") await c.resume();\n    // lazy-load guitar soundfont\n    if (!sfGuitar) {\n      try {\n        sfGuitar = await Soundfont.instrument(c as any, currentInstr);\n      } catch {}\n    }\n    if (process.env.NEXT_PUBLIC_AUDIO_UNLOCK_PING === \"true\" && ctx) {\n      const osc = ctx.createOscillator();\n      const gain = ctx.createGain();\n      gain.gain.setValueAtTime(0, ctx.currentTime);\n      osc.connect(gain).connect(ctx.destination);\n      osc.start();\n      osc.stop(ctx.currentTime + 0.01);\n      osc.onended = () => {\n        try { osc.disconnect(); gain.disconnect(); } catch {}\n      };\n    }\n  }\n\n  async function toggleEnabled(next?: boolean){\n    ensureCtx();\n    state.enabled = (typeof next === \"boolean\") ? next : !state.enabled;\n    try { localStorage.setItem(\"ot-audio-enabled\", String(state.enabled)); } catch {}\n    setMasterVolume();\n    notify();\n    track(\"fb_toggle\", { page:\"analyze\", control:\"audio\", value: state.enabled });\n  }\n\n  function setVolume(v: number){\n    ensureCtx();\n    state.volume = Math.max(0, Math.min(1, v));\n    try { localStorage.setItem(\"ot-audio-volume\", String(state.volume)); } catch {}\n    setMasterVolume();\n    notify();\n  }\n\n  async function setInstrument(name: SoundfontName){\n    ensureCtx();\n    if (!VALID_INSTR.has(name)) return;\n    currentInstr = name;\n    try { localStorage.setItem(\"ot-instrument\", name); } catch {}\n    try {\n      sfGuitar = await Soundfont.instrument(ctx as any, currentInstr);\n    } catch { sfGuitar = null; }\n    track(\"instrument_change\", { page: \"analyze\", instrument: name });\n    notify();\n  }\n\n  function playNote(midi: number, durMs = 320){\n    const c = ensureCtx();\n    void resume();\n    if (!state.enabled) return;\n    const durSec = Math.max(0.12, durMs / 1000);\n    if (sfGuitar) { try { sfGuitar.play(midi, 0, { duration: durSec }); } catch { playVoiceNote(c, master!, midi, durSec); } }\n    else { playVoiceNote(c, master!, midi, durSec); }\n    track(\"play_note\", { page:\"analyze\", value:midi });\n  }\n\n  function playChord(midis: number[], style: PlayStyle = \"hit\", durMs = 420){\n    const c = ensureCtx();\n    void resume();\n    if (!state.enabled) return;\n    const step = style === \"lightStrum\" ? STRUM_STEP_SEC : 0;\n    const holdSec = Math.max(0.18, durMs/1000);\n    if (sfGuitar) {\n      try {\n        midis.slice(0,6).forEach((m, i) => { sfGuitar.play(m, i*step, { duration: holdSec }); });\n      } catch { playVoiceChord(c, master!, midis, holdSec, step); }\n    } else {\n      playVoiceChord(c, master!, midis, holdSec, step);\n    }\n    track(\"play_chord\", { page:\"analyze\", value: midis.slice(0,6).join(\",\") });\n  }\n\n  // defer context/resume until first user gesture\n\n  return {\n    resume, toggleEnabled, setVolume,\n    getState: () => ({ ...state }),\n    subscribe(cb){ subs.add(cb); return () => subs.delete(cb); },\n    playNote, playChord,\n    setInstrument,\n    getInstrument: () => currentInstr,\n  };\n})() : createNoop();\n\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1447, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/app/AudioUnlocker.client.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { track } from \"@/lib/telemetry\";\nimport { player } from \"@/lib/audio/player\";\n\nexport default function AudioUnlocker() {\n  const [unlocked, setUnlocked] = useState(false);\n  const lockedRef = useRef(true);\n\n  useEffect(() => {\n    if (unlocked) return;\n\n    const tryUnlock = async () => {\n      if (!lockedRef.current) return;\n      lockedRef.current = false;\n      try {\n        track(\"audio_unlock_try\", {});\n        await player.resume?.();\n        setUnlocked(true);\n        track(\"audio_unlock_ok\", {});\n      } catch (e) {\n        lockedRef.current = true;\n        track(\"audio_unlock_err\", { message: (e as Error)?.message ?? \"unknown\" });\n      }\n    };\n\n    const opts: AddEventListenerOptions = { once: true, capture: true };\n    const w = window;\n\n    w.addEventListener(\"pointerdown\", tryUnlock, opts);\n    w.addEventListener(\"keydown\", tryUnlock, opts);\n    w.addEventListener(\"touchstart\", tryUnlock, opts);\n\n    const onVisibility = () => {\n      if (document.visibilityState === \"visible\" && !unlocked) {\n        lockedRef.current = true;\n      }\n    };\n    document.addEventListener(\"visibilitychange\", onVisibility);\n\n    return () => {\n      w.removeEventListener(\"pointerdown\", tryUnlock, opts);\n      w.removeEventListener(\"keydown\", tryUnlock, opts);\n      w.removeEventListener(\"touchstart\", tryUnlock, opts);\n      document.removeEventListener(\"visibilitychange\", onVisibility);\n    };\n  }, [unlocked]);\n\n  return null;\n}\n\n\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAMe,SAAS;;IACtB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,YAAY,IAAA,uKAAM,EAAC;IAEzB,IAAA,0KAAS;mCAAC;YACR,IAAI,UAAU;YAEd,MAAM;qDAAY;oBAChB,IAAI,CAAC,UAAU,OAAO,EAAE;oBACxB,UAAU,OAAO,GAAG;oBACpB,IAAI;4BAEI;wBADN,IAAA,mIAAK,EAAC,oBAAoB,CAAC;wBAC3B,QAAM,iBAAA,0IAAM,CAAC,MAAM,cAAb,qCAAA,oBAAA,0IAAM;wBACZ,YAAY;wBACZ,IAAA,mIAAK,EAAC,mBAAmB,CAAC;oBAC5B,EAAE,OAAO,GAAG;4BAE2B;wBADrC,UAAU,OAAO,GAAG;4BACiB;wBAArC,IAAA,mIAAK,EAAC,oBAAoB;4BAAE,SAAS,CAAA,YAAA,QAAC,eAAD,4BAAA,MAAc,OAAO,cAArB,sBAAA,WAAyB;wBAAU;oBAC1E;gBACF;;YAEA,MAAM,OAAgC;gBAAE,MAAM;gBAAM,SAAS;YAAK;YAClE,MAAM,IAAI;YAEV,EAAE,gBAAgB,CAAC,eAAe,WAAW;YAC7C,EAAE,gBAAgB,CAAC,WAAW,WAAW;YACzC,EAAE,gBAAgB,CAAC,cAAc,WAAW;YAE5C,MAAM;wDAAe;oBACnB,IAAI,SAAS,eAAe,KAAK,aAAa,CAAC,UAAU;wBACvD,UAAU,OAAO,GAAG;oBACtB;gBACF;;YACA,SAAS,gBAAgB,CAAC,oBAAoB;YAE9C;2CAAO;oBACL,EAAE,mBAAmB,CAAC,eAAe,WAAW;oBAChD,EAAE,mBAAmB,CAAC,WAAW,WAAW;oBAC5C,EAAE,mBAAmB,CAAC,cAAc,WAAW;oBAC/C,SAAS,mBAAmB,CAAC,oBAAoB;gBACnD;;QACF;kCAAG;QAAC;KAAS;IAEb,OAAO;AACT;GA5CwB;KAAA","debugId":null}},
    {"offset": {"line": 1527, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/hooks/useCtaTracking.ts"],"sourcesContent":["import { useCallback } from 'react';\nimport { trackCtaClick, type CtaPlace } from '@/lib/telemetry';\n\n/**\n * CTA click tracking hook\n * Provides a memoized tracking function with current page path\n */\nexport function useCtaTracking() {\n  const trackClick = useCallback((place: CtaPlace, extra?: Record<string, unknown>) => {\n    if (typeof window !== 'undefined') {\n      trackCtaClick(place, { page: window.location.pathname, ...extra });\n    }\n  }, []);\n\n  return { trackClick };\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAMO,SAAS;;IACd,MAAM,aAAa,IAAA,4KAAW;kDAAC,CAAC,OAAiB;YAC/C,wCAAmC;gBACjC,IAAA,2IAAa,EAAC,OAAO;oBAAE,MAAM,OAAO,QAAQ,CAAC,QAAQ;oBAAE,GAAG,KAAK;gBAAC;YAClE;QACF;iDAAG,EAAE;IAEL,OAAO;QAAE;IAAW;AACtB;GARgB","debugId":null}},
    {"offset": {"line": 1560, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/MobileStickyCta.client.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState, useCallback } from 'react';\nimport { useCtaTracking } from '@/hooks/useCtaTracking';\nimport { APP_STORE_URL } from '@/lib/constants/cta';\nimport { useCtaMessages } from '@/hooks/useCtaMessages';\n\nconst DISMISS_KEY = 'ot-mobile-cta-dismissed';\nconst SHOW_DELAY_MS = 3000;\nconst SCROLL_THRESHOLD = 200;\n\n/**\n * M3.5: Mobile sticky CTA component\n * Displays at the bottom on mobile after scroll/delay\n * Dismissible for the current session\n */\nexport default function MobileStickyCta() {\n  const CTA_MESSAGES = useCtaMessages();\n  const [isVisible, setIsVisible] = useState(false);\n  const [isDismissed, setIsDismissed] = useState(false);\n  const [hasScrolled, setHasScrolled] = useState(false);\n  const { trackClick } = useCtaTracking();\n\n  useEffect(() => {\n    // Check if dismissed in current session\n    const dismissed = sessionStorage.getItem(DISMISS_KEY) === '1';\n    setIsDismissed(dismissed);\n    \n    if (dismissed) return;\n\n    // Show after delay\n    const delayTimer = setTimeout(() => setIsVisible(true), SHOW_DELAY_MS);\n\n    // Show after scroll\n    const handleScroll = () => {\n      if (window.scrollY > SCROLL_THRESHOLD) {\n        setHasScrolled(true);\n      }\n    };\n    \n    window.addEventListener('scroll', handleScroll);\n    \n    return () => {\n      clearTimeout(delayTimer);\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  const handleDismiss = useCallback(() => {\n    setIsVisible(false);\n    setIsDismissed(true);\n    sessionStorage.setItem(DISMISS_KEY, '1');\n  }, []);\n\n  const handleClick = useCallback(() => {\n    trackClick('sticky');\n  }, [trackClick]);\n\n  // Show when either delay passed or user scrolled (and not dismissed)\n  const shouldShow = !isDismissed && (isVisible || hasScrolled);\n\n  if (!shouldShow) return null;\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 z-50 sm:hidden bg-gradient-to-t from-black/95 to-black/80 backdrop-blur-sm border-t border-white/20 animate-slide-up\">\n      <div className=\"container py-3 px-4 flex items-center justify-between gap-3\">\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"text-xs font-medium text-white/90\">{CTA_MESSAGES.sticky.title}</div>\n          <div className=\"text-xs text-white/60 truncate\">{CTA_MESSAGES.sticky.subtitle}</div>\n        </div>\n        <a\n          href=\"/ios-coming-soon\"\n          className=\"flex-shrink-0 px-3 py-2 text-xs font-medium bg-gradient-to-r from-purple-600 to-blue-600 hover:opacity-90 text-white rounded-lg transition-opacity relative\"\n          onClick={handleClick}\n        >\n          <span className=\"block\">{CTA_MESSAGES.sticky.button}</span>\n          <span className=\"block text-[10px] font-bold text-yellow-400\">Soon</span>\n        </a>\n        <button\n          onClick={handleDismiss}\n          className=\"flex-shrink-0 w-6 h-6 flex items-center justify-center text-white/60 hover:text-white/90 transition-colors\"\n          aria-label=\"Dismiss\"\n        >\n          ‚úï\n        </button>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AAEA;;;AAJA;;;;AAMA,MAAM,cAAc;AACpB,MAAM,gBAAgB;AACtB,MAAM,mBAAmB;AAOV,SAAS;;IACtB,MAAM,eAAe,IAAA,mJAAc;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,mJAAc;IAErC,IAAA,0KAAS;qCAAC;YACR,wCAAwC;YACxC,MAAM,YAAY,eAAe,OAAO,CAAC,iBAAiB;YAC1D,eAAe;YAEf,IAAI,WAAW;YAEf,mBAAmB;YACnB,MAAM,aAAa;wDAAW,IAAM,aAAa;uDAAO;YAExD,oBAAoB;YACpB,MAAM;0DAAe;oBACnB,IAAI,OAAO,OAAO,GAAG,kBAAkB;wBACrC,eAAe;oBACjB;gBACF;;YAEA,OAAO,gBAAgB,CAAC,UAAU;YAElC;6CAAO;oBACL,aAAa;oBACb,OAAO,mBAAmB,CAAC,UAAU;gBACvC;;QACF;oCAAG,EAAE;IAEL,MAAM,gBAAgB,IAAA,4KAAW;sDAAC;YAChC,aAAa;YACb,eAAe;YACf,eAAe,OAAO,CAAC,aAAa;QACtC;qDAAG,EAAE;IAEL,MAAM,cAAc,IAAA,4KAAW;oDAAC;YAC9B,WAAW;QACb;mDAAG;QAAC;KAAW;IAEf,qEAAqE;IACrE,MAAM,aAAa,CAAC,eAAe,CAAC,aAAa,WAAW;IAE5D,IAAI,CAAC,YAAY,OAAO;IAExB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;sCAAqC,aAAa,MAAM,CAAC,KAAK;;;;;;sCAC7E,6LAAC;4BAAI,WAAU;sCAAkC,aAAa,MAAM,CAAC,QAAQ;;;;;;;;;;;;8BAE/E,6LAAC;oBACC,MAAK;oBACL,WAAU;oBACV,SAAS;;sCAET,6LAAC;4BAAK,WAAU;sCAAS,aAAa,MAAM,CAAC,MAAM;;;;;;sCACnD,6LAAC;4BAAK,WAAU;sCAA8C;;;;;;;;;;;;8BAEhE,6LAAC;oBACC,SAAS;oBACT,WAAU;oBACV,cAAW;8BACZ;;;;;;;;;;;;;;;;;AAMT;GAxEwB;;QACD,mJAAc;QAIZ,mJAAc;;;KALf","debugId":null}},
    {"offset": {"line": 1723, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/FooterCta.client.tsx"],"sourcesContent":["\"use client\";\nimport Link from 'next/link';\nimport AppleIcon from '@/components/ui/AppleIcon';\nimport { useCtaMessages } from '@/hooks/useCtaMessages';\n\n/**\n * M3.5: Footer CTA component\n * Displays iOS Coming Soon link in the footer\n */\nexport default function FooterCta() {\n  const CTA_MESSAGES = useCtaMessages();\n  return (\n    <div className=\"mb-6 flex flex-col items-center gap-3\">\n      <div className=\"text-sm font-medium text-black/80 dark:text-white/80\">\n        {CTA_MESSAGES.footer.title}\n      </div>\n      <Link\n        href=\"/ios-coming-soon\"\n        className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium bg-gradient-to-r from-purple-600 to-blue-600 hover:opacity-90 text-white rounded-lg transition-opacity relative\"\n      >\n        <AppleIcon />\n        <span>{CTA_MESSAGES.footer.button}</span>\n        <span className=\"ml-1 px-2 py-0.5 text-xs font-bold bg-yellow-400 text-black rounded\">\n          Coming Soon\n        </span>\n      </Link>\n      <div className=\"text-xs opacity-60\">\n        {CTA_MESSAGES.footer.features}\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;AAHA;;;;AASe,SAAS;;IACtB,MAAM,eAAe,IAAA,mJAAc;IACnC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;0BACZ,aAAa,MAAM,CAAC,KAAK;;;;;;0BAE5B,6LAAC,0KAAI;gBACH,MAAK;gBACL,WAAU;;kCAEV,6LAAC,mJAAS;;;;;kCACV,6LAAC;kCAAM,aAAa,MAAM,CAAC,MAAM;;;;;;kCACjC,6LAAC;wBAAK,WAAU;kCAAsE;;;;;;;;;;;;0BAIxF,6LAAC;gBAAI,WAAU;0BACZ,aAAa,MAAM,CAAC,QAAQ;;;;;;;;;;;;AAIrC;GAtBwB;;QACD,mJAAc;;;KADb","debugId":null}},
    {"offset": {"line": 1811, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/GoogleAnalytics.tsx"],"sourcesContent":["'use client';\n\nimport Script from 'next/script';\n\nexport default function GoogleAnalytics() {\n  const gaId = process.env.NEXT_PUBLIC_GA_ID;\n\n  if (!gaId) {\n    return null;\n  }\n\n  return (\n    <>\n      <Script\n        strategy=\"afterInteractive\"\n        src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}\n      />\n      <Script\n        id=\"google-analytics\"\n        strategy=\"afterInteractive\"\n        dangerouslySetInnerHTML={{\n          __html: `\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', '${gaId}', {\n              page_path: window.location.pathname,\n            });\n          `,\n        }}\n      />\n    </>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;AAKe;;AAHf;AAFA;;;AAIe,SAAS;IACtB,MAAM,OAAO,2KAAO,CAAC,GAAG,CAAC,iBAAiB;IAE1C,IAAI,CAAC,MAAM;QACT,OAAO;IACT;IAEA,qBACE;;0BACE,6LAAC,4IAAM;gBACL,UAAS;gBACT,KAAK,AAAC,+CAAmD,OAAL;;;;;;0BAEtD,6LAAC,4IAAM;gBACL,IAAG;gBACH,UAAS;gBACT,yBAAyB;oBACvB,QAAQ,AAAC,uLAIgB,OAAL,MAAK;gBAI3B;;;;;;;;AAIR;KA7BwB","debugId":null}},
    {"offset": {"line": 1860, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/GoogleTagManager.tsx"],"sourcesContent":["'use client';\n\nimport Script from 'next/script';\n\nexport function GoogleTagManagerHead() {\n  const gtmId = process.env.NEXT_PUBLIC_GTM_ID;\n\n  if (!gtmId) {\n    return null;\n  }\n\n  return (\n    <Script\n      id=\"gtm-script\"\n      strategy=\"afterInteractive\"\n      dangerouslySetInnerHTML={{\n        __html: `\n(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\nnew Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\nj=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n})(window,document,'script','dataLayer','${gtmId}');\n        `,\n      }}\n    />\n  );\n}\n\nexport function GoogleTagManagerBody() {\n  const gtmId = process.env.NEXT_PUBLIC_GTM_ID;\n\n  if (!gtmId) {\n    return null;\n  }\n\n  return (\n    <noscript>\n      <iframe\n        src={`https://www.googletagmanager.com/ns.html?id=${gtmId}`}\n        height=\"0\"\n        width=\"0\"\n        style={{ display: 'none', visibility: 'hidden' }}\n      />\n    </noscript>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;;;AAKgB;;AAHhB;AAFA;;;AAIO,SAAS;IACd,MAAM;IAEN;;IAIA,qBACE,6LAAC,4IAAM;QACL,IAAG;QACH,UAAS;QACT,yBAAyB;YACvB,QAAQ,AAAC,gVAKgC,OAAN,OAAM;QAE3C;;;;;;AAGN;KAtBgB;AAwBT,SAAS;IACd,MAAM;IAEN;;IAIA,qBACE,6LAAC;kBACC,cAAA,6LAAC;YACC,KAAK,AAAC,+CAAoD,OAAN;YACpD,QAAO;YACP,OAAM;YACN,OAAO;gBAAE,SAAS;gBAAQ,YAAY;YAAS;;;;;;;;;;;AAIvD;MAjBgB","debugId":null}},
    {"offset": {"line": 1924, "column": 0}, "map": {"version":3,"sources":["file:///Users/nh/App/OtoTheory/ototheory-web/src/components/FooterNav.client.tsx"],"sourcesContent":["\"use client\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\n\nexport default function FooterNav() {\n  const pathname = usePathname() || \"/\";\n  const isJa = pathname.startsWith('/ja');\n  const base = isJa ? '/ja' : '';\n  const items = [\n    { href: `${base}/about`, label: isJa ? 'About' : 'About' },\n    { href: `${base}/privacy`, label: isJa ? 'Privacy' : 'Privacy' },\n    { href: `${base}/terms`, label: isJa ? 'Terms' : 'Terms' },\n    { href: `${base}/faq`, label: isJa ? 'FAQ' : 'FAQ' },\n    { href: `${base}/support`, label: isJa ? 'Support' : 'Support' },\n  ];\n  return (\n    <nav className=\"flex items-center justify-center gap-3 flex-wrap\">\n      {items.map((it, i) => (\n        <>\n          <Link key={it.href} href={it.href} className=\"hover:underline\">{it.label}</Link>\n          {i < items.length - 1 ? <span key={`${it.href}-sep`}>‚Ä¢</span> : null}\n        </>\n      ))}\n    </nav>\n  );\n}\n\n\n\n"],"names":[],"mappings":";;;;;AACA;AACA;;;AAFA;;;AAIe,SAAS;;IACtB,MAAM,WAAW,IAAA,oJAAW,OAAM;IAClC,MAAM,OAAO,SAAS,UAAU,CAAC;IACjC,MAAM,OAAO,OAAO,QAAQ;IAC5B,MAAM,QAAQ;QACZ;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAS,OAAO,OAAO,UAAU;QAAQ;QACzD;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAW,OAAO,OAAO,YAAY;QAAU;QAC/D;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAS,OAAO,OAAO,UAAU;QAAQ;QACzD;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAO,OAAO,OAAO,QAAQ;QAAM;QACnD;YAAE,MAAM,AAAC,GAAO,OAAL,MAAK;YAAW,OAAO,OAAO,YAAY;QAAU;KAChE;IACD,qBACE,6LAAC;QAAI,WAAU;kBACZ,MAAM,GAAG,CAAC,CAAC,IAAI,kBACd;;kCACE,6LAAC,0KAAI;wBAAe,MAAM,GAAG,IAAI;wBAAE,WAAU;kCAAmB,GAAG,KAAK;uBAA7D,GAAG,IAAI;;;;;oBACjB,IAAI,MAAM,MAAM,GAAG,kBAAI,6LAAC;kCAA4B;uBAAlB,AAAC,GAAU,OAAR,GAAG,IAAI,EAAC;;;;+BAAkB;;;;;;;;AAK1E;GArBwB;;QACL,oJAAW;;;KADN","debugId":null}}]
}