module.exports = [
"[project]/src/components/AdSlot.client.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>AdSlot
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ProProvider$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ProProvider.tsx [app-ssr] (ecmascript)");
"use client";
;
;
;
;
function AdSlot({ page, slot = "XXXXXXXXXX", format = "auto", style = {} }) {
    const { isPro } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ProProvider$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["usePro"])();
    const [mounted, setMounted] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [adLoaded, setAdLoaded] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        setMounted(true);
    }, []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (!mounted || isPro) return;
        // AdSenseの広告をロード
        try {
            // @ts-ignore
            if (window.adsbygoogle && !adLoaded) {
                // @ts-ignore
                (window.adsbygoogle = window.adsbygoogle || []).push({});
                setAdLoaded(true);
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])("ad_shown", {
                    page
                });
            }
        } catch (error) {
            console.error("AdSense load error:", error);
        }
    }, [
        mounted,
        isPro,
        page,
        adLoaded
    ]);
    if (isPro) {
        return null;
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        style: {
            minHeight: 110,
            ...style
        },
        "aria-label": "Advertisement",
        className: "ad-container",
        children: mounted ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("ins", {
            className: "adsbygoogle",
            style: {
                display: "block",
                ...style
            },
            "data-ad-client": "ca-pub-9662479821167655",
            "data-ad-slot": slot,
            "data-ad-format": format,
            "data-full-width-responsive": "true"
        }, void 0, false, {
            fileName: "[project]/src/components/AdSlot.client.tsx",
            lineNumber: 56,
            columnNumber: 9
        }, this) : null
    }, void 0, false, {
        fileName: "[project]/src/components/AdSlot.client.tsx",
        lineNumber: 50,
        columnNumber: 5
    }, this);
}
}),
"[project]/src/hooks/useRovingTabs.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useRovingTabs",
    ()=>useRovingTabs
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
"use client";
;
function useRovingTabs(root, options = {}) {
    const { itemSelector = '[role="tab"],[data-roving="item"]', orientation = "horizontal", includeHomeEnd = true } = options;
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const el = root.current;
        if (!el) return;
        const getItems = ()=>Array.from(el.querySelectorAll(itemSelector)).filter((node)=>!node.hasAttribute("disabled"));
        const setTabIndex = (items, idx)=>{
            items.forEach((node, i)=>node.tabIndex = i === idx ? 0 : -1);
        };
        const applyInitial = ()=>{
            const items = getItems();
            if (!items.length) return;
            let index = items.findIndex((node)=>node.getAttribute("aria-selected") === "true" || node.tabIndex === 0 || node === document.activeElement);
            if (index < 0) index = 0;
            setTabIndex(items, index);
        };
        applyInitial();
        const onKey = (event)=>{
            const items = getItems();
            if (!items.length) return;
            const currentIndex = items.indexOf(document.activeElement);
            if (currentIndex < 0) return;
            const { key } = event;
            const horizontal = orientation === "horizontal" || orientation === "both";
            const vertical = orientation === "vertical" || orientation === "both";
            let nextIndex = -1;
            if (horizontal && key === "ArrowRight") nextIndex = (currentIndex + 1) % items.length;
            if (horizontal && key === "ArrowLeft") nextIndex = (currentIndex - 1 + items.length) % items.length;
            if (vertical && key === "ArrowDown") nextIndex = (currentIndex + 1) % items.length;
            if (vertical && key === "ArrowUp") nextIndex = (currentIndex - 1 + items.length) % items.length;
            if (nextIndex >= 0) {
                event.preventDefault();
                setTabIndex(items, nextIndex);
                items[nextIndex].focus({
                    preventScroll: true
                });
                return;
            }
            if (includeHomeEnd && key === "Home") {
                event.preventDefault();
                setTabIndex(items, 0);
                items[0].focus({
                    preventScroll: true
                });
                return;
            }
            if (includeHomeEnd && key === "End") {
                event.preventDefault();
                const last = items.length - 1;
                setTabIndex(items, last);
                items[last].focus({
                    preventScroll: true
                });
            }
        };
        el.addEventListener("keydown", onKey);
        return ()=>{
            el.removeEventListener("keydown", onKey);
        };
    }, [
        root,
        itemSelector,
        orientation,
        includeHomeEnd
    ]);
}
}),
"[project]/src/lib/scaleCatalog.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Single Source of Truth for scale catalog (English-first)
__turbopack_context__.s([
    "SCALE_CATALOG",
    ()=>SCALE_CATALOG,
    "getScaleMask12",
    ()=>getScaleMask12,
    "isHeptatonic",
    ()=>isHeptatonic,
    "isPentOrBlues",
    ()=>isPentOrBlues,
    "listScales",
    ()=>listScales
]);
const SCALE_CATALOG = [
    // Use English names per Excel (avoid modal names for major/minor)
    {
        id: 'Ionian',
        display: {
            en: 'Major Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            '3',
            '4',
            '5',
            '6',
            '7'
        ],
        info: {
            oneLiner: 'Major scale; bright and stable.',
            examples: [
                {
                    title: 'Let It Be',
                    artist: 'The Beatles'
                },
                {
                    title: 'Do-Re-Mi',
                    artist: 'Richard Rodgers'
                }
            ]
        }
    },
    {
        id: 'Dorian',
        display: {
            en: 'Dorian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            '5',
            '6',
            'b7'
        ],
        info: {
            oneLiner: 'Minor with a natural 6th; cool, modal colour.',
            examples: [
                {
                    title: 'So What',
                    artist: 'Miles Davis'
                }
            ]
        }
    },
    {
        id: 'Phrygian',
        display: {
            en: 'Phrygian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            'b2',
            'b3',
            '4',
            '5',
            'b6',
            'b7'
        ],
        info: {
            oneLiner: 'Dark, Spanish/Arabic flavour with flat 2.'
        }
    },
    {
        id: 'Lydian',
        display: {
            en: 'Lydian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            '3',
            '#4',
            '5',
            '6',
            '7'
        ],
        info: {
            oneLiner: 'Dreamy major with raised 4th (♯4).',
            examples: [
                {
                    title: 'The Simpsons Theme',
                    artist: 'Danny Elfman'
                }
            ]
        }
    },
    {
        id: 'Mixolydian',
        display: {
            en: 'Mixolydian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            '3',
            '4',
            '5',
            '6',
            'b7'
        ],
        info: {
            oneLiner: 'Major with flat 7; dominant, bluesy feel.',
            examples: [
                {
                    title: 'Sweet Home Alabama',
                    artist: 'Lynyrd Skynyrd'
                }
            ]
        }
    },
    {
        id: 'Aeolian',
        display: {
            en: 'Natural Minor Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            '5',
            'b6',
            'b7'
        ],
        info: {
            oneLiner: 'Natural minor; sad or moody colour.',
            examples: [
                {
                    title: 'House of the Rising Sun',
                    artist: 'Traditional'
                }
            ]
        }
    },
    {
        id: 'Locrian',
        display: {
            en: 'Locrian Scale'
        },
        group: 'Diatonic',
        degrees: [
            '1',
            'b2',
            'b3',
            '4',
            'b5',
            'b6',
            'b7'
        ],
        info: {
            oneLiner: 'Diminished 5th; unstable, rarely used as a key.'
        }
    },
    {
        id: 'MajorPentatonic',
        display: {
            en: 'Major Pentatonic'
        },
        group: 'Pentatonic',
        degrees: [
            '1',
            '2',
            '3',
            '5',
            '6'
        ],
        info: {
            oneLiner: 'Five-note, open and melodic; fits many chords.',
            examples: [
                {
                    title: 'My Girl',
                    artist: 'The Temptations'
                }
            ]
        }
    },
    {
        id: 'MinorPentatonic',
        display: {
            en: 'Minor Pentatonic'
        },
        group: 'Pentatonic',
        degrees: [
            '1',
            'b3',
            '4',
            '5',
            'b7'
        ],
        info: {
            oneLiner: 'Five-note minor staple for rock/blues solos.',
            examples: [
                {
                    title: 'Purple Haze',
                    artist: 'Jimi Hendrix'
                }
            ]
        }
    },
    {
        id: 'Blues',
        display: {
            en: 'Blues Scale (minor)'
        },
        group: 'Pentatonic',
        degrees: [
            '1',
            'b3',
            '4',
            'b5',
            '5',
            'b7'
        ],
        info: {
            oneLiner: 'Minor pentatonic plus blue note (♭5).',
            examples: [
                {
                    title: 'Smoke on the Water',
                    artist: 'Deep Purple'
                }
            ]
        }
    },
    {
        id: 'HarmonicMinor',
        display: {
            en: 'Harmonic Minor'
        },
        group: 'Minor',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            '5',
            'b6',
            '7'
        ],
        info: {
            oneLiner: 'Minor with raised 7th; exotic dominant pull.',
            examples: [
                {
                    title: 'Misirlou',
                    artist: 'Traditional'
                }
            ]
        }
    },
    {
        id: 'MelodicMinor',
        display: {
            en: 'Melodic Minor Scale'
        },
        group: 'Minor',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            '5',
            '6',
            '7'
        ],
        info: {
            oneLiner: 'Jazz minor (ascending); smooth minor/major blend.'
        }
    },
    // Diminished scales (symmetric) — added per Excel list
    {
        id: 'DiminishedWholeHalf',
        display: {
            en: 'Diminished Scale (Whole–Half)'
        },
        group: 'Other',
        degrees: [
            '1',
            '2',
            'b3',
            '4',
            'b5',
            'b6',
            '6',
            '7'
        ],
        info: {
            oneLiner: 'Symmetric 8-note (whole–half) scale; over dim7.'
        }
    },
    {
        id: 'DiminishedHalfWhole',
        display: {
            en: 'Diminished Scale (Half–Whole)'
        },
        group: 'Other',
        degrees: [
            '1',
            'b2',
            'b3',
            '3',
            '#4',
            '5',
            '6',
            'b7'
        ],
        info: {
            oneLiner: 'Symmetric 8-note (half–whole); over 7♭9 chords.'
        }
    }
];
// Dev helper: expose catalog for quick inspection in console (no filtering)
if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
;
function getScaleMask12(id) {
    const item = SCALE_CATALOG.find((s)=>s.id === id);
    if (!item) return Array(12).fill(0);
    const DEGREE_TO_SEMITONE = {
        '1': 0,
        'b2': 1,
        '2': 2,
        'b3': 3,
        '3': 4,
        '4': 5,
        '#4': 6,
        'b5': 6,
        '5': 7,
        '#5': 8,
        'b6': 8,
        '6': 9,
        'bb7': 9,
        'b7': 10,
        '7': 11
    };
    const mask = Array(12).fill(0);
    for (const d of item.degrees){
        const s = DEGREE_TO_SEMITONE[d];
        if (typeof s === 'number') mask[(s + 120) % 12] = 1;
    }
    return mask;
}
function listScales() {
    return SCALE_CATALOG.map((s)=>({
            id: s.id,
            label: s.display.en
        }));
}
const isHeptatonic = (scaleId)=>{
    const item = SCALE_CATALOG.find((s)=>s.id === scaleId);
    return item ? item.degrees.length === 7 : false;
};
const isPentOrBlues = (scaleId)=>{
    return scaleId === 'MajorPentatonic' || scaleId === 'MinorPentatonic' || scaleId === 'Blues';
};
}),
"[project]/src/lib/scales.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "DEGREE_LABELS",
    ()=>DEGREE_LABELS,
    "DEGREE_TO_SEMITONE",
    ()=>DEGREE_TO_SEMITONE,
    "SCALE_INTERVALS",
    ()=>SCALE_INTERVALS,
    "degreeLabelFor",
    ()=>degreeLabelFor,
    "degreeRomanFor",
    ()=>degreeRomanFor,
    "getScalePitches",
    ()=>getScalePitches,
    "getScalePitchesById",
    ()=>getScalePitchesById,
    "normalizeScaleId",
    ()=>normalizeScaleId,
    "parentModeOf",
    ()=>parentModeOf,
    "romanDegreeLabelsForScale",
    ()=>romanDegreeLabelsForScale,
    "scaleTypeLabel",
    ()=>scaleTypeLabel
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scaleCatalog.ts [app-ssr] (ecmascript)");
;
const SCALE_INTERVALS = {
    Ionian: [
        0,
        2,
        4,
        5,
        7,
        9,
        11
    ],
    Dorian: [
        0,
        2,
        3,
        5,
        7,
        9,
        10
    ],
    Phrygian: [
        0,
        1,
        3,
        5,
        7,
        8,
        10
    ],
    Lydian: [
        0,
        2,
        4,
        6,
        7,
        9,
        11
    ],
    Mixolydian: [
        0,
        2,
        4,
        5,
        7,
        9,
        10
    ],
    Aeolian: [
        0,
        2,
        3,
        5,
        7,
        8,
        10
    ],
    Locrian: [
        0,
        1,
        3,
        5,
        6,
        8,
        10
    ],
    HarmonicMinor: [
        0,
        2,
        3,
        5,
        7,
        8,
        11
    ],
    MelodicMinor: [
        0,
        2,
        3,
        5,
        7,
        9,
        11
    ],
    MajorPentatonic: [
        0,
        2,
        4,
        7,
        9
    ],
    MinorPentatonic: [
        0,
        3,
        5,
        7,
        10
    ],
    Blues: [
        0,
        3,
        5,
        6,
        7,
        10
    ],
    DiminishedWholeHalf: [
        0,
        2,
        3,
        5,
        6,
        8,
        9,
        11
    ],
    DiminishedHalfWhole: [
        0,
        1,
        3,
        4,
        6,
        7,
        9,
        10
    ]
};
function getScalePitches(root, type) {
    // Prefer catalog-driven calculation when possible
    try {
        return getScalePitchesById(root, type);
    } catch  {}
    const ints = SCALE_INTERVALS[type];
    if (!ints || ints.length === 0) {
        throw new Error(`Unknown scale id: ${String(type)}`);
    }
    return ints.map((iv)=>(root + iv + 120) % 12);
}
function normalizeScaleId(id) {
    const aliases = {
        Major: 'Ionian',
        Minor: 'Aeolian'
    };
    const key = String(id);
    return aliases[key] ?? aliases[key[0].toUpperCase() + key.slice(1)] ?? id;
}
function scaleTypeLabel(t) {
    // エイリアス吸収（防御的）
    const aliasToId = {
        Major: 'Ionian',
        Minor: 'Aeolian'
    };
    const id = aliasToId[t] ?? t;
    const map = {
        Ionian: 'Major Scale',
        Dorian: 'Dorian',
        Phrygian: 'Phrygian',
        Lydian: 'Lydian',
        Mixolydian: 'Mixolydian',
        Aeolian: 'Natural Minor',
        Locrian: 'Locrian',
        HarmonicMinor: 'Harmonic Minor',
        MelodicMinor: 'Melodic Minor',
        MajorPentatonic: 'Major Pentatonic',
        MinorPentatonic: 'Minor Pentatonic'
    };
    // Mapを既定とし、未定義はカタログのdisplay.enを利用
    const short = map[id];
    if (short) return short;
    const cat = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === id);
    return (cat?.display.en || String(id)).replace(/\s*\(.*\)$/, '');
}
const DEGREE_LABELS = {
    Ionian: [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7"
    ],
    Dorian: [
        "1",
        "2",
        "♭3",
        "4",
        "5",
        "6",
        "♭7"
    ],
    Phrygian: [
        "1",
        "♭2",
        "♭3",
        "4",
        "5",
        "♭6",
        "♭7"
    ],
    Lydian: [
        "1",
        "2",
        "3",
        "♯4",
        "5",
        "6",
        "7"
    ],
    Mixolydian: [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "♭7"
    ],
    Aeolian: [
        "1",
        "2",
        "♭3",
        "4",
        "5",
        "♭6",
        "♭7"
    ],
    Locrian: [
        "1",
        "♭2",
        "♭3",
        "4",
        "♭5",
        "♭6",
        "♭7"
    ],
    HarmonicMinor: [
        "1",
        "2",
        "♭3",
        "4",
        "5",
        "♭6",
        "7"
    ],
    MelodicMinor: [
        "1",
        "2",
        "♭3",
        "4",
        "5",
        "6",
        "7"
    ],
    MajorPentatonic: [
        "1",
        "2",
        "3",
        "5",
        "6"
    ],
    MinorPentatonic: [
        "1",
        "♭3",
        "4",
        "5",
        "♭7"
    ],
    Blues: [
        "1",
        "♭3",
        "4",
        "♭5",
        "5",
        "♭7"
    ]
};
function degreeLabelFor(pc, root, type) {
    const iv = (pc - root + 120) % 12;
    // Prefer catalog degrees → semitone offsets
    const cat = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === type);
    const ivs = (cat ? cat.degrees.map((d)=>DEGREE_TO_SEMITONE[d]) : undefined) ?? SCALE_INTERVALS[type] ?? [];
    const idx = ivs.indexOf(iv);
    if (idx === -1) return null;
    const labels = cat?.degrees ?? DEGREE_LABELS[type] ?? undefined;
    if (!labels) return null;
    return labels[idx] ?? null;
}
// Convert a degree token like "1", "b2", "#4", "♭3" to Roman form (R, II, ♯IV, ♭III, etc.)
function degreeTokenToRoman(token) {
    const t = token.replace(/\s+/g, '').replace(/bb/g, '♭♭').replace(/b/g, '♭').replace(/##/g, '♯♯').replace(/#/g, '♯');
    // Extract accidentals and number
    const m = t.match(/^(♭|♯|♭♭|♯♯)?(\d)$/);
    if (!m) {
        // fallback: if already has Roman-like content, return as is
        return t;
    }
    const acc = m[1] ?? '';
    const n = m[2];
    const romanBase = {
        '1': 'R',
        '2': 'II',
        '3': 'III',
        '4': 'IV',
        '5': 'V',
        '6': 'VI',
        '7': 'VII'
    };
    const base = romanBase[n] ?? n;
    return `${acc}${base}`;
}
function degreeRomanFor(pc, root, type) {
    const iv = (pc - root + 120) % 12;
    const cat = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === type);
    const ivs = (cat ? cat.degrees.map((d)=>DEGREE_TO_SEMITONE[d]) : undefined) ?? SCALE_INTERVALS[type] ?? [];
    const idx = ivs.indexOf(iv);
    if (idx === -1) return null;
    const labels = cat?.degrees ?? DEGREE_LABELS[type] ?? undefined;
    if (!labels) return null;
    const token = labels[idx] ?? '';
    return degreeTokenToRoman(token);
}
function parentModeOf(t) {
    switch(t){
        case 'MajorPentatonic':
            return 'Ionian';
        case 'MinorPentatonic':
            return 'Aeolian';
        default:
            return null;
    }
}
// === Roman degree labels per scale type (vs Ionian baseline) ===
const IONIAN_INTERVALS = [
    0,
    2,
    4,
    5,
    7,
    9,
    11
];
const ROMAN_BASE = [
    'I',
    'II',
    'III',
    'IV',
    'V',
    'VI',
    'VII'
];
function romanDegreeLabelsForScale(scaleType) {
    const ints = SCALE_INTERVALS[scaleType];
    // Fallback for non-7-note scales
    if (!ints || ints.length !== 7) return [
        ...ROMAN_BASE
    ];
    return ints.map((semi, i)=>{
        const base = ROMAN_BASE[i];
        const diff = semi - IONIAN_INTERVALS[i];
        if (diff === 0) return base;
        if (diff > 0) return '#'.repeat(diff) + base;
        return 'b'.repeat(-diff) + base;
    });
}
const DEGREE_TO_SEMITONE = {
    '1': 0,
    'b2': 1,
    '2': 2,
    'b3': 3,
    '3': 4,
    '4': 5,
    '#4': 6,
    'b5': 6,
    '5': 7,
    '#5': 8,
    'b6': 8,
    '6': 9,
    'bb7': 9,
    'b7': 10,
    '7': 11
};
function getScalePitchesById(rootPc, id) {
    const s = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((x)=>x.id === id);
    if (!s) throw new Error(`Scale not found in catalog: ${String(id)}`);
    return s.degrees.map((d)=>(rootPc + DEGREE_TO_SEMITONE[d] + 120) % 12);
}
// Dev helper: expose minimal API for console checks
if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
;
}),
"[project]/src/components/Fretboard.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>Fretboard
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scaleCatalog.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/audio/player.ts [app-ssr] (ecmascript)");
"use client";
;
;
;
;
;
const PITCHES12 = [
    'C',
    'C#',
    'D',
    'Eb',
    'E',
    'F',
    'F#',
    'G',
    'Ab',
    'A',
    'Bb',
    'B'
];
// --- Dot visuals (shared for Degrees/Names) ---
const DOT_PX_DESKTOP = 26;
const DOT_PX_MOBILE = 24;
const FONT_PX_DESKTOP = 14;
const FONT_PX_MOBILE = 13;
// Original palette（page base: show degree colours）
const COLOR_ROOT = "hsl(355 80% 60% / .95)"; // root
const COLOR_DEG3 = "hsl(205 90% 56% / .90)"; // 3rd
const COLOR_DEG5 = "hsl(150 65% 45% / .90)"; // 5th
const COLOR_DEG7 = "hsl(48 95% 55% / .92)"; // 7th
// Preview palette（suggested-scale overlay: chord vs others）
const COLOR_CHORD = "hsl(0 85% 55% / .95)"; // chord tones (red)
const COLOR_SCALE = "hsl(210 10% 72% / .70)"; // non-chord scale tones (gray)
const COLOR_OUT = "hsl(210 6% 38% / .30)";
const COLOR_GHOST = "hsl(210 12% 58% / .60)"; // unified ghost color (darker)
const LABEL_COLOR = "#0b0b0b";
const dotStyle = (bg, isMobile)=>{
    const size = isMobile ? DOT_PX_MOBILE : DOT_PX_DESKTOP;
    return {
        width: size,
        height: size,
        borderRadius: size,
        background: bg,
        color: LABEL_COLOR,
        fontWeight: 700,
        fontSize: isMobile ? FONT_PX_MOBILE : FONT_PX_DESKTOP,
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        transform: 'translate(-50%, -50%)',
        textShadow: '0 0 1px rgba(0,0,0,.55)',
        WebkitTextStroke: '0.3px rgba(255,255,255,.35)',
        userSelect: 'none'
    };
};
function colorForDegreeLabel(preview, lbl, isChordTone, isInScale, isRoot) {
    if (!isInScale) return COLOR_OUT;
    if (preview) {
        return isChordTone ? COLOR_CHORD : COLOR_SCALE;
    }
    if (isRoot) return COLOR_ROOT;
    if (!lbl) return COLOR_SCALE;
    const l = lbl.replace(/\s/g, "");
    if (l.includes("3")) return COLOR_DEG3;
    if (l.includes("5")) return COLOR_DEG5;
    if (l.includes("7")) return COLOR_DEG7;
    return COLOR_SCALE;
}
function ghostFromBaseColor(base, alpha = 0.85) {
    try {
        if (base.includes('/')) {
            return base.replace(/\/(.*?)\)/, `/ ${alpha})`);
        }
        if (base.endsWith(')')) return base.replace(/\)$/, ` / ${alpha})`);
    } catch  {}
    return base;
}
function Fretboard({ strings = [
    'E',
    'B',
    'G',
    'D',
    'A',
    'E'
], frets = 15, dotPositions: _dotPositions = [
    3,
    5,
    7,
    9,
    12,
    15
], overlay = null, onRequestForms, formShape = null }) {
    const wrapRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    // SSRと初回クライアント描画の一致を保つため、初期値はfalse（デスクトップ想定）
    const [isMobile, setIsMobile] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [pressedCell, setPressedCell] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const update = ()=>{
            try {
                setIsMobile(window.innerWidth < 380);
            } catch  {}
        };
        update();
        window.addEventListener('resize', update);
        return ()=>window.removeEventListener('resize', update);
    }, []);
    // ScaleとChordを統合したoverlayオブジェクトを作成
    // 親から `overlay` が渡されている場合はそれを最優先（Find Key などの初期表示用）
    const overlayEff = overlay ?? null;
    // Layout constants
    const LEFT_GUTTER = 44; // px  // compact gutter (reduced)
    const SPACE_W = 28; // px  // standard fret min width
    const ROW_H = 28; // px
    const TOP_BAR_H = 32; // px
    const OPEN_GAP = 20; // px additional gap for open column (increased by +8px)
    const ZERO_COL_W = SPACE_W + OPEN_GAP; // widened open column
    const COLS = (f)=>`${ZERO_COL_W}px repeat(${f}, minmax(${SPACE_W}px, 1fr))`;
    const NUT_WIDTH = 3; // px
    // --- Chord label long-press (for mouse/touch on the label only) ---
    const PRESS_MS = 400;
    const pressTimer = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const endPress = ()=>{
        if (pressTimer.current !== null) {
            clearTimeout(pressTimer.current);
            pressTimer.current = null;
        }
    };
    const startPress = (e, ctx)=>{
        if (!onRequestForms) return;
        // マウスの長押しは不要だが、統一して実装
        endPress();
        pressTimer.current = window.setTimeout(()=>{
            onRequestForms({
                x: e.clientX,
                y: e.clientY
            }, ctx);
        }, PRESS_MS);
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{}, [
        frets,
        strings.length
    ]);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "rounded-lg border p-3 overflow-x-auto ot-fretboard ot-fb-compact",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "min-w-[640px]",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    ref: wrapRef,
                    className: "relative",
                    style: {
                        height: TOP_BAR_H + strings.length * ROW_H + 16
                    },
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "pointer-events-none absolute top-1 grid text-[12px] md:text-sm text-foreground/80",
                            style: {
                                gridTemplateColumns: COLS(frets),
                                height: TOP_BAR_H,
                                left: LEFT_GUTTER,
                                right: 0
                            },
                            children: Array.from({
                                length: frets + 1
                            }).map((_, col)=>{
                                const show = [
                                    0,
                                    1,
                                    3,
                                    5,
                                    7,
                                    9,
                                    12,
                                    15
                                ].includes(col);
                                if (!show) return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {}, col, false, {
                                    fileName: "[project]/src/components/Fretboard.tsx",
                                    lineNumber: 143,
                                    columnNumber: 33
                                }, this);
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-start justify-center",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "inline-block px-1 rounded bg-background/80",
                                        children: col
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/Fretboard.tsx",
                                        lineNumber: 146,
                                        columnNumber: 19
                                    }, this)
                                }, col, false, {
                                    fileName: "[project]/src/components/Fretboard.tsx",
                                    lineNumber: 145,
                                    columnNumber: 17
                                }, this);
                            })
                        }, void 0, false, {
                            fileName: "[project]/src/components/Fretboard.tsx",
                            lineNumber: 132,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "absolute select-none",
                            style: {
                                left: 0,
                                top: TOP_BAR_H,
                                width: LEFT_GUTTER,
                                height: strings.length * ROW_H,
                                display: 'grid',
                                gridTemplateRows: `repeat(${strings.length}, ${ROW_H}px)`
                            },
                            "aria-hidden": "true",
                            children: strings.map((s, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-center justify-center text-xs md:text-sm leading-none text-muted-foreground",
                                    children: s
                                }, `lbl-${i}`, false, {
                                    fileName: "[project]/src/components/Fretboard.tsx",
                                    lineNumber: 166,
                                    columnNumber: 15
                                }, this))
                        }, void 0, false, {
                            fileName: "[project]/src/components/Fretboard.tsx",
                            lineNumber: 153,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "absolute right-0 bottom-0 grid",
                            style: {
                                top: TOP_BAR_H,
                                left: LEFT_GUTTER,
                                width: `calc(100% - ${LEFT_GUTTER}px)`,
                                gridTemplateColumns: COLS(frets),
                                gridTemplateRows: `repeat(${strings.length}, ${ROW_H}px)`
                            },
                            children: [
                                strings.map((s, rowIdx)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"].Fragment, {
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "relative",
                                                children: renderOpenMarker({
                                                    overlay: overlayEff,
                                                    strings,
                                                    rowIdx,
                                                    isMobile
                                                })
                                            }, `open-${rowIdx}`, false, {
                                                fileName: "[project]/src/components/Fretboard.tsx",
                                                lineNumber: 175,
                                                columnNumber: 17
                                            }, this),
                                            Array.from({
                                                length: frets
                                            }).map((_, colIdx)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: `relative ${colIdx === 0 ? 'border-l border-transparent' : 'border-l border-black/10 dark:border-white/10'} ${pressedCell && pressedCell.r === rowIdx && pressedCell.c === colIdx ? 'fb-pressed' : ''} cursor-pointer select-none`,
                                                    onClick: async ()=>{
                                                        // 空白やゴースト領域でもタップで単音を軽く試聴
                                                        const STRING_OPEN_MIDI = [
                                                            64,
                                                            59,
                                                            55,
                                                            50,
                                                            45,
                                                            40
                                                        ];
                                                        const baseMidi = STRING_OPEN_MIDI[Math.min(rowIdx, STRING_OPEN_MIDI.length - 1)] ?? 64;
                                                        const midi = baseMidi + (colIdx + 1);
                                                        // 短い押下エフェクト
                                                        setPressedCell((prev)=>({
                                                                r: rowIdx,
                                                                c: colIdx,
                                                                ver: (prev?.ver ?? 0) + 1
                                                            }));
                                                        const localVer = (pressedCell?.ver ?? 0) + 1;
                                                        window.setTimeout(()=>{
                                                            setPressedCell((cur)=>cur && cur.r === rowIdx && cur.c === colIdx && cur.ver === localVer ? null : cur);
                                                        }, 180);
                                                        try {
                                                            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
                                                            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playNote(midi, 240);
                                                        } catch  {}
                                                    },
                                                    children: renderMarker({
                                                        overlay: overlayEff,
                                                        strings,
                                                        rowIdx,
                                                        colIdx,
                                                        isMobile
                                                    })
                                                }, `c-${rowIdx}-${colIdx}`, false, {
                                                    fileName: "[project]/src/components/Fretboard.tsx",
                                                    lineNumber: 177,
                                                    columnNumber: 19
                                                }, this))
                                        ]
                                    }, `row-${rowIdx}`, true, {
                                        fileName: "[project]/src/components/Fretboard.tsx",
                                        lineNumber: 173,
                                        columnNumber: 15
                                    }, this)),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    "aria-hidden": true,
                                    className: "absolute pointer-events-none z-[20] bg-black/60 dark:bg-white/70",
                                    style: {
                                        left: ZERO_COL_W - NUT_WIDTH / 2,
                                        top: 0,
                                        bottom: 0,
                                        width: NUT_WIDTH,
                                        borderRadius: 2
                                    }
                                }, void 0, false, {
                                    fileName: "[project]/src/components/Fretboard.tsx",
                                    lineNumber: 200,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/components/Fretboard.tsx",
                            lineNumber: 171,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/components/Fretboard.tsx",
                    lineNumber: 129,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 128,
                columnNumber: 7
            }, this),
            formShape && renderFormOverlay({
                formShape,
                LEFT_GUTTER,
                TOP_BAR_H,
                SPACE_W,
                ROW_H
            })
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/Fretboard.tsx",
        lineNumber: 127,
        columnNumber: 5
    }, this);
}
const pitchIndexMap = {
    C: 0,
    "C#": 1,
    Db: 1,
    D: 2,
    "D#": 3,
    Eb: 3,
    E: 4,
    F: 5,
    "F#": 6,
    Gb: 6,
    G: 7,
    "G#": 8,
    Ab: 8,
    A: 9,
    "A#": 10,
    Bb: 10,
    B: 11
};
const pitchIndex = (note)=>pitchIndexMap[note] ?? 0;
// Fallback degree label map (chromatic → degree text)
function fallbackDegreeLabel(notePc, rootPc) {
    const d = (notePc - rootPc + 12) % 12;
    const arr = [
        "1",
        "b2",
        "2",
        "b3",
        "3",
        "4",
        "#4",
        "5",
        "b6",
        "6",
        "b7",
        "7"
    ];
    return arr[d];
}
function renderMarker({ overlay, strings, rowIdx, colIdx, isMobile }) {
    if (!overlay) return null;
    const chordNotes = overlay.chordNotes ?? overlay.notes ?? [];
    const hasChord = (chordNotes?.length ?? 0) > 0;
    const chordRootIdx = hasChord ? pitchIndex(chordNotes[0] ?? "C") : 0;
    const set = new Set((chordNotes || []).map((note)=>pitchIndex(note ?? "C")));
    const openPc = pitchIndex(strings[rowIdx] ?? "E");
    // Shaped: treat capo as new nut → subtract capo semitones
    // column index 0 represents fret 1 (fret 0 = open is not drawn as a column)
    const fretN = colIdx + 1;
    const spc = (openPc + fretN) % 12; // shapedは廃止・常にsounding
    // 実音のMIDI（弦の実チューニング＋フレット数）
    const STRING_OPEN_MIDI = [
        64,
        59,
        55,
        50,
        45,
        40
    ]; // E4, B3, G3, D3, A2, E2 (high -> low)
    const baseMidi = STRING_OPEN_MIDI[Math.min(rowIdx, STRING_OPEN_MIDI.length - 1)] ?? 64;
    const midi = baseMidi + fretN;
    // scale-aware style & label
    const scaleRoot = overlay.scaleRootPc;
    const scaleType = overlay.scaleType;
    const inScale = (()=>{
        if (typeof scaleRoot !== 'number' || !scaleType) return true;
        const iv = (spc - scaleRoot + 120) % 12;
        const ivs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getScalePitches"])(scaleRoot, overlay.scaleType).map((v)=>(v - scaleRoot + 120) % 12);
        return ivs.includes(iv);
    })();
    // Optionally draw scale ghost when in scale and not a chord tone
    const hasChordOverlay = (chordNotes?.length ?? 0) > 0;
    const drawGhost = (overlay.showScaleGhost ?? true) && hasChordOverlay && inScale && !set.has(spc);
    // Draw chord tone if provided
    const drawChord = set.has(spc);
    const drawScaleMain = !hasChordOverlay && inScale;
    if (!drawGhost && !drawChord && !drawScaleMain) return null;
    const iv = typeof scaleRoot === 'number' ? (spc - scaleRoot + 120) % 12 : 0;
    const isRoot = iv === 0;
    const isChordTone = set.has(spc) || [
        0,
        4,
        7,
        10,
        11
    ].includes(iv); // root/3/5/7 as baseline
    const degreeLbl = !inScale || typeof scaleRoot !== 'number' || !scaleType ? null : (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["degreeLabelFor"])(spc, scaleRoot, overlay.scaleType) ?? null;
    const baseColor = colorForDegreeLabel(false, degreeLbl, isChordTone, inScale, isRoot);
    const showDegrees = overlay.display === 'degrees';
    const fallbackRoot = typeof scaleRoot === 'number' ? scaleRoot : chordRootIdx;
    const label = showDegrees ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["degreeRomanFor"])(spc, fallbackRoot, overlay.scaleType) ?? degreeLbl ?? fallbackDegreeLabel(spc, fallbackRoot) : PITCHES12[spc];
    const dense = (()=>{
        const def = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === overlay.scaleType);
        return (def?.degrees?.length ?? 0) > 7;
    })();
    const fretLabel = colIdx + 1;
    const stringNumber = rowIdx + 1;
    const ariaLabel = `string ${stringNumber}, fret ${fretLabel}, ${label === '1' ? 'root' : label}`;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "absolute inset-0",
        "aria-live": "polite",
        children: [
            drawGhost && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: `absolute left-1/2 top-1/2 fret-dot--ghost${dense ? ' ghost--dense' : ''}`,
                style: {
                    color: ghostFromBaseColor(baseColor)
                },
                "aria-hidden": true
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 279,
                columnNumber: 9
            }, this),
            drawScaleMain && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: async ()=>{
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playNote(midi);
                },
                style: dotStyle(baseColor, isMobile),
                className: "absolute left-1/2 top-1/2 fret-dot fret-dot--main",
                "aria-label": ariaLabel,
                children: label
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 282,
                columnNumber: 9
            }, this),
            drawChord && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: async ()=>{
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playNote(midi);
                },
                style: dotStyle(baseColor, isMobile),
                className: "absolute left-1/2 top-1/2 fret-dot fret-dot--main fret-dot--chord",
                "aria-label": ariaLabel,
                children: label
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 293,
                columnNumber: 9
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/Fretboard.tsx",
        lineNumber: 277,
        columnNumber: 5
    }, this);
}
function renderOpenMarker({ overlay, strings, rowIdx, isMobile }) {
    if (!overlay) return null;
    const chordNotes = overlay.chordNotes ?? overlay.notes ?? [];
    const hasChord = (chordNotes?.length ?? 0) > 0;
    const tonicIdx = hasChord ? pitchIndex(chordNotes[0] ?? "C") : 0;
    const set = new Set((chordNotes || []).map((note)=>pitchIndex(note ?? "C")));
    const openPc = pitchIndex(strings[rowIdx] ?? "E");
    const spcSounding = openPc; // open = fret 0 sounding
    const spc = spcSounding; // shapedは廃止・常にsounding
    // 実音のMIDI（弦の実チューニングの開放音）
    const STRING_OPEN_MIDI = [
        64,
        59,
        55,
        50,
        45,
        40
    ];
    const midi = STRING_OPEN_MIDI[Math.min(rowIdx, STRING_OPEN_MIDI.length - 1)] ?? 64;
    const scaleRoot = overlay.scaleRootPc;
    const scaleType = overlay.scaleType;
    const inScale = (()=>{
        if (typeof scaleRoot !== 'number' || !scaleType) return true;
        const iv = (spc - scaleRoot + 120) % 12;
        const ivs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getScalePitches"])(scaleRoot, overlay.scaleType).map((v)=>(v - scaleRoot + 120) % 12);
        return ivs.includes(iv);
    })();
    const hasChordOverlay = (chordNotes?.length ?? 0) > 0;
    const drawGhost = (overlay.showScaleGhost ?? true) && hasChordOverlay && inScale && !set.has(spc);
    const drawChord = set.has(spc);
    const drawScaleMain = !hasChordOverlay && inScale;
    if (!drawGhost && !drawChord && !drawScaleMain) return null;
    const iv = typeof scaleRoot === 'number' ? (spc - scaleRoot + 120) % 12 : 0;
    const isRoot = iv === 0;
    const isChordTone = [
        0,
        4,
        7,
        10,
        11
    ].includes(iv) && inScale;
    const degreeLbl = !inScale || typeof scaleRoot !== 'number' || !scaleType ? null : (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["degreeLabelFor"])(spc, scaleRoot, overlay.scaleType) ?? null;
    const bg = colorForDegreeLabel(false, degreeLbl, isChordTone, inScale, isRoot);
    const showDegrees = overlay.display === 'degrees';
    const label = showDegrees ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["degreeRomanFor"])(spc, tonicIdx, overlay.scaleType) ?? degreeLbl ?? fallbackDegreeLabel(spc, tonicIdx) : PITCHES12[spc];
    const dense = (()=>{
        const def = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === overlay.scaleType);
        return (def?.degrees?.length ?? 0) > 7;
    })();
    const stringNumber = rowIdx + 1;
    const ariaLabel = `string ${stringNumber}, fret 0, ${label === '1' ? 'root' : label}`;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "absolute inset-0",
        children: [
            drawGhost && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: `absolute left-1/2 top-1/2 fret-dot--ghost${dense ? ' ghost--dense' : ''}`,
                style: {
                    color: COLOR_GHOST
                },
                "aria-hidden": true
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 347,
                columnNumber: 9
            }, this),
            drawScaleMain && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: async ()=>{
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playNote(midi);
                },
                style: dotStyle(bg, isMobile),
                className: "absolute left-1/2 top-1/2 fret-dot fret-dot--main",
                "aria-label": ariaLabel,
                children: label
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 350,
                columnNumber: 9
            }, this),
            drawChord && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                type: "button",
                onClick: async ()=>{
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playNote(midi);
                },
                style: dotStyle(bg, isMobile),
                className: "absolute left-1/2 top-1/2 fret-dot fret-dot--main fret-dot--chord",
                "aria-label": ariaLabel,
                children: label
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 361,
                columnNumber: 9
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/Fretboard.tsx",
        lineNumber: 345,
        columnNumber: 5
    }, this);
}
function renderFormOverlay({ formShape, LEFT_GUTTER, TOP_BAR_H, SPACE_W, ROW_H }) {
    return formShape.dots.map((dot, idx)=>{
        const degree = dot.deg === '1' ? 'root' : dot.deg.replace(/b/g, 'flat ').replace(/#/g, 'sharp ');
        const ariaLabel = `string ${dot.string}, fret ${dot.fret}, ${degree}`;
        const left = `calc(${LEFT_GUTTER}px + ${dot.fret * SPACE_W}px)`;
        const top = `calc(${TOP_BAR_H}px + ${(dot.string - 0.5) * ROW_H}px)`;
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "absolute",
            role: "img",
            "aria-label": ariaLabel,
            style: {
                left,
                top,
                transform: 'translate(-50%, -50%)'
            },
            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "fret-dot--form",
                "aria-hidden": true
            }, void 0, false, {
                fileName: "[project]/src/components/Fretboard.tsx",
                lineNumber: 393,
                columnNumber: 9
            }, this)
        }, `form-${idx}`, false, {
            fileName: "[project]/src/components/Fretboard.tsx",
            lineNumber: 386,
            columnNumber: 7
        }, this);
    });
}
}),
"[project]/src/lib/music/constants.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * 音楽理論の共通定数
 */ /** ピッチクラスの名前（0=C, 1=C#, ..., 11=B） */ __turbopack_context__.s([
    "DEFAULT_MIDI_OCTAVE",
    ()=>DEFAULT_MIDI_OCTAVE,
    "PC_NAMES",
    ()=>PC_NAMES,
    "PITCH_CLASS_COUNT",
    ()=>PITCH_CLASS_COUNT,
    "mod12",
    ()=>mod12,
    "nameToPc",
    ()=>nameToPc,
    "pcToName",
    ()=>pcToName
]);
const PC_NAMES = [
    'C',
    'C#',
    'D',
    'Eb',
    'E',
    'F',
    'F#',
    'G',
    'Ab',
    'A',
    'Bb',
    'B'
];
const PITCH_CLASS_COUNT = 12;
const DEFAULT_MIDI_OCTAVE = 60;
function mod12(pc) {
    return (pc % 12 + 12) % 12;
}
function pcToName(pc) {
    return PC_NAMES[mod12(pc)];
}
function nameToPc(name) {
    const index = PC_NAMES.indexOf(name);
    return index >= 0 ? index : -1;
}
}),
"[project]/src/lib/theory.ts [app-ssr] (ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

// PITCHESは lib/music/constants.ts に移行しました
__turbopack_context__.s([
    "DEG_QUAL_MAJOR",
    ()=>DEG_QUAL_MAJOR,
    "DEG_QUAL_MINOR",
    ()=>DEG_QUAL_MINOR,
    "QUALITY_ALIASES",
    ()=>QUALITY_ALIASES,
    "QUALITY_TONES",
    ()=>QUALITY_TONES,
    "SCALESETS",
    ()=>SCALESETS,
    "classifyChord",
    ()=>classifyChord,
    "detectCadence",
    ()=>detectCadence,
    "formatRomanForDisplay",
    ()=>formatRomanForDisplay,
    "getRecommendedScalesForQuality",
    ()=>getRecommendedScalesForQuality,
    "noteToPc",
    ()=>noteToPc,
    "parseChord",
    ()=>parseChord,
    "pcToNoteName",
    ()=>pcToNoteName,
    "rankKeys",
    ()=>rankKeys,
    "rankScales",
    ()=>rankScales,
    "resolveQuality",
    ()=>resolveQuality,
    "romanToChordSymbol",
    ()=>romanToChordSymbol,
    "scoreKeyCandidates",
    ()=>scoreKeyCandidates,
    "transpose",
    ()=>transpose
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-ssr] (ecmascript)");
;
;
const SCALESETS = {
    ionian: [
        0,
        2,
        4,
        5,
        7,
        9,
        11
    ],
    dorian: [
        0,
        2,
        3,
        5,
        7,
        9,
        10
    ],
    phrygian: [
        0,
        1,
        3,
        5,
        7,
        8,
        10
    ],
    lydian: [
        0,
        2,
        4,
        6,
        7,
        9,
        11
    ],
    mixolydian: [
        0,
        2,
        4,
        5,
        7,
        9,
        10
    ],
    aeolian: [
        0,
        2,
        3,
        5,
        7,
        8,
        10
    ],
    locrian: [
        0,
        1,
        3,
        5,
        6,
        8,
        10
    ],
    locrianNat2: [
        0,
        2,
        3,
        5,
        6,
        8,
        10
    ],
    majPent: [
        0,
        2,
        4,
        7,
        9
    ],
    minPent: [
        0,
        3,
        5,
        7,
        10
    ],
    bluesMin: [
        0,
        3,
        5,
        6,
        7,
        10
    ],
    dimWholeHalf: [
        0,
        2,
        3,
        5,
        6,
        8,
        9,
        11
    ],
    dimHalfWhole: [
        0,
        1,
        3,
        4,
        6,
        7,
        9,
        10
    ],
    altered: [
        0,
        1,
        3,
        4,
        6,
        8,
        10
    ]
};
const QUALITY_ALIASES = {
    // Major family
    'maj': 'M',
    'major': 'M',
    '': 'M',
    'maj7': 'M7',
    'M7': 'M7',
    'Δ': 'M7',
    'Δ7': 'M7',
    'maj9': 'M9',
    'M9': 'M9',
    'Δ9': 'M9',
    'maj11': 'M11',
    'M11': 'M11',
    'maj13': 'M13',
    'M13': 'M13',
    // Minor family
    'min': 'm',
    'mi': 'm',
    '-': 'm',
    'min7': 'm7',
    'mi7': 'm7',
    '-7': 'm7',
    'min9': 'm9',
    'mi9': 'm9',
    'min11': 'm11',
    'mi11': 'm11',
    'min13': 'm13',
    'mi13': 'm13',
    'mM7': 'mMaj7',
    'mMaj7': 'mMaj7',
    'minMaj7': 'mMaj7',
    // Diminished family
    'dim': 'dim',
    '°': 'dim',
    'o': 'dim',
    'dim7': 'dim7',
    '°7': 'dim7',
    'o7': 'dim7',
    'm7b5': 'm7b5',
    'm7♭5': 'm7b5',
    'ø': 'm7b5',
    'ø7': 'm7b5',
    // Augmented family
    'aug': 'aug',
    '+': 'aug',
    'aug7': '7#5',
    '7#5': '7#5',
    '7+5': '7#5',
    '7♯5': '7#5',
    // Suspended
    'sus2': 'sus2',
    'sus4': 'sus4',
    'sus': 'sus4',
    '7sus4': '7sus4',
    '7sus': '7sus4',
    // Sixth chords
    '6': '6',
    'm6': 'm6',
    'min6': 'm6',
    '6/9': '6/9',
    '69': '6/9',
    // Altered/extensions
    '7b5': '7b5',
    '7♭5': '7b5',
    '7-5': '7b5',
    '7b9': '7b9',
    '7♭9': '7b9',
    '7-9': '7b9',
    '7#9': '7#9',
    '7♯9': '7#9',
    '7+9': '7#9',
    '7b13': '7b13',
    '7♭13': '7b13',
    '7#11': '7#11',
    '7♯11': '7#11',
    '7(9)': '9',
    '7(11)': '11',
    '7(13)': '13',
    'm7(9)': 'm9',
    'm7(11)': 'm11',
    'M7(9)': 'M9',
    'M7(13)': 'M13',
    '7alt': '7alt',
    '7altered': '7alt'
};
function resolveQuality(qual) {
    return QUALITY_ALIASES[qual] ?? qual;
}
const QUALITY_TONES = {
    // Basic triads (Core)
    M: [
        0,
        4,
        7
    ],
    m: [
        0,
        3,
        7
    ],
    aug: [
        0,
        4,
        8
    ],
    dim: [
        0,
        3,
        6
    ],
    // Suspended (Core)
    sus2: [
        0,
        2,
        7
    ],
    sus4: [
        0,
        5,
        7
    ],
    // Sixth chords (Core)
    "6": [
        0,
        4,
        7,
        9
    ],
    m6: [
        0,
        3,
        7,
        9
    ],
    "6/9": [
        0,
        4,
        7,
        9,
        14
    ],
    // Seventh chords (Core)
    "7": [
        0,
        4,
        7,
        10
    ],
    M7: [
        0,
        4,
        7,
        11
    ],
    m7: [
        0,
        3,
        7,
        10
    ],
    dim7: [
        0,
        3,
        6,
        9
    ],
    m7b5: [
        0,
        3,
        6,
        10
    ],
    mMaj7: [
        0,
        3,
        7,
        11
    ],
    // Ninth chords (Core)
    "9": [
        0,
        4,
        7,
        10,
        14
    ],
    M9: [
        0,
        4,
        7,
        11,
        14
    ],
    m9: [
        0,
        3,
        7,
        10,
        14
    ],
    add9: [
        0,
        4,
        7,
        14
    ],
    madd9: [
        0,
        3,
        7,
        14
    ],
    // Extended chords (Advanced)
    "11": [
        0,
        4,
        7,
        10,
        14,
        17
    ],
    M11: [
        0,
        4,
        7,
        11,
        14,
        17
    ],
    m11: [
        0,
        3,
        7,
        10,
        14,
        17
    ],
    "13": [
        0,
        4,
        7,
        10,
        14,
        21
    ],
    M13: [
        0,
        4,
        7,
        11,
        14,
        21
    ],
    m13: [
        0,
        3,
        7,
        10,
        14,
        21
    ],
    // Altered/Sus7 (Core & Advanced)
    "7sus4": [
        0,
        5,
        7,
        10
    ],
    "7b5": [
        0,
        4,
        6,
        10
    ],
    "7#5": [
        0,
        4,
        8,
        10
    ],
    "7b9": [
        0,
        4,
        7,
        10,
        13
    ],
    "7#9": [
        0,
        4,
        7,
        10,
        15
    ],
    "7#11": [
        0,
        4,
        7,
        10,
        18
    ],
    "7b13": [
        0,
        4,
        7,
        10,
        20
    ],
    "7alt": [
        0,
        4,
        7,
        10,
        13,
        15,
        18
    ]
};
const noteToPc = (n)=>{
    const i = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"].indexOf(n);
    if (i >= 0) return i;
    const flatMap = {
        Db: "C#",
        Gb: "F#",
        Ab: "G#",
        Bb: "A#",
        Eb: "D#",
        Cb: "B",
        Fb: "E"
    };
    const up = flatMap[n] ?? n;
    return __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"].indexOf(up);
};
function pcToNoteName(pc, keyRoot, mode) {
    if (keyRoot === undefined) {
        // キー情報がない場合は♭優先（Chord Libraryと同じ）
        const flatPreferred = [
            "C",
            "C#",
            "D",
            "Eb",
            "E",
            "F",
            "F#",
            "G",
            "Ab",
            "A",
            "Bb",
            "B"
        ];
        return flatPreferred[pc];
    }
    // ♯系キーと♭系キーを判定
    const sharpKeys = [
        7,
        2,
        9,
        4,
        11,
        6,
        1
    ]; // G, D, A, E, B, F#, C#
    const flatKeys = [
        5,
        10,
        3,
        8,
        1,
        6,
        11
    ]; // F, Bb, Eb, Ab, Db, Gb, Cb
    const isSharpKey = sharpKeys.includes(keyRoot);
    if (isSharpKey) {
        // ♯系キー: C, C#, D, D#, E, F, F#, G, G#, A, A#, B
        const sharpNames = [
            "C",
            "C#",
            "D",
            "D#",
            "E",
            "F",
            "F#",
            "G",
            "G#",
            "A",
            "A#",
            "B"
        ];
        return sharpNames[pc];
    } else {
        // ♭系キー（またはC): C, Db, D, Eb, E, F, Gb, G, Ab, A, Bb, B
        const flatNames = [
            "C",
            "Db",
            "D",
            "Eb",
            "E",
            "F",
            "Gb",
            "G",
            "Ab",
            "A",
            "Bb",
            "B"
        ];
        return flatNames[pc];
    }
}
const transpose = (pc, by)=>(pc + by + 12) % 12;
function parseChord(sym) {
    const slash = sym.split("/");
    const main = slash[0];
    const m = main.match(/^([A-G](#|b)?)(.*)$/);
    if (!m) throw new Error("bad chord: " + sym);
    const root = noteToPc(m[1]);
    const rawQual = (m[3] || "").trim() || "";
    const qual = resolveQuality(rawQual || "M"); // エイリアス正規化を通す
    const tonesRel = QUALITY_TONES[qual] ?? QUALITY_TONES.M;
    const tones = tonesRel.map((iv)=>transpose(root, iv % 12)); // mod12で正規化
    const bass = slash[1] ? noteToPc(slash[1]) : undefined;
    return {
        root,
        qual,
        bass,
        tones
    };
}
const DEG_QUAL_MAJOR = {
    0: [
        "M",
        "M7"
    ],
    2: [
        "m",
        "m7"
    ],
    4: [
        "m",
        "m7"
    ],
    5: [
        "M",
        "M7"
    ],
    7: [
        "M",
        "7"
    ],
    9: [
        "m",
        "m7"
    ],
    11: [
        "dim",
        "m7b5"
    ]
};
const DEG_QUAL_MINOR = {
    0: [
        "m",
        "m7"
    ],
    2: [
        "dim",
        "m7b5"
    ],
    3: [
        "M",
        "M7"
    ],
    5: [
        "m",
        "m7"
    ],
    7: [
        "m",
        "7",
        "M",
        "7"
    ],
    8: [
        "M",
        "M7"
    ],
    10: [
        "M",
        "7"
    ]
};
function rankKeys(chords) {
    const parsed = chords.map(parseChord);
    const candidates = [];
    for(let r = 0; r < 12; r++)candidates.push({
        root: r,
        mode: "Major"
    }, {
        root: r,
        mode: "Minor"
    });
    const maxPerChord = 3;
    const bonuses = 3;
    const denom = parsed.length * maxPerChord + bonuses;
    const res = candidates.map(({ root, mode })=>{
        const table = mode === "Major" ? DEG_QUAL_MAJOR : DEG_QUAL_MINOR;
        let s = 0;
        parsed.forEach((c, idx)=>{
            const deg = (c.root - root + 12) % 12;
            const expected = table[deg];
            if (expected) {
                if (expected.includes(c.qual)) s += 3;
                else s += 2;
            } else {
                const scale = mode === "Major" ? SCALESETS.ionian : SCALESETS.aeolian;
                const inScale = c.tones.every((t)=>scale.includes((t - root + 12) % 12));
                if (inScale) s += 1;
            }
            if (idx > 0) {
                const prevDeg = (parsed[idx - 1].root - root + 12) % 12;
                // 五度下行（循環）を一般的に評価: a→b が完全5度下行（-7半音＝+5半音）
                const fifthsDown = (prevDeg - deg + 12) % 12 === 7;
                if (fifthsDown) s += 1; // 五度下行ボーナス（ii→V, V→I, vi→ii, etc.）
            }
        });
        const firstDeg = (parsed[0].root - root + 12) % 12;
        if (mode === "Major" && (firstDeg === 0 || firstDeg === 9)) s += 2;
        if (mode === "Minor" && (firstDeg === 0 || firstDeg === 3)) s += 2;
        const pct = Math.round(s / Math.max(denom, 1) * 100);
        const label = `${__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"][root]} ${mode}`;
        return {
            keyRoot: root,
            mode,
            label,
            score: s,
            pct
        };
    });
    return res.sort((a, b)=>b.score - a.score);
}
function getRecommendedScalesForQuality(quality) {
    const q = resolveQuality(quality);
    switch(q){
        case 'm7b5':
            return [
                {
                    name: "Locrian ♮2",
                    scaleKey: "locrianNat2"
                },
                {
                    name: "Locrian",
                    scaleKey: "locrian"
                }
            ];
        case 'dim':
        case 'dim7':
            return [
                {
                    name: "Diminished (W-H)",
                    scaleKey: "dimWholeHalf"
                }
            ];
        case '7b9':
            return [
                {
                    name: "Diminished (H-W)",
                    scaleKey: "dimHalfWhole"
                },
                {
                    name: "Mixolydian ♭9♭13",
                    scaleKey: "altered"
                } // 近似
            ];
        case '7alt':
            return [
                {
                    name: "Altered",
                    scaleKey: "altered"
                }
            ];
        case '7':
            return [
                {
                    name: "Mixolydian",
                    scaleKey: "mixolydian"
                },
                {
                    name: "Lydian Dominant (Mixolydian ♯11)",
                    scaleKey: "lydian"
                },
                {
                    name: "Altered",
                    scaleKey: "altered"
                }
            ];
        default:
            return [];
    }
}
function rankScales(chords, baseKey) {
    const tones = Array.from(new Set(chords.map(parseChord).flatMap((c)=>c.tones)));
    const root = baseKey.root;
    const defs = baseKey.mode === "Major" ? [
        [
            "Major Scale",
            "ionian"
        ],
        [
            "Major Pentatonic",
            "majPent"
        ],
        [
            "Mixolydian Mode",
            "mixolydian"
        ],
        [
            "Lydian Mode",
            "lydian"
        ]
    ] : [
        [
            "Minor Scale",
            "aeolian"
        ],
        [
            "Minor Pentatonic",
            "minPent"
        ],
        [
            "Dorian Mode",
            "dorian"
        ],
        [
            "Phrygian Mode",
            "phrygian"
        ],
        [
            "Blues (min)",
            "bluesMin"
        ]
    ];
    return defs.map(([disp, key])=>{
        const set = SCALESETS[key].map((iv)=>transpose(root, iv));
        const cover = tones.filter((t)=>set.includes(t)).length;
        const pct = Math.round(100 * cover / Math.max(tones.length, 1));
        return {
            keyRoot: root,
            name: disp,
            label: `${__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"][root]} ${disp}`,
            pct,
            set
        };
    }).sort((a, b)=>b.pct - a.pct);
}
const DEGREE_MAP_MAJOR = {
    0: "I",
    2: "II",
    4: "III",
    5: "IV",
    7: "V",
    9: "VI",
    11: "VII"
};
const DEGREE_MAP_MINOR = {
    0: "i",
    2: "ii",
    3: "III",
    5: "iv",
    7: "v",
    8: "VI",
    10: "VII"
};
function scoreKeyCandidates(prog) {
    const ranked = rankKeys(prog);
    const top = ranked.slice(0, 5); // v3.1: 3→5候補に拡張（iOS UI改善）
    return top.map((r)=>{
        const key = {
            tonic: r.keyRoot,
            mode: r.mode
        };
        const cad = detectCadence(prog, key);
        const reasons = [];
        if (cad === "perfect") reasons.push("Cadence: V→I");
        if (cad === "deceptive") reasons.push("Cadence: V→vi");
        if (cad === "half") reasons.push("Cadence: …→V");
        reasons.unshift(`diatonic fit ${r.pct}%`);
        return {
            tonic: r.keyRoot,
            mode: r.mode,
            confidence: r.pct,
            reasons
        };
    });
}
function classifyChord(chord, key) {
    const diatonic = (()=>{
        const tonicName = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"][key.tonic];
        if (key.mode === "Major") {
            const mk = Key?.majorKey ? Key.majorKey(tonicName) : null;
            return mk?.chords || [];
        } else {
            const nk = Key?.minorKey ? Key.minorKey(tonicName) : null;
            return nk?.natural?.chords || nk?.chords || [];
        }
    })();
    const target = chord.root + (chord.triad === "maj" ? "" : chord.triad === "min" ? "m" : "dim");
    if (diatonic.includes(target)) return "diatonic";
    // secondary dominant: X7 targeting a diatonic
    const isDomLike = chord.triad === "maj" || chord.isDominantLike;
    if (isDomLike) {
        for(let r = 0; r < 12; r++){
            const deg = (r - key.tonic + 12) % 12;
            const table = key.mode === "Major" ? DEG_QUAL_MAJOR : DEG_QUAL_MINOR;
            if (table[deg]) {
                const fifth = transpose(r, 7);
                if (chord.root === fifth) return "secondary";
            }
        }
    }
    // simple borrowed detection in major: iv, bVII, bVI roots
    if (key.mode === "Major") {
        const deg = (chord.root - key.tonic + 12) % 12;
        if (deg === 5 && chord.triad === "min") return "borrowed"; // iv
        if (deg === 10 || deg === 8) return "borrowed"; // bVII, bVI
    }
    return "outside";
}
function detectCadence(prog, key) {
    if (prog.length < 2) return null;
    const last = parseChord(prog[prog.length - 1]);
    const prev = parseChord(prog[prog.length - 2]);
    const degLast = (last.root - key.tonic + 12) % 12;
    const degPrev = (prev.root - key.tonic + 12) % 12;
    if (degPrev === 7 && degLast === 0) return "perfect"; // V→I
    if (degPrev === 7 && degLast === 9) return "deceptive"; // V→vi
    if (degLast === 7) return "half"; // …→V
    return null;
}
// --- Roman Numeral to Chord Symbol Conversion ---
// Roman numeral mapping: Roman表記から度数（0-11）と明示的品質を解析
const ROMAN_MAP = {
    'Ⅰ': {
        offset: 0
    },
    'ⅰ': {
        offset: 0
    },
    'Ⅱ': {
        offset: 2
    },
    'ⅱ': {
        offset: 2
    },
    '♭Ⅱ': {
        offset: 1
    },
    '♭ⅱ': {
        offset: 1
    },
    'Ⅲ': {
        offset: 4
    },
    'ⅲ': {
        offset: 4
    },
    '♭Ⅲ': {
        offset: 3
    },
    '♭ⅲ': {
        offset: 3
    },
    'Ⅳ': {
        offset: 5
    },
    'ⅳ': {
        offset: 5
    },
    '♯Ⅳ': {
        offset: 6
    },
    '♯ⅳ': {
        offset: 6
    },
    'Ⅴ': {
        offset: 7
    },
    'ⅴ': {
        offset: 7
    },
    '♭Ⅵ': {
        offset: 8
    },
    '♭ⅵ': {
        offset: 8
    },
    'Ⅵ': {
        offset: 9
    },
    'ⅵ': {
        offset: 9
    },
    '♭Ⅶ': {
        offset: 10
    },
    '♭ⅶ': {
        offset: 10
    },
    'Ⅶ': {
        offset: 11
    },
    'ⅶ': {
        offset: 11
    }
};
/**
 * parseRomanNumeral: Roman numeral表記から度数と明示的品質を分離
 * 例: "Ⅱm7" → {deg: 2, explicitQual: "m7"}
 *     "Ⅴ" → {deg: 7, explicitQual: null}
 *     "♭Ⅶ" → {deg: 10, explicitQual: null}
 */ function parseRomanNumeral(roman) {
    // Roman表記の本体と接尾辞を分離
    // 例: "Ⅱm7" → base="Ⅱ", suffix="m7"
    let base = roman;
    let suffix = "";
    // Roman表記のパターンをチェック
    for (const [romanKey, { offset }] of Object.entries(ROMAN_MAP)){
        if (roman.startsWith(romanKey)) {
            base = romanKey;
            suffix = roman.slice(romanKey.length).trim();
            return {
                deg: offset,
                explicitQual: suffix || null
            };
        }
    }
    // マッチしない場合はエラー（または警告）
    console.warn(`Unknown Roman numeral: ${roman}`);
    return {
        deg: 0,
        explicitQual: null
    }; // デフォルトは I（tonic）
}
/**
 * defaultQualityForDegree: 度数とモードに基づいてダイアトニック品質を返す
 * 例: Major key の deg=2 → "m"（ii）
 *     Major key の deg=11 → "dim"（vii°）
 */ function defaultQualityForDegree(deg, mode) {
    const table = mode === "Major" ? DEG_QUAL_MAJOR : DEG_QUAL_MINOR;
    const candidates = table[deg];
    if (!candidates || candidates.length === 0) {
        // ダイアトニックにない度数（借用和音など）は空（Major triad）をデフォルトに
        return "";
    }
    // 第1候補（三和音）を返す
    return candidates[0];
}
function romanToChordSymbol(roman, keyRoot, mode) {
    const { deg, explicitQual } = parseRomanNumeral(roman);
    // 明示的品質がない場合、ダイアトニック品質を補完
    const quality = explicitQual !== null ? explicitQual : defaultQualityForDegree(deg, mode);
    // ルート音を計算（キーの調号に応じて♯/♭を選択）
    const rootPc = (keyRoot + deg) % 12;
    const rootName = pcToNoteName(rootPc, keyRoot, mode);
    // コードシンボルを組み立て
    return `${rootName}${quality}`;
}
function formatRomanForDisplay(degree, quality, mode, keyRoot) {
    // 度数をdiatonic度数にマッピング（0,2,4,5,7,9,11 のみ）
    const diatonicDegrees = {
        0: 1,
        2: 2,
        4: 3,
        5: 4,
        7: 5,
        9: 6,
        11: 7
    };
    const romanNum = diatonicDegrees[degree];
    if (!romanNum) {
        // 非ダイアトニック度数（借用和音など）は変化記号付きで表示
        if (degree === 1) return '♭Ⅱ' + quality; // ♭II
        if (degree === 3) return '♭Ⅲ' + quality; // ♭III
        if (degree === 6) return '♯Ⅳ' + quality; // #IV
        if (degree === 8) return '♭Ⅵ' + quality; // ♭VI
        if (degree === 10) return '♭Ⅶ' + quality; // ♭VII
        return '?'; // 不明
    }
    // 品質から大文字/小文字を決定
    const isMinor = quality.startsWith('m') && !quality.startsWith('maj');
    const isDim = quality.includes('dim') || quality.includes('°') || quality === 'm7b5' || quality === 'ø';
    // ダイアトニック品質を参照して大文字/小文字を決定
    const table = mode === "Major" ? DEG_QUAL_MAJOR : DEG_QUAL_MINOR;
    const expectedQuals = table[degree];
    const isDiatonicMinor = expectedQuals?.some((q)=>q === 'm' || q === 'm7');
    const isDiatonicDim = expectedQuals?.some((q)=>q === 'dim' || q === 'm7b5');
    // Roman数字の基本形
    const romanNumerals = [
        'I',
        'II',
        'III',
        'IV',
        'V',
        'VI',
        'VII'
    ];
    let romanBase = romanNumerals[romanNum - 1];
    // SSOT準拠: I, ii, iii, IV, V, vi, vii°
    // Major key: I, ii, iii, IV, V, vi, vii°
    // Minor key: i, ii°, III, iv, v/V, VI, VII
    if (mode === "Major") {
        // I, IV, V は大文字、ii, iii, vi は小文字、vii° は小文字+°
        if ([
            1,
            4,
            5
        ].includes(romanNum) && !isMinor && !isDim) {
            romanBase = romanBase; // 大文字のまま
        } else if (isDim || isDiatonicDim) {
            romanBase = romanBase.toLowerCase() + '°'; // vii°
        } else {
            romanBase = romanBase.toLowerCase(); // ii, iii, vi
        }
    } else {
        // Minor key: i, ii°, III, iv, v/V, VI, VII
        if ([
            3,
            6,
            7
        ].includes(romanNum) && !isMinor && !isDim) {
            romanBase = romanBase; // III, VI, VII は大文字
        } else if (romanNum === 5) {
            // v と V の両方あり（harmonic minor の V）
            romanBase = isMinor ? 'v' : 'V';
        } else if (isDim || isDiatonicDim) {
            romanBase = romanBase.toLowerCase() + '°'; // ii°
        } else {
            romanBase = romanBase.toLowerCase(); // i, iv
        }
    }
    // 7thなどの拡張を追加（dim以外）
    let extension = '';
    if (!isDim && quality && quality !== 'm' && quality !== '') {
        // 7, M7, m7, sus4などをそのまま付加
        extension = quality.replace('m', '').replace('M', 'maj'); // m7 → 7, M7 → maj7
        if (isMinor && extension.startsWith('7')) {
            // マイナーコードの場合、m7 → 7 と表示（既に小文字で示されているため）
            extension = extension;
        }
    }
    return romanBase + extension;
}
}),
"[project]/src/lib/music/constants.ts [app-ssr] (ecmascript) <export PC_NAMES as PITCHES>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "PITCHES",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"]
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-ssr] (ecmascript)");
}),
"[project]/src/lib/theory/diatonic.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "diatonicTriads",
    ()=>diatonicTriads,
    "romanOfTriad",
    ()=>romanOfTriad,
    "triadToChordSym",
    ()=>triadToChordSym
]);
function diatonicTriads({ tonicPc, scaleIntervals }) {
    const pcs = scaleIntervals.map((iv)=>(tonicPc + iv + 120) % 12);
    const triads = [];
    for(let i = 0; i < 7; i++){
        const deg = i % 7;
        const r = pcs[deg];
        const t = pcs[(deg + 2) % 7];
        const f = pcs[(deg + 4) % 7];
        const q = qualityOfTriad(r, t, f);
        triads.push({
            degree: i + 1,
            rootPc: r,
            pcs: [
                r,
                t,
                f
            ],
            quality: q
        });
    }
    return triads;
}
function qualityOfTriad(r, t, f) {
    // intervals from root in semitones (mod 12)
    const third = (t - r + 12) % 12;
    const fifth = (f - r + 12) % 12;
    if (third === 4 && fifth === 7) return 'maj';
    if (third === 3 && fifth === 7) return 'min';
    if (third === 3 && fifth === 6) return 'dim';
    if (third === 4 && fifth === 8) return 'aug';
    // fallback: closest common qualities
    if (fifth === 6) return 'dim';
    if (fifth === 8) return 'aug';
    return third < 4 ? 'min' : 'maj';
}
const ROMAN_UP = [
    "I",
    "II",
    "III",
    "IV",
    "V",
    "VI",
    "VII"
];
function romanOfTriad(degree, quality, opts) {
    const base = ROMAN_UP[degree - 1];
    const mode = opts?.case ?? 'upper';
    if (mode === 'upper') {
        // Always uppercase; add dimin./aug symbols
        if (quality === 'dim') return base + '°';
        if (quality === 'aug') return base + '+';
        return base;
    }
    // case: 'quality' → major uppercase, minor lowercase, diminished lowercase+°
    if (quality === 'min') return base.toLowerCase();
    if (quality === 'dim') return base.toLowerCase() + '°';
    if (quality === 'aug') return base + '+';
    return base; // maj
}
// Convert a triad (rootPc + quality) to a simple chord symbol (e.g., C, Cm, Cdim, C+)
const PC_TO_NAME = [
    'C',
    'C#',
    'D',
    'Eb',
    'E',
    'F',
    'F#',
    'G',
    'Ab',
    'A',
    'Bb',
    'B'
];
function triadToChordSym(t) {
    const root = PC_TO_NAME[t.rootPc % 12];
    if (t.quality === 'maj') return root;
    if (t.quality === 'min') return root + 'm';
    if (t.quality === 'dim') return root + 'dim';
    return root + '+'; // aug
}
}),
"[project]/src/lib/theory/roman.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Roman numeral utilities for chord degree display
// Mode and functions are intentionally minimal and self-contained.
__turbopack_context__.s([
    "ROMAN_NUMERALS_MAJOR",
    ()=>ROMAN_NUMERALS_MAJOR,
    "ROMAN_NUMERALS_MINOR",
    ()=>ROMAN_NUMERALS_MINOR,
    "progressionToRoman",
    ()=>progressionToRoman,
    "toRoman",
    ()=>toRoman
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/src/lib/theory.ts [app-ssr] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-ssr] (ecmascript) <export PC_NAMES as PITCHES>");
;
// Ionian/Aeolian degree maps → roman index
const DEGREE_TO_INDEX_MAJOR = {
    0: 0,
    2: 1,
    4: 2,
    5: 3,
    7: 4,
    9: 5,
    11: 6
};
const DEGREE_TO_INDEX_MINOR = {
    0: 0,
    2: 1,
    3: 2,
    5: 3,
    7: 4,
    8: 5,
    10: 6
};
const ROMAN_NUMERALS_MAJOR = [
    "I",
    "ii",
    "iii",
    "IV",
    "V",
    "vi",
    "vii°"
];
const ROMAN_NUMERALS_MINOR = [
    "i",
    "ii°",
    "III",
    "iv",
    "v",
    "VI",
    "VII"
];
function isMaj7(sym) {
    return /maj7|M7/.test(sym);
}
function hasGeneric7(sym) {
    // append "7" for dominant/mi7 etc. but avoid maj7 and m7b5/dim7
    if (isMaj7(sym)) return false;
    if (/m7b5|ø|dim7/.test(sym)) return false;
    return /(\b|[^a-zA-Z])7(?![b#0-9])/i.test(sym) || /\bm7\b/i.test(sym);
}
function normalizePcName(input) {
    const pc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["noteToPc"])(input);
    return __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][pc] ?? input;
}
function toRoman(chordSym, keyRoot, mode, opts = {}) {
    // Default: prefer diatonic mapping; only use accidentals when明示
    const { showQuality = true, accidentalsForNonDiatonic = false } = opts;
    if (!chordSym || !keyRoot) return "";
    const keyPc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["noteToPc"])(keyRoot);
    // Parse root (head of symbol, before slash)
    const head = chordSym.split("/")[0];
    const m = head.match(/^([A-G](?:#|b)?)(.*)$/i);
    if (!m) return chordSym;
    const chordRoot = normalizePcName(m[1].toUpperCase());
    const rest = m[2] || "";
    const deg = ((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["noteToPc"])(chordRoot) - keyPc + 12) % 12;
    const degreeTable = mode === "major" ? DEGREE_TO_INDEX_MAJOR : DEGREE_TO_INDEX_MINOR;
    const romanBase = mode === "major" ? ROMAN_NUMERALS_MAJOR : ROMAN_NUMERALS_MINOR;
    const romanUpper = [
        "I",
        "II",
        "III",
        "IV",
        "V",
        "VI",
        "VII"
    ];
    const idx = degreeTable[deg];
    if (idx !== undefined) {
        let roman = opts.uppercase ? romanUpper[idx] : romanBase[idx];
        // preserve diminished mark when forcing uppercase
        if (opts.uppercase) {
            if (mode === "major" && idx === 6 || mode === "minor" && idx === 1) {
                roman += "°";
            }
        }
        if (!showQuality) return roman;
        if (isMaj7(rest)) return roman + "M7";
        if (hasGeneric7(rest)) return roman + "7";
        return roman;
    }
    // Try single-step accidentals (# or b) relative to scale degrees
    if (accidentalsForNonDiatonic) {
        const scale = mode === "major" ? [
            0,
            2,
            4,
            5,
            7,
            9,
            11
        ] : [
            0,
            2,
            3,
            5,
            7,
            8,
            10
        ];
        for(let j = 0; j < scale.length; j++){
            const s = scale[j];
            if ((s + 1) % 12 === deg) {
                return "#" + romanBase[j];
            }
            if ((s + 11) % 12 === deg) {
                return "b" + romanBase[j];
            }
        }
    }
    // Fallback: actual root
    return `(${chordRoot})`;
}
function progressionToRoman(chords, keyRoot, mode) {
    return chords.map((c)=>toRoman(c, keyRoot, mode));
}
}),
"[project]/src/lib/analysis/scoreScales.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "scoreScales",
    ()=>scoreScales
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/src/lib/theory.ts [app-ssr] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-ssr] (ecmascript)");
;
;
const CANDIDATE_TYPES_MAJOR = [
    "Ionian",
    "Lydian",
    "Mixolydian",
    "MajorPentatonic"
];
const CANDIDATE_TYPES_MINOR = [
    "Aeolian",
    "Dorian",
    "Phrygian",
    "HarmonicMinor",
    "MelodicMinor",
    "MinorPentatonic"
];
function uniq(arr) {
    return Array.from(new Set(arr));
}
function scoreScales(prog, key) {
    const types = key.mode === "Major" ? CANDIDATE_TYPES_MAJOR : CANDIDATE_TYPES_MINOR;
    const chordPcs = uniq(prog.flatMap((ch)=>{
        const p = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["parseChord"])(ch);
        const thirds = p.qual.includes("m") ? 3 : 4;
        const sevenths = p.qual.includes("7") ? p.qual.includes("M7") ? 11 : 10 : null;
        const pcs = [
            p.root % 12,
            (p.root + thirds) % 12,
            (p.root + 7) % 12
        ];
        if (sevenths !== null) pcs.push((p.root + sevenths) % 12);
        return pcs;
    }));
    const hasV7 = prog.some((ch)=>/7\b/.test(ch));
    return types.map((type)=>{
        const scale = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getScalePitches"])(key.root, type);
        const hit = chordPcs.filter((pc)=>scale.includes(pc)).length;
        const cover = hit / Math.max(1, chordPcs.length);
        // ---- bonuses (max total 0.05) ----
        let bonus = 0;
        if (key.mode === "Major" && type === "Ionian") bonus += 0.02;
        if (key.mode === "Minor" && type === "Aeolian") bonus += 0.02;
        if (hasV7 && (type === "HarmonicMinor" || type === "MelodicMinor")) bonus += 0.03;
        const raw = Math.min(1, cover + bonus);
        const score = Math.round(raw * 100);
        return {
            root: key.root,
            type,
            score
        };
    }).sort((a, b)=>b.score - a.score);
}
}),
"[project]/src/lib/roman.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "progressionToRoman",
    ()=>progressionToRoman,
    "romanizeChord",
    ()=>romanizeChord
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/src/lib/theory.ts [app-ssr] (ecmascript) <locals>");
;
;
const ROMAN_UPPER = [
    "I",
    "II",
    "III",
    "IV",
    "V",
    "VI",
    "VII"
];
function baseRomanFromDegreeLabel(lbl) {
    if (!lbl) return "I";
    const n = Number(lbl.replace(/[♭#]/g, ""));
    const idx = isFinite(n) ? Math.max(1, Math.min(7, n)) - 1 : 0;
    return ROMAN_UPPER[idx];
}
function qualitySuffix(qual) {
    return /7/.test(qual) ? "7" : "";
}
function diminishedSymbol(qual) {
    return /dim|o/.test(qual) ? "°" : "";
}
function romanizeChord(chord, tonicPc, scaleType) {
    const { root, qual } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["parseChord"])(chord);
    const effectiveType = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["parentModeOf"])(scaleType) ?? scaleType;
    // try exact degree label first
    let lbl = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["degreeLabelFor"])(root, tonicPc, effectiveType);
    let accidental = lbl?.startsWith("♭") ? "♭" : lbl?.startsWith("#") ? "♯" : "";
    // if null, try ±1 semitone nearest mapping
    if (!lbl) {
        const pcs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getScalePitches"])(tonicPc, effectiveType); // absolute pcs
        const minus = (root + 12 - 1) % 12;
        const plus = (root + 1) % 12;
        const idxMinus = pcs.indexOf(minus);
        const idxPlus = pcs.indexOf(plus);
        if (idxMinus !== -1) {
            lbl = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["degreeLabelFor"])(minus, tonicPc, effectiveType); // e.g., "3"
            accidental = "♭";
        } else if (idxPlus !== -1) {
            lbl = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["degreeLabelFor"])(plus, tonicPc, effectiveType);
            accidental = "♯";
        }
    }
    const base = baseRomanFromDegreeLabel(lbl);
    const sym = diminishedSymbol(qual);
    const suf = qualitySuffix(qual);
    return `${accidental}${base}${sym}${suf}`;
}
function progressionToRoman(chords, tonicPc, scaleType) {
    return chords.map((c)=>romanizeChord(c, tonicPc, scaleType));
}
}),
"[project]/src/lib/capo/recommend.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Capo recommendation utilities
// Heuristic scoring favoring open-string friendly shapes
__turbopack_context__.s([
    "classifyScaleFlavor",
    ()=>classifyScaleFlavor,
    "recommendCapos",
    ()=>recommendCapos,
    "transposeDown",
    ()=>transposeDown
]);
function classifyScaleFlavor(scaleType) {
    const maj = [
        'Major',
        'Ionian',
        'Lydian',
        'Mixolydian',
        'Major Pentatonic'
    ];
    const t = scaleType.toLowerCase();
    for (const s of maj)if (t.includes(s.toLowerCase())) return 'majorish';
    return 'minorish';
}
// Open-chord ease per family (I..VII)
const MAJOR_FAMILY_SCORES = {
    C: [
        3,
        3,
        3,
        1,
        3,
        3,
        0
    ],
    G: [
        3,
        3,
        1,
        3,
        3,
        3,
        0
    ],
    D: [
        3,
        3,
        1,
        3,
        3,
        1,
        0
    ],
    A: [
        3,
        1,
        1,
        3,
        2,
        1,
        0
    ],
    E: [
        3,
        1,
        0,
        3,
        1,
        1,
        0
    ]
};
const MINOR_FAMILY_SCORES = {
    Am: [
        3,
        0,
        3,
        3,
        3,
        1,
        3
    ],
    Em: [
        3,
        0,
        3,
        3,
        1,
        3,
        3
    ],
    Dm: [
        3,
        0,
        1,
        0,
        3,
        0,
        3
    ]
};
function fretWeight(n) {
    if (n <= 5) return 1.0;
    if (n <= 7) return 0.92;
    if (n <= 9) return 0.82;
    return 0.7;
}
function transposeDown(pc, n) {
    return ((pc - n) % 12 + 12) % 12;
}
const NATURAL_NAME = {
    0: 'C',
    1: 'C#',
    2: 'D',
    3: 'Eb',
    4: 'E',
    5: 'F',
    6: 'F#',
    7: 'G',
    8: 'Ab',
    9: 'A',
    10: 'Bb',
    11: 'B'
};
function recommendCapos(key, scale, topN = 3, opts = {}) {
    const includeOpen = opts.includeOpen ?? true;
    const flavor = classifyScaleFlavor(scale.type);
    const picks = [];
    for(let n = 0; n <= 11; n++){
        if (!includeOpen && n === 0) continue;
        const shapedPc = transposeDown(key.tonic, n);
        const name = NATURAL_NAME[shapedPc];
        if (flavor === 'majorish') {
            const famMap = {
                C: 'C',
                G: 'G',
                D: 'D',
                A: 'A',
                E: 'E'
            };
            const fam = famMap[name];
            if (!fam) continue;
            const base = MAJOR_FAMILY_SCORES[fam].reduce((a, b)=>a + b, 0);
            const bonus = MAJOR_FAMILY_SCORES[fam][0] >= 2 && MAJOR_FAMILY_SCORES[fam][3] >= 2 && MAJOR_FAMILY_SCORES[fam][4] >= 2 ? 2 : 0;
            const score = (base + bonus) * fretWeight(n);
            picks.push({
                capo: n,
                playAs: fam,
                score,
                reasons: [
                    `I–IV–V ${bonus ? '◎' : '○'}`,
                    `open ${base}/16`,
                    n === 0 ? 'open' : `capo ${n}`
                ]
            });
        } else {
            const famMap = {
                A: 'Am',
                E: 'Em',
                D: 'Dm'
            };
            const fam = famMap[name];
            if (!fam) continue;
            const base = MINOR_FAMILY_SCORES[fam].reduce((a, b)=>a + b, 0);
            const bonus = MINOR_FAMILY_SCORES[fam][0] >= 2 && MINOR_FAMILY_SCORES[fam][3] >= 2 ? 2 : 0;
            const score = (base + bonus) * fretWeight(n);
            picks.push({
                capo: n,
                playAs: fam,
                score,
                reasons: [
                    `i–iv ${bonus ? '◎' : '○'}`,
                    `open ${base}/16`,
                    n === 0 ? 'open' : `capo ${n}`
                ]
            });
        }
    }
    return picks.sort((a, b)=>b.score - a.score).slice(0, topN);
}
}),
"[project]/src/store/analysisStore.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useAnalysisStore",
    ()=>useAnalysisStore
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zustand$2f$esm$2f$react$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zustand/esm/react.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/src/lib/theory.ts [app-ssr] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$analysis$2f$scoreScales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/analysis/scoreScales.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$roman$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/roman.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/diatonic.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/capo/recommend.ts [app-ssr] (ecmascript)");
;
;
;
;
;
;
;
const useAnalysisStore = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zustand$2f$esm$2f$react$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["create"])((set, get)=>({
        keyCandidates: [],
        capo: null,
        viewMode: "sounding",
        scaleCandidates: [],
        selectedScale: null,
        romanTokens: [],
        romanText: "",
        diatonic: null,
        recommendedCapos: [],
        analyze: (prog)=>{
            set((state)=>{
                const cands = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["scoreKeyCandidates"])(prog);
                // 既存選択がある場合でも、トップ候補と±4pt以上差があればトップへ切替（誤維持防止）
                const top = cands[0];
                const keep = state.selectedKey && cands.find((c)=>c.tonic === state.selectedKey.tonic && c.mode === state.selectedKey.mode);
                const shouldKeep = (()=>{
                    if (!keep || !top) return false;
                    const diff = Math.abs((keep.confidence || 0) - (top.confidence || 0));
                    return diff < 4; // 近差のみ維持
                })();
                const nextSel = shouldKeep && state.selectedKey ? state.selectedKey : top ? {
                    tonic: top.tonic,
                    mode: top.mode
                } : undefined;
                const sc = nextSel ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$analysis$2f$scoreScales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["scoreScales"])(prog, {
                    root: nextSel.tonic,
                    mode: nextSel.mode
                }) : [];
                const selScale = sc[0] ?? null;
                const romanTokens = nextSel && selScale ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$roman$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["progressionToRoman"])(prog, nextSel.tonic, selScale.type) : [];
                const diatonic = (()=>{
                    if (!nextSel || !selScale) return null;
                    const tonic = nextSel.tonic;
                    let st = selScale.type;
                    let intervals = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st] ?? [];
                    if (intervals.length < 7) {
                        const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                        if (parent) {
                            st = parent;
                            intervals = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent] ?? [];
                        }
                    }
                    if (!intervals.length) return null;
                    const triads = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                        tonicPc: tonic,
                        scaleIntervals: intervals
                    });
                    const romans = triads.map((t)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["romanOfTriad"])(t.degree, t.quality, {
                            case: 'upper'
                        }));
                    return {
                        triads,
                        romans
                    };
                })();
                const recommendedCapos = nextSel && selScale ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["recommendCapos"])({
                    tonic: nextSel.tonic,
                    mode: nextSel.mode
                }, {
                    type: selScale.type
                }, 3, {
                    includeOpen: false
                }) : [];
                return {
                    keyCandidates: cands,
                    selectedKey: nextSel,
                    scaleCandidates: sc,
                    selectedScale: selScale,
                    lastProg: prog,
                    romanTokens,
                    romanText: romanTokens.join(" – "),
                    diatonic,
                    recommendedCapos
                };
            });
        },
        selectKey: (key)=>set((state)=>{
                const prog = state.lastProg ?? [];
                const sc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$analysis$2f$scoreScales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["scoreScales"])(prog, {
                    root: key.tonic,
                    mode: key.mode
                });
                const selScale = sc[0] ?? null;
                const romanTokens = selScale ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$roman$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["progressionToRoman"])(prog, key.tonic, selScale.type) : [];
                const diatonic = (()=>{
                    if (!selScale) return null;
                    let st = selScale.type;
                    let intervals = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st] ?? [];
                    if (intervals.length < 7) {
                        const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                        if (parent) {
                            st = parent;
                            intervals = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent] ?? [];
                        }
                    }
                    if (!intervals.length) return null;
                    const triads = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                        tonicPc: key.tonic,
                        scaleIntervals: intervals
                    });
                    const romans = triads.map((t)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["romanOfTriad"])(t.degree, t.quality, {
                            case: 'upper'
                        }));
                    return {
                        triads,
                        romans
                    };
                })();
                const recommendedCapos = selScale ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["recommendCapos"])({
                    tonic: key.tonic,
                    mode: key.mode
                }, {
                    type: selScale.type
                }, 3, {
                    includeOpen: false
                }) : [];
                return {
                    selectedKey: key,
                    scaleCandidates: sc,
                    selectedScale: selScale,
                    romanTokens,
                    romanText: romanTokens.join(" – "),
                    diatonic,
                    recommendedCapos
                };
            }),
        selectScale: (s)=>set((state)=>{
                const prog = state.lastProg ?? [];
                const key = state.selectedKey;
                const tokens = prog.length && key ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$roman$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["progressionToRoman"])(prog, key.tonic, s.type) : [];
                const diatonic = (()=>{
                    if (!key) return null;
                    let st = s.type;
                    let intervals = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st] ?? [];
                    if (intervals.length < 7) {
                        const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                        if (parent) {
                            st = parent;
                            intervals = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent] ?? [];
                        }
                    }
                    if (!intervals.length) return null;
                    const triads = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                        tonicPc: key.tonic,
                        scaleIntervals: intervals
                    });
                    const romans = triads.map((t)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["romanOfTriad"])(t.degree, t.quality, {
                            case: 'upper'
                        }));
                    return {
                        triads,
                        romans
                    };
                })();
                const recommendedCapos = key ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["recommendCapos"])({
                    tonic: key.tonic,
                    mode: key.mode
                }, {
                    type: s.type
                }, 3, {
                    includeOpen: false
                }) : [];
                return {
                    selectedScale: s,
                    romanTokens: tokens,
                    romanText: tokens.join(" – "),
                    diatonic,
                    recommendedCapos
                };
            }),
        chooseCapo: (option)=>set({
                capo: {
                    capo: option.capo,
                    shapedKey: option.shapedKey
                }
            }),
        setViewMode: (v)=>set({
                viewMode: v
            }),
        reset: ()=>set({
                keyCandidates: [],
                selectedKey: undefined,
                analysis: undefined,
                capo: null,
                viewMode: "sounding",
                scaleCandidates: [],
                selectedScale: null,
                lastProg: []
            })
    }));
}),
"[project]/src/lib/ui/cadence.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "cadenceTooltip",
    ()=>cadenceTooltip,
    "formatCadenceLabel",
    ()=>formatCadenceLabel,
    "formatCadenceShort",
    ()=>formatCadenceShort
]);
function formatCadenceLabel(t, tailRoman) {
    if (!t) return 'Cadence: —';
    if (t === 'perfect') return `Cadence: Perfect (${tailRoman?.from ?? 'V'} → ${tailRoman?.to ?? 'I'})`;
    if (t === 'deceptive') return `Cadence: Deceptive (${tailRoman?.from ?? 'V'} → ${tailRoman?.to ?? 'vi'})`;
    // half cadence ends on V
    return `Cadence: Half (${tailRoman?.from ? `${tailRoman.from} → ` : '… → '}V)`;
}
function cadenceTooltip(t) {
    if (!t) return 'No cadence detected.';
    if (t === 'perfect') return 'Resolves to the Tonic: V → I. Feels fully resolved.';
    if (t === 'deceptive') return 'Surprises by avoiding I: V → vi (or similar).';
    return 'Phrase ends on the Dominant: … → V. Feels unresolved.';
}
function formatCadenceShort(t, tail) {
    if (!t) return '';
    if (t === 'perfect') return `Perfect (${tail?.from ?? 'V'} → ${tail?.to ?? 'I'})`;
    if (t === 'deceptive') return `Deceptive (${tail?.from ?? 'V'} → ${tail?.to ?? 'vi'})`;
    return `Half (${tail?.from ? `${tail.from} → ` : '… → '}V)`;
}
}),
"[project]/src/components/ui/InfoDot.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>InfoDot
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$dom$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-dom.js [app-ssr] (ecmascript)");
"use client";
;
;
;
function InfoDot({ text, title, children, className = "", linkHref, linkLabel = "Learn more", ariaLabel = "More info", icon = 'info' }) {
    const [open, setOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const ref = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const btnRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [coords, setCoords] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])({
        left: 0,
        top: 0,
        maxW: 320
    });
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const onDoc = (e)=>{
            if (ref.current && !ref.current.contains(e.target)) setOpen(false);
        };
        const onEsc = (e)=>{
            if (e.key === "Escape") setOpen(false);
        };
        document.addEventListener("click", onDoc);
        document.addEventListener("keydown", onEsc);
        return ()=>{
            document.removeEventListener("click", onDoc);
            document.removeEventListener("keydown", onEsc);
        };
    }, []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useLayoutEffect"])(()=>{
        if (!open) return;
        const update = ()=>{
            if (!btnRef.current) return;
            const r = btnRef.current.getBoundingClientRect();
            const maxW = Math.min(Math.floor(window.innerWidth * 0.9), 360);
            const left = Math.min(window.innerWidth - 8 - maxW, Math.max(8, Math.round(r.right - maxW)));
            const top = Math.min(window.innerHeight - 8 - 120, Math.round(r.bottom + 6));
            setCoords({
                left,
                top,
                maxW
            });
        };
        update();
        window.addEventListener("resize", update);
        window.addEventListener("scroll", update, true);
        return ()=>{
            window.removeEventListener("resize", update);
            window.removeEventListener("scroll", update, true);
        };
    }, [
        open
    ]);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: `relative inline-flex items-center ${className}`,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                ref: btnRef,
                type: "button",
                className: "info-dot",
                "aria-label": ariaLabel,
                onClick: ()=>setOpen((o)=>!o),
                children: icon === 'graduation' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                    className: "w-3 h-3",
                    viewBox: "0 0 24 24",
                    fill: "currentColor",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                        d: "M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"
                    }, void 0, false, {
                        fileName: "[project]/src/components/ui/InfoDot.tsx",
                        lineNumber: 68,
                        columnNumber: 13
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/src/components/ui/InfoDot.tsx",
                    lineNumber: 67,
                    columnNumber: 11
                }, this) : 'i'
            }, void 0, false, {
                fileName: "[project]/src/components/ui/InfoDot.tsx",
                lineNumber: 65,
                columnNumber: 7
            }, this),
            open && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$dom$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createPortal"])(/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                role: "dialog",
                className: "info-card",
                style: {
                    position: "fixed",
                    zIndex: 60,
                    left: `${coords.left}px`,
                    top: `${coords.top}px`,
                    maxWidth: `${coords.maxW}px`
                },
                children: [
                    title && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "font-medium mb-1",
                        children: title
                    }, void 0, false, {
                        fileName: "[project]/src/components/ui/InfoDot.tsx",
                        lineNumber: 87,
                        columnNumber: 23
                    }, this),
                    children ? children : (text ?? "").split("\n").map((line, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            children: line
                        }, i, false, {
                            fileName: "[project]/src/components/ui/InfoDot.tsx",
                            lineNumber: 91,
                            columnNumber: 57
                        }, this)),
                    linkHref && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "mt-2 text-right",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("a", {
                            href: linkHref,
                            className: "underline text-[12px] opacity-80",
                            children: linkLabel
                        }, void 0, false, {
                            fileName: "[project]/src/components/ui/InfoDot.tsx",
                            lineNumber: 95,
                            columnNumber: 17
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/src/components/ui/InfoDot.tsx",
                        lineNumber: 94,
                        columnNumber: 15
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ui/InfoDot.tsx",
                lineNumber: 76,
                columnNumber: 11
            }, this), document.body)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/ui/InfoDot.tsx",
        lineNumber: 64,
        columnNumber: 5
    }, this);
}
}),
"[project]/src/components/ui/Heading.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "H2",
    ()=>H2,
    "H3",
    ()=>H3
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
'use client';
;
function H2({ children, className = '', right, as: Tag = 'h2' }) {
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: `mb-2 flex items-center gap-2 ${className}`,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(Tag, {
                className: "text-xl md:text-2xl font-semibold tracking-tight text-foreground",
                children: children
            }, void 0, false, {
                fileName: "[project]/src/components/ui/Heading.tsx",
                lineNumber: 16,
                columnNumber: 7
            }, this),
            right ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "ml-auto",
                children: right
            }, void 0, false, {
                fileName: "[project]/src/components/ui/Heading.tsx",
                lineNumber: 19,
                columnNumber: 16
            }, this) : null
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/ui/Heading.tsx",
        lineNumber: 15,
        columnNumber: 5
    }, this);
}
function H3({ children, className = '', right, as: Tag = 'h3' }) {
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: `mb-1.5 flex items-center gap-2 ${className}`,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(Tag, {
                className: "text-sm md:text-base font-semibold tracking-wide text-foreground",
                children: children
            }, void 0, false, {
                fileName: "[project]/src/components/ui/Heading.tsx",
                lineNumber: 37,
                columnNumber: 7
            }, this),
            right ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "ml-auto text-xs md:text-sm text-muted-foreground",
                children: right
            }, void 0, false, {
                fileName: "[project]/src/components/ui/Heading.tsx",
                lineNumber: 41,
                columnNumber: 9
            }, this) : null
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/ui/Heading.tsx",
        lineNumber: 36,
        columnNumber: 5
    }, this);
}
}),
"[project]/src/lib/music-theory.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "analyzeChordProgression",
    ()=>analyzeChordProgression,
    "getDiatonicChordsFor",
    ()=>getDiatonicChordsFor
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$tonal$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/tonal/dist/index.mjs [app-ssr] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$key$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Key$3e$__ = __turbopack_context__.i("[project]/node_modules/@tonaljs/key/dist/index.mjs [app-ssr] (ecmascript) <export * as Key>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$note$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Note$3e$__ = __turbopack_context__.i("[project]/node_modules/@tonaljs/note/dist/index.mjs [app-ssr] (ecmascript) <export * as Note>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$scale$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Scale$3e$__ = __turbopack_context__.i("[project]/node_modules/@tonaljs/scale/dist/index.mjs [app-ssr] (ecmascript) <export * as Scale>");
;
const ALL_TONICS = [
    "C",
    "C#",
    "D",
    "Eb",
    "E",
    "F",
    "F#",
    "G",
    "Ab",
    "A",
    "Bb",
    "B"
];
// Phase E-5: Default section weights (based on musical importance)
const DEFAULT_SECTION_WEIGHTS = {
    Intro: 0.8,
    Verse: 1.0,
    PreChorus: 1.2,
    Chorus: 1.6,
    PostChorus: 1.3,
    Bridge: 0.9,
    Solo: 1.0,
    Interlude: 0.8,
    Outro: 0.9,
    Breakdown: 0.9,
    Custom: 1.0
};
const DEFAULT_WEIGHTS = {
    songHead: 1.2,
    songTail: 1.3,
    sectionEdge: 1.1
};
const SCALE_DEFS = {
    major: {
        id: "major",
        name: "Major Scale",
        tier: "free"
    },
    naturalMinor: {
        id: "naturalMinor",
        name: "Natural Minor Scale",
        tier: "free"
    },
    majorPent: {
        id: "majorPent",
        name: "Major Pentatonic",
        tier: "free"
    },
    minorPent: {
        id: "minorPent",
        name: "Minor Pentatonic",
        tier: "free"
    },
    blues: {
        id: "blues",
        name: "Blues Scale",
        tier: "free"
    },
    dorian: {
        id: "dorian",
        name: "Dorian Mode",
        tier: "pro"
    },
    mixolydian: {
        id: "mixolydian",
        name: "Mixolydian Mode",
        tier: "pro"
    },
    lydian: {
        id: "lydian",
        name: "Lydian Mode",
        tier: "pro"
    },
    harmonicMinor: {
        id: "harmonicMinor",
        name: "Harmonic Minor",
        tier: "pro"
    },
    melodicMinor: {
        id: "melodicMinor",
        name: "Melodic Minor",
        tier: "pro"
    }
};
function normalizeNote(input) {
    const n = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$note$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Note$3e$__["Note"].pitchClass(input);
    return n || input;
}
function parseChordToken(token) {
    if (!token) return null;
    // Remove bass/slash
    const [head] = token.split("/");
    const m = head.match(/^([A-Ga-g])([#b]?)(.*)$/);
    if (!m) return null;
    const root = normalizeNote((m[1] + m[2]).toUpperCase());
    const rest = (m[3] || "").toLowerCase();
    // Order matters: detect maj before generic m
    let triad = "maj";
    if (/(m7b5|ø|dim)/.test(rest)) triad = "dim";
    else if (/maj/.test(rest)) triad = "maj";
    else if (/(^|[^a-z])m(?!aj)/.test(rest)) triad = "min";
    else if (/sus|aug/.test(rest)) triad = "maj"; // treat as functional major
    else triad = "maj";
    const isDominantLike = /(^|[^a-z])7(?![a-z0-9])/.test(rest) || /7/.test(rest);
    return {
        raw: token,
        root,
        triad,
        isDominantLike
    };
}
function getDiatonicChords(key) {
    if (key.quality === "major") {
        const mk = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$key$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Key$3e$__["Key"].majorKey(key.tonic);
        return mk.chords || [];
    }
    const nk = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$key$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Key$3e$__["Key"].minorKey(key.tonic);
    return nk.natural?.chords || nk.chords || [];
}
function isDiatonicMatch(chord, diatonic) {
    const target = chord.root + (chord.triad === "maj" ? "" : chord.triad === "min" ? "m" : "dim");
    return diatonic.includes(target);
}
function fifth(note) {
    const p = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$note$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Note$3e$__["Note"].transpose(note, "5P");
    return normalizeNote(p);
}
function flat(note) {
    const p = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$note$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Note$3e$__["Note"].transpose(note, "-1m");
    return normalizeNote(p);
}
function isSecondaryDominant(chord, key) {
    // very light-weight V/V detector: major triad (or 7) on degree 2's major? We'll approximate as fifth of fifth
    const v = fifth(key.tonic);
    const vOfV = fifth(v);
    return chord.root === vOfV && (chord.triad === "maj" || chord.isDominantLike);
}
function isSubdominantMinorOrbVII(chord, key) {
    if (key.quality !== "major") return false;
    const mk = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$key$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Key$3e$__["Key"].majorKey(key.tonic);
    const scale = mk.scale || [];
    const degree4 = scale[3];
    const degree7 = scale[6];
    const ivMinor = degree4 ? normalizeNote(degree4) : "";
    const bVII = degree7 ? normalizeNote(flat(degree7)) : "";
    const isIvMinor = chord.root === ivMinor && chord.triad === "min";
    const isB7 = chord.root === bVII && chord.triad === "maj";
    return !!(isIvMinor || isB7);
}
function scoreForKey(chords, key, weights) {
    const diatonic = getDiatonicChords(key);
    let reasons = [];
    // Phase E-5: Use provided weights or fall back to legacy position weights
    const W = weights || chords.map((_, i)=>i === 0 ? 1.2 : i === chords.length - 1 ? 1.3 : 1);
    const total = W.reduce((a, b)=>a + b, 0);
    let acc = 0;
    chords.forEach((ch, i)=>{
        const w = W[i];
        if (isDiatonicMatch(ch, diatonic)) {
            acc += w * 1.0; // 100%
        } else if (isSecondaryDominant(ch, key)) {
            acc += w * 0.9; // 85-95%
            reasons.push(`Secondary dominant tolerated: ${ch.raw}`);
        } else if (isSubdominantMinorOrbVII(ch, key)) {
            acc += w * 0.8; // 70-85%
            reasons.push(`Borrowed chord tolerated: ${ch.raw}`);
        } else {
            acc += w * 0.5; // potential modulation or out-of-key
        }
    });
    const confidence = Math.round(acc / total * 100);
    reasons.unshift(`${diatonic.length} diatonic chords in ${key.tonic} ${key.quality}`);
    return {
        score: confidence,
        reasons
    };
}
function recommendScales(topKey, chords) {
    const list = [
        SCALE_DEFS.major,
        SCALE_DEFS.naturalMinor,
        SCALE_DEFS.majorPent,
        SCALE_DEFS.minorPent,
        SCALE_DEFS.blues,
        SCALE_DEFS.dorian,
        SCALE_DEFS.mixolydian,
        SCALE_DEFS.lydian,
        SCALE_DEFS.harmonicMinor,
        SCALE_DEFS.melodicMinor
    ];
    // Build a set of chord roots to approximate note coverage
    const chordRoots = new Set(chords.map((c)=>c.root));
    const keyTonic = topKey.tonic;
    const scaleScores = list.map((sm)=>{
        const scaleName = sm.id === "major" ? "Major" : sm.id === "naturalMinor" ? "Natural Minor" : sm.id === "majorPent" ? "Major Pentatonic" : sm.id === "minorPent" ? "Minor Pentatonic" : sm.id === "blues" ? "Blues" : sm.id === "dorian" ? "Dorian" : sm.id === "mixolydian" ? "Mixolydian" : sm.id === "lydian" ? "Lydian" : sm.id === "harmonicMinor" ? "Harmonic Minor" : "Melodic Minor";
        const sc = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tonaljs$2f$scale$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__Scale$3e$__["Scale"].get(`${keyTonic} ${scaleName}`);
        const noteSet = new Set((sc.notes || []).map(normalizeNote));
        const matches = Array.from(chordRoots).filter((r)=>noteSet.has(r)).length;
        const score = matches / Math.max(1, chordRoots.size);
        return {
            scale: sm,
            score
        };
    });
    scaleScores.sort((a, b)=>b.score - a.score);
    return scaleScores.slice(0, 5);
}
// Phase E-5: Compute weights for each chord based on sections
function computeWeights(chordCount, opts) {
    const W = new Array(chordCount).fill(1.0);
    const sections = opts.sections || [];
    const sectionWeights = {
        ...DEFAULT_SECTION_WEIGHTS,
        ...opts.weights?.section ?? {}
    };
    const songHead = opts.weights?.songHead ?? DEFAULT_WEIGHTS.songHead;
    const songTail = opts.weights?.songTail ?? DEFAULT_WEIGHTS.songTail;
    const sectionEdge = opts.weights?.sectionEdge ?? DEFAULT_WEIGHTS.sectionEdge;
    // Apply section weights
    for (const s of sections){
        const repeat = s.repeat ?? 1;
        const base = (s.weightMul ?? sectionWeights[s.name] ?? 1.0) * Math.sqrt(repeat);
        for(let i = s.start; i <= s.end && i < chordCount; i++){
            W[i] *= base;
        }
        // Section edge bonus
        if (s.start < chordCount) W[s.start] *= sectionEdge;
        if (s.end < chordCount) W[s.end] *= sectionEdge;
    }
    // Song-level head/tail bonus (legacy compatibility)
    if (chordCount > 0) W[0] *= songHead;
    if (chordCount > 1) W[chordCount - 1] *= songTail;
    // Normalize (Σ W = 1)
    const sumW = W.reduce((a, b)=>a + b, 0) || 1;
    return W.map((w)=>w / sumW);
}
function analyzeChordProgression(rawTokens, opts = {}) {
    const chords = rawTokens.map((t)=>t.trim()).filter(Boolean).map(parseChordToken).filter((c)=>!!c);
    // Phase E-5: Compute weights with section awareness
    const weights = computeWeights(chords.length, opts);
    const candidates = [];
    for (const tonic of ALL_TONICS){
        for (const quality of [
            "major",
            "minor"
        ]){
            const { score, reasons } = scoreForKey(chords, {
                tonic: tonic,
                quality
            }, weights);
            candidates.push({
                key: {
                    tonic: tonic,
                    quality
                },
                confidence: score,
                reasons
            });
        }
    }
    candidates.sort((a, b)=>b.confidence - a.confidence);
    const keyCandidates = candidates.slice(0, 5); // v3.1: 3→5候補に拡張（iOS UI改善）
    const recommendedScales = recommendScales(keyCandidates[0].key, chords);
    // Phase E-5: Per-section analysis (optional)
    let perSection;
    if (opts.sections && opts.sections.length > 0) {
        perSection = opts.sections.map((sec)=>{
            const slice = rawTokens.slice(sec.start, Math.min(sec.end + 1, rawTokens.length));
            // Analyze section without section weights (just the chords themselves)
            const local = analyzeChordProgression(slice, {
                weights: {
                    songHead: 1.0,
                    songTail: 1.0
                }
            });
            return {
                section: sec,
                best: local.keyCandidates[0],
                ranking: local.keyCandidates
            };
        });
    }
    return {
        keyCandidates,
        recommendedScales,
        perSection
    };
}
function getDiatonicChordsFor(req) {
    const key = {
        tonic: req.tonic,
        quality: req.quality
    };
    const chords = getDiatonicChords(key);
    return {
        chords
    };
}
}),
"[project]/src/lib/chords.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "ADVANCED_QUALITIES",
    ()=>ADVANCED_QUALITIES,
    "ADV_ALTERED_DOM",
    ()=>ADV_ALTERED_DOM,
    "ADV_AUG_MAJMIN",
    ()=>ADV_AUG_MAJMIN,
    "ADV_DIM_VARIANTS",
    ()=>ADV_DIM_VARIANTS,
    "ADV_EXTENSIONS",
    ()=>ADV_EXTENSIONS,
    "ADV_SUS_ADDS",
    ()=>ADV_SUS_ADDS,
    "BASS_NOTES",
    ()=>BASS_NOTES,
    "QUICK_QUALITIES",
    ()=>QUICK_QUALITIES,
    "isAdvanced",
    ()=>isAdvanced,
    "isQuick",
    ()=>isQuick
]);
const QUICK_QUALITIES = [
    "M",
    "m",
    "7",
    "M7",
    "m7",
    "sus4",
    "dim"
];
const ADV_EXTENSIONS = [
    "6",
    "m6",
    "9",
    "m9",
    "11",
    "M11",
    "13",
    "M13"
];
const ADV_ALTERED_DOM = [
    "7b5",
    "7#5",
    "7b9",
    "7#9",
    "7#11",
    "7b13",
    "7alt"
];
const ADV_DIM_VARIANTS = [
    "dim7",
    "m7b5"
];
const ADV_SUS_ADDS = [
    "sus2",
    "add9",
    "add11",
    "add13",
    "6/9"
];
const ADV_AUG_MAJMIN = [
    "aug",
    "mM7"
];
const ADVANCED_QUALITIES = [
    ...ADV_EXTENSIONS,
    ...ADV_ALTERED_DOM,
    ...ADV_DIM_VARIANTS,
    ...ADV_SUS_ADDS,
    ...ADV_AUG_MAJMIN,
    "/bass"
];
const isAdvanced = (q)=>ADVANCED_QUALITIES.includes(q);
const isQuick = (q)=>QUICK_QUALITIES.includes(q);
const BASS_NOTES = [
    "C",
    "C#",
    "D",
    "Eb",
    "E",
    "F",
    "F#",
    "G",
    "Ab",
    "A",
    "Bb",
    "B"
];
}),
"[project]/src/lib/compat.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getBaseKind",
    ()=>getBaseKind,
    "isCompatible",
    ()=>isCompatible,
    "preferredBase",
    ()=>preferredBase
]);
const getBaseKind = (q)=>{
    if (q.startsWith("M") || q === "M") return "major";
    if (q.startsWith("m")) return "minor";
    if (q === "7" || /^7/.test(q) || [
        "9",
        "11",
        "13"
    ].includes(q)) return "dominant";
    if (q.startsWith("dim") || q === "m7b5") return "diminished";
    if (q === "aug") return "augmented";
    return "unknown";
};
const preferredBase = (candidate)=>{
    if ([
        "M9",
        "M11",
        "M13",
        "6"
    ].includes(candidate)) return "major";
    if ([
        "m6",
        "m9"
    ].includes(candidate)) return "minor";
    if ([
        "7b5",
        "7#5",
        "7b9",
        "7#9",
        "7#11",
        "7b13",
        "7alt",
        "9",
        "11",
        "13"
    ].includes(candidate)) return "dominant";
    if ([
        "dim7",
        "m7b5"
    ].includes(candidate)) return "diminished";
    if ([
        "add9",
        "add11",
        "add13",
        "sus2",
        "6/9"
    ].includes(candidate)) return "any";
    if (candidate === "aug" || candidate === "mM7") return "any";
    return "any";
};
const isCompatible = (currentBase, candidate)=>{
    const pref = preferredBase(candidate);
    if (pref === "any") return true;
    if (currentBase === "unknown") return true;
    if (currentBase === "major" && pref === "minor") return false;
    if (currentBase === "minor" && pref === "major") return false;
    if (currentBase !== "dominant" && [
        "7b5",
        "7#5",
        "7b9",
        "7#9",
        "7#11",
        "7b13",
        "7alt",
        "9",
        "11",
        "13"
    ].includes(candidate)) {
        return false;
    }
    if (currentBase !== "diminished" && [
        "dim7",
        "m7b5"
    ].includes(candidate)) return false;
    return true;
};
}),
"[project]/src/lib/theory/capo.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Simple capo advisor based on friendly open-chord shapes
// PITCHESは lib/music/constants.ts に統一
__turbopack_context__.s([
    "PITCHES",
    ()=>PITCHES,
    "suggestCapoOptions",
    ()=>suggestCapoOptions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-ssr] (ecmascript)");
;
const PITCHES = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"];
const SHAPES_MAJOR = [
    {
        key: 'C',
        label: 'C',
        weight: 1.0
    },
    {
        key: 'G',
        label: 'G',
        weight: 1.0
    },
    {
        key: 'D',
        label: 'D',
        weight: 0.95
    },
    {
        key: 'A',
        label: 'A',
        weight: 0.9
    },
    {
        key: 'E',
        label: 'E',
        weight: 0.9
    }
];
const SHAPES_MINOR = [
    {
        key: 'A',
        label: 'Am',
        weight: 1.0
    },
    {
        key: 'E',
        label: 'Em',
        weight: 1.0
    },
    {
        key: 'D',
        label: 'Dm',
        weight: 0.8
    }
];
function idx(p) {
    const n = p.replace('♭', 'b').replace('＃', '#');
    const map = {
        'Db': 'C#',
        'D#': 'Eb',
        'Gb': 'F#',
        'G#': 'Ab',
        'A#': 'Bb'
    };
    const canon = map[n] || n;
    return __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"].indexOf(canon);
}
const dist = (from, to)=>(to - from + 12) % 12;
function suggestCapoOptions(target) {
    const targetIdx = idx(target.tonic);
    const shapes = target.mode === 'minor' ? SHAPES_MINOR : SHAPES_MAJOR;
    const options = shapes.map((s)=>{
        const capo = dist(idx(s.key), targetIdx);
        const capoPenalty = capo <= 2 ? 0 : capo <= 4 ? 0.1 : capo <= 6 ? 0.25 : 0.4;
        const score = s.weight - capoPenalty;
        const notes = [];
        if (capo <= 2) notes.push('Low position');
        if (capo >= 6) notes.push('Higher position (thinner tone)');
        if (/^(E|A|C|G)/.test(s.label)) notes.push('Many open strings');
        return {
            capo,
            shapedKey: target.mode === 'minor' ? s.label : s.label,
            sounding: {
                tonic: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PC_NAMES"][targetIdx],
                mode: target.mode
            },
            score,
            notes
        };
    }).sort((a, b)=>b.score - a.score);
    const picked = [];
    for (const o of options)if (!picked.some((p)=>p.capo === o.capo)) picked.push(o);
    return picked.slice(0, 3);
}
}),
"[project]/src/components/DiatonicCapoTable.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>DiatonicCapoTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/store/analysisStore.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/diatonic.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/capo/recommend.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$capo$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/capo.ts [app-ssr] (ecmascript)");
"use client";
;
;
;
;
;
;
;
function DiatonicCapoTable({ onPick, selectedId, onSelectId }) {
    const selectedKey = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useAnalysisStore"])((s)=>s.selectedKey);
    const selectedScale = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useAnalysisStore"])((s)=>s.selectedScale);
    const degreeLabels = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["romanDegreeLabelsForScale"])(selectedScale?.type ?? 'Ionian');
    const toFancy = (s)=>s.replaceAll('b', '♭').replaceAll('#', '♯');
    const cellBase = "px-2 py-1 text-center border rounded-[var(--chip-br)]";
    const cellNeutral = "border-neutral-300 dark:border-neutral-700";
    const cellOpen = "bg-emerald-50 border-emerald-200 text-emerald-900 dark:bg-emerald-800/25 dark:border-emerald-700 dark:text-emerald-100";
    // Mobile long-press support
    const longPressTimerRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const longPressTriggeredRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(false);
    const handleTouchStart = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])((i, sym, pcs)=>{
        longPressTriggeredRef.current = false;
        longPressTimerRef.current = setTimeout(()=>{
            longPressTriggeredRef.current = true;
            const confirmed = window.confirm(`Add "${sym}" to progression?`);
            if (confirmed) {
                const id = `open-${i}`;
                onSelectId?.(id);
                onPick?.({
                    id,
                    row: 'open',
                    degree: i,
                    pcs,
                    capo: 0,
                    isRightClick: true
                });
            }
        }, 500); // 500ms long press
    }, [
        onPick,
        onSelectId
    ]);
    const handleTouchEnd = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])(()=>{
        if (longPressTimerRef.current) {
            clearTimeout(longPressTimerRef.current);
            longPressTimerRef.current = null;
        }
    }, []);
    const openCells = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"].useMemo(()=>{
        if (!selectedKey || !selectedScale) return Array(7).fill({
            sym: '—',
            pcs: []
        });
        let st = selectedScale.type;
        let ivs = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st] ?? [];
        if (ivs.length !== 7) {
            const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
            if (parent) ivs = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent] ?? [];
        }
        if (ivs.length !== 7) return Array(7).fill({
            sym: '—',
            pcs: []
        });
        const tris = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["diatonicTriads"])({
            tonicPc: selectedKey.tonic,
            scaleIntervals: ivs
        });
        return tris.map((t)=>({
                sym: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["triadToChordSym"])({
                    rootPc: t.rootPc,
                    quality: t.quality
                }),
                pcs: t.pcs
            }));
    }, [
        selectedKey,
        selectedScale
    ]);
    const capoRows = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"].useMemo(()=>{
        if (!selectedKey || !selectedScale) return [];
        const modeLabel = selectedKey.mode === 'Major' || selectedKey.mode === 'Minor' ? selectedKey.mode : selectedKey.mode === 'major' ? 'Major' : 'Minor';
        const picks = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$capo$2f$recommend$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["recommendCapos"])({
            tonic: selectedKey.tonic,
            mode: modeLabel
        }, {
            type: selectedScale.type
        }, 3, {
            includeOpen: true
        });
        const nonZero = picks.filter((p)=>p.capo !== 0).sort((a, b)=>a.capo - b.capo).slice(0, 2);
        return nonZero.map((p)=>{
            const playAs = p.playAs; // e.g., G or Am
            const isMinor = /m$/.test(playAs);
            const name = isMinor ? playAs.replace(/m$/, '') : playAs;
            const pc = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$capo$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PITCHES"].indexOf(name);
            let st = selectedScale.type;
            let ivs = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st] ?? [];
            if (ivs.length !== 7) {
                const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                if (parent) ivs = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent] ?? [];
            }
            const tris = ivs.length === 7 ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                tonicPc: pc,
                scaleIntervals: ivs
            }) : [];
            const cells = (tris.length ? tris : Array(7).fill(null)).map((t)=>t ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["triadToChordSym"])({
                    rootPc: t.rootPc,
                    quality: t.quality
                }) : '—');
            const cellsPcs = (tris.length ? tris : Array(7).fill(null)).map((t)=>t ? t.pcs : []);
            return {
                capo: p.capo,
                label: `Capo ${p.capo}`,
                cells,
                cellsPcs,
                tooltip: `Play as ${playAs}${p.reasons && p.reasons.length ? ' · ' + p.reasons.join(' · ') : ''}`
            };
        });
    }, [
        selectedKey,
        selectedScale
    ]);
    const header = degreeLabels.map(toFancy);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "overflow-x-auto capo-compact capo-compact--tight",
        "aria-live": "polite",
        "aria-labelledby": "diatonic-title",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("table", {
            className: "w-full border-separate rounded-xl border text-sm md:text-[0.95rem]",
            style: {
                borderSpacing: '6px'
            },
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("colgroup", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("col", {
                            className: "w-12 sm:w-14 md:w-18"
                        }, void 0, false, {
                            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                            lineNumber: 85,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("col", {
                            span: 7
                        }, void 0, false, {
                            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                            lineNumber: 86,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                    lineNumber: 84,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("thead", {
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("tr", {
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("th", {
                                scope: "col",
                                className: "px-1 py-0 text-center text-sm font-medium border-none bg-transparent rounded-none"
                            }, void 0, false, {
                                fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                lineNumber: 90,
                                columnNumber: 13
                            }, this),
                            header.map((d, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("th", {
                                    scope: "col",
                                    className: "px-1 py-0 text-center text-sm font-medium border-none bg-transparent rounded-none",
                                    children: d
                                }, `hdr-${i}`, false, {
                                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                    lineNumber: 92,
                                    columnNumber: 15
                                }, this))
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                        lineNumber: 89,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                    lineNumber: 88,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("tbody", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("tr", {
                            "data-row": "open",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("th", {
                                    scope: "row",
                                    className: "px-1 py-0 text-center text-xs font-normal border-none bg-transparent rounded-none text-foreground/70",
                                    title: "Open (no capo)",
                                    children: "Open"
                                }, void 0, false, {
                                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                    lineNumber: 98,
                                    columnNumber: 13
                                }, this),
                                openCells.map((c, i)=>// cell id unique: open-<degreeIndex>
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("td", {
                                        className: [
                                            cellBase,
                                            cellOpen,
                                            onPick ? 'cursor-pointer select-none tapfx' : '',
                                            selectedId === `open-${i}` ? 'ring-2 ring-emerald-400/60 dia-cell--active' : 'dia-cell--idle'
                                        ].join(' '),
                                        onClick: (e)=>{
                                            if (e.button === 2) return; // 右クリックは無視
                                            if (longPressTriggeredRef.current) {
                                                longPressTriggeredRef.current = false;
                                                return;
                                            } // 長押し後のクリックを無視
                                            const id = `open-${i}`;
                                            onSelectId?.(id);
                                            onPick?.({
                                                id,
                                                row: 'open',
                                                degree: i,
                                                pcs: c.pcs,
                                                capo: 0
                                            });
                                        },
                                        onContextMenu: (e)=>{
                                            e.preventDefault();
                                            e.stopPropagation();
                                            const confirmed = window.confirm(`Add "${c.sym}" to progression?`);
                                            if (confirmed) {
                                                const id = `open-${i}`;
                                                onSelectId?.(id);
                                                onPick?.({
                                                    id,
                                                    row: 'open',
                                                    degree: i,
                                                    pcs: c.pcs,
                                                    capo: 0,
                                                    isRightClick: true
                                                });
                                            }
                                        },
                                        onTouchStart: ()=>handleTouchStart(i, c.sym, c.pcs),
                                        onTouchEnd: handleTouchEnd,
                                        onTouchCancel: handleTouchEnd,
                                        role: onPick ? 'button' : undefined,
                                        "aria-label": onPick ? `Open ${c.sym}` : undefined,
                                        "aria-pressed": selectedId === `open-${i}`,
                                        children: c.sym
                                    }, `open-${i}`, false, {
                                        fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                        lineNumber: 101,
                                        columnNumber: 15
                                    }, this))
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                            lineNumber: 97,
                            columnNumber: 11
                        }, this),
                        capoRows.map((r)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("tr", {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("th", {
                                        scope: "row",
                                        className: "px-1 py-0 text-center text-xs font-normal border-none bg-transparent rounded-none text-foreground/70",
                                        title: r.tooltip,
                                        children: r.label
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                        lineNumber: 130,
                                        columnNumber: 15
                                    }, this),
                                    r.cells.map((c, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("td", {
                                            className: [
                                                cellBase,
                                                cellNeutral,
                                                'opacity-65 cursor-default pointer-events-none',
                                                selectedId === `capo${r.capo}-${i}` ? 'dia-cell--active' : 'dia-cell--idle'
                                            ].join(' '),
                                            role: "button",
                                            tabIndex: -1,
                                            "aria-disabled": "true",
                                            "aria-label": `${r.label} ${c}`,
                                            children: c
                                        }, `capo-${r.capo}-${i}`, false, {
                                            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                            lineNumber: 132,
                                            columnNumber: 17
                                        }, this))
                                ]
                            }, `capo-${r.capo}`, true, {
                                fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                                lineNumber: 129,
                                columnNumber: 13
                            }, this))
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/components/DiatonicCapoTable.tsx",
                    lineNumber: 96,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/src/components/DiatonicCapoTable.tsx",
            lineNumber: 83,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/src/components/DiatonicCapoTable.tsx",
        lineNumber: 82,
        columnNumber: 5
    }, this);
}
}),
"[project]/src/lib/theory/roman/patterns.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "PATTERNS",
    ()=>PATTERNS,
    "PATTERN_LABEL_EN",
    ()=>PATTERN_LABEL_EN,
    "PATTERN_SUMMARY_EN",
    ()=>PATTERN_SUMMARY_EN,
    "patternInfoEN",
    ()=>patternInfoEN
]);
const PATTERNS = [
    {
        id: 'doo-wop',
        name: 'Doo‑Wop (I–vi–IV–V)',
        mode: 'major',
        seq: [
            'I',
            'vi',
            'IV',
            'V'
        ],
        summary: "50s/60s loop: I→vi→IV→V back to I."
    },
    {
        id: 'axis',
        name: 'Axis (I–V–vi–IV)',
        mode: 'major',
        seq: [
            'I',
            'V',
            'vi',
            'IV'
        ],
        summary: 'Modern pop four‑chords loop.'
    },
    {
        id: 'canon',
        name: "Pachelbel's Canon",
        mode: 'major',
        seq: [
            'I',
            'V',
            'vi',
            'iii',
            'IV',
            'I',
            'IV',
            'V'
        ],
        variants: [
            [
                'I',
                'V',
                'vi',
                'IV'
            ]
        ],
        summary: 'Pachelbel‑style ground; long loop back to I.'
    },
    {
        id: 'ii-V-I',
        name: 'ii–V–I',
        mode: 'any',
        seq: [
            'ii',
            'V',
            'I'
        ],
        summary: 'The classic resolution run‑up.'
    },
    {
        id: 'turnaround',
        name: 'Turnaround (I–vi–ii–V)',
        mode: 'any',
        seq: [
            'I',
            'vi',
            'ii',
            'V'
        ],
        summary: 'Quick loop returning to the top.'
    },
    {
        id: 'andalusian',
        name: 'Andalusian (i–VII–VI–V)',
        mode: 'minor',
        seq: [
            'i',
            'VII',
            'VI',
            'V'
        ],
        summary: 'Classic minor descent; flamenco/Latin flavor.'
    },
    {
        id: 'authentic',
        name: 'Authentic cadence (V–I)',
        mode: 'any',
        seq: [
            'V',
            'I'
        ],
        summary: 'Perfect cadence V→I.'
    },
    {
        id: 'plagal',
        name: 'Plagal cadence (IV–I)',
        mode: 'any',
        seq: [
            'IV',
            'I'
        ],
        summary: 'Gentle IV→I resolution.'
    },
    {
        id: 'deceptive',
        name: 'Deceptive cadence (V–vi)',
        mode: 'major',
        seq: [
            'V',
            'vi'
        ],
        summary: 'Deceptive V→vi keeps motion going.'
    }
];
const PATTERN_LABEL_EN = {
    dooWop: "Doo‑Wop (I–VI–IV–V)",
    axis: "Axis (I–V–vi–IV)",
    canon: "Canon (I–V–vi–iii–IV–I–IV–V)",
    twoFiveOne: "ii–V–I",
    turnaround: "Turnaround",
    andalusian: "Andalusian cadence",
    authentic: "Perfect cadence (V → I)",
    plagal: "Plagal cadence (IV → I)",
    deceptive: "Deceptive cadence (V → vi)"
};
const PATTERN_SUMMARY_EN = {
    dooWop: "’50s progression. Nostalgic loop: tonic → relative minor → subdominant → dominant. Try adding 7ths for color.",
    axis: "Modern pop staple. A catchy loop that feels forward yet stable. Swap to ii–V at the end for a stronger landing.",
    canon: "Pachelbel‑style ground. Persistent bass motion with rotating functions; great for variations and melodies.",
    twoFiveOne: "The classic run‑up then land. Link by guide tones (3rd↔7th). Works anywhere you want a clear resolution.",
    turnaround: "Short cycle that brings you back to the top (e.g., I–VI7–ii7–V7). Use at phrase ends or between sections.",
    andalusian: "Descending minor flavor (e.g., i–♭VII–♭VI–V). Adds drama; land clearly on the target chord.",
    authentic: "Strong homecoming: dominant pulls into tonic. Extend V with 7/9/13; keep the landing clean on I.",
    plagal: "Gentler IV → I resolution. Use to soften endings or after a bright Lydian moment.",
    deceptive: "Twist the expectation: V → vi instead of I. Keeps energy moving; return to I later for closure."
};
function patternInfoEN(id) {
    return {
        label: PATTERN_LABEL_EN[id],
        summary: PATTERN_SUMMARY_EN[id]
    };
}
}),
"[project]/src/lib/theory/roman/match.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "matchPatterns",
    ()=>matchPatterns,
    "normalizeRomanToken",
    ()=>normalizeRomanToken
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2f$patterns$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/roman/patterns.ts [app-ssr] (ecmascript)");
;
function normalizeRomanToken(tok) {
    const t = (tok || "").toString().trim().toUpperCase();
    // Remove qualities/extensions, keep degree with optionally B/#
    return t.replace(/MAJ7|M7|7|MAJ|MIN|MI|DIM|AUG|SUS\d?|ADD\d+|Ø|O/g, "").replace(/\(|\)/g, "").replace(/[^IVB#]+/g, "").replace(/B/g, "B");
}
function matchPatterns(romanLine, mode) {
    const rom = romanLine.map(normalizeRomanToken);
    const hits = [];
    for (const p of __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2f$patterns$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["PATTERNS"]){
        const seqs = [
            p.seq,
            ...p.variants ?? []
        ].map((s)=>s.map(normalizeRomanToken));
        for (const seq of seqs){
            const L = seq.length;
            // slide over roman tokens
            for(let i = 0; i + L <= rom.length; i++){
                let ok = true;
                for(let k = 0; k < L; k++){
                    if (rom[i + k] !== seq[k]) {
                        ok = false;
                        break;
                    }
                }
                if (ok) {
                    hits.push({
                        id: p.id,
                        name: p.name,
                        summary: p.tooltip,
                        start: i,
                        end: i + L
                    });
                    break; // prefer first longest match for this pattern
                }
            }
        }
    }
    hits.sort((a, b)=>b.end - b.start - (a.end - a.start));
    return dedupe(hits);
}
function dedupe(xs) {
    const res = [];
    for (const m of xs){
        if (res.some((r)=>!(m.end <= r.start || r.end <= m.start))) continue;
        res.push(m);
    }
    return res;
}
}),
"[project]/src/features/sketch/storage.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// src/features/sketch/storage.ts
__turbopack_context__.s([
    "loadAll",
    ()=>loadAll,
    "saveCloudPro",
    ()=>saveCloudPro,
    "saveLocalFree",
    ()=>saveLocalFree
]);
const KEY = 'ot_sketches';
const FREE_LIMIT = 3;
const loadAll = ()=>JSON.parse(localStorage.getItem(KEY) || '[]');
const saveLocalFree = (sk)=>{
    const list = loadAll().filter((s)=>s.id !== sk.id);
    list.unshift(sk); // 先頭が最新
    if (list.length > FREE_LIMIT) {
        // LRU超過 → Pro誘導
        localStorage.setItem(KEY, JSON.stringify(list.slice(0, FREE_LIMIT)));
        return {
            ok: false,
            reason: 'limit_exceeded'
        };
    }
    localStorage.setItem(KEY, JSON.stringify(list));
    return {
        ok: true
    };
};
const saveCloudPro = async (sk)=>{
    // await fetch('/api/sketch', { method:'POST', body: JSON.stringify(sk) })
    return {
        ok: true
    };
}; // Free/Proの境界はSSOTの通り。保存/呼び出し/自動保存の3点がM1の核。
}),
"[project]/src/features/sketch/useSketch.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// src/features/sketch/useSketch.ts
__turbopack_context__.s([
    "useSketch",
    ()=>useSketch
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/features/sketch/storage.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-ssr] (ecmascript)");
;
;
;
const useSketch = (isPro)=>{
    const [sketch, setSketch] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const timer = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const scheduleAutosave = ()=>{
        if (timer.current) window.clearTimeout(timer.current);
        timer.current = window.setTimeout(()=>{
            if (!sketch) return;
            (async ()=>{
                const r = isPro ? await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["saveCloudPro"](sketch) : __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["saveLocalFree"](sketch);
                if (!r.ok && r.reason === 'limit_exceeded') {
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"]('project_limit_warn', {
                        page: 'chord_progression'
                    });
                // UI側で「3件まで」トースト表示
                } else {
                    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"]('save_project', {
                        page: 'chord_progression'
                    });
                }
            })();
        }, 3000); // 3秒アイドル
    };
    // 状態が変わるたびに自動保存を予約
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        scheduleAutosave(); /* eslint-disable-next-line */ 
    }, [
        sketch
    ]);
    return {
        sketch,
        setSketch
    };
};
}),
"[project]/src/store/sketchStore.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "useSketchStore",
    ()=>useSketchStore
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zustand$2f$esm$2f$react$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zustand/esm/react.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/features/sketch/storage.ts [app-ssr] (ecmascript)");
;
;
const generateId = ()=>Math.random().toString(36).substr(2, 9);
const useSketchStore = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zustand$2f$esm$2f$react$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["create"])((set, get)=>({
        sketches: [],
        currentSketch: null,
        isLoading: false,
        error: null,
        loadSketches: ()=>{
            set({
                isLoading: true,
                error: null
            });
            try {
                const sketches = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["loadAll"])();
                set({
                    sketches,
                    isLoading: false
                });
            } catch (error) {
                set({
                    error: 'Failed to load sketches',
                    isLoading: false
                });
            }
        },
        saveSketch: async (sketchData)=>{
            const sketch = {
                ...sketchData,
                id: generateId(),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            // Freeユーザーの場合
            const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["saveLocalFree"])(sketch);
            if (result.ok) {
                // ローカルストレージが更新されたので、ストアも更新
                const sketches = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["loadAll"])();
                set({
                    sketches,
                    currentSketch: sketch
                });
                return {
                    ok: true
                };
            } else {
                // Proユーザーの場合（スケルトン実装）
                try {
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["saveCloudPro"])(sketch);
                    const sketches = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["loadAll"])();
                    set({
                        sketches,
                        currentSketch: sketch
                    });
                    return {
                        ok: true
                    };
                } catch (error) {
                    return {
                        ok: false,
                        reason: 'cloud_save_failed'
                    };
                }
            }
        },
        loadSketch: (id)=>{
            const sketches = get().sketches;
            const sketch = sketches.find((s)=>s.id === id);
            if (sketch) {
                set({
                    currentSketch: sketch
                });
            }
        },
        deleteSketch: (id)=>{
            const sketches = get().sketches.filter((s)=>s.id !== id);
            localStorage.setItem('ot_sketches', JSON.stringify(sketches));
            set({
                sketches
            });
            if (get().currentSketch?.id === id) {
                set({
                    currentSketch: null
                });
            }
        },
        duplicateSketch: (id)=>{
            const sketches = get().sketches;
            const original = sketches.find((s)=>s.id === id);
            if (original) {
                const duplicate = {
                    ...original,
                    id: generateId(),
                    name: `${original.name} Copy`,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["saveLocalFree"])(duplicate);
                if (result.ok) {
                    const updatedSketches = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["loadAll"])();
                    set({
                        sketches: updatedSketches,
                        currentSketch: duplicate
                    });
                }
            }
        },
        renameSketch: (id, name)=>{
            const sketches = get().sketches.map((s)=>s.id === id ? {
                    ...s,
                    name,
                    updatedAt: new Date().toISOString()
                } : s);
            localStorage.setItem('ot_sketches', JSON.stringify(sketches));
            set({
                sketches
            });
            if (get().currentSketch?.id === id) {
                set({
                    currentSketch: {
                        ...get().currentSketch,
                        name,
                        updatedAt: new Date().toISOString()
                    }
                });
            }
        },
        startAutoSave: (sketch)=>{
            // 3秒アイドル後に自動保存
            const timeoutId = setTimeout(()=>{
                const currentState = get();
                if (currentState.currentSketch?.id === sketch.id) {
                    // 変更があった場合のみ保存
                    const updatedSketch = {
                        ...sketch,
                        updatedAt: new Date().toISOString()
                    };
                    const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["saveLocalFree"])(updatedSketch);
                    if (result.ok) {
                        const sketches = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$storage$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["loadAll"])();
                        set({
                            sketches,
                            currentSketch: updatedSketch
                        });
                    }
                }
            }, 3000);
            // タイムアウトIDを保持（クリーンアップ用）
            return timeoutId;
        },
        stopAutoSave: ()=>{
        // 自動保存をキャンセル
        }
    }));
}),
"[project]/src/lib/export/png.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// src/lib/export/png.ts
__turbopack_context__.s([
    "exportPng",
    ()=>exportPng
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$html$2d$to$2d$image$2f$es$2f$index$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/html-to-image/es/index.js [app-ssr] (ecmascript)");
;
;
let exporting = false;
async function exportPng(el, theme = 'auto') {
    if (exporting) return; // 重複防止
    exporting = true;
    try {
        // 一時的に可視化してレンダリングを確実にする
        const originalOpacity = el.style.opacity;
        const originalVisibility = el.style.visibility;
        el.style.opacity = '1';
        el.style.visibility = 'visible';
        // Fretboard内の全てのテキスト要素を強制的に黒色にし、フレット番号ボックスの背景を調整
        const allElements = el.querySelectorAll('*');
        const originalStyles = [];
        allElements.forEach((elem)=>{
            const htmlElem = elem;
            const originalColor = htmlElem.style.color;
            const originalFill = htmlElem.style.fill;
            const originalBg = htmlElem.style.background;
            originalStyles.push({
                elem: htmlElem,
                color: originalColor,
                fill: originalFill,
                bg: originalBg
            });
            // 全てのテキストを黒色に
            htmlElem.style.color = '#000000';
            if (htmlElem.tagName === 'text' || htmlElem.tagName === 'tspan') {
                htmlElem.style.fill = '#000000';
            }
            // フレット番号を含むspan要素の背景を薄いグレーに変更
            if (htmlElem.tagName === 'SPAN' && htmlElem.className.includes('inline-block')) {
                const text = htmlElem.textContent?.trim();
                if (text && /^\d+$/.test(text)) {
                    htmlElem.style.background = '#f3f4f6'; // 薄いグレー (Tailwind gray-100相当)
                    htmlElem.style.color = '#000000';
                }
            }
        });
        // レンダリング完了を待つ
        await new Promise((resolve)=>setTimeout(resolve, 150));
        el.dataset.export = theme; // CSSでテーマ反転を制御
        const dataUrl = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$html$2d$to$2d$image$2f$es$2f$index$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toPng"])(el, {
            pixelRatio: 2,
            backgroundColor: '#ffffff',
            cacheBust: true
        });
        // 元に戻す
        el.style.opacity = originalOpacity;
        el.style.visibility = originalVisibility;
        originalStyles.forEach(({ elem, color, fill, bg })=>{
            elem.style.color = color;
            elem.style.fill = fill;
            elem.style.background = bg;
        });
        const a = document.createElement('a');
        a.href = dataUrl;
        a.download = 'ot-progression.png';
        a.click();
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"]('export_png', {
            page: 'chord_progression',
            ok: true
        });
    } catch (e) {
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"]('export_png', {
            page: 'chord_progression',
            ok: false,
            err: String(e)
        });
    } finally{
        el.removeAttribute('data-export');
        exporting = false;
    }
}
}),
"[project]/src/lib/music/chordParser.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * コード記号のパースとMIDI音への変換
 */ __turbopack_context__.s([
    "chordToMidi",
    ()=>chordToMidi,
    "parseChordSymbol",
    ()=>parseChordSymbol
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-ssr] (ecmascript)");
;
function parseChordSymbol(symbol) {
    // ルート音とクオリティを分離
    const match = symbol.match(/^([A-G](?:#|b)?)(.*)$/);
    if (!match) return null;
    const root = match[1];
    const quality = (match[2] || '').toLowerCase();
    const rootPc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["nameToPc"])(root);
    if (rootPc < 0) return null;
    const intervals = getIntervalsForQuality(quality, symbol);
    return {
        rootPc,
        quality,
        intervals
    };
}
/**
 * クオリティ文字列からインターバルを取得
 */ function getIntervalsForQuality(quality, originalSymbol) {
    // 基本トライアド
    let base;
    // マイナーコードの判定（"m" があるが "maj" ではない）
    if (/(^|[^a-z])m(?!aj)/.test(quality)) {
        base = [
            0,
            3,
            7
        ]; // Minor
    } else if (/dim|°/.test(quality)) {
        return [
            0,
            3,
            6
        ]; // Diminished
    } else if (/aug|\+/.test(quality)) {
        return [
            0,
            4,
            8
        ]; // Augmented
    } else {
        base = [
            0,
            4,
            7
        ]; // Major (default)
    }
    // 7thコードの処理
    if (/maj7|M7/.test(originalSymbol)) {
        return [
            ...base,
            11
        ]; // Major 7th
    } else if (/7/.test(quality)) {
        return [
            ...base,
            10
        ]; // Dominant 7th
    }
    // 6thコードの処理
    if (/6/.test(quality)) {
        return [
            ...base.slice(0, 3),
            9
        ]; // 6th
    }
    // Suspendedコードの処理
    if (/sus4/.test(quality)) {
        return [
            0,
            5,
            7
        ]; // sus4
    } else if (/sus2/.test(quality)) {
        return [
            0,
            2,
            7
        ]; // sus2
    }
    // 9thコードの処理（簡易版）
    if (/9/.test(quality)) {
        return [
            ...base,
            10,
            14
        ]; // Add 9th (2 octaves up)
    }
    return base;
}
function chordToMidi(symbol, octave = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["DEFAULT_MIDI_OCTAVE"]) {
    const parsed = parseChordSymbol(symbol);
    if (!parsed) return null;
    const base = octave + parsed.rootPc;
    return parsed.intervals.map((interval)=>base + interval);
}
}),
"[project]/src/components/Toast.client.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>Toast
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useCtaTracking$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/hooks/useCtaTracking.ts [app-ssr] (ecmascript)");
"use client";
;
;
;
const TOAST_COLORS = {
    info: 'bg-blue-600',
    success: 'bg-green-600',
    warning: 'bg-orange-600'
};
const DEFAULT_DURATION = 5000;
function Toast({ message, type = 'info', ctaText, ctaHref, ctaPlace, onClose, duration = DEFAULT_DURATION }) {
    const { trackClick } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useCtaTracking$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCtaTracking"])();
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (duration > 0) {
            const timer = setTimeout(onClose, duration);
            return ()=>clearTimeout(timer);
        }
    }, [
        duration,
        onClose
    ]);
    const handleCtaClick = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])(()=>{
        if (ctaPlace) {
            trackClick(ctaPlace);
        }
    }, [
        ctaPlace,
        trackClick
    ]);
    const bgColor = TOAST_COLORS[type];
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "fixed bottom-20 sm:bottom-6 left-1/2 -translate-x-1/2 z-50 animate-slide-up max-w-md w-full mx-4",
        role: "alert",
        "aria-live": "polite",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: `${bgColor} text-white rounded-lg shadow-2xl p-4 flex items-center justify-between gap-3`,
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex-1 min-w-0",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "text-sm font-medium",
                        children: message
                    }, void 0, false, {
                        fileName: "[project]/src/components/Toast.client.tsx",
                        lineNumber: 65,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/src/components/Toast.client.tsx",
                    lineNumber: 64,
                    columnNumber: 9
                }, this),
                ctaText && ctaHref && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("a", {
                    href: ctaHref,
                    target: "_blank",
                    rel: "noopener noreferrer",
                    className: "flex-shrink-0 px-3 py-1.5 text-sm font-medium bg-white/20 hover:bg-white/30 rounded transition-colors",
                    onClick: handleCtaClick,
                    children: ctaText
                }, void 0, false, {
                    fileName: "[project]/src/components/Toast.client.tsx",
                    lineNumber: 68,
                    columnNumber: 11
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                    onClick: onClose,
                    className: "flex-shrink-0 w-6 h-6 flex items-center justify-center hover:bg-white/20 rounded transition-colors",
                    "aria-label": "Close notification",
                    children: "✕"
                }, void 0, false, {
                    fileName: "[project]/src/components/Toast.client.tsx",
                    lineNumber: 78,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/src/components/Toast.client.tsx",
            lineNumber: 63,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/src/components/Toast.client.tsx",
        lineNumber: 58,
        columnNumber: 5
    }, this);
}
}),
"[project]/src/lib/chords/types.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "DEFAULT_CONTEXT",
    ()=>DEFAULT_CONTEXT
]);
const DEFAULT_CONTEXT = {
    plan: 'free',
    notationStyle: 'english'
};
}),
"[project]/src/lib/chords/normalize.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "normalizeChordSpec",
    ()=>normalizeChordSpec
]);
function normalizeChordSpec(input, ctx, options = {}) {
    const spec = JSON.parse(JSON.stringify(input));
    const warnings = [];
    // dom は 7th 前提
    if (spec.family === 'dom') spec.seventh = '7';
    // Pro gating
    if (ctx.plan === 'free') {
        // Pro: Tension, Alter, 6/9, /bass をロック
        if (spec.extMode === 'tension') spec.ext = {
            nine: false,
            eleven: false,
            thirteen: false
        };
        spec.alt = {};
        // 6/9 は Pro 専用（6 と add9 の同時→6/9 変換を禁止）
        // slash も禁止
        if (spec.slash) spec.slash = null;
    }
    // Add/Tension 排他
    if (spec.extMode === 'add') {
        spec.ext.nine = spec.ext.eleven = spec.ext.thirteen = false;
    } else {
        spec.ext.add9 = spec.ext.add11 = spec.ext.add13 = false;
    }
    // 13 は 9 を内包
    if (spec.ext.thirteen) spec.ext.nine = true;
    // sus2/sus4 相互排他（後勝ち）
    if (spec.sus === 'sus2' && input.sus === 'sus4') spec.sus = 'sus4';
    if (spec.sus === 'sus4' && input.sus === 'sus2') spec.sus = 'sus2';
    // maj/dom の 11 は回避警告（オプションで自動是正）
    if (spec.ext.eleven) {
        if (spec.family === 'maj') {
            if (options.autoCorrect11th) {
                // 自動是正: 11 → #11 (Lydian)
                spec.ext.eleven = false;
                if (spec.alt) {
                    spec.alt.sharpEleven = true;
                } else {
                    spec.alt = {
                        sharpEleven: true
                    };
                }
                warnings.push('11 → #11 に自動調整しました（メジャーではavoid音のため）。');
            } else {
                warnings.push('メジャーでの11は3度と濁ります。#11（Lydian）を検討してください。');
            }
        }
        if (spec.family === 'dom') {
            if (options.autoCorrect11th) {
                // 自動是正: 11 → #11 または sus4 の提案（ここでは#11を選択）
                spec.ext.eleven = false;
                if (spec.alt) {
                    spec.alt.sharpEleven = true;
                } else {
                    spec.alt = {
                        sharpEleven: true
                    };
                }
                warnings.push('11 → #11 に自動調整しました（ドミナントでは3度と衝突するため）。');
            } else {
                warnings.push('ドミナントでの11は3度と衝突します。#11 または sus4 を検討してください。');
            }
        }
    }
    // 非 dom で Alterations は無効
    if (spec.family !== 'dom') spec.alt = {};
    // maj7 + sus は既定で無効
    if (spec.seventh === 'maj7' && spec.sus) {
        warnings.push('maj7 with sus is uncommon; use sus4(maj7) in advanced mode.');
        spec.sus = null;
    }
    // Tension は 7th を持つ時のみ活性
    if (spec.extMode === 'tension' && ![
        '7',
        'maj7',
        'm7'
    ].includes(spec.seventh)) {
        spec.ext = {
            nine: false,
            eleven: false,
            thirteen: false
        };
    }
    return {
        spec,
        warnings
    };
}
}),
"[project]/src/lib/chords/format.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "formatChordSymbol",
    ()=>formatChordSymbol
]);
function formatChordSymbol(s, ctx) {
    const parts = [
        s.root
    ];
    // family: output english by default
    const fam = s.family === 'maj' ? '' : s.family === 'min' ? 'm' : s.family === 'dom' ? '' : s.family === 'sus' ? 'sus' : s.family === 'dim' ? 'dim' : s.family === 'aug' ? 'aug' : '5';
    parts.push(fam);
    // seventh
    const sev = s.seventh === 'maj7' ? ctx.notationStyle === 'compact' ? 'M7' : 'maj7' : s.seventh === '7' ? '7' : s.seventh === 'm7' ? 'm7' : s.seventh === '6' ? '6' : s.seventh === 'm7b5' ? 'm7b5' : s.seventh === 'dim7' ? 'dim7' : '';
    parts.push(sev);
    // extensions
    if (s.extMode === 'tension') {
        if (s.ext.thirteen) parts.push('13');
        else if (s.ext.eleven) parts.push('11');
        else if (s.ext.nine) parts.push('9');
    } else {
        const adds = [
            s.ext.add9 && 'add9',
            s.ext.add11 && 'add11',
            s.ext.add13 && 'add13'
        ].filter(Boolean);
        if (adds.length) parts.push(`(${adds.join(',')})`);
    }
    // alterations
    const alt = [
        s.alt.b9 && 'b9',
        s.alt.s9 && '#9',
        s.alt.s11 && '#11',
        s.alt.b13 && 'b13'
    ].filter(Boolean).join('');
    parts.push(alt);
    // sus
    if (s.sus) parts.push(s.sus);
    // /bass
    if (s.slash) parts.push(`/${s.slash}`);
    return parts.join('');
}
}),
"[project]/src/lib/pro/guard.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * Pro feature guard utilities
 * Defines which chord types require Pro subscription for adding to progression
 */ /**
 * Chord quality types that require Pro subscription
 * - Altered Dominant: 7b9, 7#9, 7#11, 7b13, 7alt
 * - 13th extensions: 13, M13, m13
 * - Slash/On-Bass: detected via 'slash' flag
 */ __turbopack_context__.s([
    "canAddQuality",
    ()=>canAddQuality,
    "getProOnlyReason",
    ()=>getProOnlyReason,
    "shouldShowProBadge",
    ()=>shouldShowProBadge
]);
const PRO_ONLY_QUALITIES = new Set([
    // Altered Dominant
    '7b9',
    '7#9',
    '7#11',
    '7b13',
    '7alt',
    // 13th系
    '13',
    'M13',
    'm13'
]);
function canAddQuality(quality, options) {
    const { isPro, hasSlash } = options;
    // Pro users can add everything
    if (isPro) return true;
    // Slash/On-Bass requires Pro
    if (hasSlash) return false;
    // Check if quality is in Pro-only set
    return !PRO_ONLY_QUALITIES.has(quality);
}
function shouldShowProBadge(quality, hasSlash) {
    return PRO_ONLY_QUALITIES.has(quality) || !!hasSlash;
}
function getProOnlyReason(quality, hasSlash) {
    if (hasSlash) return 'slash';
    if (quality.includes('alt')) return 'altered';
    if (quality.includes('13')) return '13th';
    if (PRO_ONLY_QUALITIES.has(quality)) return 'advanced';
    return null;
}
}),
"[project]/src/lib/quality-master.ts [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Quality Master Data - Single Source of Truth for chord qualities
// Generated from /Users/nh/App/OtoTheory/docs/content/Quality Master.csv
__turbopack_context__.s([
    "QUALITY_MASTER",
    ()=>QUALITY_MASTER,
    "getFreeQualities",
    ()=>getFreeQualities,
    "getProQualities",
    ()=>getProQualities,
    "getQualitiesByCategory",
    ()=>getQualitiesByCategory,
    "getQualityComment",
    ()=>getQualityComment,
    "getQualityInfo",
    ()=>getQualityInfo,
    "isProQuality",
    ()=>isProQuality
]);
const QUALITY_MASTER = [
    // Free - 基本 (Basics)
    {
        tier: 'Free',
        categoryJa: '基本',
        categoryEn: 'Basics',
        quality: 'Major',
        commentJa: '明るく、ハッピーな響きの基本となるコード。',
        commentEn: 'The fundamental chord for a bright and happy sound.'
    },
    {
        tier: 'Free',
        categoryJa: '基本',
        categoryEn: 'Basics',
        quality: 'm (minor)',
        commentJa: '少し切なく、落ち着いた響きの基本となるコード。',
        commentEn: 'The fundamental chord for a slightly sad and calm sound.'
    },
    {
        tier: 'Free',
        categoryJa: '基本',
        categoryEn: 'Basics',
        quality: '7',
        commentJa: '次のコードへ進みたくなるような、少し不安定でおしゃれな響き。',
        commentEn: 'A slightly unstable and stylish sound that creates a sense of resolution to the next chord.'
    },
    {
        tier: 'Free',
        categoryJa: '基本',
        categoryEn: 'Basics',
        quality: 'maj7',
        commentJa: '明るく、洗練された都会的な響き。',
        commentEn: 'A bright, sophisticated, and urban sound.'
    },
    {
        tier: 'Free',
        categoryJa: '基本',
        categoryEn: 'Basics',
        quality: 'm7',
        commentJa: '切なさの中に、おしゃれな雰囲気が加わった響き。',
        commentEn: 'A sound that adds a stylish atmosphere to sadness.'
    },
    // Free - 基本の飾り付け (Essential Colors)
    {
        tier: 'Free',
        categoryJa: '基本の飾り付け',
        categoryEn: 'Essential Colors',
        quality: 'sus4',
        commentJa: 'メジャーでもマイナーでもない、解決を待つ浮遊感のある響き。',
        commentEn: 'A sound with a floating feel, neither major nor minor, awaiting resolution.'
    },
    {
        tier: 'Free',
        categoryJa: '基本の飾り付け',
        categoryEn: 'Essential Colors',
        quality: 'sus2',
        commentJa: 'sus4よりも、より明るく爽やかな浮遊感を持つ響き。',
        commentEn: 'A sound with a brighter and fresher floating feel than sus4.'
    },
    {
        tier: 'Free',
        categoryJa: '基本の飾り付け',
        categoryEn: 'Essential Colors',
        quality: 'add9',
        commentJa: '通常のコードにキラキラした透明感を加える、現代ポップスの定番。',
        commentEn: 'The go-to chord in modern pop, adding a sparkling transparency to a basic chord.'
    },
    {
        tier: 'Free',
        categoryJa: '基本の飾り付け',
        categoryEn: 'Essential Colors',
        quality: 'dim',
        commentJa: '不気味で緊張感のある響き。コードとコードを繋ぐ時に便利。',
        commentEn: 'A spooky and tense sound, useful for connecting one chord to another.'
    },
    // Pro - ✨ キラキラ・浮遊感 (Sparkle & Float)
    {
        tier: 'Pro',
        categoryJa: '✨ キラキラ・浮遊感',
        categoryEn: 'Sparkle & Float',
        quality: 'M9 (maj9)',
        commentJa: 'ポップス、R&Bの王道おしゃれサウンド。',
        commentEn: 'The quintessential stylish sound for Pop and R&B.'
    },
    {
        tier: 'Pro',
        categoryJa: '✨ キラキラ・浮遊感',
        categoryEn: 'Sparkle & Float',
        quality: '6',
        commentJa: 'maj7より少しレトロで温かい響き。',
        commentEn: 'A slightly more retro and warmer sound than maj7.'
    },
    {
        tier: 'Pro',
        categoryJa: '✨ キラキラ・浮遊感',
        categoryEn: 'Sparkle & Float',
        quality: '6/9',
        commentJa: 'ジャズやフュージョンで多用される、明るく豊かな響き。',
        commentEn: 'A bright and rich sound frequently used in Jazz and Fusion.'
    },
    {
        tier: 'Pro',
        categoryJa: '✨ キラキラ・浮遊感',
        categoryEn: 'Sparkle & Float',
        quality: 'add#11',
        commentJa: '現代的でドリーミーな、まさに「浮遊感」のあるサウンド。',
        commentEn: 'A modern, dreamy sound that truly gives a "floating" feel.'
    },
    // Pro - 🌃 おしゃれ・都会的 (Stylish & Urban)
    {
        tier: 'Pro',
        categoryJa: '🌃 おしゃれ・都会的',
        categoryEn: 'Stylish & Urban',
        quality: 'm9',
        commentJa: 'm7をさらにスムーズで洗練させた響き。',
        commentEn: 'An even smoother and more refined sound than m7.'
    },
    {
        tier: 'Pro',
        categoryJa: '🌃 おしゃれ・都会的',
        categoryEn: 'Stylish & Urban',
        quality: 'm11',
        commentJa: 'Lo-fi Hip HopやR&Bで定番の、少しアンニュイなサウンド。',
        commentEn: 'A standard sound in Lo-fi Hip Hop and R&B, with a slightly melancholic vibe.'
    },
    {
        tier: 'Pro',
        categoryJa: '🌃 おしゃれ・都会的',
        categoryEn: 'Stylish & Urban',
        quality: 'm7b5',
        commentJa: 'マイナーキーのii-V-Iで必須。ジャズ、ボサノヴァへの入り口。',
        commentEn: 'Essential for minor key ii-V-I progressions. Your gateway to Jazz and Bossa Nova.'
    },
    {
        tier: 'Pro',
        categoryJa: '🌃 おしゃれ・都会的',
        categoryEn: 'Stylish & Urban',
        quality: 'mM7',
        commentJa: '映画音楽のような、ミステリアスでドラマチックな響き。',
        commentEn: 'A mysterious and dramatic sound, reminiscent of a movie soundtrack.'
    },
    {
        tier: 'Pro',
        categoryJa: '🌃 おしゃれ・都会的',
        categoryEn: 'Stylish & Urban',
        quality: 'm6',
        commentJa: 'ジャズや映画音楽で耳にする、少しレトロでミステリアスな響き。',
        commentEn: 'A slightly retro and mysterious sound, often heard in jazz and film scores.'
    },
    // Pro - ⚡️ 緊張感・スパイス (Tension & Spice)
    {
        tier: 'Pro',
        categoryJa: '⚡️ 緊張感・スパイス',
        categoryEn: 'Tension & Spice',
        quality: '7sus4',
        commentJa: 'V7の前に置くことで、解決感を劇的に高めるプロの技。',
        commentEn: 'A pro technique that dramatically enhances the feeling of resolution when placed before a V7 chord.'
    },
    {
        tier: 'Pro',
        categoryJa: '⚡️ 緊張感・スパイス',
        categoryEn: 'Tension & Spice',
        quality: 'aug',
        commentJa: '不安定で、次のコードへ進む推進力が強い。',
        commentEn: 'An unstable sound with a strong drive to move to the next chord.'
    },
    {
        tier: 'Pro',
        categoryJa: '⚡️ 緊張感・スパイス',
        categoryEn: 'Tension & Spice',
        quality: 'dim7',
        commentJa: '経過コードとして非常に便利。緊張感を一気に高める。',
        commentEn: 'Very useful as a passing chord to instantly increase tension.'
    },
    {
        tier: 'Pro',
        categoryJa: '⚡️ 緊張感・スパイス',
        categoryEn: 'Tension & Spice',
        quality: '7(#9)',
        commentJa: 'ブルージーでロックな緊張感。',
        commentEn: 'A bluesy and rock-oriented tension.'
    },
    {
        tier: 'Pro',
        categoryJa: '⚡️ 緊張感・スパイス',
        categoryEn: 'Tension & Spice',
        quality: '7(b9)',
        commentJa: 'ジャズで多用される強い緊張感。',
        commentEn: 'A strong tension frequently used in Jazz.'
    },
    {
        tier: 'Pro',
        categoryJa: '⚡️ 緊張感・スパイス',
        categoryEn: 'Tension & Spice',
        quality: '7(#5)',
        commentJa: 'augと同じ。解決先を強く示す。',
        commentEn: 'Same as augmented. Strongly indicates the point of resolution.'
    },
    {
        tier: 'Pro',
        categoryJa: '⚡️ 緊張感・スパイス',
        categoryEn: 'Tension & Spice',
        quality: '7(b13)',
        commentJa: '複雑でムーディーな緊張感。',
        commentEn: 'A complex and moody tension.'
    }
];
const getQualityInfo = (quality)=>{
    return QUALITY_MASTER.find((q)=>q.quality === quality);
};
const getProQualities = ()=>{
    return QUALITY_MASTER.filter((q)=>q.tier === 'Pro').map((q)=>q.quality);
};
const getFreeQualities = ()=>{
    return QUALITY_MASTER.filter((q)=>q.tier === 'Free').map((q)=>q.quality);
};
const isProQuality = (quality)=>{
    return QUALITY_MASTER.some((q)=>q.quality === quality && q.tier === 'Pro');
};
const getQualityComment = (quality, locale)=>{
    const info = getQualityInfo(quality);
    if (!info) return '';
    return locale === 'ja' ? info.commentJa : info.commentEn;
};
const getQualitiesByCategory = (tier)=>{
    const filtered = QUALITY_MASTER.filter((q)=>q.tier === tier);
    const grouped = {};
    filtered.forEach((q)=>{
        if (!grouped[q.categoryJa]) {
            grouped[q.categoryJa] = [];
        }
        grouped[q.categoryJa].push(q);
    });
    return grouped;
};
}),
"[project]/src/components/ChordBuilder.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ChordBuilder
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2f$types$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/chords/types.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2f$normalize$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/chords/normalize.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2f$format$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/chords/format.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$pro$2f$guard$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/pro/guard.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$quality$2d$master$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/quality-master.ts [app-ssr] (ecmascript)");
"use client";
;
;
;
;
;
;
;
const ROOTS = [
    'C',
    'C#',
    'D',
    'Eb',
    'E',
    'F',
    'F#',
    'G',
    'Ab',
    'A',
    'Bb',
    'B'
];
// Pro Badge component (small 👑 at top-right of chip)
const ProBadge = ()=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
        className: "absolute -top-1 -right-1 text-[10px]",
        title: "Pro専用",
        children: "👑"
    }, void 0, false, {
        fileName: "[project]/src/components/ChordBuilder.tsx",
        lineNumber: 20,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0));
function ChordBuilder({ plan = 'free', onConfirm, onBlock, onPreview }) {
    // Debug: Log plan value
    console.log('[debug] plan in ChordBuilder:', plan);
    const baseSpec = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>({
            root: 'C',
            family: 'maj',
            seventh: 'none',
            extMode: 'add',
            ext: {},
            alt: {},
            sus: null,
            slash: null
        }), []);
    const [spec, setSpec] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(baseSpec);
    const ctx = {
        ...__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2f$types$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["DEFAULT_CONTEXT"],
        plan
    };
    // Session state for 11th warning (show once per session)
    const [has11thWarningShown, setHas11thWarningShown] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const { spec: norm, warnings } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2f$normalize$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["normalizeChordSpec"])(spec, ctx), [
        spec,
        ctx
    ]);
    const symbol = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2f$format$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["formatChordSymbol"])(norm, ctx), [
        norm,
        ctx
    ]);
    const setRoot = (r)=>setSpec((s)=>({
                ...s,
                root: r
            }));
    // Show 11th warning once per session
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (!has11thWarningShown && norm.ext.eleven && (norm.family === 'maj' || norm.family === 'dom')) {
            setHas11thWarningShown(true);
        }
    }, [
        norm.ext.eleven,
        norm.family,
        has11thWarningShown
    ]);
    // Helper function to convert Japanese category names to English
    const getEnglishCategoryName = (japaneseCategory)=>{
        switch(japaneseCategory){
            case '基本':
                return 'Basics';
            case '基本の飾り付け':
                return 'Essential Colors';
            case '✨ キラキラ・浮遊感':
                return '✨ Sparkle & Float';
            case '🌃 おしゃれ・都会的':
                return '🌃 Stylish & Urban';
            case '⚡️ 緊張感・スパイス':
                return '⚡️ Tension & Spice';
            default:
                return japaneseCategory;
        }
    };
    const getQualityFromSpec = (spec)=>{
        if (!spec) return '';
        // Map spec properties to quality labels
        if (spec.seventh === 'none' && spec.extMode === 'add' && spec.ext.add9) return 'add9';
        if (spec.seventh === 'none' && spec.extMode === 'add' && spec.ext.add11) return 'add#11';
        if (spec.seventh === 'sus4') return 'sus4';
        if (spec.seventh === 'sus2') return 'sus2';
        if (spec.family === 'maj' && spec.seventh === 'none') return 'M';
        if (spec.family === 'min' && spec.seventh === 'none') return 'm';
        if (spec.family === 'maj' && spec.seventh === '7') return 'M7';
        if (spec.family === 'min' && spec.seventh === '7') return 'm7';
        if (spec.family === 'dom' && spec.seventh === '7') return '7';
        if (spec.family === 'dim' && spec.seventh === 'none') return 'dim';
        if (spec.family === 'aug' && spec.seventh === 'none') return 'aug';
        if (spec.family === 'maj' && spec.seventh === '9') return 'M9';
        if (spec.family === 'min' && spec.seventh === '9') return 'm9';
        if (spec.family === 'min' && spec.seventh === '11') return 'm11';
        if (spec.family === 'min' && spec.seventh === '7b5') return 'm7b5';
        if (spec.family === 'min' && spec.seventh === 'M7') return 'mM7';
        if (spec.family === 'min' && spec.seventh === '6') return 'm6';
        if (spec.family === 'maj' && spec.seventh === '6') return '6';
        if (spec.family === 'maj' && spec.seventh === '6/9') return '6/9';
        if (spec.family === 'dom' && spec.seventh === 'sus4') return '7sus4';
        if (spec.family === 'dim' && spec.seventh === '7') return 'dim7';
        if (spec.family === 'dom' && spec.seventh === '7' && spec.alt.s9) return '7(#9)';
        if (spec.family === 'dom' && spec.seventh === '7' && spec.alt.b9) return '7(b9)';
        if (spec.family === 'dom' && spec.seventh === '7' && spec.alt.s5) return '7(#5)';
        if (spec.family === 'dom' && spec.seventh === '7' && spec.alt.b13) return '7(b13)';
        return '';
    };
    // Quality presets based on Quality Master.csv
    const qualityPresets = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>{
        console.log('🔍 ChordBuilder: Creating quality presets...');
        const freeQualities = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$quality$2d$master$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getQualitiesByCategory"])('Free');
        const proQualities = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$quality$2d$master$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getQualitiesByCategory"])('Pro');
        // Debug: Log the qualities
        console.log('🔍 Free qualities:', freeQualities);
        console.log('🔍 Pro qualities:', proQualities);
        console.log('🔍 Total qualities in QUALITY_MASTER:', __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$quality$2d$master$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["QUALITY_MASTER"].length);
        const presets = [];
        // Free qualities only - show Japanese category names for Japanese version
        Object.entries(freeQualities).forEach(([category, qualities])=>{
            qualities.forEach((quality)=>{
                const qualityLabel = quality.quality === 'm (minor)' ? 'm' : quality.quality === 'Major' ? 'M' : quality.quality === 'maj7' ? 'M7' : quality.quality;
                presets.push({
                    label: qualityLabel,
                    apply: ()=>{
                        const spec = getSpecFromQuality(quality.quality);
                        if (spec) setSpec(spec);
                    },
                    pro: false,
                    comment: quality.commentJa,
                    category: category // Use Japanese category names
                });
            });
        });
        // Pro qualities - show Japanese category names, only if user has Pro
        if (plan === 'pro') {
            Object.entries(proQualities).forEach(([category, qualities])=>{
                qualities.forEach((quality)=>{
                    const qualityLabel = quality.quality === 'M9 (maj9)' ? 'M9' : quality.quality === 'm7b5' ? 'm7b5' : quality.quality === 'mM7' ? 'mM7' : quality.quality === 'm6' ? 'm6' : quality.quality === '7(#9)' ? '7(#9)' : quality.quality === '7(b9)' ? '7(b9)' : quality.quality === '7(#5)' ? '7(#5)' : quality.quality === '7(b13)' ? '7(b13)' : quality.quality;
                    presets.push({
                        label: qualityLabel,
                        apply: ()=>{
                            const spec = getSpecFromQuality(quality.quality);
                            if (spec) setSpec(spec);
                        },
                        pro: true,
                        comment: quality.commentJa,
                        category: category // Use Japanese category names
                    });
                });
            });
        }
        console.log('🔍 Final presets count:', presets.length, 'Free count:', presets.filter((p)=>!p.pro).length, 'Pro count:', presets.filter((p)=>p.pro).length);
        return presets;
    }, [
        setSpec,
        plan
    ]);
    // Helper function to convert quality string to ChordSpec
    const getSpecFromQuality = (quality)=>{
        const baseSpec = {
            ext: {},
            alt: {},
            sus: null,
            slash: null
        };
        switch(quality){
            case 'Major':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: 'none',
                    extMode: 'add'
                };
            case 'm (minor)':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'min',
                    seventh: 'none',
                    extMode: 'add'
                };
            case '7':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'dom',
                    seventh: '7',
                    extMode: 'tension'
                };
            case 'maj7':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: 'maj7',
                    extMode: 'add'
                };
            case 'm7':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'min',
                    seventh: 'm7',
                    extMode: 'add'
                };
            case 'sus4':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: 'sus4',
                    extMode: 'add'
                };
            case 'sus2':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: 'sus2',
                    extMode: 'add'
                };
            case 'add9':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: 'none',
                    extMode: 'add',
                    ext: {
                        add9: true
                    }
                };
            case 'dim':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'dim',
                    seventh: 'none',
                    extMode: 'add'
                };
            case 'M9 (maj9)':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: 'maj7',
                    extMode: 'add',
                    ext: {
                        add9: true
                    }
                };
            case '6':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: '6',
                    extMode: 'add'
                };
            case '6/9':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: '6',
                    extMode: 'add',
                    ext: {
                        add9: true
                    }
                };
            case 'add#11':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'maj',
                    seventh: 'none',
                    extMode: 'add',
                    ext: {
                        add11: true
                    },
                    alt: {
                        s11: true
                    }
                };
            case 'm9':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'min',
                    seventh: 'm7',
                    extMode: 'add',
                    ext: {
                        add9: true
                    }
                };
            case 'm11':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'min',
                    seventh: 'm7',
                    extMode: 'add',
                    ext: {
                        add9: true,
                        add11: true
                    }
                };
            case 'm7b5':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'min',
                    seventh: 'm7b5',
                    extMode: 'add'
                };
            case 'mM7':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'min',
                    seventh: 'maj7',
                    extMode: 'add'
                };
            case 'm6':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'min',
                    seventh: '6',
                    extMode: 'add'
                };
            case '7sus4':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'dom',
                    seventh: '7',
                    sus: 'sus4',
                    extMode: 'tension'
                };
            case 'aug':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'aug',
                    seventh: 'none',
                    extMode: 'add'
                };
            case 'dim7':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'dim',
                    seventh: 'dim7',
                    extMode: 'add'
                };
            case '7(#9)':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'dom',
                    seventh: '7',
                    extMode: 'tension',
                    alt: {
                        sharp9: true
                    }
                };
            case '7(b9)':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'dom',
                    seventh: '7',
                    extMode: 'tension',
                    alt: {
                        flat9: true
                    }
                };
            case '7(#5)':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'dom',
                    seventh: '7',
                    extMode: 'tension',
                    alt: {
                        sharp5: true
                    }
                };
            case '7(b13)':
                return {
                    ...baseSpec,
                    root: 'C',
                    family: 'dom',
                    seventh: '7',
                    extMode: 'tension',
                    alt: {
                        flat13: true
                    }
                };
            default:
                return null;
        }
    };
    const renderChip = (label, active, onClick, opts)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "relative inline-block",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                    className: `h-9 px-3 rounded border text-xs ${active ? 'bg-[var(--brand-primary)] text-white' : ''} ${opts?.locked ? 'opacity-50' : ''}`,
                    onClick: ()=>{
                        if (!opts?.disabled && !opts?.locked) {
                            onClick();
                        } else if (opts?.locked) {
                            // Pro quality clicked in free plan
                            onBlock?.('pro_quality', label);
                        }
                    },
                    title: opts?.locked ? 'Proで解放' : opts?.comment,
                    "aria-disabled": opts?.disabled || opts?.locked,
                    onContextMenu: (e)=>{
                        e.preventDefault();
                        if (opts?.comment) {
                        // Show comment tooltip on right-click/long-press
                        // For now, we'll use the title attribute, but this could be enhanced with a custom tooltip
                        }
                    },
                    children: label
                }, void 0, false, {
                    fileName: "[project]/src/components/ChordBuilder.tsx",
                    lineNumber: 212,
                    columnNumber: 7
                }, this),
                opts?.showProBadge && plan === 'free' && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(ProBadge, {}, void 0, false, {
                    fileName: "[project]/src/components/ChordBuilder.tsx",
                    lineNumber: 232,
                    columnNumber: 49
                }, this)
            ]
        }, label, true, {
            fileName: "[project]/src/components/ChordBuilder.tsx",
            lineNumber: 211,
            columnNumber: 5
        }, this);
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "space-y-4",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "text-xs opacity-70 mb-0.5",
                        children: "ルート"
                    }, void 0, false, {
                        fileName: "[project]/src/components/ChordBuilder.tsx",
                        lineNumber: 239,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",
                        children: ROOTS.map((r)=>renderChip(r, norm.root === r, ()=>setRoot(r)))
                    }, void 0, false, {
                        fileName: "[project]/src/components/ChordBuilder.tsx",
                        lineNumber: 240,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ChordBuilder.tsx",
                lineNumber: 238,
                columnNumber: 7
            }, this),
            (()=>{
                const quick = plan === 'free' ? qualityPresets.filter((p)=>!p.pro) // ← Pro項目を隠す
                 : qualityPresets;
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "text-xs opacity-70 mb-0.5",
                            children: [
                                "クイック (",
                                quick.length,
                                "種類)"
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/components/ChordBuilder.tsx",
                            lineNumber: 251,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",
                            children: quick.map((p)=>{
                                // Check if this quality is currently selected
                                const currentQuality = spec ? getQualityFromSpec(spec) : null;
                                const isSelected = currentQuality === p.label;
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "relative",
                                    children: renderChip(p.label, isSelected, p.apply, {
                                        locked: plan === 'free' && !!p.pro,
                                        showProBadge: !!p.pro,
                                        comment: p.comment
                                    })
                                }, p.label, false, {
                                    fileName: "[project]/src/components/ChordBuilder.tsx",
                                    lineNumber: 258,
                                    columnNumber: 19
                                }, this);
                            })
                        }, void 0, false, {
                            fileName: "[project]/src/components/ChordBuilder.tsx",
                            lineNumber: 252,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/components/ChordBuilder.tsx",
                    lineNumber: 250,
                    columnNumber: 11
                }, this);
            })(),
            plan === 'free' ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("details", {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("summary", {
                        className: "cursor-pointer text-sm",
                        children: "高度な機能 (Pro) 👑"
                    }, void 0, false, {
                        fileName: "[project]/src/components/ChordBuilder.tsx",
                        lineNumber: 275,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "mt-3 space-y-3",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "text-sm opacity-70 p-4 bg-gray-50 rounded-lg",
                            children: "Pro版では、より高度なコード品質をご利用いただけます。"
                        }, void 0, false, {
                            fileName: "[project]/src/components/ChordBuilder.tsx",
                            lineNumber: 277,
                            columnNumber: 13
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/src/components/ChordBuilder.tsx",
                        lineNumber: 276,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ChordBuilder.tsx",
                lineNumber: 274,
                columnNumber: 9
            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("details", {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("summary", {
                        className: "cursor-pointer text-sm",
                        children: "高度な機能 (Pro)"
                    }, void 0, false, {
                        fileName: "[project]/src/components/ChordBuilder.tsx",
                        lineNumber: 284,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "mt-3 space-y-3",
                        children: Object.entries((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$quality$2d$master$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getQualitiesByCategory"])('Pro')).map(([category, qualities])=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "text-xs opacity-70 mb-0.5",
                                        children: category
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordBuilder.tsx",
                                        lineNumber: 289,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",
                                        children: qualities.map((quality)=>{
                                            const qualityLabel = quality.quality === 'M9 (maj9)' ? 'M9' : quality.quality === 'm7b5' ? 'm7b5' : quality.quality === 'mM7' ? 'mM7' : quality.quality === 'm6' ? 'm6' : quality.quality === '7(#9)' ? '7(#9)' : quality.quality === '7(b9)' ? '7(b9)' : quality.quality === '7(#5)' ? '7(#5)' : quality.quality === '7(b13)' ? '7(b13)' : quality.quality;
                                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "relative",
                                                children: renderChip(qualityLabel, false, ()=>{
                                                    const spec = getSpecFromQuality(quality.quality);
                                                    if (spec) setSpec(spec);
                                                }, {
                                                    comment: quality.commentJa
                                                })
                                            }, quality.quality, false, {
                                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                                lineNumber: 303,
                                                columnNumber: 23
                                            }, this);
                                        })
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordBuilder.tsx",
                                        lineNumber: 290,
                                        columnNumber: 17
                                    }, this),
                                    category === '🌃 おしゃれ・都会的' && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-3",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "text-xs opacity-70 mb-0.5",
                                                children: "Slash (On)"
                                            }, void 0, false, {
                                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                                lineNumber: 318,
                                                columnNumber: 21
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "flex gap-1 overflow-x-auto whitespace-nowrap py-0 -mx-2 px-2",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                        className: "h-9 px-3 rounded border text-xs bg-orange-500 text-white",
                                                        onClick: ()=>setSpec({
                                                                ...spec,
                                                                slash: undefined
                                                            }),
                                                        children: "クリア"
                                                    }, void 0, false, {
                                                        fileName: "[project]/src/components/ChordBuilder.tsx",
                                                        lineNumber: 320,
                                                        columnNumber: 23
                                                    }, this),
                                                    [
                                                        'C',
                                                        'C#',
                                                        'D',
                                                        'D#',
                                                        'E',
                                                        'F',
                                                        'F#',
                                                        'G',
                                                        'G#',
                                                        'A',
                                                        'A#',
                                                        'B'
                                                    ].map((bassNote)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                            className: `h-9 px-3 rounded border text-xs ${spec?.slash === bassNote ? 'bg-[var(--brand-primary)] text-white' : 'bg-gray-600 text-white hover:bg-gray-500'}`,
                                                            onClick: ()=>setSpec({
                                                                    ...spec,
                                                                    slash: bassNote
                                                                }),
                                                            children: bassNote
                                                        }, bassNote, false, {
                                                            fileName: "[project]/src/components/ChordBuilder.tsx",
                                                            lineNumber: 327,
                                                            columnNumber: 25
                                                        }, this))
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                                lineNumber: 319,
                                                columnNumber: 21
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/components/ChordBuilder.tsx",
                                        lineNumber: 317,
                                        columnNumber: 19
                                    }, this)
                                ]
                            }, category, true, {
                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                lineNumber: 288,
                                columnNumber: 15
                            }, this))
                    }, void 0, false, {
                        fileName: "[project]/src/components/ChordBuilder.tsx",
                        lineNumber: 285,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ChordBuilder.tsx",
                lineNumber: 283,
                columnNumber: 9
            }, this),
            warnings.length > 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "text-xs text-yellow-600 dark:text-yellow-400",
                children: warnings[0]
            }, void 0, false, {
                fileName: "[project]/src/components/ChordBuilder.tsx",
                lineNumber: 349,
                columnNumber: 9
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center justify-between mb-3",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "text-sm font-medium text-gray-700 dark:text-gray-300",
                                children: "プレビュー"
                            }, void 0, false, {
                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                lineNumber: 356,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "text-xl font-bold text-gray-900 dark:text-white bg-white dark:bg-gray-700 px-3 py-1 rounded border",
                                children: symbol || 'コードを選択してください'
                            }, void 0, false, {
                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                lineNumber: 357,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/ChordBuilder.tsx",
                        lineNumber: 355,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex gap-2 justify-center",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                className: "flex items-center gap-1 rounded-lg bg-green-500 hover:bg-green-600 text-white px-4 py-2 text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",
                                onClick: ()=>onPreview?.(symbol),
                                disabled: !symbol,
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                        className: "w-4 h-4",
                                        fill: "currentColor",
                                        viewBox: "0 0 20 20",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                            d: "M8 5v10l8-5-8-5z"
                                        }, void 0, false, {
                                            fileName: "[project]/src/components/ChordBuilder.tsx",
                                            lineNumber: 368,
                                            columnNumber: 15
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/src/components/ChordBuilder.tsx",
                                        lineNumber: 367,
                                        columnNumber: 13
                                    }, this),
                                    "再生"
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                lineNumber: 362,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                className: "rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",
                                onClick: ()=>setSpec(baseSpec),
                                children: "クリア"
                            }, void 0, false, {
                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                lineNumber: 372,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                className: "rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-2 text-sm font-medium transition-all transform hover:scale-105",
                                onClick: ()=>{
                                    // Check if chord can be added
                                    const isPro = plan === 'pro';
                                    const hasSlash = !!norm.slash;
                                    // Simple quality extraction for guard check
                                    // (This is a simplified check - actual quality depends on full spec)
                                    let qualityToCheck = '';
                                    if (norm.ext.thirteen) qualityToCheck = '13';
                                    else if (norm.alt.b9) qualityToCheck = '7b9';
                                    else if (norm.alt.s9) qualityToCheck = '7#9';
                                    else if (norm.alt.s11) qualityToCheck = '7#11';
                                    else if (norm.alt.b13) qualityToCheck = '7b13';
                                    else if (norm.alt.alt) qualityToCheck = '7alt';
                                    const canAdd = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$pro$2f$guard$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["canAddQuality"])(qualityToCheck, {
                                        isPro,
                                        hasSlash
                                    });
                                    if (!canAdd) {
                                        // Block and notify parent
                                        if (hasSlash) {
                                            onBlock?.('pro_slash');
                                        } else {
                                            onBlock?.('pro_quality', qualityToCheck);
                                        }
                                    } else {
                                        // Allow add
                                        onConfirm?.(symbol, norm);
                                    }
                                },
                                children: "追加"
                            }, void 0, false, {
                                fileName: "[project]/src/components/ChordBuilder.tsx",
                                lineNumber: 378,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/components/ChordBuilder.tsx",
                        lineNumber: 361,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/components/ChordBuilder.tsx",
                lineNumber: 354,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/components/ChordBuilder.tsx",
        lineNumber: 237,
        columnNumber: 5
    }, this);
}
}),
"[project]/src/app/chord-progression/page.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>FindKeyPage
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$AdSlot$2e$client$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/AdSlot.client.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/hooks/useRovingTabs.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$Fretboard$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/Fretboard.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/src/lib/theory.ts [app-ssr] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__ = __turbopack_context__.i("[project]/src/lib/music/constants.ts [app-ssr] (ecmascript) <export PC_NAMES as PITCHES>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scales.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/diatonic.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/scaleCatalog.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/roman.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/store/analysisStore.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$ui$2f$cadence$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/ui/cadence.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/InfoDot.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/Heading.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2d$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music-theory.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/chords.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ProProvider$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ProProvider.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$compat$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/compat.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$DiatonicCapoTable$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/DiatonicCapoTable.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2f$match$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/roman/match.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2f$patterns$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/theory/roman/patterns.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/audio/player.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$useSketch$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/features/sketch/useSketch.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$sketchStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/store/sketchStore.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/telemetry.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$export$2f$png$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/export/png.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$chordParser$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/music/chordParser.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$Toast$2e$client$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/Toast.client.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useCtaMessages$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/hooks/useCtaMessages.ts [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ChordBuilder$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ChordBuilder.tsx [app-ssr] (ecmascript)");
"use client";
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
function FindKeyPage() {
    const CTA_MESSAGES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useCtaMessages$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCtaMessages"])();
    const pathname = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["usePathname"])();
    const searchParams = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useSearchParams"])();
    const isJapanese = pathname.startsWith('/ja');
    const rootRowRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRovingTabs"])(rootRowRef, {
        orientation: "horizontal"
    });
    const fbToggleRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRovingTabs"])(fbToggleRef, {
        orientation: "horizontal"
    });
    const presetRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$useRovingTabs$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRovingTabs"])(presetRef, {
        orientation: "horizontal"
    });
    const exportRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const exportCardRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    // スロット固定の進行（空は空文字）。初期値は C–Am–F–G を 1〜4 に配置
    const [slots, setSlots] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(()=>{
        const a = new Array(12).fill("");
        a[0] = "C";
        a[1] = "Am";
        a[2] = "F";
        a[3] = "G";
        return a;
    });
    // 表示用の詰めた配列と、元スロットのインデックス
    const filledIndices = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>slots.reduce((acc, v, i)=>{
            if (v) acc.push(i);
            return acc;
        }, []), [
        slots
    ]);
    const progression = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>filledIndices.map((i)=>slots[i]), [
        filledIndices,
        slots
    ]);
    // 追加入力のカーソル位置（次の空スロット）
    const firstEmpty = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>{
        const idx = slots.findIndex((s)=>!s);
        return idx === -1 ? 11 : idx;
    }, [
        slots
    ]);
    const [cursorIndex, setCursorIndex] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(0);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        setCursorIndex(firstEmpty);
    }, [
        firstEmpty
    ]);
    const ROOTS = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>[
            'C',
            'C#',
            'D',
            'Eb',
            'E',
            'F',
            'F#',
            'G',
            'Ab',
            'A',
            'Bb',
            'B'
        ], []);
    const QUALITIES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>[
            {
                label: 'M',
                value: ''
            },
            {
                label: 'M7',
                value: 'maj7'
            },
            {
                label: '7',
                value: '7'
            },
            {
                label: '6',
                value: '6'
            },
            {
                label: 'add9',
                value: 'add9'
            },
            {
                label: 'sus4',
                value: 'sus4'
            },
            {
                label: 'sus2',
                value: 'sus2'
            },
            {
                label: 'm',
                value: 'm'
            },
            {
                label: 'm7',
                value: 'm7'
            },
            {
                label: 'dim',
                value: 'dim'
            },
            {
                label: 'm7b5',
                value: 'm7b5'
            },
            {
                label: 'aug',
                value: 'aug'
            }
        ], []);
    const [rootSel, setRootSel] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])('C');
    const [qualitySel, setQualitySel] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])('M');
    const [modifiers, setModifiers] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])([]);
    const TENSIONS = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>[
            {
                label: 'sus2',
                value: 'sus2'
            },
            {
                label: 'sus4',
                value: 'sus4'
            },
            {
                label: 'add9',
                value: 'add9'
            },
            {
                label: 'add11',
                value: 'add11'
            },
            {
                label: 'add13',
                value: 'add13'
            }
        ], []);
    const [tensionsSel, setTensionsSel] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])([]);
    const [bassSel, setBassSel] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])('');
    const composeChord = (root, quality, tensions, bass)=>{
        if (!root) return '';
        const qualityPart = quality || '';
        const tensionPart = tensions.length ? tensions.join('') : '';
        const chord = `${root}${qualityPart}${tensionPart}`;
        return bass ? `${chord}/${bass}` : chord;
    };
    const toggleTension = (val)=>{
        setTensionsSel((prev)=>prev.includes(val) ? prev.filter((v)=>v !== val) : [
                ...prev,
                val
            ]);
    };
    const [result, setResult] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [keys, setKeys] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])([]);
    const [scales, setScales] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])([]);
    const [selectedScaleRank, setSelectedScaleRank] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [romanLine, setRomanLine] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])([]);
    const { keyCandidates, selectedKey: selFromStore, analyze: runAnalyze, selectKey, scaleCandidates, selectedScale, selectScale, reset: resetAnalysis } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useAnalysisStore"])();
    const [fbDisplay, setFbDisplay] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])('degrees');
    const [selectedCellId, setSelectedCellId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [overlayChordNotes, setOverlayChordNotes] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [formsPop, setFormsPop] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [formShape, setFormShape] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const resetForms = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])(()=>{
        setFormsPop(null);
        setFormShape(null);
    }, []);
    const isHeptatonic = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>{
        const t = selectedScale?.type;
        const ivs = t ? __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][t] : null;
        return !ivs || ivs.length === 7;
    }, [
        selectedScale?.type
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (!isHeptatonic && fbDisplay !== 'degrees') setFbDisplay('degrees');
    }, [
        isHeptatonic
    ]);
    const [selectedKey, setSelectedKey] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const gridRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const leftWrapRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const resultRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const rightRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [dragIndex, setDragIndex] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    // Mobile touch drag support
    const touchStartRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const dragPreviewRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    // Playback state
    const [isPlaying, setIsPlaying] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [bpm, setBpm] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(120);
    const playbackTimerRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [currentChordIndex, setCurrentChordIndex] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(-1);
    const moveSlot = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])((from, to)=>{
        setSlots((prev)=>{
            if (from === to) return prev;
            const arr = prev.slice();
            const tmp = arr[from];
            arr[from] = arr[to];
            arr[to] = tmp;
            return arr;
        });
    }, []);
    // Mobile drag handlers
    const [touchDragTarget, setTouchDragTarget] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const handleTouchStartDrag = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])((e, i)=>{
        if (!slots[i]) return; // Only drag filled slots
        e.stopPropagation();
        const touch = e.touches[0];
        touchStartRef.current = {
            index: i,
            startX: touch.clientX,
            startY: touch.clientY
        };
        setDragIndex(i);
        setTouchDragTarget(null);
    }, [
        slots
    ]);
    const handleTouchMoveDrag = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])((e, currentIndex)=>{
        if (touchStartRef.current === null || dragIndex === null) return;
        const touch = e.touches[0];
        const element = document.elementFromPoint(touch.clientX, touch.clientY);
        // Find the slot element
        let slotElement = element;
        while(slotElement && !slotElement.hasAttribute('data-slot-index')){
            slotElement = slotElement.parentElement;
        }
        if (slotElement) {
            const targetIndex = parseInt(slotElement.getAttribute('data-slot-index') || '-1');
            if (targetIndex >= 0 && targetIndex !== dragIndex) {
                setTouchDragTarget(targetIndex);
            }
        }
    }, [
        dragIndex
    ]);
    const handleTouchEndDrag = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])((e)=>{
        if (touchStartRef.current !== null && dragIndex !== null && touchDragTarget !== null && dragIndex !== touchDragTarget) {
            moveSlot(dragIndex, touchDragTarget);
        }
        touchStartRef.current = null;
        setDragIndex(null);
        setTouchDragTarget(null);
    }, [
        dragIndex,
        touchDragTarget,
        moveSlot
    ]);
    // Playback state flag to ensure stopPlayback is effective
    const isPlayingRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(false);
    // Playback functions
    const stopPlayback = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])(()=>{
        isPlayingRef.current = false;
        if (playbackTimerRef.current) {
            clearInterval(playbackTimerRef.current);
            playbackTimerRef.current = null;
        }
        setIsPlaying(false);
        setCurrentChordIndex(-1);
    }, []);
    const startPlayback = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])(async ()=>{
        const filledSlots = slots.map((s, i)=>({
                chord: s,
                index: i
            })).filter((x)=>x.chord);
        if (filledSlots.length === 0) return;
        // 前回の再生が残っていたら確実に停止
        stopPlayback();
        await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
        isPlayingRef.current = true;
        setIsPlaying(true);
        setCurrentChordIndex(0);
        // Count-in: simple metronome click
        const countInBeats = 4;
        const beatDuration = 60 / bpm * 1000;
        for(let i = 0; i < countInBeats; i++){
            if (!isPlayingRef.current) return; // 停止されたらカウントイン中でも中断
            await new Promise((resolve)=>setTimeout(resolve, beatDuration));
            if (!isPlayingRef.current) return;
            // Play a simple click sound (high MIDI note, short duration)
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playNote(84, 100); // C6, 100ms
        }
        // Start progression playback (4 beats per chord)
        let chordIdx = 0;
        let beatCount = 0;
        const playBeat = async ()=>{
            if (!isPlayingRef.current) {
                // 停止フラグが立っていたらタイマーをクリア
                if (playbackTimerRef.current) {
                    clearInterval(playbackTimerRef.current);
                    playbackTimerRef.current = null;
                }
                return;
            }
            if (beatCount % 4 === 0) {
                // New chord every 4 beats
                if (chordIdx >= filledSlots.length) {
                    chordIdx = 0; // Loop
                }
                const { chord, index } = filledSlots[chordIdx];
                setCurrentChordIndex(index);
                await playChordSymbol(chord);
                chordIdx++;
            } else {
                // Re-trigger the same chord
                if (chordIdx > 0 && chordIdx <= filledSlots.length) {
                    const { chord } = filledSlots[chordIdx - 1];
                    await playChordSymbol(chord);
                }
            }
            beatCount++;
        };
        if (!isPlayingRef.current) return;
        await playBeat(); // Play first beat immediately
        if (!isPlayingRef.current) return;
        playbackTimerRef.current = setInterval(playBeat, beatDuration);
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('progression_play', {
            page: 'chord_progression',
            bpm,
            chordCount: filledSlots.length
        });
    }, [
        slots,
        bpm,
        stopPlayback
    ]);
    const togglePlayback = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])(()=>{
        if (isPlaying) {
            stopPlayback();
        } else {
            startPlayback();
        }
    }, [
        isPlaying,
        startPlayback,
        stopPlayback
    ]);
    // Stop playback when component unmounts or slots change
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        return ()=>{
            if (playbackTimerRef.current) {
                clearInterval(playbackTimerRef.current);
            }
        };
    }, []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (isPlaying) {
            stopPlayback();
        }
    }, [
        slots
    ]);
    const removeSlot = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useCallback"])((idx)=>{
        setSlots((prev)=>{
            const arr = prev.slice();
            arr[idx] = "";
            return arr;
        });
    }, []);
    const { isPro } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ProProvider$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["usePro"])();
    // Debug: Log isPro value
    console.log('[debug] isPro in page:', isPro);
    const { sketch, setSketch } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$features$2f$sketch$2f$useSketch$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useSketch"])(isPro);
    const sketchIdRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const ensureSketchId = ()=>{
        if (!sketchIdRef.current) sketchIdRef.current = Math.random().toString(36).slice(2, 10);
        return sketchIdRef.current;
    };
    const { sketches, loadSketches, deleteSketch, saveSketch } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$sketchStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useSketchStore"])();
    const [showSketchList, setShowSketchList] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [selectedSketchForAction, setSelectedSketchForAction] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const sketchesDropRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [sketchName, setSketchName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])("");
    // Preset popup state
    const [showPresetPopup, setShowPresetPopup] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [presetKey, setPresetKey] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])('C');
    const presetPopupRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (showSketchList) loadSketches();
    }, [
        showSketchList,
        loadSketches
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const onDown = (e)=>{
            if (!showSketchList) return;
            const el = sketchesDropRef.current;
            if (el && !el.contains(e.target)) setShowSketchList(false);
        };
        const onKey = (e)=>{
            if (e.key === 'Escape') setShowSketchList(false);
        };
        document.addEventListener('mousedown', onDown);
        document.addEventListener('keydown', onKey);
        return ()=>{
            document.removeEventListener('mousedown', onDown);
            document.removeEventListener('keydown', onKey);
        };
    }, [
        showSketchList
    ]);
    // Close preset popup on outside click or ESC
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (!showPresetPopup) return;
        const onDown = (e)=>{
            const el = presetPopupRef.current;
            if (el && !el.contains(e.target)) setShowPresetPopup(false);
        };
        const onKey = (e)=>{
            if (e.key === 'Escape') setShowPresetPopup(false);
        };
        document.addEventListener('mousedown', onDown);
        document.addEventListener('keydown', onKey);
        return ()=>{
            document.removeEventListener('mousedown', onDown);
            document.removeEventListener('keydown', onKey);
        };
    }, [
        showPresetPopup
    ]);
    // Save（Result内のプロンプト）
    const [showNamePrompt, setShowNamePrompt] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [nameInput, setNameInput] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])("");
    const defaultSketchName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>progression.length ? progression.join(" ") : `Untitled ${new Date().toLocaleString()}`, [
        progression
    ]);
    // M3.5: Toast notifications
    const [toastConfig, setToastConfig] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const toastShownRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(new Set());
    // M3.5: Show toast when reaching 9-12 chords
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const filledCount = slots.filter((s)=>s !== "").length;
        if (filledCount === 9 && !toastShownRef.current.has('limit_warn')) {
            setToastConfig({
                message: CTA_MESSAGES.toast.limitWarn,
                type: 'info',
                ctaText: CTA_MESSAGES.toast.ctaButton,
                ctaHref: '/ios-coming-soon',
                ctaPlace: 'limit_toast'
            });
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["trackToast"])('limit_warn', {
                page: 'chord_progression',
                chordCount: filledCount
            });
            toastShownRef.current.add('limit_warn');
        } else if (filledCount === 12 && !toastShownRef.current.has('limit_block')) {
            setToastConfig({
                message: CTA_MESSAGES.toast.limitBlock,
                type: 'warning',
                ctaText: CTA_MESSAGES.toast.ctaButton,
                ctaHref: '/ios-coming-soon',
                ctaPlace: 'limit_toast'
            });
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["trackToast"])('limit_block', {
                page: 'chord_progression',
                chordCount: filledCount
            });
            toastShownRef.current.add('limit_block');
        }
    }, [
        slots
    ]);
    // M3.5: Current sketch name for PNG export
    const [currentExportName, setCurrentExportName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])("");
    const handleExportSketch = async (sk)=>{
        try {
            // Sketchのデータからエクスポートカードを一時的に生成してPNG出力
            if (!exportCardRef.current) return;
            // Set the sketch name for export
            setCurrentExportName(sk.name || "Untitled Sketch");
            // Wait for state update
            await new Promise((resolve)=>setTimeout(resolve, 50));
            // 一時的にopacityを1にしてレンダリング
            const exportCard = exportCardRef.current;
            exportCard.style.opacity = '1';
            exportCard.style.visibility = 'visible';
            // レンダリング完了を待つ
            await new Promise((resolve)=>setTimeout(resolve, 200));
            // PNG出力
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$export$2f$png$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["exportPng"])(exportCard, 'auto');
            // 元に戻す
            exportCard.style.opacity = '0.0001';
            exportCard.style.visibility = 'hidden';
            setCurrentExportName("");
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('export_png', {
                page: 'chord_progression',
                source: 'sketch',
                id: sk.id
            });
            // M3.5: Show toast after PNG export
            if (!toastShownRef.current.has('png_export')) {
                setToastConfig({
                    message: CTA_MESSAGES.toast.pngExport,
                    type: 'success',
                    ctaText: CTA_MESSAGES.toast.ctaButton,
                    ctaHref: '/ios-coming-soon',
                    ctaPlace: 'png_toast'
                });
                toastShownRef.current.add('png_export');
            }
        } catch (e) {
            console.error('Export failed:', e);
            setCurrentExportName("");
        }
    };
    const doSaveSketch = async ()=>{
        try {
            // M3.5: Check Free limit BEFORE saving (directly from localStorage)
            if (!isPro) {
                const existingSketches = JSON.parse(localStorage.getItem('ot_sketches') || '[]');
                console.log('[DEBUG] doSaveSketch - isPro:', isPro, 'existing sketches:', existingSketches.length);
                if (existingSketches.length >= 3) {
                    console.log('[DEBUG] Blocking save - limit reached');
                    setShowNamePrompt(false);
                    setNameInput("");
                    setToastConfig({
                        message: CTA_MESSAGES.toast.sketchLimit,
                        type: 'warning',
                        ctaText: CTA_MESSAGES.toast.ctaButton,
                        ctaHref: '/ios-coming-soon',
                        ctaPlace: 'limit_toast'
                    });
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["trackToast"])('limit_block', {
                        page: 'chord_progression',
                        context: 'sketch_limit'
                    });
                    return;
                }
            }
            console.log('[DEBUG] Proceeding with save');
            const tonicGuess = selFromStore ? __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][selFromStore.tonic] : selectedKey ? selectedKey.tonic : 'C';
            const scaleGuess = selectedScale?.type || (selFromStore ? selFromStore.mode : 'Ionian');
            const name = (nameInput.trim() || defaultSketchName).slice(0, 48);
            const data = {
                name,
                schema: 'sketch_v1',
                appVersion: '3.0.0',
                key: {
                    tonic: tonicGuess,
                    scaleId: String(scaleGuess)
                },
                capo: {
                    fret: 0,
                    note: 'Shaped'
                },
                progression: {
                    items: progression.map((c, i)=>({
                            id: c,
                            degree: '',
                            quality: ''
                        }))
                },
                fretboardView: {
                    mode: fbDisplay === 'names' ? 'Names' : 'Degrees',
                    guide: !!overlayChordNotes
                }
            };
            const r = await saveSketch(data);
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('save_project', {
                page: 'chord_progression',
                ok: r?.ok
            });
            setShowNamePrompt(false);
            setNameInput("");
        } catch  {}
    };
    const [showAdv, setShowAdv] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [showUpgrade, setShowUpgrade] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [addedFlash, setAddedFlash] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [isAnalyzing, startAnalyze] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useTransition"])();
    const [patternHits, setPatternHits] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])([]);
    const [cadences, setCadences] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])([]);
    // Romanハイライト: 範囲(start<=i<end)を保持
    const [romanHL, setRomanHL] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    // Romanボックスをスクロール対象に
    const romanBoxRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    // Romanの小文字(i,v,x)だけを大文字化。括弧の中だけに適用するユーティリティ。
    function upperRomansInParens(name) {
        return name.replace(/\(([^)]+)\)/g, (_, inner)=>{
            const up = inner.replace(/[ivx]+/g, (m)=>m.toUpperCase());
            return `(${up})`;
        });
    }
    const parseProg = (arr)=>arr.map((t)=>{
            const m = t.match(/^([A-G](?:#|b)?)(.*)$/);
            return {
                root: m?.[1] || t,
                quality: m?.[2] || ''
            };
        });
    // Quick: ベース品質の“選択のみ”
    const onPickBase = (q)=>{
        setQualitySel(q);
        // ベース変更で矛盾する modifier は自動クリア
        setModifiers((prev)=>prev.filter((m)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$compat$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["isCompatible"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$compat$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getBaseKind"])(q), m)));
        if (bassSel === rootSel) setBassSel('');
    };
    // Advanced: 要素のトグル（Pro以外はアップグレード誘導）
    const toggleModifier = (m)=>{
        if (!isPro) {
            setShowUpgrade(true);
            return;
        }
        if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$compat$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["isCompatible"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$compat$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getBaseKind"])(qualitySel), m)) return;
        setModifiers((prev)=>prev.includes(m) ? prev.filter((x)=>x !== m) : [
                ...prev,
                m
            ]);
    };
    // Slash: ノートのみ（同音/同じノートで解除）
    const onPickBass = (n)=>{
        if (!isPro) {
            setShowUpgrade(true);
            return;
        }
        if (n === rootSel || n === bassSel) setBassSel('');
        else setBassSel(n);
    };
    // Preset helper: Roman numerals to actual chords based on key
    const applyPreset = (presetName, romans, key)=>{
        const keyPc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["noteToPc"])(key);
        if (keyPc === undefined || keyPc < 0 || keyPc > 11) return;
        // プリセットは基本的にMajor keyで定義されている
        // （将来的にMinorプリセットを追加する場合は、ここで判定ロジックを追加）
        const mode = "Major";
        // theory.tsのromanToChordSymbol関数を使用（文脈化された変換）
        const chords = romans.map((roman)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["romanToChordSymbol"])(roman, keyPc, mode));
        // Append to existing progression (find first empty slot)
        setSlots((prev)=>{
            const arr = [
                ...prev
            ];
            let insertIdx = arr.findIndex((s)=>!s); // Find first empty slot
            if (insertIdx === -1) insertIdx = 0; // If all full, start from beginning
            chords.forEach((c, i)=>{
                const targetIdx = (insertIdx + i) % 12;
                arr[targetIdx] = c;
            });
            return arr;
        });
        // Move cursor to next empty slot or wrap around
        setCursorIndex((prev)=>{
            const arr = [
                ...slots
            ];
            chords.forEach((c, i)=>{
                const insertIdx = arr.findIndex((s)=>!s);
                if (insertIdx === -1) return 0;
                const targetIdx = (insertIdx + i) % 12;
                arr[targetIdx] = c;
            });
            const nextEmpty = arr.findIndex((s)=>!s);
            return nextEmpty === -1 ? 0 : nextEmpty;
        });
        // Don't auto-analyze - user must click Analyze button
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('preset_inserted', {
            page: 'chord_progression',
            preset: presetName
        });
        setShowPresetPopup(false);
    };
    const analyze = ()=>{
        const res = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2d$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["analyzeChordProgression"])(progression);
        setResult(res);
        const ranked = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["rankKeys"])(progression);
        setKeys(ranked.slice(0, 4));
        if (ranked.length > 0) {
            const mode = ranked[0].mode === "Major" ? "major" : "minor";
            const keyName = ranked[0].label.split(" ")[0];
            const sel = {
                tonic: keyName,
                mode
            };
            setSelectedKey(sel);
            setRomanLine(progression.map((c)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toRoman"])(c, sel.tonic, sel.mode, {
                    showQuality: true,
                    uppercase: true
                })));
        } else {
            setScales([]);
            setSelectedKey(null);
            setRomanLine([]);
        }
        // store-based analysis for Top3 candidates
        runAnalyze(progression);
        // Auto-scroll to result section
        setTimeout(()=>{
            const resultElement = document.getElementById('result');
            if (resultElement) {
                resultElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }, 100);
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const current = selFromStore || selectedKey;
        if (!current) return;
        const tonic = typeof current.tonic === 'number' ? __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][current.tonic] : current.tonic;
        const mode = current.mode === 'Major' || current.mode === 'Minor' ? current.mode === 'Major' ? 'major' : 'minor' : current.mode;
        setRomanLine(progression.map((c)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toRoman"])(c, tonic, mode, {
                showQuality: true,
                uppercase: true
            })));
    }, [
        selFromStore,
        selectedKey,
        progression
    ]);
    // Roman pattern detection
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (!selectedKey || romanLine.length === 0) {
            setPatternHits([]);
            return;
        }
        const mode = selectedKey.mode;
        setPatternHits((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2f$match$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["matchPatterns"])(romanLine, mode));
    }, [
        romanLine,
        selectedKey
    ]);
    // Cadence detection (rule-based; normalize tokens + loop-boundary)
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (!romanLine || romanLine.length === 0) {
            setCadences([]);
            return;
        }
        const norm = romanLine.map((t)=>{
            const m = t.replace(/\s+/g, "").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);
            if (!m) return t.toUpperCase();
            const acc = m[1] ?? "";
            const core = (m[2] ?? "").toUpperCase();
            return `${acc}${core}`;
        });
        let raw = null;
        try {
            raw = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["detectCadence"](norm);
        } catch  {}
        const arr = Array.isArray(raw) ? raw : raw ? [
            raw
        ] : [];
        const views = arr.map((r)=>{
            if (typeof r === 'string') return {
                type: r
            };
            const type = r?.type ?? r;
            const tail = r?.tailRoman ?? (r?.pair ? {
                from: r.pair[0],
                to: r.pair[1]
            } : undefined);
            return {
                type,
                tail
            };
        });
        if (norm.length >= 2) {
            const last = norm[norm.length - 1];
            const first = norm[0];
            if (!views.some((v)=>v.type === 'perfect') && last === 'V' && first === 'I') views.push({
                type: 'perfect',
                tail: {
                    from: 'V',
                    to: 'I'
                }
            });
            if (!views.some((v)=>v.type === 'deceptive') && last === 'V' && first === 'VI') views.push({
                type: 'deceptive',
                tail: {
                    from: 'V',
                    to: 'vi'
                }
            });
        }
        setCadences(views);
    }, [
        romanLine
    ]);
    // Fallback cadence (render-time) in case state-based detection fails
    const fallbackCadence = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useMemo"])(()=>{
        if (!romanLine || romanLine.length === 0) return null;
        const norm = romanLine.map((t)=>{
            const m = t.replace(/\s+/g, "").match(/^(b|#)?([ivIV]+)(?:[°ø].*)?/);
            if (!m) return t.toUpperCase();
            const acc = m[1] ?? "";
            const core = (m[2] ?? "").toUpperCase();
            return `${acc}${core}`;
        });
        if (norm.length < 2) return null;
        const first = norm[0];
        const last = norm[norm.length - 1];
        if (last === 'V' && first === 'I') return {
            type: 'perfect',
            tail: {
                from: 'V',
                to: 'I'
            }
        };
        if (last === 'V' && first === 'VI') return {
            type: 'deceptive',
            tail: {
                from: 'V',
                to: 'vi'
            }
        };
        if (last === 'V') return {
            type: 'half',
            tail: {
                from: undefined,
                to: 'V'
            }
        };
        return null;
    }, [
        romanLine
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const compute = ()=>{
            if (!gridRef.current || !leftWrapRef.current || !resultRef.current) return;
            // Desktopのみmin-heightを計算。モバイルはstickyを使わないため0に戻す。
            const isDesktop = "undefined" !== 'undefined' && window.matchMedia && window.matchMedia('(min-width: 1024px)').matches;
            if ("TURBOPACK compile-time truthy", 1) {
                leftWrapRef.current.style.minHeight = '0px';
                return;
            }
            //TURBOPACK unreachable
            ;
            // ループで伸び続けないよう、測定前に一旦0へ戻してから距離を測る
            const prevMin = undefined;
            const gridTop = undefined;
            const rightBottom = undefined;
            const resultTop = undefined;
            // two-col の下端を #result の直前に一致させる。誤差はceilで吸収
            const stopY = undefined;
            const minH = undefined;
            const prevNum = undefined;
        };
        // 初期・安定後
        requestAnimationFrame(compute);
        const t = setTimeout(compute, 120);
        // リサイズはデバウンス
        let rto = null;
        const onResize = ()=>{
            if (rto) clearTimeout(rto);
            rto = setTimeout(compute, 120);
        };
        window.addEventListener('resize', onResize);
        window.addEventListener('orientationchange', onResize);
        window.addEventListener('load', compute);
        // 右パネルサイズ変化を監視（デバウンス付き）
        let ro = null;
        let roResult = null;
        if (typeof ResizeObserver !== 'undefined' && rightRef.current) {
            let rt = null;
            ro = new ResizeObserver(()=>{
                if (rt) clearTimeout(rt);
                rt = setTimeout(compute, 100);
            });
            ro.observe(rightRef.current);
        }
        if (typeof ResizeObserver !== 'undefined' && resultRef.current) {
            let rt2 = null;
            roResult = new ResizeObserver(()=>{
                if (rt2) clearTimeout(rt2);
                rt2 = setTimeout(compute, 100);
            });
            roResult.observe(resultRef.current);
        }
        return ()=>{
            clearTimeout(t);
            if (rto) clearTimeout(rto);
            window.removeEventListener('resize', onResize);
            window.removeEventListener('orientationchange', onResize);
            window.removeEventListener('load', compute);
            if (ro) ro.disconnect();
            if (roResult) roResult.disconnect();
        };
    }, []);
    // コンテンツが変わったときにも軽く再同期
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        if (!leftWrapRef.current) return;
        const isDesktop = "undefined" !== 'undefined' && window.matchMedia && window.matchMedia('(min-width: 1024px)').matches;
        if ("TURBOPACK compile-time truthy", 1) return;
        //TURBOPACK unreachable
        ;
    }, [
        result,
        showAdv,
        progression.length
    ]);
    const previewLabel = (qualitySel === 'M' ? `${rootSel}` : `${rootSel}${qualitySel}`) + (modifiers.length ? ` ${modifiers.join(' ')}` : '') + (bassSel ? `/${bassSel}` : '');
    const previewPlay = async ()=>{
        if (!rootSel) return;
        const pc = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"].indexOf(rootSel);
        if (pc < 0) return;
        const base = 60 + pc; // C4基準
        const q = qualitySel.toLowerCase();
        const has = (m)=>modifiers.includes(m);
        let intervals = [
            0,
            4,
            7
        ];
        if (q.includes('m') && !q.includes('maj')) intervals = [
            0,
            3,
            7
        ];
        if (q.includes('dim')) intervals = [
            0,
            3,
            6
        ];
        if (q.includes('maj7') || q.includes('mmaj7')) intervals = [
            ...q.includes('m') ? [
                0,
                3,
                7
            ] : [
                0,
                4,
                7
            ],
            11
        ];
        else if (q.includes('7')) intervals = [
            0,
            4,
            7,
            10
        ];
        if (has('sus2')) intervals = [
            0,
            2,
            7
        ];
        if (has('sus4')) intervals = [
            0,
            5,
            7
        ];
        const midis = intervals.map((iv)=>base + iv % 12);
        try {
            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playChord(midis, 'lightStrum', 300);
        } catch  {}
    };
    // 現在の編集内容をSketchへ反映（3秒アイドルで自動保存）
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        try {
            const id = ensureSketchId();
            const name = progression.length ? progression.join(" ").slice(0, 48) : `Untitled ${new Date().toLocaleString()}`;
            const tonicGuess = selFromStore ? __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][selFromStore.tonic] : selectedKey ? selectedKey.tonic : 'C';
            const scaleGuess = selectedScale?.type || (selFromStore ? selFromStore.mode : 'Ionian');
            setSketch({
                id,
                name,
                createdAt: sketch?.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                schema: 'sketch_v1',
                appVersion: '3.0.0',
                key: {
                    tonic: tonicGuess,
                    scaleId: String(scaleGuess)
                },
                capo: {
                    fret: 0,
                    note: 'Shaped'
                },
                progression: {
                    items: progression.map((c, i)=>({
                            id: `${i + 1}-${c}`,
                            degree: '',
                            quality: ''
                        }))
                },
                fretboardView: {
                    mode: fbDisplay === 'names' ? 'Names' : 'Degrees',
                    guide: !!overlayChordNotes
                }
            });
        } catch  {}
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [
        slots,
        fbDisplay,
        overlayChordNotes,
        selFromStore,
        selectedKey,
        selectedScale
    ]);
    // モバイル判定（SSRと一致させるため初期false、マウント後に判定）
    const [isTouchDevice, setIsTouchDevice] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        try {
            const touch = 'ontouchstart' in window || (navigator?.maxTouchPoints ?? 0) > 0;
            setIsTouchDevice(!!touch);
        } catch  {
            setIsTouchDevice(false);
        }
    }, []);
    // 進行チップ（"C", "Am", "F"...）を簡易解析して発音
    const playChordSymbol = async (symbol)=>{
        try {
            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
            const midis = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$chordParser$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["chordToMidi"])(symbol);
            if (midis && midis.length > 0) {
                __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playChord(midis, 'lightStrum', 300);
            }
        } catch (error) {
            console.error('Failed to play chord:', symbol, error);
        }
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("main", {
        ref: exportRef,
        className: "ot-page ot-stack",
        "data-page": "find-key",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                id: "progression",
                className: "ot-card prog-compact",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center justify-between gap-4 sm:gap-3 mb-1 sm:mb-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex items-center gap-2",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H2"], {
                                        className: "mb-0 text-left",
                                        children: "Build progression"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 813,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                        title: "Build Progression",
                                        text: isJapanese ? "Choose Chordsからコードを選んでスロットに追加ボタンから追加してください。上部のプリセットからコード進行を選択して追加することもできます。" : "Select chords from Choose Chords and add them using the slot add button. You can also select chord progressions from the presets at the top to add them."
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 814,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 812,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex flex-wrap items-center gap-2 relative",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        type: "button",
                                        className: "btn-ghost btn-reset chip-pressable text-sm px-3 py-1 inline-flex items-center gap-1",
                                        title: "Reset progression",
                                        onClick: ()=>{
                                            setSlots(Array(12).fill(""));
                                            setCursorIndex(0);
                                            resetAnalysis();
                                            setKeys([]);
                                            setResult(null);
                                            setOverlayChordNotes(null);
                                            setSelectedCellId(null);
                                            setFbDisplay('degrees');
                                        },
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                className: "w-4 h-4",
                                                viewBox: "0 0 24 24",
                                                fill: "currentColor",
                                                "aria-hidden": "true",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                    d: "M12 5V2L7 7l5 5V9c2.76 0 5 2.24 5 5a5 5 0 1 1-5-5z"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 840,
                                                    columnNumber: 19
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 839,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                children: "Reset"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 842,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 824,
                                        columnNumber: 13
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        type: "button",
                                        className: "chip-pressable inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs border",
                                        title: "Show sketches",
                                        onClick: ()=>setShowSketchList((v)=>!v),
                                        "aria-expanded": showSketchList,
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                className: "w-4 h-4",
                                                viewBox: "0 0 24 24",
                                                fill: "currentColor",
                                                "aria-hidden": "true",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                    d: "M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h12v2H3v-2z"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 851,
                                                    columnNumber: 101
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 851,
                                                columnNumber: 17
                                            }, this),
                                            "Sketches"
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 844,
                                        columnNumber: 15
                                    }, this),
                                    showSketchList && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        ref: sketchesDropRef,
                                        className: "fixed right-4 top-20 z-[10000] w-[320px] max-h-[70vh] overflow-auto rounded-md border bg-white dark:bg-neutral-900 shadow-2xl p-2 space-y-2",
                                        children: sketches.length === 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70 p-2",
                                            children: "No sketches yet"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 857,
                                            columnNumber: 21
                                        }, this) : sketches.map((sk)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "flex items-center justify-between gap-2 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/10",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                        className: "text-left text-sm flex-1 truncate",
                                                        title: `${sk.name}`,
                                                        onClick: ()=>setSelectedSketchForAction(sk),
                                                        children: sk.name
                                                    }, void 0, false, {
                                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                                        lineNumber: 861,
                                                        columnNumber: 25
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                        className: "ot-btn-ghost text-xs",
                                                        title: "Delete",
                                                        onClick: (e)=>{
                                                            e.stopPropagation();
                                                            deleteSketch(sk.id);
                                                            loadSketches();
                                                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('project_delete', {
                                                                page: 'chord_progression',
                                                                id: sk.id
                                                            });
                                                        },
                                                        children: "🗑️"
                                                    }, void 0, false, {
                                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                                        lineNumber: 868,
                                                        columnNumber: 25
                                                    }, this)
                                                ]
                                            }, sk.id, true, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 860,
                                                columnNumber: 23
                                            }, this))
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 855,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "w-4",
                                        "aria-hidden": "true"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 882,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "inline-flex items-center gap-2",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                className: "chip-pressable text-sm px-3 py-1.5 inline-flex items-center gap-1.5 rounded-lg border",
                                                title: isPlaying ? "Stop playback" : "Play progression",
                                                onClick: togglePlayback,
                                                disabled: progression.length === 0,
                                                style: {
                                                    opacity: progression.length === 0 ? 0.5 : 1
                                                },
                                                children: isPlaying ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                            className: "w-4 h-4",
                                                            viewBox: "0 0 24 24",
                                                            fill: "currentColor",
                                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("rect", {
                                                                x: "5",
                                                                y: "5",
                                                                width: "14",
                                                                height: "14",
                                                                rx: "1"
                                                            }, void 0, false, {
                                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                lineNumber: 897,
                                                                columnNumber: 25
                                                            }, this)
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 896,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            children: "Stop"
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 899,
                                                            columnNumber: 23
                                                        }, this)
                                                    ]
                                                }, void 0, true) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                                            className: "w-4 h-4",
                                                            viewBox: "0 0 24 24",
                                                            fill: "currentColor",
                                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                                d: "M8 5v14l11-7z"
                                                            }, void 0, false, {
                                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                lineNumber: 904,
                                                                columnNumber: 25
                                                            }, this)
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 903,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            children: "Play"
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 906,
                                                            columnNumber: 23
                                                        }, this)
                                                    ]
                                                }, void 0, true)
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 886,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "inline-flex items-center gap-1.5",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                                        htmlFor: "bpm-input",
                                                        className: "text-xs opacity-70",
                                                        children: "BPM:"
                                                    }, void 0, false, {
                                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                                        lineNumber: 911,
                                                        columnNumber: 19
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                                        id: "bpm-input",
                                                        type: "number",
                                                        min: "40",
                                                        max: "240",
                                                        value: bpm,
                                                        onChange: (e)=>setBpm(Math.max(40, Math.min(240, parseInt(e.target.value) || 120))),
                                                        className: "w-16 px-2 py-1 text-sm rounded border bg-transparent",
                                                        disabled: isPlaying
                                                    }, void 0, false, {
                                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                                        lineNumber: 912,
                                                        columnNumber: 19
                                                    }, this)
                                                ]
                                            }, void 0, true, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 910,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 885,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("select", {
                                        className: "chip",
                                        "aria-label": "Instrument",
                                        defaultValue: ("TURBOPACK compile-time falsy", 0) ? "TURBOPACK unreachable" : 'acoustic_guitar_steel',
                                        onChange: async (e)=>{
                                            const v = e.currentTarget.value;
                                            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].setInstrument(v);
                                        },
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("option", {
                                                value: "acoustic_guitar_steel",
                                                children: "Acoustic Steel"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 931,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("option", {
                                                value: "acoustic_guitar_nylon",
                                                children: "Acoustic Nylon"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 932,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("option", {
                                                value: "electric_guitar_clean",
                                                children: "Electric Clean"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 933,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("option", {
                                                value: "distortion_guitar",
                                                children: "Distortion"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 934,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("option", {
                                                value: "overdriven_guitar",
                                                children: "Over Drive"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 935,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("option", {
                                                value: "electric_guitar_muted",
                                                children: "Muted"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 936,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("option", {
                                                value: "acoustic_grand_piano",
                                                children: "Piano"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 937,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 925,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 822,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 811,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "prog-slots mt-2 flex flex-wrap gap-1",
                        "aria-label": "Progression slots",
                        children: Array.from({
                            length: 12
                        }).map((_, i)=>{
                            const filled = Boolean(slots[i]);
                            const tone = 16; // emerald hue base
                            const alpha = i < 8 ? 0 : (i - 7) * 0.08; // 0,0.08,0.16,0.24 for 8..11
                            const bg = `rgba(16,185,129,${alpha.toFixed(2)})`;
                            const active = cursorIndex === i;
                            const isCurrentlyPlaying = currentChordIndex === i && isPlaying;
                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                "data-slot-index": i,
                                className: [
                                    "inline-flex items-center justify-center rounded border text-xs select-none relative chip-pressable",
                                    filled ? "bg-black/5 dark:bg-white/10" : "bg-transparent",
                                    active ? "ring-2 ring-emerald-400/60" : "",
                                    isCurrentlyPlaying ? "ring-4 ring-blue-500/80 shadow-lg" : "",
                                    dragIndex === i ? "opacity-50 scale-105" : "",
                                    touchDragTarget === i ? "ring-2 ring-blue-400" : ""
                                ].join(" "),
                                style: {
                                    padding: '6px 10px',
                                    minWidth: 72,
                                    minHeight: 36,
                                    background: filled ? undefined : bg,
                                    borderColor: 'var(--line)',
                                    transition: 'opacity 0.15s, transform 0.15s, box-shadow 0.15s',
                                    touchAction: filled ? 'none' : 'auto'
                                },
                                onClick: ()=>{
                                    if (filled) {
                                        playChordSymbol(slots[i]);
                                    } else {
                                        setCursorIndex(i);
                                    }
                                },
                                draggable: filled,
                                onDragStart: ()=>setDragIndex(i),
                                onDragOver: (e)=>e.preventDefault(),
                                onDrop: ()=>{
                                    if (dragIndex !== null) {
                                        moveSlot(dragIndex, i);
                                        setDragIndex(null);
                                    }
                                },
                                onTouchStart: (e)=>handleTouchStartDrag(e, i),
                                onTouchMove: (e)=>handleTouchMoveDrag(e, i),
                                onTouchEnd: handleTouchEndDrag,
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "absolute left-1 top-1 text-[10px] opacity-70 select-none pointer-events-none",
                                        children: String(i + 1)
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 983,
                                        columnNumber: 19
                                    }, this),
                                    filled ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                children: slots[i]
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 986,
                                                columnNumber: 23
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                "aria-label": "Remove chord",
                                                className: "absolute -top-1 -right-1 w-4 h-4 rounded-full bg-black/50 text-white text-[10px] leading-4 hover:bg-black/70",
                                                onClick: (e)=>{
                                                    e.stopPropagation();
                                                    removeSlot(i);
                                                },
                                                children: "×"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 987,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true) : null
                                ]
                            }, `slot-${i}`, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 953,
                                columnNumber: 17
                            }, this);
                        })
                    }, void 0, false, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 944,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 810,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                id: "choose",
                ref: rightRef,
                className: "ot-card right-panel",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center justify-between mb-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex items-center gap-2",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H2"], {
                                        className: "mb-0 text-left",
                                        children: "Choose chords"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1005,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                        title: "Choose Chords",
                                        text: isJapanese ? "ルートとコードタイプを選んでください。追加ボタンでコード進行のスロットに追加できます。\nProプランの場合、より複雑なコードタイプを選ぶことができます。" : "Select a root note and chord type. Use the Add button to add to chord progression slots.\nPro plan allows you to select more complex chord types."
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1006,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1004,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                type: "button",
                                className: "chip-pressable text-sm px-3 py-1 inline-flex items-center gap-1 rounded-lg border",
                                title: "Load preset progression",
                                onClick: ()=>setShowPresetPopup(true),
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        children: "📋"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1021,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        children: "Presets"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1022,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1015,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1003,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ChordBuilder$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                        plan: (()=>{
                            // Debug: Allow forced plan via query parameter
                            const forcedPlan = searchParams.get('plan');
                            if (forcedPlan === 'pro' || forcedPlan === 'free') {
                                return forcedPlan;
                            }
                            return isPro ? 'pro' : 'free';
                        })(),
                        onPreview: async (symbol)=>{
                            // 既存の簡易プレビューと同等：symbol → MIDI 変換して再生
                            try {
                                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
                                const midis = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$chordParser$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["chordToMidi"])(symbol); // 既存ユーティリティ
                                __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playChord(midis, 'lightStrum', 300);
                            } catch  {}
                        },
                        onBlock: (reason)=>{
                            // Pro限定（/bass など）に当たったときは課金モーダルを開く
                            setShowUpgrade(true);
                        },
                        onConfirm: (symbol)=>{
                            // 12スロットに追加（最初の空きに入れてカーソルを進める）
                            setSlots((prev)=>{
                                const arr = [
                                    ...prev
                                ];
                                let idx = arr.findIndex((s)=>!s);
                                if (idx === -1) idx = 0;
                                arr[idx] = symbol;
                                return arr;
                            });
                            setCursorIndex((prev)=>{
                                // 直感的に "次の空スロット" へ
                                const arr = [
                                    ...slots
                                ];
                                let i = arr.findIndex((s)=>!s);
                                return i === -1 ? 0 : i;
                            });
                            setAddedFlash(true); // 既存の "Added" 演出があるなら
                        }
                    }, void 0, false, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1026,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "mt-4",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                            className: `w-full px-6 py-2 text-base rounded-lg font-semibold text-white transition-transform active:scale-[.98] active:translate-y-px focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300 ${isAnalyzing ? 'bg-rose-400/70 cursor-wait' : 'bg-rose-400 hover:bg-rose-500'}`,
                            onClick: ()=>{
                                const items = parseProg(progression);
                                const hasAdv = items.some((i)=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$chords$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["ADVANCED_QUALITIES"].some((a)=>i.quality.includes(a)));
                                if (hasAdv && !isPro) {
                                    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
                                    ;
                                    return;
                                }
                                startAnalyze(()=>{
                                    // Run analysis without auto-scroll (analyze function has its own scroll)
                                    const res = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2d$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["analyzeChordProgression"])(progression);
                                    setResult(res);
                                    const ranked = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$locals$3e$__["rankKeys"])(progression);
                                    setKeys(ranked.slice(0, 4));
                                    if (ranked.length > 0) {
                                        const mode = ranked[0].mode === "Major" ? "major" : "minor";
                                        const keyName = ranked[0].label.split(" ")[0];
                                        const sel = {
                                            tonic: keyName,
                                            mode
                                        };
                                        setSelectedKey(sel);
                                        setRomanLine(progression.map((c)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toRoman"])(c, sel.tonic, sel.mode, {
                                                showQuality: true,
                                                uppercase: true
                                            })));
                                    } else {
                                        setScales([]);
                                        setSelectedKey(null);
                                        setRomanLine([]);
                                    }
                                    // store-based analysis for Top3 candidates
                                    runAnalyze(progression);
                                    // Auto-scroll to result section
                                    setTimeout(()=>{
                                        const resultElement = document.getElementById('result');
                                        if (resultElement) {
                                            resultElement.scrollIntoView({
                                                behavior: 'smooth',
                                                block: 'start'
                                            });
                                        }
                                    }, 100);
                                });
                            },
                            disabled: isAnalyzing,
                            "aria-busy": isAnalyzing,
                            children: isAnalyzing ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                className: "inline-flex items-center gap-2",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                        className: "h-4 w-4 animate-spin",
                                        viewBox: "0 0 24 24",
                                        "aria-hidden": "true",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("circle", {
                                                className: "opacity-25",
                                                cx: "12",
                                                cy: "12",
                                                r: "10",
                                                stroke: "currentColor",
                                                strokeWidth: "3"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1115,
                                                columnNumber: 27
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                className: "opacity-75",
                                                fill: "currentColor",
                                                d: "M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4z"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1116,
                                                columnNumber: 27
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1114,
                                        columnNumber: 25
                                    }, this),
                                    "Analyzing…"
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1113,
                                columnNumber: 23
                            }, this) : 'Analyze'
                        }, void 0, false, {
                            fileName: "[project]/src/app/chord-progression/page.tsx",
                            lineNumber: 1068,
                            columnNumber: 21
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1067,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 1002,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                id: "result",
                ref: resultRef,
                className: "ot-card",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex items-center justify-between",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H2"], {
                                className: "text-left mb-0",
                                children: "Result"
                            }, void 0, false, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1126,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex items-center gap-2",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    type: "button",
                                    className: "chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",
                                    onClick: ()=>setShowNamePrompt(true),
                                    title: "Save sketch",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("svg", {
                                            className: "w-4 h-4",
                                            viewBox: "0 0 24 24",
                                            fill: "currentColor",
                                            "aria-hidden": "true",
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("path", {
                                                d: "M17 3H5a2 2 0 0 0-2 2v14l4-4h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1134,
                                                columnNumber: 99
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1134,
                                            columnNumber: 15
                                        }, this),
                                        "Save"
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1128,
                                    columnNumber: 13
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1127,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1125,
                        columnNumber: 9
                    }, this),
                    showNamePrompt && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "fixed inset-0 z-[10000]",
                        role: "dialog",
                        "aria-modal": "true",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "absolute inset-0 bg-black/40",
                                onClick: ()=>{
                                    setShowNamePrompt(false);
                                    setNameInput("");
                                }
                            }, void 0, false, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1141,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[420px]",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "text-base font-semibold mb-2",
                                        children: "Save sketch"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1143,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                        type: "text",
                                        className: "chip px-2 py-2 text-sm w-full",
                                        placeholder: defaultSketchName,
                                        value: nameInput,
                                        onChange: (e)=>setNameInput(e.target.value),
                                        "aria-label": "Sketch name",
                                        autoFocus: true
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1144,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-3 flex items-center justify-end gap-2",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                className: "chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",
                                                onClick: ()=>{
                                                    setShowNamePrompt(false);
                                                    setNameInput("");
                                                },
                                                children: "Cancel"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1154,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                className: "chip-pressable inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm border",
                                                onClick: doSaveSketch,
                                                children: "OK"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1159,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1153,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1142,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1140,
                        columnNumber: 11
                    }, this),
                    selectedSketchForAction && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "fixed inset-0 z-[10001]",
                        role: "dialog",
                        "aria-modal": "true",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "absolute inset-0 bg-black/40",
                                onClick: ()=>setSelectedSketchForAction(null)
                            }, void 0, false, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1172,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-neutral-900 border rounded-lg shadow-xl p-4 w-[92vw] max-w-[320px]",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "text-base font-semibold mb-3",
                                        children: selectedSketchForAction.name
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1174,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "space-y-2",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                className: "w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",
                                                onClick: ()=>{
                                                    try {
                                                        const sk = selectedSketchForAction;
                                                        const arr = new Array(12).fill("");
                                                        (sk?.progression?.items || []).forEach((it, idx)=>{
                                                            if (idx < 12) arr[idx] = String(it?.id || "");
                                                        });
                                                        setSlots(arr);
                                                        setCursorIndex(arr.findIndex((s)=>!s) === -1 ? 11 : arr.findIndex((s)=>!s));
                                                        // 解析を実行して候補を生成
                                                        try {
                                                            runAnalyze(arr.filter(Boolean));
                                                        } catch  {}
                                                        // Apply key to analysis store if possible
                                                        const tonicPc = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"].indexOf(sk.key.tonic);
                                                        if (tonicPc >= 0) {
                                                            try {
                                                                selectKey?.({
                                                                    tonic: tonicPc,
                                                                    mode: String(sk.key.scaleId || '')?.toLowerCase().includes('aeolian') || String(sk.key.scaleId || '').toLowerCase().includes('minor') ? 'Minor' : 'Major'
                                                                });
                                                            } catch  {}
                                                        }
                                                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('open_project', {
                                                            page: 'chord_progression',
                                                            id: sk.id
                                                        });
                                                        setShowSketchList(false);
                                                        setSelectedSketchForAction(null);
                                                    } catch  {}
                                                },
                                                children: "Edit"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1176,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                className: "w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",
                                                onClick: async ()=>{
                                                    try {
                                                        const sk = selectedSketchForAction;
                                                        // Export機能を実装（後で追加）
                                                        await handleExportSketch(sk);
                                                        setSelectedSketchForAction(null);
                                                    } catch  {}
                                                },
                                                children: "Export"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1201,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                type: "button",
                                                className: "w-full chip-pressable inline-flex items-center justify-center gap-1 px-4 py-2 rounded-lg text-sm border",
                                                onClick: ()=>setSelectedSketchForAction(null),
                                                children: "Cancel"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1215,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1175,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1173,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1171,
                        columnNumber: 11
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        ref: exportCardRef,
                        "aria-hidden": true,
                        style: {
                            position: 'fixed',
                            left: 0,
                            top: 0,
                            zIndex: 9999,
                            opacity: 0.0001,
                            pointerEvents: 'none',
                            width: 800,
                            height: 600,
                            background: '#ffffff',
                            color: '#000000',
                            padding: 24,
                            borderRadius: 12,
                            border: '2px solid #cbd5e1',
                            boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                        },
                        children: (()=>{
                            const exportName = currentExportName || (nameInput?.trim() ? nameInput : defaultSketchName);
                            const keyLabel = (()=>{
                                const k = selFromStore;
                                if (!k) return '-';
                                return `${__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][k.tonic]} ${k.mode}`;
                            })();
                            const progText = progression.join(' ');
                            const scaleLabel = (()=>{
                                const s = selectedScale;
                                if (!s) return '-';
                                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["scaleTypeLabel"])(s.type);
                            })();
                            const fb = (()=>{
                                const capoN = 0;
                                const rootPc = selectedScale ? selectedScale.root : undefined;
                                const notesSounding = selectedScale && typeof rootPc === 'number' ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getScalePitchesById"])(rootPc, selectedScale.type).map((pc)=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][pc]) : [];
                                const displayMode = isHeptatonic ? fbDisplay : 'degrees';
                                const quality = (()=>{
                                    const q = selectedScale?.type;
                                    if (!q) return 'maj';
                                    return q.toLowerCase().includes('aeolian') || q.toLowerCase().startsWith('min') ? 'min' : 'maj';
                                })();
                                const rootForContext = typeof rootPc === 'number' ? rootPc : 0;
                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    style: {
                                        marginTop: 8,
                                        background: '#ffffff',
                                        border: '2px solid #cbd5e1',
                                        borderRadius: '8px',
                                        padding: '12px',
                                        width: '100%'
                                    },
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$Fretboard$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                        overlay: {
                                            viewMode: 'sounding',
                                            capo: capoN,
                                            notes: notesSounding,
                                            chordNotes: overlayChordNotes ?? undefined,
                                            showScaleGhost: Boolean(overlayChordNotes),
                                            display: displayMode,
                                            scaleRootPc: typeof rootPc === 'number' ? rootPc : 0,
                                            scaleType: selectedScale?.type ?? 'Ionian',
                                            context: {
                                                chordRootPc: typeof rootPc === 'number' ? rootPc : 0,
                                                quality
                                            }
                                        },
                                        onRequestForms: ()=>{}
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1276,
                                        columnNumber: 19
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1275,
                                    columnNumber: 17
                                }, this);
                            })();
                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                style: {
                                    background: '#ffffff',
                                    color: '#000000',
                                    fontFamily: 'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif',
                                    width: '100%',
                                    height: '100%',
                                    display: 'flex',
                                    flexDirection: 'column',
                                    gap: '12px',
                                    padding: '8px'
                                },
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        style: {
                                            fontWeight: 700,
                                            fontSize: 24,
                                            color: '#000000',
                                            lineHeight: 1.3
                                        },
                                        children: exportName
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1295,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        style: {
                                            fontSize: 18,
                                            color: '#000000',
                                            fontWeight: 600
                                        },
                                        children: [
                                            "Key: ",
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                style: {
                                                    color: '#1e40af'
                                                },
                                                children: keyLabel
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1296,
                                                columnNumber: 87
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1296,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        style: {
                                            fontSize: 16,
                                            color: '#000000',
                                            fontWeight: 500
                                        },
                                        children: [
                                            "Progression: ",
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                style: {
                                                    color: '#1e40af'
                                                },
                                                children: progText || '-'
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1297,
                                                columnNumber: 95
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1297,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        style: {
                                            fontSize: 16,
                                            color: '#000000',
                                            fontWeight: 500
                                        },
                                        children: [
                                            "Scale: ",
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                style: {
                                                    color: '#1e40af'
                                                },
                                                children: scaleLabel
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1298,
                                                columnNumber: 89
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1298,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        style: {
                                            flex: 1,
                                            background: '#ffffff',
                                            border: '2px solid #cbd5e1',
                                            borderRadius: '8px',
                                            padding: '12px',
                                            overflow: 'hidden'
                                        },
                                        children: fb
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1299,
                                        columnNumber: 17
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1284,
                                columnNumber: 15
                            }, this);
                        })()
                    }, void 0, false, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1228,
                        columnNumber: 9
                    }, this),
                    keyCandidates.length > 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-4",
                        children: [
                            keyCandidates.length > 0 && progression.length < 8 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "text-xs px-3 py-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200",
                                children: [
                                    "⚠️ 精度向上のため、8コード以上の入力を推奨します（現在: ",
                                    progression.length,
                                    "コード）"
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1310,
                                columnNumber: 17
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H3"], {
                                children: "Key"
                            }, void 0, false, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1315,
                                columnNumber: 15
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex items-center justify-between gap-2",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "chip-row mb-2",
                                    role: "tablist",
                                    "aria-label": "Key candidates",
                                    children: keyCandidates.map((k, idx)=>{
                                        const active = selFromStore && selFromStore.tonic === k.tonic && selFromStore.mode === k.mode;
                                        const label = `${__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][k.tonic]} ${k.mode}`;
                                        const reasons = k.reasons.join("\n");
                                        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            role: "tab",
                                            "aria-selected": active,
                                            className: [
                                                "chip",
                                                "chip--key",
                                                active ? "chip--active" : ""
                                            ].join(" "),
                                            title: `Why this key\n${reasons}`,
                                            onClick: ()=>selectKey({
                                                    tonic: k.tonic,
                                                    mode: k.mode
                                                }),
                                            "data-roving": "item",
                                            children: [
                                                label,
                                                " ",
                                                Math.round(k.confidence),
                                                "%"
                                            ]
                                        }, `${label}-${idx}`, true, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1323,
                                            columnNumber: 23
                                        }, this);
                                    })
                                }, void 0, false, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1317,
                                    columnNumber: 17
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1316,
                                columnNumber: 15
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "result-block",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H3"], {
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "flex items-center gap-2",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    children: "Scale"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1342,
                                                    columnNumber: 21
                                                }, this),
                                                (()=>{
                                                    const curId = selectedScale?.type ?? scaleCandidates?.[0]?.type ?? 'Ionian';
                                                    const cur = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scaleCatalog$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_CATALOG"].find((s)=>s.id === curId);
                                                    if (!cur) return null;
                                                    const notesInC = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getScalePitchesById"])(0, cur.id).map((pc)=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][pc]).join(' ');
                                                    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                                        title: cur.display.en,
                                                        className: "ml-1",
                                                        linkHref: "/resources/glossary",
                                                        linkLabel: "Glossary",
                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                            className: "text-sm",
                                                            children: [
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "mb-1",
                                                                    children: [
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("b", {
                                                                            children: "Degrees:"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                            lineNumber: 1351,
                                                                            columnNumber: 51
                                                                        }, this),
                                                                        " ",
                                                                        cur.degrees.join(' ')
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                    lineNumber: 1351,
                                                                    columnNumber: 29
                                                                }, this),
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "mb-1",
                                                                    children: [
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("b", {
                                                                            children: "Notes in C:"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                            lineNumber: 1352,
                                                                            columnNumber: 51
                                                                        }, this),
                                                                        " ",
                                                                        notesInC
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                    lineNumber: 1352,
                                                                    columnNumber: 29
                                                                }, this),
                                                                cur.info?.oneLiner && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                                    className: "mb-1",
                                                                    children: [
                                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("b", {
                                                                            children: "About:"
                                                                        }, void 0, false, {
                                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                            lineNumber: 1353,
                                                                            columnNumber: 75
                                                                        }, this),
                                                                        " ",
                                                                        cur.info.oneLiner
                                                                    ]
                                                                }, void 0, true, {
                                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                    lineNumber: 1353,
                                                                    columnNumber: 53
                                                                }, this)
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 1350,
                                                            columnNumber: 27
                                                        }, this)
                                                    }, void 0, false, {
                                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                                        lineNumber: 1349,
                                                        columnNumber: 25
                                                    }, this);
                                                })()
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1341,
                                            columnNumber: 19
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1340,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "chip-row mb-2",
                                        role: "tablist",
                                        "aria-label": "Scale candidates",
                                        children: scaleCandidates.map((s, idx)=>{
                                            const type = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["normalizeScaleId"])(s.type);
                                            const active = selectedScale?.type === type && selectedScale?.root === s.root;
                                            const label = `${__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][s.root]} ${(0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["scaleTypeLabel"])(type)}`;
                                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                role: "tab",
                                                "aria-selected": active,
                                                className: [
                                                    "chip",
                                                    "chip--key",
                                                    active ? "chip--active" : ""
                                                ].join(" "),
                                                onClick: ()=>{
                                                    selectScale(s);
                                                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('scale_pick', {
                                                        page: 'find-key',
                                                        scale: s.type,
                                                        key: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][s.root]
                                                    });
                                                },
                                                "data-roving": "item",
                                                children: [
                                                    label,
                                                    " ",
                                                    Math.round(s.score),
                                                    "%"
                                                ]
                                            }, `${label}-${idx}`, true, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1366,
                                                columnNumber: 23
                                            }, this);
                                        })
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1360,
                                        columnNumber: 17
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1339,
                                columnNumber: 15
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1307,
                        columnNumber: 13
                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "text-sm opacity-70",
                        children: "Click Analyze to see results."
                    }, void 0, false, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1382,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 1124,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                className: "ot-card mt-2",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H2"], {
                        children: "Tools"
                    }, void 0, false, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1388,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-4",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "result-block",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H3"], {
                                        right: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            ref: fbToggleRef,
                                            className: "flex items-center gap-2 bg-transparent shadow-none fretboard-toggle",
                                            "aria-label": "Fretboard notation",
                                            role: "tablist",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                    role: "tab",
                                                    "aria-selected": fbDisplay === 'degrees',
                                                    tabIndex: fbDisplay === 'degrees' ? 0 : -1,
                                                    className: [
                                                        "chip",
                                                        "chip--key",
                                                        fbDisplay === 'degrees' ? "chip--active" : ""
                                                    ].join(" "),
                                                    onClick: ()=>setFbDisplay('degrees'),
                                                    "data-roving": "item",
                                                    children: "Degrees"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1395,
                                                    columnNumber: 23
                                                }, void 0),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                    role: "tab",
                                                    "aria-selected": fbDisplay === 'names',
                                                    tabIndex: isHeptatonic && fbDisplay === 'names' ? 0 : -1,
                                                    "aria-disabled": !isHeptatonic,
                                                    className: [
                                                        "chip",
                                                        "chip--key",
                                                        fbDisplay === 'names' ? "chip--active" : "",
                                                        !isHeptatonic ? "chip--disabled" : ""
                                                    ].join(" "),
                                                    onClick: ()=>{
                                                        if (isHeptatonic) setFbDisplay('names');
                                                    },
                                                    "data-roving": "item",
                                                    children: "Names"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1403,
                                                    columnNumber: 23
                                                }, void 0)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1394,
                                            columnNumber: 21
                                        }, void 0),
                                        children: "Fretboard"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1392,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "fret-wrap",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "fret-inner",
                                            children: selectedScale ? (()=>{
                                                const capoN = 0;
                                                const rootPc = selectedScale.root;
                                                const notesSounding = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["getScalePitchesById"])(rootPc, selectedScale.type).map((pc)=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][pc]);
                                                const displayMode = isHeptatonic ? fbDisplay : 'degrees';
                                                const quality = (()=>{
                                                    const q = selectedScale?.type;
                                                    if (!q) return 'maj';
                                                    return q.toLowerCase().includes('aeolian') || q.toLowerCase().startsWith('min') ? 'min' : 'maj';
                                                })();
                                                const rootForContext = rootPc;
                                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$Fretboard$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                                    overlay: {
                                                        viewMode: 'sounding',
                                                        capo: capoN,
                                                        notes: notesSounding,
                                                        chordNotes: overlayChordNotes ?? undefined,
                                                        showScaleGhost: Boolean(overlayChordNotes),
                                                        display: displayMode,
                                                        scaleRootPc: rootPc,
                                                        scaleType: selectedScale.type,
                                                        context: {
                                                            chordRootPc: rootPc,
                                                            quality
                                                        }
                                                    },
                                                    onRequestForms: (at, ctx)=>{
                                                        setFormsPop({
                                                            at,
                                                            rootPc: ctx.rootPc ?? rootForContext,
                                                            quality: ctx.quality
                                                        });
                                                    },
                                                    formShape: formShape
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1430,
                                                    columnNumber: 25
                                                }, this);
                                            })() : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "text-center text-sm opacity-50 py-8",
                                                children: "Click Analyze to see fretboard"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1439,
                                                columnNumber: 23
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1417,
                                            columnNumber: 19
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1416,
                                        columnNumber: 17
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1391,
                                columnNumber: 15
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                                className: "result-block space-y-2",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H3"], {
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "flex items-center gap-2",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    children: "Diatonic"
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1451,
                                                    columnNumber: 21
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                                    className: "ml-1",
                                                    title: "Diatonic chords",
                                                    linkHref: "/resources/glossary",
                                                    linkLabel: "Glossary",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                            className: "text-sm",
                                                            children: "Chords built only from the key’s scale tones (I–ii–iii–IV–V–vi–vii°)."
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 1458,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("ul", {
                                                            className: "mt-2 list-disc pl-5 space-y-1 text-sm",
                                                            children: [
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                                    children: "Stable sound: everything stays inside the key."
                                                                }, void 0, false, {
                                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                    lineNumber: 1460,
                                                                    columnNumber: 25
                                                                }, this),
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                                    children: "Use: begin inside → add color with a borrowed chord (iv, bVII, bVI)."
                                                                }, void 0, false, {
                                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                    lineNumber: 1461,
                                                                    columnNumber: 25
                                                                }, this),
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                                    children: "Try: ii–V–I or IV–V–I for clear motion."
                                                                }, void 0, false, {
                                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                    lineNumber: 1462,
                                                                    columnNumber: 25
                                                                }, this)
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 1459,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h4", {
                                                            className: "mt-3 font-medium",
                                                            children: "Shaped vs. Sounding (Capo)"
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 1464,
                                                            columnNumber: 23
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("ul", {
                                                            className: "mt-1 list-disc pl-5 space-y-1 text-sm",
                                                            children: [
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                                    children: "Shaped: labels show the shapes you fret after capo."
                                                                }, void 0, false, {
                                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                    lineNumber: 1466,
                                                                    columnNumber: 25
                                                                }, this),
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("li", {
                                                                    children: "Sounding: labels show the actual pitch you hear."
                                                                }, void 0, false, {
                                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                                    lineNumber: 1467,
                                                                    columnNumber: 25
                                                                }, this)
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 1465,
                                                            columnNumber: 23
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1452,
                                                    columnNumber: 21
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1450,
                                            columnNumber: 19
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1449,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$DiatonicCapoTable$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                        selectedId: selectedCellId,
                                        onSelectId: (id)=>setSelectedCellId(id),
                                        onPick: async ({ id, pcs, isRightClick })=>{
                                            // 右クリックの場合はコード進行に追加
                                            if (isRightClick) {
                                                // ダイアトニックテーブルからコード名を取得
                                                const selectedKey = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useAnalysisStore"].getState().selectedKey;
                                                const selectedScale = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$store$2f$analysisStore$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useAnalysisStore"].getState().selectedScale;
                                                if (!selectedKey || !selectedScale) return;
                                                let st = selectedScale.type;
                                                let ivs = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][st] ?? [];
                                                if (ivs.length !== 7) {
                                                    const parent = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["parentModeOf"])(st);
                                                    if (parent) ivs = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$scales$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["SCALE_INTERVALS"][parent] ?? [];
                                                }
                                                if (ivs.length !== 7) return;
                                                const tris = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["diatonicTriads"])({
                                                    tonicPc: selectedKey.tonic,
                                                    scaleIntervals: ivs
                                                });
                                                const degreeIndex = parseInt(id.replace('open-', ''));
                                                const triad = tris[degreeIndex];
                                                if (!triad) return;
                                                const chordSym = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$diatonic$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["triadToChordSym"])({
                                                    rootPc: triad.rootPc,
                                                    quality: triad.quality
                                                });
                                                const newSlots = [
                                                    ...slots
                                                ];
                                                newSlots[cursorIndex] = chordSym;
                                                setSlots(newSlots);
                                                if (cursorIndex < 11) setCursorIndex(cursorIndex + 1);
                                                (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('diatonic_pick', {
                                                    page: 'find-key',
                                                    action: 'right_click_add'
                                                });
                                                return;
                                            }
                                            // 同じセルを再選択 → リセット（スケールトーンのみ表示に戻す）
                                            if (selectedCellId === id) {
                                                setOverlayChordNotes(null);
                                                setSelectedCellId(null);
                                                resetForms();
                                                return;
                                            }
                                            const mainNotes = pcs.map((pc)=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$music$2f$constants$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__PC_NAMES__as__PITCHES$3e$__["PITCHES"][pc]);
                                            setOverlayChordNotes(mainNotes);
                                            setSelectedCellId(id);
                                            resetForms();
                                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$telemetry$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["track"])('diatonic_pick', {
                                                page: 'find-key'
                                            });
                                            // 和音再生（ピッチクラス→C4基準の実音に変換して3音同時）
                                            try {
                                                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].resume();
                                                const midis = pcs.map((pc)=>60 + pc % 12);
                                                __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$audio$2f$player$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["player"].playChord(midis, 'lightStrum', 260);
                                            } catch  {}
                                        }
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1472,
                                        columnNumber: 17
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1448,
                                columnNumber: 15
                            }, this),
                            isHeptatonic && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$Heading$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["H3"], {
                                        children: "Roman"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1530,
                                        columnNumber: 19
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        ref: romanBoxRef,
                                        className: "rounded-md border px-3 py-2",
                                        "aria-live": "polite",
                                        "data-testid": "roman-row",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex-1 overflow-x-auto whitespace-nowrap text-lg md:text-xl tracking-wide",
                                            children: romanLine.length === 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                children: "-"
                                            }, void 0, false, {
                                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                                lineNumber: 1534,
                                                columnNumber: 25
                                            }, this) : romanLine.map((tok, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"].Fragment, {
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            "data-idx": i,
                                                            className: romanHL && i >= romanHL.start && i <= romanHL.end ? 'roman-mark' : undefined,
                                                            children: String(tok || '').toUpperCase()
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 1538,
                                                            columnNumber: 29
                                                        }, this),
                                                        i < romanLine.length - 1 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            "aria-hidden": true,
                                                            className: "mx-1",
                                                            children: "–"
                                                        }, void 0, false, {
                                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                                            lineNumber: 1544,
                                                            columnNumber: 57
                                                        }, this) : null
                                                    ]
                                                }, `rom-${i}`, true, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1537,
                                                    columnNumber: 27
                                                }, this))
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1532,
                                            columnNumber: 21
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1531,
                                        columnNumber: 19
                                    }, this)
                                ]
                            }, void 0, true),
                            patternHits.length > 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "mt-2 flex flex-wrap items-center gap-2",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "text-xs opacity-70",
                                        children: "Patterns"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1556,
                                        columnNumber: 19
                                    }, this),
                                    (()=>{
                                        const h = patternHits[0];
                                        const idToEn = {
                                            'doo-wop': 'dooWop',
                                            'axis': 'axis',
                                            'canon': 'canon',
                                            'ii-V-I': 'twoFiveOne',
                                            'turnaround': 'turnaround',
                                            'andalusian': 'andalusian',
                                            'authentic': 'authentic',
                                            'plagal': 'plagal',
                                            'deceptive': 'deceptive'
                                        };
                                        const en = idToEn[h.id] ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$theory$2f$roman$2f$patterns$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["patternInfoEN"])(idToEn[h.id]) : null;
                                        const label = en?.label || upperRomansInParens(h.name).replace(/\(I–vi–IV–V\)/, "(I–VI–IV–V)");
                                        const summary = en?.summary || h.summary || h.name;
                                        const isActive = !!(romanHL && romanHL.start === h.start && romanHL.end === h.end);
                                        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                    type: "button",
                                                    className: [
                                                        "text-sm leading-tight font-medium hover:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/50 rounded"
                                                    ].join(' '),
                                                    title: summary,
                                                    onClick: ()=>{
                                                        setRomanHL((prev)=>prev && prev.start === h.start && prev.end === h.end ? null : {
                                                                start: Math.max(0, h.start),
                                                                end: Math.max(h.start, Math.min(romanLine.length - 1, h.end))
                                                            });
                                                        requestAnimationFrame(()=>{
                                                            const box = romanBoxRef.current;
                                                            if (!box) return;
                                                            const mark = box.querySelector(`[data-idx="${h.start}"]`);
                                                            if (mark) box.scrollLeft = Math.max(0, mark.offsetLeft - 12);
                                                        });
                                                    },
                                                    children: label
                                                }, `${h.id}-0`, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1576,
                                                    columnNumber: 25
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                                    ariaLabel: `${label} – info`,
                                                    text: `${label}\n\n${summary}`
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1596,
                                                    columnNumber: 25
                                                }, this)
                                            ]
                                        }, void 0, true);
                                    })()
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1555,
                                columnNumber: 17
                            }, this),
                            (cadences.length > 0 || fallbackCadence) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "mt-2 flex flex-wrap items-center gap-2",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                        className: "text-xs opacity-70",
                                        children: "Cadence"
                                    }, void 0, false, {
                                        fileName: "[project]/src/app/chord-progression/page.tsx",
                                        lineNumber: 1606,
                                        columnNumber: 19
                                    }, this),
                                    (()=>{
                                        const c = cadences[0] ?? fallbackCadence;
                                        const t = c?.type ?? c; // 'perfect' | 'deceptive' | 'half'
                                        const tail = c?.tail ?? c?.tailRoman;
                                        const label = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$ui$2f$cadence$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["formatCadenceShort"])(t, tail);
                                        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "inline-flex items-center gap-1.5 text-sm leading-tight",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "font-medium",
                                                    children: label
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1614,
                                                    columnNumber: 25
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$InfoDot$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                                                    text: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$ui$2f$cadence$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cadenceTooltip"])(t)
                                                }, void 0, false, {
                                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                                    lineNumber: 1615,
                                                    columnNumber: 25
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1613,
                                            columnNumber: 23
                                        }, this);
                                    })()
                                ]
                            }, void 0, true, {
                                fileName: "[project]/src/app/chord-progression/page.tsx",
                                lineNumber: 1605,
                                columnNumber: 17
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/src/app/chord-progression/page.tsx",
                        lineNumber: 1389,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 1387,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("section", {
                className: "ot-card",
                "aria-label": "Ad",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$AdSlot$2e$client$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                    page: "chord_progression",
                    format: "horizontal"
                }, void 0, false, {
                    fileName: "[project]/src/app/chord-progression/page.tsx",
                    lineNumber: 1630,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 1629,
                columnNumber: 7
            }, this),
            showPresetPopup && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-50 flex items-center justify-center bg-black/40",
                style: {
                    backdropFilter: 'blur(4px)'
                },
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    ref: presetPopupRef,
                    className: "bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                            className: "text-lg font-semibold mb-4",
                            children: "Load Preset"
                        }, void 0, false, {
                            fileName: "[project]/src/app/chord-progression/page.tsx",
                            lineNumber: 1637,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mb-4",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                    className: "text-xs opacity-70 mb-1 block",
                                    children: "Key"
                                }, void 0, false, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1641,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex flex-wrap gap-1",
                                    children: [
                                        'C',
                                        'C#',
                                        'D',
                                        'D#',
                                        'E',
                                        'F',
                                        'F#',
                                        'G',
                                        'G#',
                                        'A',
                                        'A#',
                                        'B'
                                    ].map((k)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            className: `chip ${presetKey === k ? 'chip--active' : ''}`,
                                            onClick: ()=>setPresetKey(k),
                                            children: k
                                        }, k, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1644,
                                            columnNumber: 19
                                        }, this))
                                }, void 0, false, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1642,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/app/chord-progression/page.tsx",
                            lineNumber: 1640,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "space-y-2 max-h-[60vh] overflow-y-auto",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-V-vi-IV', [
                                            'Ⅰ',
                                            'Ⅴ',
                                            'Ⅵm',
                                            'Ⅳ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅴ–Ⅵm–Ⅳ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1661,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Pop progression"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1662,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1657,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('ii-V-I', [
                                            'Ⅱm',
                                            'Ⅴ',
                                            'Ⅰ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅱm–Ⅴ–Ⅰ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1668,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Jazz turnaround"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1669,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1664,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('12-bar-blues', [
                                            'Ⅰ',
                                            'Ⅰ',
                                            'Ⅰ',
                                            'Ⅰ',
                                            'Ⅳ',
                                            'Ⅳ',
                                            'Ⅰ',
                                            'Ⅰ',
                                            'Ⅴ',
                                            'Ⅳ',
                                            'Ⅰ',
                                            'Ⅴ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "12-bar Blues"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1675,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Classic blues form (all 12 slots)"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1676,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1671,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-II', [
                                            'Ⅰ',
                                            'Ⅱ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅱ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1682,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Simple two-chord progression"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1683,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1678,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-bVII-IV', [
                                            'Ⅰ',
                                            '♭Ⅶ',
                                            'Ⅳ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–♭Ⅶ–Ⅳ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1689,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Rock progression"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1690,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1685,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('vi-IV-I-V', [
                                            'Ⅵm',
                                            'Ⅳ',
                                            'Ⅰ',
                                            'Ⅴ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅵm–Ⅳ–Ⅰ–Ⅴ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1698,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Emotional / Ballad (I-V-vi-IVの逆回転)"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1699,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1694,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-vi-IV-V', [
                                            'Ⅰ',
                                            'Ⅵm',
                                            'Ⅳ',
                                            'Ⅴ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅵm–Ⅳ–Ⅴ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1705,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "50's progression / Doo-wop"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1706,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1701,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-IV-V', [
                                            'Ⅰ',
                                            'Ⅳ',
                                            'Ⅴ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅳ–Ⅴ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1712,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Three-chord song / Rock classic"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1713,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1708,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('vi-ii-V-I', [
                                            'Ⅵm',
                                            'Ⅱm',
                                            'Ⅴ',
                                            'Ⅰ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅵm–Ⅱm–Ⅴ–Ⅰ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1719,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Circle progression / Jazz standard"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1720,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1715,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-bVII-bVI-bVII', [
                                            'Ⅰ',
                                            '♭Ⅶ',
                                            '♭Ⅵ',
                                            '♭Ⅶ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–♭Ⅶ–♭Ⅵ–♭Ⅶ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1726,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Mixolydian vamp / Rock anthem"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1727,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1722,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-IVm-I-V', [
                                            'Ⅰ',
                                            'Ⅳm',
                                            'Ⅰ',
                                            'Ⅴ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅳm–Ⅰ–Ⅴ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1735,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Borrowed chord / Minor IV"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1736,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1731,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('vi-IV-I-III', [
                                            'Ⅵm',
                                            'Ⅳ',
                                            'Ⅰ',
                                            'Ⅲ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅵm–Ⅳ–Ⅰ–Ⅲ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1742,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Andalusian cadence / Spanish feel"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1743,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1738,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-bIII-bVII-IV', [
                                            'Ⅰ',
                                            '♭Ⅲ',
                                            '♭Ⅶ',
                                            'Ⅳ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–♭Ⅲ–♭Ⅶ–Ⅳ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1749,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Modal interchange / Epic progression"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1750,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1745,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-iii-IV-V', [
                                            'Ⅰ',
                                            'Ⅲm',
                                            'Ⅳ',
                                            'Ⅴ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅲm–Ⅳ–Ⅴ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1756,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Classic progression / Beatles style"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1757,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1752,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-V-vi-iii-IV-I-IV-V', [
                                            'Ⅰ',
                                            'Ⅴ',
                                            'Ⅵm',
                                            'Ⅲm',
                                            'Ⅳ',
                                            'Ⅰ',
                                            'Ⅳ',
                                            'Ⅴ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅴ–Ⅵm–Ⅲm–Ⅳ–Ⅰ–Ⅳ–Ⅴ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1763,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Pachelbel's Canon / Wedding classic"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1764,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1759,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-bVI-bVII-I', [
                                            'Ⅰ',
                                            '♭Ⅵ',
                                            '♭Ⅶ',
                                            'Ⅰ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–♭Ⅵ–♭Ⅶ–Ⅰ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1770,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Power ballad / 80s rock"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1771,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1766,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('vi-V-IV-III', [
                                            'Ⅵm',
                                            'Ⅴ',
                                            'Ⅳ',
                                            'Ⅲ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅵm–Ⅴ–Ⅳ–Ⅲ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1777,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Descending progression / Melancholic"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1778,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1773,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-IV-bVII-IV', [
                                            'Ⅰ',
                                            'Ⅳ',
                                            '♭Ⅶ',
                                            'Ⅳ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅳ–♭Ⅶ–Ⅳ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1784,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Folk/Country vamp"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1785,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1780,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-bVII-IV-I', [
                                            'Ⅰ',
                                            '♭Ⅶ',
                                            'Ⅳ',
                                            'Ⅰ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–♭Ⅶ–Ⅳ–Ⅰ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1791,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Stadium anthem / Closing progression"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1792,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1787,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    className: "w-full text-left px-4 py-2.5 rounded-lg border hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",
                                    onClick: ()=>applyPreset('I-iii-vi-IV', [
                                            'Ⅰ',
                                            'Ⅲm',
                                            'Ⅵm',
                                            'Ⅳ'
                                        ], presetKey),
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "font-medium",
                                            children: "Ⅰ–Ⅲm–Ⅵm–Ⅳ"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1798,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-xs opacity-70",
                                            children: "Smooth descent / R&B style"
                                        }, void 0, false, {
                                            fileName: "[project]/src/app/chord-progression/page.tsx",
                                            lineNumber: 1799,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/src/app/chord-progression/page.tsx",
                                    lineNumber: 1794,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/src/app/chord-progression/page.tsx",
                            lineNumber: 1656,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                            className: "mt-4 w-full px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600",
                            onClick: ()=>setShowPresetPopup(false),
                            children: "Cancel"
                        }, void 0, false, {
                            fileName: "[project]/src/app/chord-progression/page.tsx",
                            lineNumber: 1803,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/src/app/chord-progression/page.tsx",
                    lineNumber: 1636,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 1635,
                columnNumber: 9
            }, this),
            toastConfig && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$Toast$2e$client$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["default"], {
                message: toastConfig.message,
                type: toastConfig.type,
                ctaText: toastConfig.ctaText,
                ctaHref: toastConfig.ctaHref,
                ctaPlace: toastConfig.ctaPlace,
                onClose: ()=>setToastConfig(null)
            }, void 0, false, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 1815,
                columnNumber: 9
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/app/chord-progression/page.tsx",
        lineNumber: 808,
        columnNumber: 5
    }, this);
}
const AdvSection = ({ title, children })=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "text-xs text-black/60 dark:text-white/60 mb-1",
                children: title
            }, void 0, false, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 1830,
                columnNumber: 5
            }, ("TURBOPACK compile-time value", void 0)),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "adv-grid",
                children: children
            }, void 0, false, {
                fileName: "[project]/src/app/chord-progression/page.tsx",
                lineNumber: 1831,
                columnNumber: 5
            }, ("TURBOPACK compile-time value", void 0))
        ]
    }, void 0, true, {
        fileName: "[project]/src/app/chord-progression/page.tsx",
        lineNumber: 1829,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0));
const Chip = ({ label, onClick, disabled, active, small })=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
        className: [
            "chip",
            small ? "chip--sm" : "",
            active ? "chip--active" : "",
            disabled ? "chip--disabled" : ""
        ].join(" "),
        onClick: onClick,
        "aria-disabled": disabled,
        children: label
    }, void 0, false, {
        fileName: "[project]/src/app/chord-progression/page.tsx",
        lineNumber: 1838,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)); // moved to components/ui/InfoDot
}),
];

//# sourceMappingURL=src_a3bfbd48._.js.map