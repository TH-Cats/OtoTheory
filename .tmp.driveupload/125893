(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,12187,e=>{"use strict";e.s(["default",()=>o]);var t=e.i(43476),a=e.i(71645),r=e.i(9593),n=e.i(7442);function o(e){let{page:o,slot:i="XXXXXXXXXX",format:s="auto",style:l={}}=e,{isPro:c}=(0,n.usePro)(),[d,m]=(0,a.useState)(!1),[h,u]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{m(!0)},[]),(0,a.useEffect)(()=>{if(d&&!c)try{window.adsbygoogle&&!h&&((window.adsbygoogle=window.adsbygoogle||[]).push({}),u(!0),(0,r.track)("ad_shown",{page:o}))}catch(e){console.error("AdSense load error:",e)}},[d,c,o,h]),c)?null:(0,t.jsx)("div",{style:{minHeight:110,...l},"aria-label":"Advertisement",className:"ad-container",children:d?(0,t.jsx)("ins",{className:"adsbygoogle",style:{display:"block",...l},"data-ad-client":"ca-pub-9662479821167655","data-ad-slot":i,"data-ad-format":s,"data-full-width-responsive":"true"}):null})}},96751,e=>{"use strict";e.s(["default",()=>n]);var t=e.i(43476),a=e.i(71645),r=e.i(74080);function n(e){let{text:n,title:o,children:i,className:s="",linkHref:l,linkLabel:c="Learn more",ariaLabel:d="More info",icon:m="info"}=e,[h,u]=(0,a.useState)(!1),f=(0,a.useRef)(null),p=(0,a.useRef)(null),[x,g]=(0,a.useState)({left:0,top:0,maxW:320});return(0,a.useEffect)(()=>{let e=e=>{f.current&&!f.current.contains(e.target)&&u(!1)},t=e=>{"Escape"===e.key&&u(!1)};return document.addEventListener("click",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",t)}},[]),(0,a.useLayoutEffect)(()=>{if(!h)return;let e=()=>{if(!p.current)return;let e=p.current.getBoundingClientRect(),t=Math.min(Math.floor(.9*window.innerWidth),360);g({left:Math.min(window.innerWidth-8-t,Math.max(8,Math.round(e.right-t))),top:Math.min(window.innerHeight-8-120,Math.round(e.bottom+6)),maxW:t})};return e(),window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e,!0)}},[h]),(0,t.jsxs)("div",{ref:f,className:"relative inline-flex items-center ".concat(s),children:[(0,t.jsx)("button",{ref:p,type:"button",className:"info-dot","aria-label":d,onClick:()=>u(e=>!e),children:"graduation"===m?(0,t.jsx)("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"})}):"i"}),h&&(0,r.createPortal)((0,t.jsxs)("div",{role:"dialog",className:"info-card",style:{position:"fixed",zIndex:60,left:"".concat(x.left,"px"),top:"".concat(x.top,"px"),maxWidth:"".concat(x.maxW,"px")},children:[o&&(0,t.jsx)("div",{className:"font-medium mb-1",children:o}),i||(null!=n?n:"").split("\n").map((e,a)=>(0,t.jsx)("div",{children:e},a)),l&&(0,t.jsx)("div",{className:"mt-2 text-right",children:(0,t.jsx)("a",{href:l,className:"underline text-[12px] opacity-80",children:c})})]}),document.body)]})}},72038,e=>{"use strict";e.s(["default",()=>A],72038);var t=e.i(43476),a=e.i(71645),r=e.i(12187),n=e.i(8118),o=e.i(18566),i=e.i(9760),s=e.i(9593);let l=(0,a.createContext)(null),c=e=>{let{children:t}=e,[r,n]=(0,a.useState)("Degrees"),[o,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),m=(0,a.useRef)(!1),h=(0,a.useCallback)(e=>{d(t=>(m.current||t||!e||(s.track("overlay_shown",{page:"chord_progression",control:"chord"}),m.current=!0),e))},[]),u=(0,a.useCallback)(()=>{d(null),s.track("overlay_reset",{page:"chord_progression"})},[]);return a.default.createElement(l.Provider,{value:{viewMode:r,scale:o,chord:c,setViewMode:e=>{e!==r&&(n(e),s.track("fb_toggle",{page:"chord_progression",value:e}))},setScale:i,setChordFromUser:h,resetChord:u,setScaleLayer:e=>i(e),resetChordLayer:()=>u()}},t)};var d=e.i(49204),m=e.i(77613),h=e.i(96751),u=e.i(52739),f=e.i(15803),p=e.i(29428),x=e.i(88327),g=e.i(26393);async function b(e,t){try{let a=window.__SCALES_API__;if(!(null==a?void 0:a.getScalePitchesById))return;let r=a.getScalePitchesById(e,t),n=r.slice(0,Math.min(5,r.length)),o=n.slice(),i=n.slice().reverse().slice(1),l=[...o,...i];for(let e of(await g.player.resume(),l))g.player.playNote(60+e,100),await new Promise(e=>setTimeout(e,100));(0,s.track)("scale_arpeggio_play",{page:"find-chords",scaleId:t,rootPc:e})}catch(e){}}let y=function(e){let{chordQuality:r,rootPc:n,onPreviewScale:o,onResetPreview:i,openGlossary:l,activeScaleId:c}=e,{scales:d}=function(e){switch(e){case"maj":case"maj7":return{scales:["Ionian","Lydian"],why:["maj_ionian","maj_lydian"]};case"min":case"m7":return{scales:["Aeolian","Dorian","Phrygian"],why:["min_aeolian","min_dorian","min_phrygian"]};case"dom7":case"7":return{scales:["Mixolydian","Altered"],why:["dom_mixolydian","dom_altered"]};case"m7b5":return{scales:["Locrian","DiminishedWholeHalf"],why:["m7b5_locrian","dim_wh"]};case"dim":return{scales:["DiminishedWholeHalf","Locrian"],why:["dim_wh","m7b5_locrian"]}}}(r),h=(0,a.useRef)(null);return(0,m.useRovingTabs)(h,{orientation:"horizontal"}),(0,t.jsx)("div",{className:"ot-scale-table","data-testid":"scale-chips","aria-label":"Suggested scales",children:(0,t.jsxs)("details",{className:"rounded border p-2 bg-background/40",children:[(0,t.jsx)("summary",{className:"text-sm cursor-pointer select-none",children:"Suggested scales for this chord"}),(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{role:"tablist","aria-label":"Preview scale",className:"flex flex-wrap gap-2",ref:h,children:d.map((e,a)=>(0,t.jsxs)("div",{className:"inline-flex items-center gap-1",children:[(0,t.jsx)("button",{role:"tab",className:["chip",c===e?"chip--active":""].join(" "),onClick:()=>{o(e),(0,s.track)("overlay_shown",{control:"scale",scaleId:e}),b(n,e)},"aria-describedby":"why-".concat(e),"data-roving":"item",children:function(e,t,a){if("maj"===t||"maj7"===t){if(0===a)return"Ionian (Major Scale)";if(1===a)return"Lydian (#4 Color)"}if("min"===t||"m7"===t){if(0===a)return"Aeolian (Natural Minor)";if(1===a)return"Dorian (Bright Minor)";if(2===a)return"Phrygian (Dark Minor)"}if("dom7"===t||"7"===t){if(0===a)return"Mixolydian (Dominant)";if(1===a)return"Altered (Tension)"}if("m7b5"===t){if(0===a)return"Locrian (Half-Dim)";if(1===a)return"Whole–Half Dim"}if("dim"===t){if(0===a)return"Whole–Half Dim";if(1===a)return"Locrian"}return e}(e,r,a)}),(0,t.jsx)("button",{type:"button",className:"inline-flex items-center justify-center w-5 h-5 rounded-full text-xs opacity-60 hover:opacity-100 hover:bg-black/5 dark:hover:bg-white/10 transition-opacity",onClick:()=>l(e),"aria-label":"Learn more about ".concat(e),title:"Learn more in Glossary",children:"ⓘ"})]},e))}),(0,t.jsx)("button",{className:"btn-ghost text-xs ml-auto",onClick:i,children:"Reset"})]}),(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-x-4 gap-y-1 items-center text-xs opacity-80",children:d.map(e=>(0,t.jsx)("span",{id:"why-".concat(e),children:{maj_ionian:"Foundation for major chords – fits all diatonic tones",maj_lydian:"Bright color with raised 4th (#11) – jazz/modern sound",maj_mixolydian:"Dominant-like major – contains the b7 for blues flavor",min_aeolian:"Natural minor foundation – matches all minor scale tones",min_dorian:"Brighter minor with natural 6th – popular in jazz and funk",min_phrygian:"Dark minor with flat 2nd – Spanish/flamenco character",min_harmonic:"Dramatic minor with raised 7th – classical and exotic sound",min_melodic:"Jazz minor – ascending melodic scale with natural 6th and 7th",dom_mixolydian:"Perfect for dominant 7th – contains the b7 tension",dom_altered:"Maximum tension – all alterations (b9, #9, #11, b13)",dom_wholetone:"Symmetrical whole-tone pattern – dreamy, unresolved quality",m7b5_locrian:"Outlines half-diminished chord – starts on the 7th degree",dim_wh:"Symmetrical whole-half pattern – creates tension over diminished chords"}[({Ionian:"maj_ionian",Lydian:"maj_lydian",Aeolian:"min_aeolian",Dorian:"min_dorian",Phrygian:"min_phrygian",Mixolydian:"dom_mixolydian",Locrian:"m7b5_locrian",DiminishedWholeHalf:"dim_wh",Altered:"dom_altered",HarmonicMinor:"min_harmonic",MelodicMinor:"min_melodic",WholeTone:"dom_wholetone"})[e]]||""},"why-".concat(e)))})]})})};var v=e.i(74080);function j(e){let{at:r,quality:n,rootPc:o,onPick:i,onClose:l,page:c="analyze"}=e,d=(0,a.useRef)(null),h=(0,a.useRef)(l);h.current=l;let u=(0,a.useRef)(!1),f=(0,a.useRef)(!1),p=(0,a.useRef)(null);(0,m.useRovingTabs)(p,{orientation:"horizontal"}),(0,a.useEffect)(()=>{var e;u.current||(u.current=!0,(0,s.trackOverlayShown)({control:"forms",open:!0,page:c}));let t=null==(e=d.current)?void 0:e.querySelector("button");function a(e){"Escape"===e.key&&h.current()}function r(e){d.current&&(d.current.contains(e.target)||h.current())}return null==t||t.focus({preventScroll:!0}),document.addEventListener("keydown",a),document.addEventListener("mousedown",r),()=>{document.removeEventListener("keydown",a),document.removeEventListener("mousedown",r)}},[c]);let x={position:"fixed",left:r.x,top:r.y,zIndex:0x7fffffff,pointerEvents:"auto"},b=e=>{f.current||(f.current=!0,(0,s.trackOverlayShown)({control:"forms",value:e,page:c}),i(e),l())},y=async e=>{try{await g.player.resume();let t=("maj"===n?[0,4,7]:[0,3,7]).map(e=>60+o+e);g.player.playChord(t,"lightStrum",300),(0,s.track)("play_chord",{page:c,source:"form_preview",kind:e})}catch(e){}},j=(0,t.jsxs)("div",{role:"dialog","aria-modal":"true","aria-label":"Chord forms",ref:d,style:x,className:"ot-pop",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("p",{className:"ot-h3",style:{margin:0},children:"Chord Forms"}),(0,t.jsx)("button",{type:"button",onClick:l,className:"text-xs opacity-60 hover:opacity-100 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/10","aria-label":"Close",children:"✕"})]}),(0,t.jsxs)("p",{className:"text-xs opacity-70 mb-3",children:["Select a fingering pattern for ","maj"===n?"major":"minor"," chord"]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",ref:p,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{type:"button","data-roving":"item",onClick:()=>b("open"),className:"flex-1 px-3 py-2 rounded border text-left hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",children:[(0,t.jsx)("div",{className:"font-medium",children:"Open Position"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Uses open strings"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>y("open"),className:"w-8 h-8 flex items-center justify-center rounded border hover:bg-black/5 dark:hover:bg-white/10 transition-colors","aria-label":"Preview open position",title:"Preview sound",children:"▶"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{type:"button","data-roving":"item",onClick:()=>b("barreE"),className:"flex-1 px-3 py-2 rounded border text-left hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",children:[(0,t.jsx)("div",{className:"font-medium",children:"Barre (E-shape)"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"6th string root"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>y("barreE"),className:"w-8 h-8 flex items-center justify-center rounded border hover:bg-black/5 dark:hover:bg-white/10 transition-colors","aria-label":"Preview E-shape barre",title:"Preview sound",children:"▶"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{type:"button","data-roving":"item",onClick:()=>b("barreA"),className:"flex-1 px-3 py-2 rounded border text-left hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",children:[(0,t.jsx)("div",{className:"font-medium",children:"Barre (A-shape)"}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"5th string root"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>y("barreA"),className:"w-8 h-8 flex items-center justify-center rounded border hover:bg-black/5 dark:hover:bg-white/10 transition-colors","aria-label":"Preview A-shape barre",title:"Preview sound",children:"▶"})]})]}),(0,t.jsx)("p",{className:"ot-hint mt-3",children:"Right-click or long-press a chord to open."})]});return"undefined"!=typeof document?(0,v.createPortal)(j,document.body):j}function w(e){return(e%12+12)%12}function N(e,t){let a=w(t);for(let t=1;t<=12;t++)if(w(e+t)===a)return t;return 1}let k={1:e=>{let{rootPc:t}=e;return[{chord:"".concat((0,x.pcToName)(t),"maj7"),reason:"Richer tonic sound with major 7th",examples:["The Girl from Ipanema","Fly Me to the Moon"]},{chord:"".concat((0,x.pcToName)(t),"6"),reason:"Jazz tonic with added 6th",examples:["All the Things You Are","Autumn Leaves"]},{chord:"".concat((0,x.pcToName)((0,x.mod12)(t+9)),"m"),reason:"Relative minor shares the same notes",examples:["Let It Be","No Woman No Cry"]}]},2:e=>{let{rootPc:t,key:a}=e;return[{chord:"".concat((0,x.pcToName)(t),"m7"),reason:"Jazz ii with minor 7th",examples:["Autumn Leaves","Fly Me to the Moon"]},{chord:(0,x.pcToName)((0,x.mod12)(a.tonic+5)),reason:"IV chord shares subdominant function",examples:["Let It Be","Hey Jude"]}]},4:e=>{let{rootPc:t,key:a}=e;return[{chord:"".concat((0,x.pcToName)(t),"maj7"),reason:"Lydian color with major 7th",examples:["The Girl from Ipanema","Dreams (Fleetwood Mac)"]},{chord:"".concat((0,x.pcToName)((0,x.mod12)(a.tonic+2)),"m"),reason:"ii chord shares subdominant function",examples:["Autumn Leaves","Fly Me to the Moon"]},{chord:"".concat((0,x.pcToName)(t),"m"),reason:"Borrowed minor IV for color",examples:["Yesterday","Creep"]}]},5:e=>{let{rootPc:t,key:a}=e;return[{chord:"".concat((0,x.pcToName)(t),"7"),reason:"Dominant 7th creates strong tension",examples:["Sweet Home Alabama","Twist and Shout"]},{chord:"".concat((0,x.pcToName)(t),"sus4"),reason:"Suspended 4th delays resolution",examples:["Pinball Wizard","The Edge of Glory"]},{chord:"".concat((0,x.pcToName)((0,x.mod12)(a.tonic+11)),"dim"),reason:"vii° shares dominant function",examples:["Girl from Ipanema","Michelle"]}]},6:e=>{let{rootPc:t,key:a}=e;return[{chord:"".concat((0,x.pcToName)(t),"m7"),reason:"Jazz minor with added 7th",examples:["Stairway to Heaven","Hotel California"]},{chord:(0,x.pcToName)(a.tonic),reason:"Relative major shares the same notes",examples:["Let It Be","Hey Jude"]}]}},S={1:e=>{let{rootPc:t}=e;return[{chord:"".concat((0,x.pcToName)(t),"m7"),reason:"Natural minor 7th",examples:["Stairway to Heaven","Smooth"]},{chord:"".concat((0,x.pcToName)(t),"m6"),reason:"Minor 6th for Dorian color",examples:["Scarborough Fair","So What"]},{chord:(0,x.pcToName)((0,x.mod12)(t+3)),reason:"Relative major (bIII) shares notes",examples:["Stairway to Heaven","All Along the Watchtower"]}]},4:e=>{let{rootPc:t}=e;return[{chord:"".concat((0,x.pcToName)(t),"m7"),reason:"Minor 7th for subdominant color",examples:["Light My Fire","Losing My Religion"]}]},5:e=>{let{rootPc:t,quality:a}=e;return"min"===a?[{chord:"".concat((0,x.pcToName)(t),"7"),reason:"Raised 3rd (V7) for stronger resolution",examples:["Stairway to Heaven","House of the Rising Sun"]}]:[{chord:"".concat((0,x.pcToName)(t),"7"),reason:"Dominant 7th for tension",examples:["Smooth","Black Magic Woman"]}]}};var _=e.i(9976);function C(e){let{substitute:a,onPlay:r,onAdd:n}=e;return(0,t.jsxs)("div",{className:"rounded border p-2 bg-white dark:bg-neutral-900/50 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-1",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium text-base",children:a.chord}),(0,t.jsx)("div",{className:"text-sm opacity-80 mt-0.5",children:a.reason})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>r(a),className:"w-8 h-8 flex items-center justify-center rounded border hover:bg-black/5 dark:hover:bg-white/10 transition-colors","aria-label":"Preview ".concat(a.chord),title:"Preview sound","data-roving":"item",children:"▶"}),n&&(0,t.jsx)("button",{type:"button",onClick:()=>n(a),className:"px-2 py-1 text-xs rounded border bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300 hover:bg-emerald-100 dark:hover:bg-emerald-900/50 transition-colors","aria-label":"Add ".concat(a.chord," to progression"),title:"Add to progression",children:"+ Add"})]})]}),a.examples&&a.examples.length>0&&(0,t.jsxs)("div",{className:"text-xs opacity-60 mt-1 flex items-center gap-1",children:[(0,t.jsx)("span",{className:"opacity-70",children:"Examples:"}),(0,t.jsx)("span",{children:a.examples.join(" · ")})]})]})}let M=function(e){let{rootPc:r,quality:n,degree:o,keyContext:i,onAdd:l,page:c="find-chords"}=e,d=(0,a.useRef)(null);(0,m.useRovingTabs)(d,{orientation:"horizontal"});let h=(0,a.useMemo)(()=>({rootPc:r,quality:n,degree:o,key:i}),[r,n,o,i]),u=(0,a.useMemo)(()=>(function(e){let{degree:t,key:a}=e,r=("Major"===a.mode?k:S)[t];return(r?r(e):function(e){let{rootPc:t,quality:a}=e,r=[];return"maj"===a?r.push({chord:"".concat((0,x.pcToName)(t),"maj7"),reason:"Added major 7th for richer sound"}):"min"===a&&r.push({chord:"".concat((0,x.pcToName)(t),"m7"),reason:"Added minor 7th for jazz flavor"}),r}(e)).slice(0,3)})(h),[h]);(0,a.useEffect)(()=>{u.length>0&&(0,s.track)("substitute_shown",{page:c,rootPc:r,quality:n,degree:o,count:u.length})},[u,c,r,n,o]);let f=(0,a.useCallback)(async e=>{try{await g.player.resume();let t=(0,_.chordToMidi)(e.chord);if(!t||0===t.length)return void console.warn("Failed to parse chord: ".concat(e.chord));g.player.playChord(t,"lightStrum",300),(0,s.track)("play_chord",{page:c,source:"substitute_preview",chord:e.chord})}catch(e){console.error("Failed to play substitute chord:",e)}},[c]),p=(0,a.useCallback)(e=>{l&&(l(e.chord),(0,s.track)("substitute_add",{page:c,rootPc:r,originalQuality:n,substituteChord:e.chord}))},[l,c,r,n]);return 0===u.length?null:(0,t.jsxs)("details",{className:"rounded border p-2 bg-background/40 mt-2",children:[(0,t.jsxs)("summary",{className:"text-sm cursor-pointer select-none font-medium",children:["Substitute Chords (",u.length,")"]}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("p",{className:"text-xs opacity-70 mb-3 px-1",children:"Alternative chords with similar harmonic function"}),(0,t.jsx)("div",{className:"space-y-2",ref:d,children:u.map((e,a)=>(0,t.jsx)(C,{substitute:e,onPlay:f,onAdd:l?p:void 0},"".concat(e.chord,"-").concat(a)))})]})]})};function A(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"ot-page",children:"Loading..."}),children:(0,t.jsx)(L,{})})}function L(){let e=(0,o.useSearchParams)(),l=(0,a.useMemo)(()=>x.PC_NAMES,[]),g=p.SCALE_CATALOG,[b,v]=(0,a.useState)(e.get("key")||"C"),w="minor"===e.get("mode")?"Aeolian":"Ionian",[k,S]=(0,a.useState)(w),_=(0,a.useMemo)(()=>{var e;let t=g.find(e=>e.id===k);return(null!=(e=null==t?void 0:t.degrees.length)?e:7)===7},[k]);(0,a.useMemo)(()=>{let e=g.find(e=>e.id===k);if(7!==e.degrees.length)return[];let t="Aeolian"===e.id?"minor":"major";return(0,n.getDiatonicChordsFor)({tonic:b,quality:t,scale:e.id}).chords},[b,k]),(0,a.useMemo)(()=>"Aeolian"===k?"minor":"major",[k]);let C=(0,a.useRef)(null);(0,m.useRovingTabs)(C,{orientation:"horizontal"});let A=(0,a.useRef)(null);(0,m.useRovingTabs)(A,{orientation:"horizontal"});let[L,E]=(0,a.useState)("degrees"),[T,R]=(0,a.useState)(0),[I,z]=(0,a.useState)(null),[D,F]=(0,a.useState)(null),[H,B]=(0,a.useState)(null),[W,O]=(0,a.useState)(null),[q,G]=(0,a.useState)(null),[X,V]=(0,a.useState)(null),J=(0,a.useCallback)(()=>{G(null),V(null)},[]);(0,a.useEffect)(()=>{},[L,I]);let{selectKey:K}=(0,u.useAnalysisStore)();async function U(){let e=l.indexOf(b);K({tonic:e,mode:"major"==("Aeolian"===k?"minor":"major")?"Major":"Minor"}),z(null)}(0,a.useEffect)(()=>{U()},[]);let Q=(0,a.useMemo)(()=>l.indexOf(b),[b]),Y=(0,a.useMemo)(()=>k,[k]),Z=(0,a.useCallback)(()=>{E("degrees"),R(0),z(null),F(null),B(null),O(null),J(),(0,s.track)("overlay_reset",{page:"find-chords",scale:k,key:b})},[Q,Y,J]);return(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&Z()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Z]),x.PC_NAMES,(0,t.jsx)(c,{children:(0,t.jsxs)("main",{className:"ot-page ot-stack","data-page":"find-chords",children:[(0,t.jsx)("h1",{className:"sr-only",children:"Find Chords"}),(0,t.jsxs)("section",{className:"ot-card",children:[(0,t.jsx)("h2",{className:"ot-h2",children:"Select Key & Scale"}),(0,t.jsxs)("div",{className:"mt-3 grid sm:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"Key"}),(0,t.jsx)("div",{className:"flex flex-col gap-2",role:"tablist","aria-label":"Select key",ref:C,children:[["C","C#","D","Eb","E","F"],["F#","G","Ab","A","Bb","B"]].map((e,a)=>(0,t.jsx)("div",{ref:0===a?C:void 0,className:"flex flex-wrap gap-2",children:e.map(e=>(0,t.jsx)("button",{role:"tab","aria-selected":b===e,tabIndex:b===e?0:-1,className:["chip chip--key",b===e?"chip--active":""].join(" "),"data-roving":"item",onClick:()=>{v(e);let t="major"==("Aeolian"===k?"minor":"major")?"Major":"Minor";K({tonic:l.indexOf(e),mode:t}),(0,s.track)("key_pick",{page:"find-chords",key:e,mode:t}),U()},title:"Key ".concat(e),children:e},e))},"krow-".concat(a)))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"scale",className:"block text-sm mb-1",children:[(0,t.jsx)("span",{children:"Scale"}),(()=>{var e,a,r,n;let o=g.find(e=>e.id===k),i=(0,f.getScalePitchesById)(0,o.id).map(e=>x.PC_NAMES[e]).join(" "),s="".concat(o.group," scale — ").concat(o.degrees.length,"-note pattern.");return(0,t.jsx)(h.default,{title:o.display.en,className:"ml-2",linkHref:"/resources/glossary",linkLabel:"Glossary",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"Degrees:"})," ",o.degrees.join(" ")]}),(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"Notes in C:"})," ",i]}),(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("b",{children:"About:"})," ",null!=(n=null==(e=o.info)?void 0:e.oneLiner)?n:s]}),!!(null==(r=o.info)||null==(a=r.examples)?void 0:a.length)&&(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("b",{className:"text-xs",children:"Song examples"}),(0,t.jsx)("ul",{className:"text-xs mt-1 space-y-1",children:o.info.examples.map((e,a)=>(0,t.jsxs)("li",{children:[e.url?(0,t.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",children:e.title}):e.title,e.artist?" — ".concat(e.artist):"",e.cue?" (".concat(e.cue,")"):""]},a))})]})]})})})()]}),(0,t.jsx)("select",{id:"scale",name:"scale",className:"w-full rounded border px-3 py-2 text-sm bg-transparent",value:k,onChange:e=>{var t;S(t=e.target.value),l.indexOf(b),(0,s.track)("scale_pick",{page:"find-chords",scale:t,key:b}),U()},children:g.map(e=>(0,t.jsx)("option",{value:e.id,children:e.display.en},e.id))})]})]})]}),(0,t.jsxs)("section",{className:"ot-card",children:[(0,t.jsx)("h2",{className:"ot-h2",children:"Result"}),(0,t.jsxs)("div",{className:"ot-stack",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"ot-h3 flex items-center gap-2",children:[(0,t.jsx)("span",{children:"Diatonic"}),(0,t.jsxs)(h.default,{title:"Diatonic chords",linkHref:"/resources/glossary",linkLabel:"Glossary",children:[(0,t.jsx)("p",{className:"text-sm",children:"Chords built only from the key’s scale tones (I–ii–iii–IV–V–vi–vii°)."}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"Capo rows show the shapes you fret. The sounding chord tones on the fretboard are the same as the Open row."}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"See details in Reference → Capo & Shapes"})]})]}),!_&&(0,t.jsx)("p",{className:"text-xs text-foreground/70 mt-1",children:"This scale is not heptatonic; Roman numerals are hidden. Diatonic suggestions are limited to the Open row."}),(0,t.jsx)("div",{"data-testid":_?void 0:"diatonic-open-only",children:(0,t.jsx)(d.default,{selectedId:H,onSelectId:e=>{H!==e&&B(e)},onPick:e=>{let{pcs:t}=e;z(t.map(e=>x.PC_NAMES[e])),O(t),J(),(0,s.track)("diatonic_pick",{page:"find-chords",id:H,scale:k,key:b})}})})]}),H&&W&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(y,{chordQuality:P(W),rootPc:Q,onPreviewScale:e=>{F(e)},onResetPreview:()=>{F(null),Z()},openGlossary:e=>{try{window.open("/resources/glossary","_blank")}catch(e){}},activeScaleId:D})}),H&&W&&(0,t.jsx)(M,{rootPc:Q,quality:P(W),degree:parseInt(H.split("-")[1]||"0",10)+1,keyContext:{tonic:l.indexOf(b),mode:"Aeolian"===k?"Minor":"Major"},page:"find-chords"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"ot-h3 flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Fretboard"}),(0,t.jsxs)("span",{ref:A,className:"flex items-center gap-2",role:"tablist","aria-orientation":"horizontal","aria-label":"Fretboard notation",children:[(0,t.jsx)("button",{role:"tab","aria-selected":"degrees"===L,tabIndex:"degrees"===L?0:-1,className:["chip","degrees"===L?"chip--on":""].join(" "),"data-roving":"item",onClick:()=>{J(),E("degrees")},children:"Degrees"}),(0,t.jsx)("button",{role:"tab","aria-selected":"names"===L,tabIndex:"names"===L?0:-1,className:["chip","names"===L?"chip--on":""].join(" "),"data-roving":"item",onClick:()=>{J(),E("names")},children:"Names"}),H&&(0,t.jsx)("button",{role:"tab","aria-selected":!1,tabIndex:-1,className:"chip",onClick:Z,"aria-label":"Reset",children:"Reset"})]})]}),(0,t.jsx)(i.default,{overlay:{viewMode:"sounding",capo:T,display:L,scaleRootPc:Q,scaleType:null!=D?D:Y,showScaleGhost:!!H,chordNotes:null!=I?I:void 0,context:{chordRootPc:W&&W.length?W[0]:void 0,quality:(()=>{let e=null!=W?W:[];return"min"===P(e.length?e:[Q])?"min":"maj"})()}},onRequestForms:(e,t)=>{G({at:e,rootPc:t.rootPc,quality:t.quality})},formShape:X})]})]})]}),(0,t.jsx)("section",{className:"ot-card ad-placeholder","aria-label":"Ad",children:(0,t.jsx)(r.default,{page:"find_chords",format:"horizontal"})}),q&&(0,t.jsx)(j,{at:q.at,quality:q.quality,rootPc:q.rootPc,page:"find-chords",onPick:e=>{V(function(e,t,a){if("open"===e)return{kind:"open",quality:t,rootPc:a,rootString:6,dots:"maj"===t?[{string:6,fret:0,deg:"1"},{string:5,fret:2,deg:"5"},{string:4,fret:2,deg:"1"},{string:3,fret:1,deg:"3"},{string:2,fret:0,deg:"5"},{string:1,fret:0,deg:"1"}]:[{string:6,fret:0,deg:"1"},{string:5,fret:2,deg:"5"},{string:4,fret:2,deg:"1"},{string:3,fret:0,deg:"b3"},{string:2,fret:0,deg:"5"},{string:1,fret:0,deg:"1"}]};if("barreE"===e){let e=N(4,a);return{kind:"barreE",quality:t,rootPc:a,rootString:6,dots:[{string:6,fret:e,deg:"1"},{string:5,fret:e+2,deg:"5"},{string:4,fret:e+2,deg:"1"},{string:3,fret:"maj"===t?e+1:e,deg:"maj"===t?"3":"b3"},{string:2,fret:e,deg:"5"},{string:1,fret:e,deg:"1"}],barre:{stringFrom:6,fret:e}}}let r=N(9,a);return{kind:"barreA",quality:t,rootPc:a,rootString:5,dots:[{string:5,fret:r,deg:"1"},{string:4,fret:r+2,deg:"5"},{string:3,fret:"maj"===t?r+2:r,deg:"maj"===t?"3":"b3"},{string:2,fret:r+2,deg:"1"},{string:1,fret:r,deg:"5"}],barre:{stringFrom:5,fret:r}}}(e,q.quality,q.rootPc))},onClose:()=>G(null)})]})})}function P(e){let t=new Set(e.map(t=>(t-e[0]+12)%12));return t.has(0)&&t.has(4)&&t.has(7)?"maj":t.has(0)&&t.has(3)&&t.has(7)?"min":t.has(0)&&t.has(3)&&t.has(6)?"dim":t.has(0)&&t.has(4)&&t.has(7)&&t.has(10)?"dom7":t.has(0)&&t.has(3)&&t.has(6)&&t.has(10)?"m7b5":"maj"}}]);