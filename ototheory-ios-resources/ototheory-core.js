"use strict";var OtoCore=(()=>{var C=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var _=(o,n)=>{for(var e in n)C(o,e,{get:n[e],enumerable:!0})},I=(o,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of E(n))!y.call(o,s)&&s!==e&&C(o,s,{get:()=>n[s],enumerable:!(t=D(n,s))||t.enumerable});return o};var T=o=>I(C({},"__esModule",{value:!0}),o);var sn={};_(sn,{DEFAULT_CONTEXT:()=>q,DEFAULT_MIDI_OCTAVE:()=>L,PC_NAMES:()=>u,PITCH_CLASS_COUNT:()=>O,analyzeProgression:()=>S,getDiatonicChords:()=>H,interval:()=>F,mod12:()=>i,nameToPc:()=>v,normalizeChordSymbol:()=>R,parseChord:()=>B,pcToName:()=>N,scoreScales:()=>P,transpose:()=>G});var u=["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],O=12,L=60;function i(o){return(o%12+12)%12}function N(o){return u[i(o)]}function v(o){let n=u.indexOf(o);return n>=0?n:-1}function G(o,n){return i(o+n)}function F(o,n){return i(n-o)}function R(o){return o.replace(/maj7/i,"maj7").replace(/min7/i,"m7").replace(/min/i,"m").replace(/dim/i,"dim").replace(/aug/i,"aug").trim()}var q={plan:"free",notationStyle:"english"};function w(o){return{major:[0,2,4,5,7,9,11],ionian:[0,2,4,5,7,9,11],dorian:[0,2,3,5,7,9,10],phrygian:[0,1,3,5,7,8,10],lydian:[0,2,4,6,7,9,11],mixolydian:[0,2,4,5,7,9,10],minor:[0,2,3,5,7,8,10],aeolian:[0,2,3,5,7,8,10],locrian:[0,1,3,5,6,8,10]}[o.toLowerCase()]||null}function z(o,n){let e=i(o),t=i(n);return e===4&&t===7?"maj":e===3&&t===7?"min":e===3&&t===6?"dim":e===4&&t===8?"aug":"maj"}function U(o,n){return n==="maj"?o:n==="min"?o+"m":n==="dim"?o+"dim":n==="aug"?o+"aug":o}function V(o,n){let e=u.indexOf(o);if(e===-1)return console.warn(`Invalid key: ${o}`),[];let t=w(n);if(!t||t.length<7)return console.warn(`Invalid or non-heptatonic scale: ${n}`),[];let s=[];for(let c=0;c<7;c++){let r=i(e+t[c]),f=u[r],p=t[(c+2)%7]-t[c],a=t[(c+4)%7]-t[c],l=z(p,a),d=U(f,l);s.push({degree:c+1,root:f,quality:l,symbol:d})}return s}function b(o,n){return V(o,n).map(e=>e.symbol)}function B(o){let n=o.split("/"),e=n[0],t=n[1]||void 0,s=e.match(/^([A-G](?:#|b)?)(.*)$/);if(!s)return null;let c=s[1],r=s[2]||"major";return{root:c,quality:r,bass:t}}function H(o,n){return b(o,n)}var $={0:["","maj7","7"],2:["m","m7"],4:["m","m7"],5:["","maj7"],7:["","7"],9:["m","m7"],11:["dim","m7b5"]},J={0:["m","m7"],2:["dim","m7b5"],3:["","maj7"],5:["m","m7"],7:["m","7"],8:["","maj7"],10:["","7"]},Q=[0,2,4,5,7,9,11],Y=[0,2,3,5,7,8,10];function K(o){if(o=o.trim(),!o)return null;let n=o.match(/^([A-G](?:#|b)?)/);if(!n)return null;let e=n[1],t=e.replace(/Db/,"C#").replace(/Eb/,"D#").replace(/Gb/,"F#").replace(/Ab/,"G#").replace(/Bb/,"A#"),s=u.indexOf(t);if(s===-1)return null;let r=o.slice(e.length).split("/")[0];return(!r||r==="maj")&&(r=""),r==="min"&&(r="m"),{root:s,quality:r}}function X(o){let{root:n,quality:e}=o,t=[n];return e.includes("m")?t.push(i(n+3)):t.push(i(n+4)),e.includes("dim")?t.push(i(n+6)):e.includes("aug")||e.includes("+")?t.push(i(n+8)):t.push(i(n+7)),e.includes("maj7")||e.includes("M7")?t.push(i(n+11)):e.includes("7")&&t.push(i(n+10)),t}function W(o,n){let{root:e,mode:t}=n,s=t==="Major"?$:J,c=t==="Major"?Q:Y,p=o.length*3+3,a=0,l=[];if(o.forEach((m,h)=>{let A=i(m.root-e),g=s[A];if(g?g.includes(m.quality)?a+=3:a+=2:X(m).every(j=>c.includes(i(j-e)))&&(a+=1),h>0){let M=i(o[h-1].root-e),x=A;M===7&&x===0&&(a+=1,l.includes("Cadence: V\u2192I")||l.push("Cadence: V\u2192I")),M===2&&x===7&&(a+=1)}}),o.length>0){let m=i(o[0].root-e);t==="Major"&&(m===0||m===9)&&(a+=2),t==="Minor"&&(m===0||m===3)&&(a+=2)}let d=Math.round(a/Math.max(p,1)*100);return l.unshift(`diatonic fit ${d}%`),{score:d,reasons:l}}function S(o){let n=o.map(K).filter(t=>t!==null);if(n.length===0)return[];let e=[];for(let t=0;t<12;t++)for(let s of["Major","Minor"]){let{score:c,reasons:r}=W(n,{root:t,mode:s});e.push({tonic:u[t],mode:s,confidence:c,reasons:r})}return e.sort((t,s)=>s.confidence-t.confidence),e.slice(0,3)}var Z={Ionian:[0,2,4,5,7,9,11],Dorian:[0,2,3,5,7,9,10],Phrygian:[0,1,3,5,7,8,10],Lydian:[0,2,4,6,7,9,11],Mixolydian:[0,2,4,5,7,9,10],Aeolian:[0,2,3,5,7,8,10],Locrian:[0,1,3,5,6,8,10],HarmonicMinor:[0,2,3,5,7,8,11],MelodicMinor:[0,2,3,5,7,9,11],MajorPentatonic:[0,2,4,7,9],MinorPentatonic:[0,3,5,7,10]},k=["Ionian","Lydian","Mixolydian","MajorPentatonic"],nn=["Aeolian","Dorian","Phrygian","HarmonicMinor"];function on(o){if(o=o.trim(),!o)return null;let n=o.match(/^([A-G](?:#|b)?)/);if(!n)return null;let e=n[1],t=e.replace(/Db/,"C#").replace(/Eb/,"D#").replace(/Gb/,"F#").replace(/Ab/,"G#").replace(/Bb/,"A#"),s=u.indexOf(t);if(s===-1)return null;let r=o.slice(e.length).split("/")[0];return(!r||r==="maj")&&(r=""),r==="min"&&(r="m"),{root:s,quality:r}}function tn(o){let{root:n,quality:e}=o,t=[n];return e.includes("m")?t.push(i(n+3)):t.push(i(n+4)),e.includes("dim")?t.push(i(n+6)):e.includes("aug")||e.includes("+")?t.push(i(n+8)):t.push(i(n+7)),e.includes("maj7")||e.includes("M7")?t.push(i(n+11)):e.includes("7")&&t.push(i(n+10)),t}function en(o,n){let e=Z[n];return e?e.map(t=>i(o+t)):[]}function rn(o){return Array.from(new Set(o))}function P(o,n){let e=u.indexOf(n.root);if(e===-1)return[];let t=n.mode==="Major"?k:nn,s=rn(o.map(on).filter(r=>r!==null).flatMap(tn)),c=o.some(r=>/7\b/.test(r));return t.map(r=>{let f=en(e,r),a=s.filter(h=>f.includes(h)).length/Math.max(1,s.length),l=0;n.mode==="Major"&&r==="Ionian"&&(l+=.02),n.mode==="Minor"&&r==="Aeolian"&&(l+=.02),c&&(r==="HarmonicMinor"||r==="MelodicMinor")&&(l+=.03);let d=Math.min(1,a+l),m=Math.round(d*100);return{root:n.root,type:r,score:m}}).sort((r,f)=>f.score-r.score)}return T(sn);})();
