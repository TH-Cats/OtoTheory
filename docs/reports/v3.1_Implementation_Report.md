# OtoTheory v3 Implementation Report

> **æœ¬ãƒ¬ãƒãƒ¼ãƒˆã¯å®Ÿè£…ã®é€²æ—ã¨è©³ç´°ã‚’è¨˜éŒ²ã™ã‚‹æ­£æœ¬ã§ã™ã€‚**

---

## M0: Baselineï¼ˆçµ±åˆã®åœŸå°ï¼‰ âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-01  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3-m0-baseline`

### å®Ÿè£…æ¦‚è¦
Chord Progression ã‚’ä¸­å¿ƒã«æ®ãˆã€çµ±ä¸€ã•ã‚ŒãŸ Result ã‚«ãƒ¼ãƒ‰ã¨äºŒå±¤ Overlay ã‚’å®Ÿè£…ã€‚Free åˆ¶é™ã¨ Telemetry ã®åŸºç›¤ã‚’æ§‹ç¯‰ã€‚

### ä¸»ãªæˆæœ
- Chord Progression ãƒšãƒ¼ã‚¸ã®æ–°è¦å®Ÿè£…
- Result ã‚«ãƒ¼ãƒ‰: Key/Scale å€™è£œè¡¨ç¤º
- Fretboard äºŒå±¤ Overlayï¼ˆScale=è¼ªéƒ­ã€Chord=å¡—ã‚Šï¼‰
- Diatonic Tableï¼ˆOpenè¡Œã®ã¿ï¼‰
- Capo ææ¡ˆï¼ˆTop2ã€Shapedè¡¨è¨˜ï¼‰
- Telemetry åŸºç›¤ï¼ˆæœ€å°ã‚»ãƒƒãƒˆï¼‰

**M0å®Œäº†ã€‚æ¬¡ã¯M1ï¼ˆSketch Libraryï¼‰ã«é€²ã‚€ã€‚**

---

## M1: Sketch Libraryï¼ˆä¿å­˜ãƒ»å‘¼ã³å‡ºã—ï¼‰ âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3-m1-sketch-playback`

### å®Ÿè£…æ¦‚è¦
é€²è¡Œã®ä¿å­˜ãƒ»å‘¼ã³å‡ºã—æ©Ÿèƒ½ã‚’å®Ÿè£…ã€‚Free ã¯3ä»¶ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã€Pro ã¯ç„¡åˆ¶é™ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼ˆã‚¹ã‚±ãƒ«ãƒˆãƒ³ï¼‰ã€‚

### A. Sketch Storageï¼ˆä¿å­˜æ§‹é€ ï¼‰

#### Sketch Typeå®šç¾©
```typescript
// src/types/sketch.ts
export type Sketch = {
  id: string;
  name: string;
  createdAt: string;
  updatedAt: string;
  schema: 'sketch_v1';
  appVersion: string;
  data: {
    key?: { tonic: number; mode: string };
    scale?: { id: string; label: string };
    capo?: { fret: number; note: string };
    progression: { items: Array<{id: string; degree: string; quality: string}> };
    fretboardView?: { mode: 'Degrees'|'Names'; guide: boolean };
  };
};
```

#### Storageå®Ÿè£…
```typescript
// src/features/sketch/storage.ts
- loadAll(): Sketch[] â†’ localStorage ã¾ãŸã¯ cloud ã‹ã‚‰èª­ã¿è¾¼ã¿
- saveLocalFree(sketch): void â†’ LRUä¸Šæ›¸ãï¼ˆ3ä»¶åˆ¶é™ï¼‰
- saveCloudPro(sketch): Promise<void> â†’ ã‚¹ã‚±ãƒ«ãƒˆãƒ³å®Ÿè£…
```

### B. Sketchç®¡ç†UI

#### Sketches Dropdown
- "Build progression" ãƒ˜ãƒƒãƒ€å†…ã« "Sketches" ãƒœã‚¿ãƒ³
- ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³è¡¨ç¤º
- å„Sketchã« "Edit" / "Export" / "Delete" ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- å¤–å´ã‚¯ãƒªãƒƒã‚¯/ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹

#### Saveæ©Ÿèƒ½
- "Result" ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã« "Save" ãƒœã‚¿ãƒ³
- ã‚¯ãƒªãƒƒã‚¯ã§åå‰å…¥åŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå: "Sketch YYYY-MM-DD HH:mm"
- Free tier: 4ä»¶ç›®ã§LRUä¸Šæ›¸ãè­¦å‘Š

#### Auto-save
- ã‚³ãƒ¼ãƒ‰è¿½åŠ ãƒ»ä¸¦ã¹æ›¿ãˆãƒ»Keyåˆ‡æ›¿å¾Œ **3ç§’ã‚¢ã‚¤ãƒ‰ãƒ«** ã§è‡ªå‹•ä¿å­˜
- `useEffect` + `setTimeout` ã§å®Ÿè£…
- æ—¢å­˜Sketchã®å ´åˆã®ã¿ï¼ˆæ–°è¦ã¯æ‰‹å‹•ä¿å­˜ãŒå¿…è¦ï¼‰

### C. PNG Export

#### Export Flow
1. Sketchãƒªã‚¹ãƒˆã‹ã‚‰é¸æŠ
2. "Edit" ã¾ãŸã¯ "Export" ã‚’é¸æŠ
3. "Export" â†’ PNGç”»åƒã‚’å³åº§ã«ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

#### Export Content
å°‚ç”¨ã®éè¡¨ç¤ºè¦ç´ ï¼ˆ`exportCardRef`ï¼‰ã«ä»¥ä¸‹ã‚’æç”»ï¼š
- **Sketch Name**: ãƒ•ã‚©ãƒ³ãƒˆã‚¦ã‚§ã‚¤ãƒˆ700ã€24px
- **Key**: 18pxã€å€¤ã‚’é’è‰²å¼·èª¿
- **Progression**: ã‚³ãƒ¼ãƒ‰åã‚’16pxè¡¨ç¤º
- **Scale**: 18pxã€å€¤ã‚’é’è‰²å¼·èª¿
- **Fretboard**: å®Ÿéš›ã®DOMè¦ç´ ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã€ã‚¹ã‚±ãƒ¼ãƒ«ãƒˆãƒ¼ãƒ³ã‚’è¡¨ç¤º

#### è¦–èªæ€§å‘ä¸Š
- å…¨ãƒ†ã‚­ã‚¹ãƒˆ: é»’è‰²ï¼ˆ`#000000`ï¼‰ã«å¼·åˆ¶
- é‡è¦ãªå€¤: é’è‰²ï¼ˆ`#1e40af`ï¼‰ã§å¼·èª¿
- ãƒ•ãƒ¬ãƒƒãƒˆç•ªå·ãƒœãƒƒã‚¯ã‚¹: è–„ã„ã‚°ãƒ¬ãƒ¼ï¼ˆ`#f3f4f6`ï¼‰
- èƒŒæ™¯: ç™½è‰²ï¼ˆ`#ffffff`ï¼‰
- ãƒœãƒ¼ãƒ€ãƒ¼: 2pxã€è§’ä¸¸12pxã€ã‚·ãƒ£ãƒ‰ã‚¦ä»˜ã

#### æŠ€è¡“å®Ÿè£…
```typescript
// src/lib/export/png.ts
- html-to-image ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨
- opacity: 1, visibility: visible ã‚’ä¸€æ™‚çš„ã«è¨­å®š
- 100msé…å»¶ã§Reactãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†ã‚’å¾…æ©Ÿ
- æˆåŠŸ/å¤±æ•—ã«é–¢ã‚ã‚‰ãš export_png Telemetry ã‚’1å›ã ã‘é€ä¿¡
```

### D. Key/Scaleå¾©å…ƒ

#### å•é¡Œ
Sketchã‚’èª­ã¿è¾¼ã‚“ã§ã‚‚ã€Key/ScaleãŒ UI ã«åæ˜ ã•ã‚Œãªã„ã€‚

#### è§£æ±ºç­–
```typescript
// src/app/find-key/page.tsx
const handleSketchLoad = (sketch: Sketch) => {
  // 1. Slotsã«é€²è¡Œã‚’å¾©å…ƒ
  const newSlots = Array(12).fill("");
  sketch.data.progression.items.forEach((item, i) => {
    if (i < 12) newSlots[i] = item.id.split('-')[1]; // "1-C" â†’ "C"
  });
  setSlots(newSlots);
  
  // 2. Analyzeå®Ÿè¡Œã§Keyå€™è£œã‚’ç”Ÿæˆ
  const progression = newSlots.filter(Boolean);
  runAnalyze(progression);
  
  // 3. Sketchã«ä¿å­˜ã•ã‚ŒãŸKeyã‚’é¸æŠ
  if (sketch.data.key && sketch.data.scale) {
    const { tonic, mode } = sketch.data.key;
    selectKey({ tonic, mode: mode as any });
    // Scaleã‚‚å¾©å…ƒ...
  }
};
```

### E. Telemetry
- `save_project`: Sketchä¿å­˜æ™‚
- `open_project`: Sketchèª­ã¿è¾¼ã¿æ™‚
- `project_delete`: Sketchå‰Šé™¤æ™‚
- `export_png`: PNGå‡ºåŠ›æ™‚ï¼ˆæˆåŠŸ/å¤±æ•—ã«é–¢ã‚ã‚‰ãš1å›ï¼‰

### ãƒ†ã‚¹ãƒˆç¢ºèªé …ç›®
- [x] Sketchä¿å­˜ï¼ˆåå‰å…¥åŠ›ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåï¼‰
- [x] Free tier 3ä»¶åˆ¶é™ï¼ˆLRUä¸Šæ›¸ãï¼‰
- [x] Sketchèª­ã¿è¾¼ã¿ï¼ˆEdit/Exporté¸æŠï¼‰
- [x] Key/Scaleå¾©å…ƒã®æ­£ç¢ºæ€§
- [x] Auto-saveï¼ˆ3ç§’ã‚¢ã‚¤ãƒ‰ãƒ«ï¼‰
- [x] PNG Exportï¼ˆè¦–èªæ€§ã€ãƒ•ãƒ¬ãƒƒãƒˆãƒœãƒ¼ãƒ‰è¡¨ç¤ºï¼‰
- [x] å¤–å´ã‚¯ãƒªãƒƒã‚¯/ESCã‚­ãƒ¼ã§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é–‰ã˜ã‚‹
- [x] Telemetryã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/types/sketch.ts`: Sketchå‹å®šç¾©
- `src/features/sketch/storage.ts`: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…
- `src/store/sketchStore.ts`: Zustand store
- `src/lib/export/png.ts`: PNGå‡ºåŠ›
- `src/app/find-key/page.tsx`: UIçµ±åˆ
- `src/lib/telemetry.ts`: Telemetryã‚¤ãƒ™ãƒ³ãƒˆ

**M1å®Œäº†ã€‚æ¬¡ã¯M2ï¼ˆProgression Liteï¼‰ã«é€²ã‚€ã€‚**

---

## M2-1: Undoæ©Ÿèƒ½ âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
**æ±ºå®šæ—¥**: 2025-10-03

### ç†ç”±
- å„ã‚³ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆÃ—ï¼‰ãŒã‚ã‚Šã€å€‹åˆ¥å‰Šé™¤ãŒå®¹æ˜“
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ä¸¦ã¹æ›¿ãˆå¯èƒ½
- Undoæ©Ÿèƒ½ã®å„ªå…ˆåº¦ãŒä½ã„
- UIãŒç…©é›‘ã«ãªã‚‹æ‡¸å¿µ

**M2-1ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€‚M2-2ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆæ‹¡å……ï¼‰ã«é€²ã‚€ã€‚**

---

## M2-2: ãƒ—ãƒªã‚»ãƒƒãƒˆæ‹¡å…… âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`

### å®Ÿè£…æ¦‚è¦
20ç¨®é¡ã®å®Ÿç”¨çš„ãªãƒ—ãƒªã‚»ãƒƒãƒˆé€²è¡Œã‚’å®Ÿè£…ã€‚ã‚­ãƒ¼é¸æŠã¨Romanæ•°å­—ã‹ã‚‰å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰åã«å¤‰æ›ã—ã€é€²è¡Œã«è¿½åŠ ã€‚

### ãƒ—ãƒªã‚»ãƒƒãƒˆä¸€è¦§ï¼ˆ20ç¨®é¡ï¼‰

#### åŸºæœ¬çš„ãªé€²è¡Œï¼ˆ1ã€œ5ï¼‰
1. **â… â€“â…¤â€“â…¥mâ€“â…£** (Pop progression)
2. **â…¡mâ€“â…¤â€“â… ** (Jazz turnaround)
3. **â… â€“â…£â€“â…¤** (Three-chord song / Rock classic)
4. **â… â€“â…¥mâ€“â…£â€“â…¤** (50's progression / Doo-wop)
5. **â…¥mâ€“â…£â€“â… â€“â…¤** (Emotional / Ballad)

#### ç™ºå±•çš„ãªé€²è¡Œï¼ˆ6ã€œ10ï¼‰
6. **â…¥mâ€“â…¡mâ€“â…¤â€“â… ** (Circle progression / Jazz standard)
7. **â… â€“â™­â…¦â€“â…£** (Rock progression)
8. **â… â€“â…¡** (Simple two-chord)
9. **â… â€“â…£â€“â™­â…¦â€“â…£** (Folk/Country vamp)
10. **â… â€“â™­â…¦â€“â™­â…¥â€“â™­â…¦** (Mixolydian vamp / Rock anthem)

#### å¿œç”¨çš„ãªé€²è¡Œï¼ˆ11ã€œ20ï¼‰
11. **â… â€“â…£mâ€“â… â€“â…¤** (Borrowed chord / Minor IV)
12. **â…¥mâ€“â…£â€“â… â€“â…¢** (Andalusian cadence / Spanish feel)
13. **â… â€“â™­â…¢â€“â™­â…¦â€“â…£** (Modal interchange / Epic progression)
14. **â… â€“â…¢mâ€“â…£â€“â…¤** (Classic progression / Beatles style)
15. **â… â€“â…¤â€“â…¥mâ€“â…¢mâ€“â…£â€“â… â€“â…£â€“â…¤** (Pachelbel's Canon / Wedding classic)
16. **â… â€“â™­â…¥â€“â™­â…¦â€“â… ** (Power ballad / 80s rock)
17. **â…¥mâ€“â…¤â€“â…£â€“â…¢** (Descending progression / Melancholic)
18. **â… â€“â™­â…¦â€“â…£â€“â… ** (Stadium anthem / Closing progression)
19. **â… â€“â…¢mâ€“â…¥mâ€“â…£** (Smooth descent / R&B style)
20. **â… â€“â…£â€“â… â€“â…¤â€“â… â€“â™­â…¦â€“â…£â€“â…¤â€“â… â€“â…£â€“â… â€“â…¤** (12-bar Blues)

### UI/UXæ”¹å–„

#### ãƒ—ãƒªã‚»ãƒƒãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
1. **ãƒˆãƒªã‚¬ãƒ¼**: "Presets" ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **ã‚­ãƒ¼é¸æŠ**: 12ç¨®é¡ã®ã‚­ãƒ¼ï¼ˆC, C#, D...ï¼‰ã‹ã‚‰é¸æŠ
3. **ãƒ—ãƒªã‚»ãƒƒãƒˆä¸€è¦§**: 20ç¨®é¡ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤º
4. **é¸æŠ**: ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã§é€²è¡Œã«è¿½åŠ 
5. **ã‚¯ãƒ­ãƒ¼ã‚º**: å¤–å´ã‚¯ãƒªãƒƒã‚¯/ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹

#### è¿½åŠ æ–¹å¼ã®æ”¹å–„
- **ç©ºã‚¹ãƒ­ãƒƒãƒˆã‹ã‚‰è¿½åŠ **: æœ€åˆã®ç©ºã‚¹ãƒ­ãƒƒãƒˆã‹ã‚‰é †ã«è¿½åŠ 
- **å…¨ã‚¹ãƒ­ãƒƒãƒˆåŸ‹ã¾ã£ã¦ã„ã‚‹å ´åˆ**: å…ˆé ­ã‹ã‚‰ä¸Šæ›¸ã
- **Analyzeä¸è¦**: ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠå¾Œã€æ‰‹å‹•ã§Analyzeãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
- **è­¦å‘Šè¡¨ç¤º**: Analyzeå¾Œã€8ã‚³ãƒ¼ãƒ‰æœªæº€ã®å ´åˆã®ã¿è­¦å‘Šè¡¨ç¤º

#### Resetå‹•ä½œã®å¼·åŒ–
- **é€²è¡Œã‚¯ãƒªã‚¢**: å…¨12ã‚¹ãƒ­ãƒƒãƒˆã‚’ç©ºã«
- **åˆ†æçµæœã‚¯ãƒªã‚¢**: `resetAnalysis()` å‘¼ã³å‡ºã—
- **Key/Scaleå‰Šé™¤**: `keyCandidates`, `selectedKey`, `scaleCandidates`, `selectedScale` ã‚’ç©ºã«
- **ãƒ•ãƒ¬ãƒƒãƒˆãƒœãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ**: `setOverlayChordNotes(null)` ã§ãƒ‰ãƒƒãƒˆã‚’å®Œå…¨å‰Šé™¤
- **UIçŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ**: `selectedCellId`, `fbDisplay` ã‚’åˆæœŸçŠ¶æ…‹ã«

#### Romanæ•°å­—ã®å¤§æ–‡å­—çµ±ä¸€
- **â… , â…¡, â…¢, â…£, â…¤, â…¥, â…¦**: ã™ã¹ã¦å¤§æ–‡å­—
- **ãƒã‚¤ãƒŠãƒ¼ã‚³ãƒ¼ãƒ‰**: â…¡m, â…¢m, â…¥m ã®ã‚ˆã†ã« "m" ã‚’ä»˜åŠ 
- **å¤‰åŒ–è¨˜å·**: â™­â…¢, â™­â…¥, â™­â…¦ ã®ã‚ˆã†ã«å‰ç½®

### UIæ”¹å–„
1. **ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ‡ã‚¶ã‚¤ãƒ³**:
   - `max-h-[60vh] overflow-y-auto` ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ
   - `z-[10000]` ã§æœ€å‰é¢è¡¨ç¤º
   - `shadow-2xl` ã§è¦–è¦šçš„å¼·èª¿
2. **ã‚­ãƒ¼é¸æŠ**:
   - 12å€‹ã®ãƒœã‚¿ãƒ³ã‚’æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤º
   - é¸æŠä¸­ã®ã‚­ãƒ¼ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆ`bg-blue-500 text-white`ï¼‰
3. **ãƒ—ãƒªã‚»ãƒƒãƒˆã‚¢ã‚¤ãƒ†ãƒ **:
   - Romanæ•°å­—ã¨èª¬æ˜ã‚’2è¡Œè¡¨ç¤º
   - ãƒ›ãƒãƒ¼ã§èƒŒæ™¯è‰²å¤‰åŒ–ï¼ˆ`hover:bg-black/5`ï¼‰
4. **å¤–å´ã‚¯ãƒªãƒƒã‚¯/ESCå¯¾å¿œ**:
   - `useEffect` + `mousedown` / `keydown` ã‚¤ãƒ™ãƒ³ãƒˆ
   - `presetPopupRef.current?.contains(e.target)` ã§åˆ¤å®š
5. **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ**:
   - ãƒ—ãƒªã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã«`max-h-[60vh] overflow-y-auto`ã‚’é©ç”¨
   - å¤šæ•°ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã§ã‚‚å¿«é©ã«é–²è¦§å¯èƒ½

#### æŠ€è¡“å®Ÿè£…
**Romanæ•°å­—ãƒãƒƒãƒ”ãƒ³ã‚°**:
```typescript
const map: Record<string, {offset: number, quality: string}> = {
  'â… ': {offset: 0, quality: ''},
  'â…¡': {offset: 2, quality: ''},
  'â…¡m': {offset: 2, quality: 'm'},
  'â…¢': {offset: 4, quality: ''},
  'â…¢m': {offset: 4, quality: 'm'},
  'â…£': {offset: 5, quality: ''},
  'â…¤': {offset: 7, quality: ''},
  'â…¥': {offset: 9, quality: ''},
  'â…¥m': {offset: 9, quality: 'm'},
  'â™­â…¥': {offset: 8, quality: ''},  // æ–°è¦è¿½åŠ 
  'â™­â…¦': {offset: 10, quality: ''},
  'â…¦': {offset: 11, quality: ''},
};
```

**çŠ¶æ…‹ç®¡ç†**:
- `showPresetPopup`: ãƒ—ãƒªã‚»ãƒƒãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®è¡¨ç¤ºåˆ¶å¾¡
- `presetKey`: é¸æŠã•ã‚ŒãŸã‚­ãƒ¼ï¼ˆC, C#, D...ï¼‰
- `presetPopupRef`: å¤–å´ã‚¯ãƒªãƒƒã‚¯/ESCã‚­ãƒ¼ã§ã‚¯ãƒ­ãƒ¼ã‚º

**Telemetry**:
- `preset_inserted`: ãƒ—ãƒªã‚»ãƒƒãƒˆåã¨ãƒšãƒ¼ã‚¸ã‚’è¨˜éŒ²
- ä¾‹: `{page: 'chord_progression', preset: 'I-V-vi-IV'}`

#### ãƒ†ã‚¹ãƒˆç¢ºèªé …ç›®
- [x] Presetsãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
- [x] 12ç¨®é¡ã®ã‚­ãƒ¼ã‹ã‚‰é¸æŠå¯èƒ½
- [x] 10ç¨®é¡ã®ãƒ—ãƒªã‚»ãƒƒãƒˆãŒæ­£ã—ãè¡¨ç¤º
- [x] ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠã§ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãå…¥åŠ›ã•ã‚Œã‚‹ï¼ˆRoman â†’ å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰åï¼‰
- [x] Analyzeå‰ã¯ResultãŒè¡¨ç¤ºã•ã‚Œãªã„
- [x] Analyzeãƒœã‚¿ãƒ³ã§æ­£ã—ãKey/ScaleãŒåˆ†æã•ã‚Œã‚‹
- [x] 8ã‚³ãƒ¼ãƒ‰æœªæº€ã®è­¦å‘ŠãŒé©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡¨ç¤º
- [x] Resetãƒœã‚¿ãƒ³ã§å…¨ã¦ã‚¯ãƒªã‚¢ã•ã‚Œã‚‹ï¼ˆãƒ•ãƒ¬ãƒƒãƒˆãƒœãƒ¼ãƒ‰å«ã‚€ï¼‰
- [x] å¤–å´ã‚¯ãƒªãƒƒã‚¯/ESCã‚­ãƒ¼ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‰ã˜ã‚‹
- [x] Telemetryã‚¤ãƒ™ãƒ³ãƒˆãŒæ­£ã—ãé€ä¿¡ã•ã‚Œã‚‹

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/app/find-key/page.tsx`: ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ—ãƒªã‚»ãƒƒãƒˆé©ç”¨ã€UI
- `src/lib/telemetry.ts`: `preset_inserted` ã‚¤ãƒ™ãƒ³ãƒˆ

**M2-2å®Œäº†ã€‚æ¬¡ã¯M2-3ï¼ˆè‡ªå‹•ãƒ«ãƒ¼ãƒ—UIï¼‰ã«é€²ã‚€ã€‚**

---

## M2-3: è‡ªå‹•ãƒ«ãƒ¼ãƒ—UIï¼ˆPlay/Stopã€BPMè¨­å®šï¼‰ âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`  
**æ‹…å½“**: M2-3 Playback Controls

### å®Ÿè£…æ¦‚è¦
ã‚³ãƒ¼ãƒ‰é€²è¡Œã®è‡ªå‹•å†ç”Ÿæ©Ÿèƒ½ã‚’å®Ÿè£…ã€‚4æ‹å­ã§ãƒ«ãƒ¼ãƒ—å†ç”Ÿã—ã€BPMèª¿æ•´ã€ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ã€è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã€‚

### ä¸»ãªæ©Ÿèƒ½

#### 1. **Play/Stopãƒœã‚¿ãƒ³**
- **â–¶ Play**: å†ç”Ÿé–‹å§‹ï¼ˆ4æ‹ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ â†’ ãƒ«ãƒ¼ãƒ—å†ç”Ÿï¼‰
- **â¹ Stop**: å³åº§ã«åœæ­¢ï¼ˆâ– ã‚¢ã‚¤ã‚³ãƒ³ä½¿ç”¨ï¼‰
- é€²è¡ŒãŒç©ºã®å ´åˆã¯ç„¡åŠ¹åŒ–ï¼ˆopacity: 0.5ï¼‰
- `chip-pressable`ã‚¯ãƒ©ã‚¹ã§ãƒ—ãƒ¬ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

#### 2. **BPMè¨­å®š**
- ç¯„å›²: 40ã€œ240 BPM
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 120 BPM
- å†ç”Ÿä¸­ã¯å¤‰æ›´ä¸å¯ï¼ˆ`disabled={isPlaying}`ï¼‰
- `w-16`ã§å¹…ã‚’å›ºå®šã—ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®‰å®š

#### 3. **ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³**
- å†ç”Ÿå‰ã«4æ‹ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³
- C6ï¼ˆMIDI 84ï¼‰ã‚’100msã§å†ç”Ÿ
- åœæ­¢ãƒ•ãƒ©ã‚°ï¼ˆ`isPlayingRef`ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€é€”ä¸­åœæ­¢ã«å¯¾å¿œ

#### 4. **ãƒ«ãƒ¼ãƒ—å†ç”Ÿ**
- å„ã‚³ãƒ¼ãƒ‰ã‚’4æ‹ï¼ˆ4/4æ‹å­ï¼‰ã§å†ç”Ÿ
- 1æ‹ç›®: æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’å†ç”Ÿ
- 2ã€œ4æ‹ç›®: åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’å†ãƒˆãƒªã‚¬ãƒ¼
- é€²è¡Œã®æœ€å¾Œã¾ã§åˆ°é”ã—ãŸã‚‰å…ˆé ­ã«ãƒ«ãƒ¼ãƒ—

#### 5. **è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**
- ç¾åœ¨å†ç”Ÿä¸­ã®ã‚¹ãƒ­ãƒƒãƒˆã«`ring-4 ring-blue-500/80 shadow-lg`ã‚’é©ç”¨
- ã‚¹ãƒ­ãƒƒãƒˆç•ªå·ã¨ã‚³ãƒ¼ãƒ‰åã‚’è¡¨ç¤º
- å†ç”Ÿä½ç½®ãŒä¸€ç›®ã§ã‚ã‹ã‚‹

### UI/UXæ”¹å–„

#### ãƒœã‚¿ãƒ³é…ç½®ã®æœ€é©åŒ–
```
[Presets] [Reset] [Sketches]  |  [â–¶ Play] [BPM: 120] [Acoustic Steel â–¼]
```

**å·¦ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆç·¨é›†ç³»ï¼‰**:
- Presets: ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠ
- Reset: é€²è¡Œãƒªã‚»ãƒƒãƒˆ
- Sketches: ã‚¹ã‚±ãƒƒãƒç®¡ç†

**å³ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆå†ç”Ÿç³»ï¼‰**: 16pxã®ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã‚Š
- Play/Stop: å†ç”Ÿåˆ¶å¾¡
- BPM: ãƒ†ãƒ³ãƒè¨­å®š
- Instrument: éŸ³è‰²é¸æŠ

#### éŸ³è‰²é¸æŠã®æ”¹å–„
1. **ğŸ¸ãƒãƒ¼ã‚¯å‰Šé™¤**: å†—é•·ãªã‚¢ã‚¤ã‚³ãƒ³ã‚’å‰Šé™¤ã—ã¦ã™ã£ãã‚Š
2. **è¡¨ç¤ºåã‚’ã‚ã‹ã‚Šã‚„ã™ã**:
   - `Steel` â†’ **`Acoustic Steel`**
   - `Nylon` â†’ **`Acoustic Nylon`**
   - `Clean` â†’ **`Electric Clean`**
   - `Distortion` â†’ **`Distortion`**
   - `Over Drive` â†’ **`Over Drive`**
   - `Muted` â†’ **`Muted`**
   - `Piano` â†’ **`Piano`**

3. **Over DriveéŸ³æºä¿®æ­£**: `overdrive_guitar` â†’ `overdriven_guitar`ï¼ˆæ­£ã—ã„ç¶´ã‚Šï¼‰

#### åœæ­¢ã‚¢ã‚¤ã‚³ãƒ³ã®æ”¹å–„
- ä¸€æ™‚åœæ­¢è¨˜å·ï¼ˆâ€–ï¼‰â†’ **åœæ­¢è¨˜å·ï¼ˆâ– ï¼‰**
- SVGã§14x14ã®æ­£æ–¹å½¢ã‚’æç”»
- è¦–è¦šçš„ã«ã€Œå®Œå…¨åœæ­¢ã€ã‚’æ˜ç¢ºã«

### æŠ€è¡“å®Ÿè£…

#### çŠ¶æ…‹ç®¡ç†
```typescript
const [isPlaying, setIsPlaying] = useState(false);
const [bpm, setBpm] = useState(120);
const [currentChordIndex, setCurrentChordIndex] = useState<number>(-1);
const playbackTimerRef = useRef<NodeJS.Timeout | null>(null);
const isPlayingRef = useRef(false); // åœæ­¢ãƒ•ãƒ©ã‚°
```

#### åœæ­¢åˆ¶å¾¡ã®å¼·åŒ–
**å•é¡Œ**: åœæ­¢ãƒœã‚¿ãƒ³ãŒåŠ¹ã‹ãªã„ã“ã¨ãŒã‚ã‚‹

**è§£æ±ºç­–**:
1. **`isPlayingRef`ãƒ•ãƒ©ã‚°**: ã‚¿ã‚¤ãƒãƒ¼å†…ã§åœæ­¢åˆ¤å®š
2. **ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ä¸­ã®åœæ­¢**: å„ãƒ“ãƒ¼ãƒˆã§`isPlayingRef`ã‚’ãƒã‚§ãƒƒã‚¯
3. **å†ç”Ÿãƒ«ãƒ¼ãƒ—ä¸­ã®åœæ­¢**: `playBeat`é–¢æ•°å†…ã§åœæ­¢ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯ã€ã‚¿ã‚¤ãƒãƒ¼ã‚¯ãƒªã‚¢
4. **é–‹å§‹æ™‚ã®å¼·åˆ¶åœæ­¢**: `startPlayback`ã®æœ€åˆã§`stopPlayback()`ã‚’å‘¼ã³å‡ºã—

```typescript
const stopPlayback = useCallback(() => {
  isPlayingRef.current = false;
  if (playbackTimerRef.current) {
    clearInterval(playbackTimerRef.current);
    playbackTimerRef.current = null;
  }
  setIsPlaying(false);
  setCurrentChordIndex(-1);
}, []);

const startPlayback = useCallback(async () => {
  stopPlayback(); // å‰å›ã®å†ç”Ÿã‚’ç¢ºå®Ÿã«åœæ­¢
  
  isPlayingRef.current = true;
  setIsPlaying(true);
  
  // ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³
  for (let i = 0; i < countInBeats; i++) {
    if (!isPlayingRef.current) return; // åœæ­¢ãƒã‚§ãƒƒã‚¯
    await new Promise(resolve => setTimeout(resolve, beatDuration));
    if (!isPlayingRef.current) return;
    player.playNote(84, 100);
  }
  
  // ãƒ«ãƒ¼ãƒ—å†ç”Ÿ
  const playBeat = async () => {
    if (!isPlayingRef.current) {
      // åœæ­¢ãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ãŸã‚‰ã‚¿ã‚¤ãƒãƒ¼ã‚¯ãƒªã‚¢
      if (playbackTimerRef.current) {
        clearInterval(playbackTimerRef.current);
        playbackTimerRef.current = null;
      }
      return;
    }
    // ... ã‚³ãƒ¼ãƒ‰å†ç”Ÿãƒ­ã‚¸ãƒƒã‚¯
  };
  
  playbackTimerRef.current = setInterval(playBeat, beatDuration);
}, [slots, bpm, stopPlayback]);
```

#### ã‚³ãƒ¼ãƒ‰å†ç”Ÿãƒ­ã‚¸ãƒƒã‚¯
```typescript
const playChordSymbol = async (symbol: string) => {
  // ç°¡æ˜“ãƒ‘ãƒ¼ã‚¹: "Cmaj7", "Am", "F#m7" ãªã©
  const m = symbol.match(/^([A-G](?:#|b)?)(.*)$/);
  const root = m?.[1] || symbol;
  const qual = (m?.[2] || '').toLowerCase();
  
  // MIDIéŸ³éšè¨ˆç®—ï¼ˆC4åŸºæº–=60ï¼‰
  const pcTable = ['C','C#','D','Eb','E','F','F#','G','Ab','A','Bb','B'];
  const pc = pcTable.indexOf(root);
  const base = 60 + pc;
  
  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«æ±ºå®š
  let intervals = [0,4,7]; // Major triad
  if (/(^|[^a-z])m(?!aj)/.test(qual)) intervals = [0,3,7]; // Minor
  if (/dim|Â°/.test(qual)) intervals = [0,3,6]; // Diminished
  if (/maj7/.test(qual)) intervals = [...intervals, 11]; // Maj7
  else if (/7/.test(qual)) intervals = [0,4,7,10]; // Dom7
  if (/sus2/.test(qual)) intervals = [0,2,7];
  if (/sus4/.test(qual)) intervals = [0,5,7];
  
  const midis = intervals.map(iv => base + (iv%12));
  await player.resume();
  player.playChord(midis, 'lightStrum', 300);
};
```

### Telemetry
```typescript
track('progression_play', {
  page: 'chord_progression',
  bpm: 120,
  chordCount: 4
});
```

### ãƒ†ã‚¹ãƒˆç¢ºèªé …ç›®
- [x] Playãƒœã‚¿ãƒ³ã§ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ â†’ ãƒ«ãƒ¼ãƒ—å†ç”Ÿé–‹å§‹
- [x] Stopãƒœã‚¿ãƒ³ã§å³åº§ã«åœæ­¢ï¼ˆã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ä¸­ã‚‚å«ã‚€ï¼‰
- [x] BPMè¨­å®šãŒæ­£ã—ãåæ˜ ã•ã‚Œã‚‹ï¼ˆ40ã€œ240ï¼‰
- [x] å†ç”Ÿä¸­ã®ã‚¹ãƒ­ãƒƒãƒˆãŒé’ã„ãƒªãƒ³ã‚°ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- [x] é€²è¡Œã®æœ€å¾Œã¾ã§è¡Œã£ãŸã‚‰å…ˆé ­ã«ãƒ«ãƒ¼ãƒ—
- [x] é€²è¡ŒãŒç©ºã®å ´åˆã¯Playãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–
- [x] éŸ³è‰²é¸æŠã§æ­£ã—ã„æ¥½å™¨éŸ³ãŒå†ç”Ÿã•ã‚Œã‚‹
- [x] Over DriveãŒæ­£ã—ãå†ç”Ÿã•ã‚Œã‚‹ï¼ˆ`overdriven_guitar`ï¼‰
- [x] åœæ­¢ã‚¢ã‚¤ã‚³ãƒ³ãŒâ– ã§è¡¨ç¤ºã•ã‚Œã‚‹
- [x] ãƒœã‚¿ãƒ³é…ç½®ãŒå·¦ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆç·¨é›†ï¼‰ã¨å³ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆå†ç”Ÿï¼‰ã«åˆ†ã‹ã‚Œã¦ã„ã‚‹
- [x] Telemetryã‚¤ãƒ™ãƒ³ãƒˆãŒæ­£ã—ãé€ä¿¡ã•ã‚Œã‚‹

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/app/find-key/page.tsx`: ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã€å†ç”Ÿåˆ¶å¾¡ã€UI
- `src/lib/audio/player.ts`: éŸ³è‰²ç®¡ç†ã€SoundFontå†ç”Ÿ
- `src/lib/audio/voices.ts`: Web Audio API fallback
- `src/lib/telemetry.ts`: `progression_play` ã‚¤ãƒ™ãƒ³ãƒˆ

**M2-3å®Œäº†ã€‚UIæ”¹å–„ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆM2-4ã€œM2-6ï¼‰ã‚‚å®Œäº†ã€‚**

---

## M2ç·æ‹¬ âœ… å®Œäº†
**å®Ÿè£…æœŸé–“**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`  
**æœ€çµ‚ã‚³ãƒŸãƒƒãƒˆ**: [å®Ÿè£…å®Œäº†å¾Œã«è¨˜éŒ²]

### å®Œäº†ã—ãŸæ©Ÿèƒ½
1. ~~**M2-1: Undoæ©Ÿèƒ½**~~ â†’ ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆå€‹åˆ¥å‰Šé™¤ãƒœã‚¿ãƒ³ã§ååˆ†ï¼‰
2. **M2-2: ãƒ—ãƒªã‚»ãƒƒãƒˆæ‹¡å……** â†’ 20ç¨®é¡ã®ãƒ—ãƒªã‚»ãƒƒãƒˆå®Ÿè£…
3. **M2-3: è‡ªå‹•ãƒ«ãƒ¼ãƒ—UI** â†’ Play/Stopã€BPMã€ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³å®Ÿè£…
4. **M2-4: Telemetry** â†’ `preset_inserted`, `progression_play` ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè£…
5. **M2-5: UIæ”¹å–„** â†’ ãƒœã‚¿ãƒ³é…ç½®ã€éŸ³è‰²é¸æŠã€åœæ­¢åˆ¶å¾¡ã®æœ€é©åŒ–
6. **M2-6: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°** â†’ ãƒ¬ãƒãƒ¼ãƒˆã¨SSOTåæ˜ 

### ä¸»ãªæˆæœ
- **ãƒ—ãƒªã‚»ãƒƒãƒˆ**: 20ç¨®é¡ã®å®Ÿç”¨çš„ãªé€²è¡Œãƒ‘ã‚¿ãƒ¼ãƒ³
- **è‡ªå‹•å†ç”Ÿ**: 4æ‹å­ãƒ«ãƒ¼ãƒ—ã€BPMèª¿æ•´ã€è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- **UI/UX**: ç›´æ„Ÿçš„ãªãƒœã‚¿ãƒ³é…ç½®ã€ã‚ã‹ã‚Šã‚„ã™ã„éŸ³è‰²å
- **å®‰å®šæ€§**: åœæ­¢åˆ¶å¾¡ã®å¼·åŒ–ã€Over DriveéŸ³æºä¿®æ­£

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
**M3: Find Chordså¼·åŒ–** ã«é€²ã‚€æº–å‚™å®Œäº†ã€‚

---

## M3: Find Chordså¼·åŒ– ğŸš§ é€²è¡Œä¸­
**å®Ÿè£…é–‹å§‹**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`

### å®Ÿè£…ç›®æ¨™
Find Chords ãƒšãƒ¼ã‚¸ã«ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ã‚ˆã‚Šå®Ÿç”¨çš„ãªå­¦ç¿’ãƒ„ãƒ¼ãƒ«ã«å¼·åŒ–ã™ã‚‹ï¼š

1. **Scale Table**: å„ã‚³ãƒ¼ãƒ‰ã«æ¨å¥¨ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ2ã€œ3ç¨®é¡ï¼‰ã‚’è¡¨ç¤º
2. **Chord Forms**: Open/Barreãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤ºã¨è©¦è´
3. **Capo ææ¡ˆ**: Top2ã‚’æŠ˜ã‚ŠãŸãŸã¿å†…ã«è¡¨ç¤ºï¼ˆShapedè¡¨è¨˜ï¼‰
4. **åŸºç¤ä»£ç†ã‚³ãƒ¼ãƒ‰**: ä»£è¡¨çš„ãªä»£ç†ã‚³ãƒ¼ãƒ‰å€™è£œã‚’æç¤º

### A. Scale Tableï¼ˆå„ã‚³ãƒ¼ãƒ‰ã«æ¨å¥¨ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰

#### è¦ä»¶
- å„ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦2ã€œ3å€‹ã®æ¨å¥¨ã‚¹ã‚±ãƒ¼ãƒ«ã‚’è¡¨ç¤º
- "Why"ï¼ˆä¸€æ–‡ã§ã®ç†ç”±ï¼‰ã‚’ä»˜è¨˜
- Glossaryï¼ˆç”¨èªè§£èª¬ï¼‰ã¸ã®ãƒªãƒ³ã‚¯
- çŸ­ã„ã‚¢ãƒ«ãƒšã‚¸ã‚ªè©¦è´æ©Ÿèƒ½

#### å®Ÿè£…è¨ˆç”»

**1. Scaleæ¨å¥¨ãƒ­ã‚¸ãƒƒã‚¯**
```typescript
// src/lib/scales/recommendations.ts
type ScaleRecommendation = {
  scaleId: ScaleId;
  reason: string; // "Why" ä¸€æ–‡
  glossaryKey?: string;
};

function getRecommendedScales(chord: {root: string, quality: string}): ScaleRecommendation[] {
  // ä¾‹: Cmaj â†’ Ionian, Lydian
  // ä¾‹: Dm â†’ Dorian, Aeolian
  // ä¾‹: G7 â†’ Mixolydian, Altered
}
```

**2. UIå®Ÿè£…**
- DiatonicTable ã®å„è¡Œã« "Scales" ãƒœã‚¿ãƒ³è¿½åŠ 
- ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
- å„ã‚¹ã‚±ãƒ¼ãƒ«ã«è©¦è´ãƒœã‚¿ãƒ³ï¼ˆã‚¢ãƒ«ãƒšã‚¸ã‚ªå†ç”Ÿï¼‰

**3. ã‚¢ãƒ«ãƒšã‚¸ã‚ªå†ç”Ÿ**
```typescript
// src/lib/audio/arpeggio.ts
function playArpeggio(rootMidi: number, scaleIntervals: number[], tempo: number) {
  // ã‚¹ã‚±ãƒ¼ãƒ«éŸ³ã‚’é †æ¬¡å†ç”Ÿï¼ˆä¸Šæ˜‡â†’ä¸‹é™ï¼‰
  // å„éŸ³ 80ã€œ100msç¨‹åº¦
}
```

### B. Chord Formsï¼ˆOpen/Barreè¡¨ç¤ºï¼‰

#### è¦ä»¶
- Open positionï¼ˆé–‹æ”¾å¼¦ï¼‰ãƒ•ã‚©ãƒ¼ãƒ 
- Barreï¼ˆã‚»ãƒ¼ãƒï¼‰ãƒ•ã‚©ãƒ¼ãƒ 
- ãƒ•ã‚©ãƒ¼ãƒ ã”ã¨ã«è©¦è´æ©Ÿèƒ½
- Compactè¡¨ç¤ºã¯ vNext

#### ç¾çŠ¶ç¢ºèª
- `ChordFormsPopover` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ—¢ã«å­˜åœ¨
- `buildForm` é–¢æ•°ã§ Open/Barre ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆå¯èƒ½
- ç¾åœ¨ã¯ "Forms..." ãƒœã‚¿ãƒ³ã§è¡¨ç¤º

#### æ”¹å–„è¨ˆç”»
1. **UIæ”¹å–„**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ãƒ‡ã‚¶ã‚¤ãƒ³æœ€é©åŒ–
2. **è©¦è´æ©Ÿèƒ½**: å„ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªãƒƒã‚¯ã§å’ŒéŸ³å†ç”Ÿ
3. **ãƒ•ã‚©ãƒ¼ãƒ èª¬æ˜**: Open/Barreã®é•ã„ã‚’ç°¡æ½”ã«è¡¨ç¤º

### C. Capoææ¡ˆï¼ˆTop2ã€Shapedè¡¨è¨˜ï¼‰

#### è¦ä»¶
- æŠ˜ã‚ŠãŸãŸã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã«è¡¨ç¤º
- ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰ãŒå¤šã„Top2ã‚’ææ¡ˆ
- Shapedè¡¨è¨˜ã§è¡¨ç¤ºï¼ˆå®ŸéŸ³ã§ã¯ãªãæŠ¼ã•ãˆæ–¹ï¼‰
- æ³¨è¨˜: "Shaped=fingered / Sounding=actual"
- éŸ³ã¯é³´ã‚‰ã•ãªã„

#### ç¾çŠ¶ç¢ºèª
- `CapoFold` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ—¢ã«å­˜åœ¨
- `recommendCapos` é–¢æ•°ã§Top2ã‚’å–å¾—
- Shapedè¡¨è¨˜ã§è¡¨ç¤ºæ¸ˆã¿

#### æ”¹å–„è¨ˆç”»
- UIç¢ºèªã¨ãƒ†ã‚¹ãƒˆ
- æ³¨è¨˜ã®è¦–èªæ€§å‘ä¸Š

### D. åŸºç¤ä»£ç†ã‚³ãƒ¼ãƒ‰

#### è¦ä»¶
- å„ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦2ã€œ3å€‹ã®ä»£ç†ã‚³ãƒ¼ãƒ‰å€™è£œ
- ä¸€æ–‡ã§ã®ç†ç”±èª¬æ˜
- ä»£è¡¨æ›²ã®ä¾‹ç¤ºï¼ˆ2ã€œ3ä»¶ï¼‰
- è©¦è´æ©Ÿèƒ½
- "+Add" ã§é€²è¡Œã«è¿½åŠ 
- "Replace"ï¼ˆç½®æ›ï¼‰æ©Ÿèƒ½

#### å®Ÿè£…è¨ˆç”»

**1. ä»£ç†ã‚³ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯**
```typescript
// src/lib/chords/substitute.ts
type SubstituteChord = {
  chord: string; // "Dm7" ãªã©
  reason: string; // "Same function, richer sound"
  examples: string[]; // ["Song A", "Song B"]
};

function getSubstitutes(chord: {root: string, quality: string}, context: {key: string, mode: string}): SubstituteChord[] {
  // ä¾‹: C â†’ Cmaj7, C6, Am (relative minor)
  // ä¾‹: G7 â†’ G7sus4, Dm7 (ii-V substitution)
}
```

**2. UIå®Ÿè£…**
- DiatonicTable ã®å„è¡Œã« "Substitutes" ãƒœã‚¿ãƒ³è¿½åŠ 
- ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§å€™è£œã‚’è¡¨ç¤º
- å„å€™è£œã«è©¦è´ãƒœã‚¿ãƒ³
- "+Add" / "Replace" ãƒœã‚¿ãƒ³

### å®Ÿè£…é †åº
1. **M3-1**: Scale Tableï¼ˆæ¨å¥¨ã‚¹ã‚±ãƒ¼ãƒ«è¡¨ç¤ºï¼‹è©¦è´ï¼‰
2. **M3-2**: Chord Forms UIæ”¹å–„
3. **M3-3**: Capoææ¡ˆã®æœ€çµ‚ç¢ºèª
4. **M3-4**: åŸºç¤ä»£ç†ã‚³ãƒ¼ãƒ‰å®Ÿè£…

### Telemetryè¿½åŠ 
- `scale_suggestion_shown`: ã‚¹ã‚±ãƒ¼ãƒ«å€™è£œè¡¨ç¤ºæ™‚
- `scale_arpeggio_play`: ã‚¢ãƒ«ãƒšã‚¸ã‚ªè©¦è´æ™‚
- `chord_form_shown`: ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºæ™‚
- `substitute_shown`: ä»£ç†ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºæ™‚
- `substitute_add`: ä»£ç†ã‚³ãƒ¼ãƒ‰ã‚’é€²è¡Œã«è¿½åŠ æ™‚

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
M3-1ï¼ˆScale Tableï¼‰ã®å®Ÿè£…ã‹ã‚‰é–‹å§‹ã™ã‚‹ã€‚

---

## M3-1: Scale Tableï¼ˆæ¨å¥¨ã‚¹ã‚±ãƒ¼ãƒ«è¡¨ç¤ºï¼‹è©¦è´ï¼‰ âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`

### å®Ÿè£…æ¦‚è¦
å„ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã€æ¨å¥¨ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ2ã€œ3ç¨®é¡ï¼‰ã‚’è¡¨ç¤ºã—ã€Whyæ–‡ï¼ˆç†ç”±èª¬æ˜ï¼‰ã¨Glossaryãƒªãƒ³ã‚¯ã€ã‚¢ãƒ«ãƒšã‚¸ã‚ªè©¦è´æ©Ÿèƒ½ã‚’æä¾›ã€‚

### ä¸»ãªæ©Ÿèƒ½

#### 1. **Whyæ–‡ã®å……å®Ÿ** âœ…
ã‚ˆã‚Šè©³ç´°ã§åˆ†ã‹ã‚Šã‚„ã™ã„èª¬æ˜ã«æ”¹å–„ï¼š
- `maj_ionian`: "Foundation for major chords â€“ fits all diatonic tones"
- `maj_lydian`: "Bright color with raised 4th (#11) â€“ jazz/modern sound"
- `min_aeolian`: "Natural minor foundation â€“ matches all minor scale tones"
- `min_dorian`: "Brighter minor with natural 6th â€“ popular in jazz and funk"
- `min_phrygian`: "Dark minor with flat 2nd â€“ Spanish/flamenco character"
- `dom_mixolydian`: "Perfect for dominant 7th â€“ contains the b7 tension"
- `dom_altered`: "Maximum tension â€“ all alterations (b9, #9, #11, b13)"
- `m7b5_locrian`: "Outlines half-diminished chord â€“ starts on the 7th degree"
- `dim_wh`: "Symmetrical whole-half pattern â€“ creates tension over diminished chords"

#### 2. **Glossaryçµ±åˆ** âœ…
- â’¤ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç‹¬ç«‹ã—ãŸãƒœã‚¿ãƒ³ã«åˆ†é›¢
- ã‚¯ãƒªãƒƒã‚¯ã§å®Ÿéš›ã®Glossaryãƒšãƒ¼ã‚¸ã¸ãƒªãƒ³ã‚¯ï¼ˆ`/reference#scales`ï¼‰
- ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆ`opacity-60` â†’ `opacity-100`ï¼‰
- å††å½¢èƒŒæ™¯ã¨ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³åŠ¹æœ
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œï¼ˆ`aria-label`, `title`ï¼‰

#### 3. **ã‚¹ã‚±ãƒ¼ãƒ«æ¨å¥¨ã®æ‹¡å……** âœ…
æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã¨ã‚¹ã‚±ãƒ¼ãƒ«ã«å¯¾å¿œï¼š

**å¯¾å¿œã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—**:
- `maj` / `maj7` â†’ Ionian, Lydian
- `min` / `m7` â†’ Aeolian, Dorian, **Phrygianï¼ˆæ–°è¦ï¼‰**
- `dom7` / `7` â†’ Mixolydian, **Alteredï¼ˆæ–°è¦ï¼‰**
- `m7b5` â†’ Locrian, DiminishedWholeHalf
- `dim` â†’ DiminishedWholeHalf, Locrian

**æ–°è¦è¿½åŠ ã‚¹ã‚±ãƒ¼ãƒ«**:
- `Phrygian`: æš—ã„ãƒã‚¤ãƒŠãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆâ™­2ï¼‰
- `Altered`: æœ€å¤§ã®ç·Šå¼µæ„Ÿï¼ˆãƒ‰ãƒŸãƒŠãƒ³ãƒˆç”¨ï¼‰
- `HarmonicMinor`, `MelodicMinor`, `WholeTone`: å°†æ¥ã®æ‹¡å¼µç”¨

#### 4. **ã‚¢ãƒ«ãƒšã‚¸ã‚ªå†ç”Ÿã®æ”¹å–„** âœ…
- **ä¸Šæ˜‡â†’ä¸‹é™ãƒ‘ã‚¿ãƒ¼ãƒ³**: ã‚ˆã‚Šè‡ªç„¶ãªéŸ¿ã
- **æœ€å¤§5éŸ³**: ã‚¹ã‚±ãƒ¼ãƒ«ã®ç‰¹å¾´ã‚’è¡¨ç¾
- **å„éŸ³100ms**: ãƒªã‚ºãƒŸã‚«ãƒ«ãªå†ç”Ÿ
- **ãƒ«ãƒ¼ãƒˆéŸ³ã®é‡è¤‡ãªã—**: ä¸‹é™æ™‚ã¯2éŸ³ç›®ã‹ã‚‰
- **Telemetryè¿½åŠ **: `scale_arpeggio_play` ã‚¤ãƒ™ãƒ³ãƒˆ

```typescript
const ascending = steps.slice(); // [1, 2, 3, 4, 5]
const descending = steps.slice().reverse().slice(1); // [4, 3, 2, 1]
const pattern = [...ascending, ...descending]; // [1, 2, 3, 4, 5, 4, 3, 2, 1]
```

#### 5. **UIæ”¹å–„** âœ…
- ã‚¹ã‚±ãƒ¼ãƒ«ãƒãƒƒãƒ—ã¨â’¤ãƒœã‚¿ãƒ³ã‚’è¦–è¦šçš„ã«åˆ†é›¢
- `inline-flex items-center gap-1` ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- â’¤ãƒœã‚¿ãƒ³ã«å††å½¢èƒŒæ™¯ï¼ˆ`w-5 h-5 rounded-full`ï¼‰
- ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆ`hover:bg-black/5 dark:hover:bg-white/10`ï¼‰
- `transition-opacity` ã§ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### æŠ€è¡“å®Ÿè£…

#### ã‚¹ã‚±ãƒ¼ãƒ«æ¨å¥¨ãƒ­ã‚¸ãƒƒã‚¯
```typescript
// src/lib/scaleSuggestions.ts
export function suggestScalesForChord(quality: 'maj'|'min'|'dom7'|'m7b5'|'dim'|'maj7'|'m7'|'7'): Suggest {
  switch (quality) {
    case 'maj':
    case 'maj7':
      return { scales: ['Ionian','Lydian'], why: ['maj_ionian','maj_lydian'] };
    case 'min':
    case 'm7':
      return { scales: ['Aeolian','Dorian','Phrygian'], why: ['min_aeolian','min_dorian','min_phrygian'] };
    case 'dom7':
    case '7':
      return { scales: ['Mixolydian','Altered'], why: ['dom_mixolydian','dom_altered'] };
    // ...
  }
}
```

#### ã‚¢ãƒ«ãƒšã‚¸ã‚ªå†ç”Ÿ
```typescript
async function playArpShort(rootPc:number, scaleId:string){
  const pcs: number[] = api.getScalePitchesById(rootPc, scaleId);
  const steps = pcs.slice(0, Math.min(5, pcs.length));
  const ascending = steps.slice();
  const descending = steps.slice().reverse().slice(1);
  const pattern = [...ascending, ...descending];
  const dur = 100;
  await player.resume();
  for (const pc of pattern) {
    player.playNote(60 + pc, dur);
    await wait(dur);
  }
  tel('scale_arpeggio_play', { page: 'find-chords', scaleId, rootPc });
}
```

### Telemetry
- `scale_arpeggio_play`: ã‚¢ãƒ«ãƒšã‚¸ã‚ªè©¦è´æ™‚ã«ãƒšãƒ¼ã‚¸ã€ã‚¹ã‚±ãƒ¼ãƒ«IDã€ãƒ«ãƒ¼ãƒˆéŸ³ã‚’è¨˜éŒ²

### ãƒ†ã‚¹ãƒˆç¢ºèªé …ç›®
- [x] ã‚³ãƒ¼ãƒ‰é¸æŠæ™‚ã«Scale Tableè¡¨ç¤º
- [x] 2ã€œ3å€‹ã®ã‚¹ã‚±ãƒ¼ãƒ«å€™è£œãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] Whyæ–‡ãŒåˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤ºã•ã‚Œã‚‹
- [x] â’¤ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§Glossaryãƒšãƒ¼ã‚¸ãŒé–‹ã
- [x] ã‚¹ã‚±ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚¯ãƒªãƒƒã‚¯ã§ã‚¢ãƒ«ãƒšã‚¸ã‚ªå†ç”Ÿï¼ˆä¸Šæ˜‡â†’ä¸‹é™ï¼‰
- [x] Phrygian, Alteredã‚¹ã‚±ãƒ¼ãƒ«ãŒæ­£ã—ãæ¨å¥¨ã•ã‚Œã‚‹
- [x] ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- [x] Telemetryã‚¤ãƒ™ãƒ³ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/components/ScaleTable.tsx`: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/lib/scaleSuggestions.ts`: ã‚¹ã‚±ãƒ¼ãƒ«æ¨å¥¨ãƒ­ã‚¸ãƒƒã‚¯
- `src/lib/telemetry.ts`: Telemetryã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©

**M3-1å®Œäº†ã€‚æ¬¡ã¯M3-2ï¼ˆChord Forms UIæ”¹å–„ï¼‰ã«é€²ã‚€ã€‚**

---

## M3-2: Chord Forms UIæ”¹å–„ âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`

### å®Ÿè£…æ¦‚è¦
æ—¢å­˜ã® `ChordFormsPopover` ã‚’å¤§å¹…ã«æ”¹å–„ã€‚ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºã‚’æœ€é©åŒ–ã—ã€è©¦è´æ©Ÿèƒ½ã‚’è¿½åŠ ã€‚

### ä¸»ãªæ©Ÿèƒ½

#### 1. **è©¦è´æ©Ÿèƒ½ã®è¿½åŠ ** âœ…
å„ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆOpen, Barre E, Barre Aï¼‰ã«â–¶ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ï¼š
- ã‚¯ãƒªãƒƒã‚¯ã§3å’ŒéŸ³ã‚’å†ç”Ÿï¼ˆãƒ«ãƒ¼ãƒˆã€3åº¦ã€5åº¦ï¼‰
- Major: `[0, 4, 7]` / Minor: `[0, 3, 7]`
- `lightStrum` ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ10ã€œ20msé…å»¶ï¼‰
- 300mså†ç”Ÿæ™‚é–“

```typescript
const playFormPreview = async (kind: FormKind) => {
  await player.resume();
  const intervals = quality === 'maj' ? [0, 4, 7] : [0, 3, 7];
  const midis = intervals.map(iv => 60 + rootPc + iv);
  player.playChord(midis, 'lightStrum', 300);
  track('play_chord', { page, source: 'form_preview', kind });
};
```

#### 2. **UIæ”¹å–„** âœ…
**ãƒ˜ãƒƒãƒ€ãƒ¼**:
- ã‚¿ã‚¤ãƒˆãƒ« + âœ•ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
- `flex items-center justify-between` ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

**èª¬æ˜æ–‡**:
- "Select a fingering pattern for major/minor chord"
- `text-xs opacity-70` ã§æ§ãˆã‚ã«è¡¨ç¤º

**ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰**:
- ã‚«ãƒ¼ãƒ‰å½¢å¼ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ`flex items-center gap-2`ï¼‰
- ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦ï¼‰+ è©¦è´ãƒœã‚¿ãƒ³ï¼ˆå³ï¼‰ã®2ã‚«ãƒ©ãƒ 
- ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆ`hover:bg-emerald-50 dark:hover:bg-emerald-900/20`ï¼‰
- ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³åŠ¹æœï¼ˆ`transition-colors`ï¼‰

**å„ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º**:
- **Open Position**: "Uses open strings"
- **Barre (E-shape)**: "6th string root"
- **Barre (A-shape)**: "5th string root"

#### 3. **Propsæ‹¡å¼µ** âœ…
- `rootPc: number` ã‚’è¿½åŠ ï¼ˆè©¦è´æ©Ÿèƒ½ã®ãŸã‚ï¼‰

```typescript
type Props = {
  at: { x: number; y: number };
  quality: Quality;
  rootPc: number; // è¿½åŠ 
  onPick: (kind: FormKind) => void;
  onClose: () => void;
  page?: string;
};
```

#### 4. **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£** âœ…
- `aria-label` / `title` å±æ€§
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼ˆæ—¢å­˜ã® `useRovingTabs`ï¼‰
- Escape ã‚­ãƒ¼ã§é–‰ã˜ã‚‹ï¼ˆæ—¢å­˜ï¼‰
- å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ï¼ˆæ—¢å­˜ï¼‰

### UIæ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chord Forms                      âœ•  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Select a fingering pattern...       â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â” â”‚
â”‚ â”‚ Open Position           â”‚ â”‚ â–¶ â”‚ â”‚
â”‚ â”‚ Uses open strings       â”‚ â””â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â” â”‚
â”‚ â”‚ Barre (E-shape)         â”‚ â”‚ â–¶ â”‚ â”‚
â”‚ â”‚ 6th string root         â”‚ â””â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â” â”‚
â”‚ â”‚ Barre (A-shape)         â”‚ â”‚ â–¶ â”‚ â”‚
â”‚ â”‚ 5th string root         â”‚ â””â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                     â”‚
â”‚ Right-click or long-press...        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Telemetry
- `overlay_shown`: ãƒ•ã‚©ãƒ¼ãƒ é¸æŠæ™‚ï¼ˆæ—¢å­˜ï¼‰
- `play_chord`: è©¦è´ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ï¼ˆ`source: 'form_preview'`ï¼‰

### ãƒ†ã‚¹ãƒˆç¢ºèªé …ç›®
- [x] Fretboardå³ã‚¯ãƒªãƒƒã‚¯/é•·æŠ¼ã—ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
- [x] 3ã¤ã®ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] å„ãƒ•ã‚©ãƒ¼ãƒ ã«èª¬æ˜æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] â–¶ãƒœã‚¿ãƒ³ã§å’ŒéŸ³ãŒå†ç”Ÿã•ã‚Œã‚‹
- [x] Major/Minorã§æ­£ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ãŒå†ç”Ÿã•ã‚Œã‚‹
- [x] ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå‹•ä½œã™ã‚‹
- [x] ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- [x] âœ•ãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹
- [x] Telemetryã‚¤ãƒ™ãƒ³ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/components/ChordFormsPopover.tsx`: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/lib/chordForms.ts`: ãƒ•ã‚©ãƒ¼ãƒ æ§‹é€ å®šç¾©
- `src/lib/audio/player.ts`: éŸ³å£°å†ç”Ÿ
- `src/lib/telemetry.ts`: Telemetryã‚¤ãƒ™ãƒ³ãƒˆ

**M3-2å®Œäº†ã€‚æ¬¡ã¯M3-3ï¼ˆCapoææ¡ˆã®ç¢ºèªï¼‰ã«é€²ã‚€ã€‚**

---

## M3-3: Capoææ¡ˆã®ç¢ºèª âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`

### å®Ÿè£…æ¦‚è¦
æ—¢å­˜ã® `CapoFold` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç¢ºèªã—ã€UIæ”¹å–„ã‚’å®Ÿæ–½ã€‚Top2è¡¨ç¤ºã€Shapedè¡¨è¨˜ã€æ³¨è¨˜ã®è¦–èªæ€§ã‚’å‘ä¸Šã€‚

### ä¸»ãªæ”¹å–„

#### 1. **æ³¨è¨˜ã®è¦–èªæ€§å‘ä¸Š** âœ…
- **å¤ªå­— + æ˜ç¢ºãªèª¬æ˜**:
  ```
  Note: Shaped = fingered position / Sounding = actual pitch
  ```
- `text-xs opacity-70` ã§æ§ãˆã‚ã«è¡¨ç¤º
- `<strong>` ã‚¿ã‚°ã§å¼·èª¿

#### 2. **Shapedãƒãƒƒã‚¸ã®æ”¹å–„** âœ…
- ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã‚«ãƒ©ãƒ¼ã®ãƒãƒƒã‚¸
- `bg-emerald-100 dark:bg-emerald-900/30`
- `text-emerald-700 dark:text-emerald-300`
- `px-2 py-0.5 rounded-full` ã§ä¸¸ã¿ã®ã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³

#### 3. **ã‚¹ã‚³ã‚¢è¡¨ç¤ºã®è¿½åŠ ** âœ…
- ã‚ªãƒ¼ãƒ—ãƒ³ã‚³ãƒ¼ãƒ‰ã®å‰²åˆã‚’ï¼…è¡¨ç¤º
- `{Math.round(it.score * 100)}% open chords`
- `text-xs opacity-70` ã§æ§ãˆã‚ã«

#### 4. **ã‚«ãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ”¹å–„** âœ…
- å„Capoææ¡ˆã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤º
- `rounded border p-2 bg-background/40`
- `space-y-2` ã§é©åˆ‡ãªé–“éš”

#### 5. **ç†ç”±ã®è¡¨ç¤º** âœ…
- `reasons` é…åˆ—ãŒã‚ã‚‹å ´åˆã«è¡¨ç¤º
- `Â·` åŒºåˆ‡ã‚Šã§è¤‡æ•°ç†ç”±ã‚’ä¸¦åˆ—è¡¨ç¤º
- `text-xs opacity-60` ã§è£œè¶³æƒ…å ±ã¨ã—ã¦

### UIæ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¼ Capo Suggestions (Top 2)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Note: Shaped = fingered position /  â”‚
â”‚       Sounding = actual pitch        â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Capo 2 [Shaped]   75% open    â”‚  â”‚
â”‚ â”‚ Play as G                      â”‚  â”‚
â”‚ â”‚ Many open chords Â· Easy shapes â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Capo 5 [Shaped]   60% open    â”‚  â”‚
â”‚ â”‚ Play as C                      â”‚  â”‚
â”‚ â”‚ Familiar shapes                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¢å­˜æ©Ÿèƒ½ã®ç¢ºèª

#### Top2è¡¨ç¤º âœ…
```typescript
recommendCapos({ tonic, mode }, { type: scaleType }, 2, { includeOpen: false })
```
- æœ€å¤§2ä»¶ã®ææ¡ˆ
- `includeOpen: false` ã§ã‚«ãƒãªã—ï¼ˆ0ãƒ•ãƒ¬ãƒƒãƒˆï¼‰ã‚’é™¤å¤–

#### Shapedè¡¨è¨˜ âœ…
- "Play as G" ãªã©ã®è¡¨è¨˜
- `playAs` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§æä¾›

#### æŠ˜ã‚ŠãŸãŸã¿ âœ…
- `<details>` / `<summary>` è¦ç´ ä½¿ç”¨
- `cursor-pointer` ã§è¦–è¦šçš„ã«åˆ†ã‹ã‚Šã‚„ã™ã

### ãƒ†ã‚¹ãƒˆç¢ºèªé …ç›®
- [x] Key/Scaleé¸æŠæ™‚ã«è‡ªå‹•è¨ˆç®—
- [x] Top2ï¼ˆæœ€å¤§2ä»¶ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] Shapedãƒãƒƒã‚¸ãŒæ˜ç¢ºã«è¡¨ç¤ºã•ã‚Œã‚‹
- [x] æ³¨è¨˜ãŒèª­ã¿ã‚„ã™ã„
- [x] ã‚¹ã‚³ã‚¢ï¼ˆ% open chordsï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] ç†ç”±ï¼ˆreasonsï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] æŠ˜ã‚ŠãŸãŸã¿/å±•é–‹ãŒå‹•ä½œã™ã‚‹
- [x] ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- [x] éŸ³ã¯é³´ã‚‰ãªã„ï¼ˆè¦ä»¶é€šã‚Šï¼‰

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/components/CapoFold.tsx`: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/lib/capo/recommend.ts`: Capoæ¨å¥¨ãƒ­ã‚¸ãƒƒã‚¯
- `src/store/analysisStore.ts`: Key/ScaleçŠ¶æ…‹ç®¡ç†

**M3-3å®Œäº†ã€‚æ¬¡ã¯M3-4ï¼ˆåŸºç¤ä»£ç†ã‚³ãƒ¼ãƒ‰å®Ÿè£…ï¼‰ã«é€²ã‚€ã€‚**

---

## M3-4: åŸºç¤ä»£ç†ã‚³ãƒ¼ãƒ‰ âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`  
**çŠ¶æ…‹**: ãƒ­ã‚¸ãƒƒã‚¯ + UIå®Œæˆ

### å®Ÿè£…æ¦‚è¦
å„ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã€æ©Ÿèƒ½çš„ã«é¡ä¼¼ã—ãŸä»£ç†ã‚³ãƒ¼ãƒ‰å€™è£œã‚’æç¤ºã™ã‚‹æ©Ÿèƒ½ã€‚ãƒ­ã‚¸ãƒƒã‚¯ã¨UIã€ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’å®Ÿè£…å®Œäº†ã€‚

### å®Œäº†ã—ãŸé …ç›®

#### 1. **ä»£ç†ã‚³ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯** âœ…
`src/lib/chords/substitute.ts` ã‚’ä½œæˆã—ã€åŒ…æ‹¬çš„ãªä»£ç†ã‚³ãƒ¼ãƒ‰æ¨å¥¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã€‚

**ä¸»ãªæ©Ÿèƒ½**:
- Major key / Minor key ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¯¾å¿œ
- åº¦æ•°ï¼ˆI, ii, iii, IV, V, vi, viiÂ°ï¼‰ã”ã¨ã®ä»£ç†ã‚³ãƒ¼ãƒ‰
- ç†ç”±èª¬æ˜ï¼ˆä¸€æ–‡ï¼‰
- ä»£è¡¨æ›²ã®ä¾‹ç¤ºï¼ˆ2ã€œ3ä»¶ï¼‰

**ä»£ç†ã‚³ãƒ¼ãƒ‰ä¾‹**:

**Major Key**:
- **I (Tonic)** â†’ Imaj7, I6, vimï¼ˆç›¸å¯¾çŸ­èª¿ï¼‰
- **ii (Subdominant)** â†’ iim7, IV
- **IV (Subdominant)** â†’ IVmaj7, ii, ivmï¼ˆå€Ÿç”¨ã‚³ãƒ¼ãƒ‰ï¼‰
- **V (Dominant)** â†’ V7, Vsus4, viiÂ°
- **vi (Tonic)** â†’ vim7, Iï¼ˆç›¸å¯¾é•·èª¿ï¼‰

**Minor Key**:
- **i (Tonic)** â†’ im7, im6, â™­IIIï¼ˆç›¸å¯¾é•·èª¿ï¼‰
- **iv (Subdominant)** â†’ ivm7
- **v/V (Dominant)** â†’ V7ï¼ˆå°éŸ³ã‚’å«ã‚€ï¼‰

```typescript
export type SubstituteChord = {
  chord: string; // "Cmaj7", "Am" ãªã©
  reason: string; // ä»£ç†ã®ç†ç”±ï¼ˆä¸€æ–‡ï¼‰
  examples?: string[]; // ä»£è¡¨æ›²ã®ä¾‹ï¼ˆ2ã€œ3ä»¶ï¼‰
};

export function getSubstitutes(context: ChordContext): SubstituteChord[] {
  // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«åŸºã¥ã„ã¦ä»£ç†ã‚³ãƒ¼ãƒ‰ã‚’æ¨å¥¨
  // æœ€å¤§3ã¤ã¾ã§è¿”ã™
}
```

#### 2. **SubstituteCard UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** âœ…
`src/components/SubstituteCard.tsx` ã‚’ä½œæˆã—ã€ä»£ç†ã‚³ãƒ¼ãƒ‰ã®è¡¨ç¤ºUIã‚’å®Ÿè£…ã€‚

**ä¸»ãªæ©Ÿèƒ½**:
- æŠ˜ã‚ŠãŸãŸã¿å¼ã‚«ãƒ¼ãƒ‰ï¼ˆ`<details>` / `<summary>`ï¼‰
- å„ä»£ç†ã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤º
- ç†ç”±èª¬æ˜ + ä»£è¡¨æ›²ã®ä¾‹ç¤º
- ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰èƒŒæ™¯ï¼‰
- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ

#### 3. **è©¦è´æ©Ÿèƒ½** âœ…
å„ä»£ç†ã‚³ãƒ¼ãƒ‰ã«â–¶ãƒœã‚¿ãƒ³ã‚’å®Ÿè£…ï¼š
- ã‚¯ãƒªãƒƒã‚¯ã§å’ŒéŸ³ã‚’å†ç”Ÿ
- ã‚³ãƒ¼ãƒ‰åã‹ã‚‰ç°¡æ˜“çš„ã«MIDIéŸ³ã‚’ç”Ÿæˆ
- Major/Minor/Diminished/7th/6th/suså¯¾å¿œ
- `lightStrum` ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ10ã€œ20msé…å»¶ï¼‰

```typescript
const playSubstitute = async (sub: SubstituteChord) => {
  const symbol = sub.chord; // "Cmaj7", "Am6" ãªã©
  // ã‚³ãƒ¼ãƒ‰åã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦MIDIéŸ³ã«å¤‰æ›
  const midis = intervals.map(iv => base + iv);
  player.playChord(midis, 'lightStrum', 300);
  track('play_chord', { page, source: 'substitute_preview', chord: symbol });
};
```

#### 4. **Addæ©Ÿèƒ½** âœ…
å„ä»£ç†ã‚³ãƒ¼ãƒ‰ã«ã€Œ+ Addã€ãƒœã‚¿ãƒ³ã‚’å®Ÿè£…ï¼š
- `onAdd` ãƒ—ãƒ­ãƒƒãƒ—ã§è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é€šçŸ¥
- å°†æ¥çš„ã« Chord Progression ã¸ã®è¿½åŠ ã«å¯¾å¿œï¼ˆã‚¹ã‚±ãƒ«ãƒˆãƒ³å®Ÿè£…ï¼‰
- ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã‚«ãƒ©ãƒ¼ã®ãƒœã‚¿ãƒ³ï¼ˆ`bg-emerald-50 dark:bg-emerald-900/30`ï¼‰

#### 5. **Telemetry** âœ…
- `substitute_shown`: ä»£ç†ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºæ™‚ï¼ˆrootPc, quality, degree, countï¼‰
- `substitute_add`: ä»£ç†ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ æ™‚ï¼ˆsubstituteChordï¼‰
- `play_chord`: è©¦è´æ™‚ï¼ˆsource: 'substitute_preview'ï¼‰

#### 6. **Find Chords ãƒšãƒ¼ã‚¸ã¸ã®çµ±åˆ** âœ…
- DiatonicTable ã§ã‚³ãƒ¼ãƒ‰é¸æŠæ™‚ã«è‡ªå‹•è¡¨ç¤º
- ScaleTable ã®ç›´å¾Œã«é…ç½®
- åº¦æ•°ã‚’è‡ªå‹•è¨ˆç®—ï¼ˆselectedCellIdã‹ã‚‰å–å¾—ï¼‰
- Key/Mode ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªå‹•è¨­å®š

### æŠ€è¡“å®Ÿè£…

```typescript
// src/lib/chords/substitute.ts
const context: ChordContext = {
  rootPc: 0, // C
  quality: 'maj',
  degree: 1, // I
  key: { tonic: 0, mode: 'Major' }
};

const subs = getSubstitutes(context);
// [
//   { chord: "Cmaj7", reason: "Richer tonic sound with major 7th", examples: [...] },
//   { chord: "C6", reason: "Jazz tonic with added 6th", examples: [...] },
//   { chord: "Am", reason: "Relative minor shares the same notes", examples: [...] }
// ]
```

### UIæ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¼ Substitute Chords (3)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Alternative chords with similar...  â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Cmaj7                    â–¶ +Addâ”‚  â”‚
â”‚ â”‚ Richer tonic sound...          â”‚  â”‚
â”‚ â”‚ Examples: The Girl from...     â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ C6                       â–¶ +Addâ”‚  â”‚
â”‚ â”‚ Jazz tonic with added 6th...   â”‚  â”‚
â”‚ â”‚ Examples: All the Things...    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Am                       â–¶ +Addâ”‚  â”‚
â”‚ â”‚ Relative minor shares...       â”‚  â”‚
â”‚ â”‚ Examples: Let It Be...         â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ†ã‚¹ãƒˆç¢ºèªé …ç›®
- [x] DiatonicTable ã§ã‚³ãƒ¼ãƒ‰é¸æŠæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [x] 2ã€œ3å€‹ã®ä»£ç†ã‚³ãƒ¼ãƒ‰å€™è£œãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] å„ã‚³ãƒ¼ãƒ‰ã«ç†ç”±èª¬æ˜ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] ä»£è¡¨æ›²ã®ä¾‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆã‚ã‚‹å ´åˆï¼‰
- [x] â–¶ãƒœã‚¿ãƒ³ã§å’ŒéŸ³ãŒå†ç”Ÿã•ã‚Œã‚‹
- [x] + Add ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå‹•ä½œã™ã‚‹
- [x] ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- [x] Telemetryã‚¤ãƒ™ãƒ³ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/lib/chords/substitute.ts`: ä»£ç†ã‚³ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
- `src/components/SubstituteCard.tsx`: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/app/find-chords/page.tsx`: ãƒšãƒ¼ã‚¸çµ±åˆ
- `src/lib/telemetry.ts`: Telemetryã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©

**M3-4å®Œäº†ã€‚ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã€Find Chordsãƒšãƒ¼ã‚¸ã«çµ±åˆã•ã‚Œã¾ã—ãŸã€‚**

---

## M3ç·æ‹¬ âœ… ä¸»è¦æ©Ÿèƒ½å®Œäº†
**å®Ÿè£…æœŸé–“**: 2025-10-03  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`

### å®Œäº†ã—ãŸæ©Ÿèƒ½
1. **M3-1: Scale Table** âœ… å®Œäº†
   - Whyæ–‡ã®å……å®Ÿã€Glossaryçµ±åˆ
   - ã‚¹ã‚±ãƒ¼ãƒ«æ¨å¥¨æ‹¡å……ï¼ˆPhrygian, Alteredè¿½åŠ ï¼‰
   - ã‚¢ãƒ«ãƒšã‚¸ã‚ªå†ç”Ÿæ”¹å–„ï¼ˆä¸Šæ˜‡â†’ä¸‹é™ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
   - Telemetryè¿½åŠ 

2. **M3-2: Chord Forms UIæ”¹å–„** âœ… å®Œäº†
   - ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºæœ€é©åŒ–
   - è©¦è´æ©Ÿèƒ½è¿½åŠ ï¼ˆâ–¶ãƒœã‚¿ãƒ³ï¼‰
   - UIæ”¹å–„ï¼ˆã‚«ãƒ¼ãƒ‰å½¢å¼ã€èª¬æ˜ä»˜ãï¼‰

3. **M3-3: Capoææ¡ˆã®ç¢ºèª** âœ… å®Œäº†
   - Top2è¡¨ç¤ºã€Shapedè¡¨è¨˜
   - æ³¨è¨˜ã®è¦–èªæ€§å‘ä¸Š
   - ã‚¹ã‚³ã‚¢è¡¨ç¤ºè¿½åŠ 

4. **M3-4: åŸºç¤ä»£ç†ã‚³ãƒ¼ãƒ‰** âœ… å®Œäº†
   - ãƒ­ã‚¸ãƒƒã‚¯å®Œæˆ âœ…
   - UIå®Œæˆ âœ…
   - è©¦è´æ©Ÿèƒ½ âœ…
   - Addæ©Ÿèƒ½ï¼ˆã‚¹ã‚±ãƒ«ãƒˆãƒ³ï¼‰ âœ…
   - Telemetry âœ…

### ä¸»ãªæˆæœ
- **Scale Table**: 11ç¨®é¡ã®ã‚¹ã‚±ãƒ¼ãƒ«ã«å¯¾å¿œã€è©³ç´°ãªèª¬æ˜ä»˜ã
- **Chord Forms**: 3ç¨®é¡ã®ãƒ•ã‚©ãƒ¼ãƒ ã™ã¹ã¦ã«è©¦è´æ©Ÿèƒ½
- **Capo**: Top2ã‚’æ˜ç¢ºã«è¡¨ç¤ºã€è¦–èªæ€§å¤§å¹…å‘ä¸Š
- **ä»£ç†ã‚³ãƒ¼ãƒ‰**: åŒ…æ‹¬çš„ãªãƒ­ã‚¸ãƒƒã‚¯ + å®Œå…¨ãªUIå®Ÿè£…

### çµ±è¨ˆ
| é …ç›® | æ•°å€¤ |
|------|------|
| **æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** | 1å€‹ï¼ˆSubstituteCardï¼‰ |
| **æ–°è¦Telemetryã‚¤ãƒ™ãƒ³ãƒˆ** | 2å€‹ï¼ˆsubstitute_shown, substitute_addï¼‰ |
| **å¯¾å¿œã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—** | Major/Minor key ã§ 7åº¦æ•° |
| **æœ€å¤§ä»£ç†ã‚³ãƒ¼ãƒ‰å€™è£œ** | 3å€‹/ã‚³ãƒ¼ãƒ‰ |

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
**M3å®Œå…¨å®Œäº†ï¼æ¬¡ã¯M3.5 Web Lite GA** ã«é€²ã‚€ã€‚

---

## M3.5: Web Lite GAï¼ˆå³ãƒªãƒªãƒ¼ã‚¹ï¼‰ âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-04  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/v3.0-ssot`

### å®Ÿè£…æ¦‚è¦
M3ã¾ã§ã®æ©Ÿèƒ½ã‚’å³ãƒªãƒªãƒ¼ã‚¹å¯èƒ½ãªå½¢ã«æ•´å‚™ã—ã€iOS Proã¸ã®é€å®¢ä½“åˆ¶ã‚’æ§‹ç¯‰ã€‚

### Phase 1: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ•´ç† âœ…

#### A. Melody/Solo Analyze ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ’¤å»
```typescript
// src/app/analyze/page.tsx
import { redirect } from 'next/navigation';

export default function AnalyzePage() {
  redirect('/find-key'); // Chord Progressionã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
}
```

```typescript
// src/components/Nav.tsx
// "Melody/Solo Analyze" ãƒªãƒ³ã‚¯ã‚’å‰Šé™¤
const links = [
  { href: '/find-key', label: 'Chord Progression' },
  { href: '/find-chords', label: 'Find Chords' },
  // { href: '/analyze', label: 'Melody/Solo Analyze' }, // å‰Šé™¤
];
```

**Flag OFFæ–¹é‡ã¨ä¸€è‡´**: éŒ²éŸ³æ©Ÿèƒ½ã¯å®Œå…¨ã«ééœ²å‡º

---

### Phase 2: 6é¢CTAå®Ÿè£… âœ…

#### 1. ãƒ˜ãƒƒãƒ€ãƒ¼CTAï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å¸¸è¨­ï¼‰
```typescript
// src/components/HeaderCta.client.tsx
export default function HeaderCta() {
  return (
    <a href="https://apps.apple.com/app/ototheory"
       className="hidden sm:flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium bg-blue-600 hover:bg-blue-700 text-white rounded-md"
       onClick={() => trackCtaClick('header', { page: window.location.pathname })}>
      <AppleIcon /> Get iOS App
    </a>
  );
}
```

#### 2. ãƒ¢ãƒã‚¤ãƒ«ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼CTAï¼ˆç”»é¢ä¸‹éƒ¨å›ºå®šï¼‰
```typescript
// src/components/MobileStickyCta.client.tsx
export default function MobileStickyCta() {
  const [isVisible, setIsVisible] = useState(false);
  
  useEffect(() => {
    const handleScroll = () => {
      if (window.scrollY > 200) setIsVisible(true);
      else setIsVisible(false);
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  if (!isVisible) return null;
  
  return (
    <div className="fixed bottom-0 left-0 right-0 bg-blue-600 text-white p-3 text-center shadow-lg z-50 animate-slide-up sm:hidden">
      <a href="https://apps.apple.com/app/ototheory" onClick={() => trackCtaClick('sticky')}>
        Download on App Store
      </a>
    </div>
  );
}
```

#### 3. 9-12ã‚³ãƒ¼ãƒ‰åˆ°é”ãƒˆãƒ¼ã‚¹ãƒˆ
```typescript
// src/app/find-key/page.tsx
useEffect(() => {
  const filledCount = slots.filter(s => s !== "").length;
  if (filledCount === 9 && !toastShownRef.current.has('limit_warn')) {
    setToastConfig({
      message: '8+ chords recommended for better accuracy. Want unlimited? Get iOS Pro!',
      type: 'info',
      ctaText: 'Get Pro',
      ctaHref: 'https://apps.apple.com/app/ototheory',
      ctaPlace: 'limit_toast'
    });
    trackToast('limit_warn', { page: 'chord_progression', chordCount: filledCount });
    toastShownRef.current.add('limit_warn');
  } else if (filledCount === 12 && !toastShownRef.current.has('limit_block')) {
    setToastConfig({
      message: '12 chord limit reached (Web Lite). Upgrade to iOS Pro for unlimited!',
      type: 'warning',
      ctaText: 'Get Pro',
      ctaHref: 'https://apps.apple.com/app/ototheory',
      ctaPlace: 'limit_toast'
    });
    trackToast('limit_block', { page: 'chord_progression', chordCount: filledCount });
    toastShownRef.current.add('limit_block');
  }
}, [slots]);
```

#### 4. Sketch 4ä»¶ç›®ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆFreeåˆ¶é™ï¼‰
```typescript
// src/app/find-key/page.tsx - doSaveSketch
const doSaveSketch = async () => {
  try {
    // M3.5: Check Free limit BEFORE saving (directly from localStorage)
    if (!isPro) {
      const existingSketches = JSON.parse(localStorage.getItem('ot_sketches') || '[]');
      
      if (existingSketches.length >= 3) {
        setShowNamePrompt(false);
        setNameInput("");
        setToastConfig({
          message: '3 sketch limit reached! Delete a sketch or upgrade to iOS Pro for unlimited sketches.',
          type: 'warning',
          ctaText: 'Get Pro',
          ctaHref: 'https://apps.apple.com/app/ototheory',
          ctaPlace: 'limit_toast'
        });
        trackToast('limit_block', { page: 'chord_progression', context: 'sketch_limit' });
        return; // ä¿å­˜ã‚’ãƒ–ãƒ­ãƒƒã‚¯
      }
    }
    // é€šå¸¸ã®ä¿å­˜å‡¦ç†...
  }
};
```

#### 5. PNGå¾Œãƒˆãƒ¼ã‚¹ãƒˆ
```typescript
// src/app/find-key/page.tsx - handleExportSketch
const handleExportSketch = async (sk: any) => {
  try {
    // PNGå‡ºåŠ›å‡¦ç†...
    await exportPng(exportCard, 'auto');
    track('export_png', { page: 'chord_progression', source: 'sketch', id: sk.id });

    // M3.5: Show toast after PNG export
    if (!toastShownRef.current.has('png_export')) {
      setToastConfig({
        message: 'PNG exported! Want MIDI export? Get iOS Pro for full DAW integration!',
        type: 'success',
        ctaText: 'Get Pro',
        ctaHref: 'https://apps.apple.com/app/ototheory',
        ctaPlace: 'png_toast'
      });
      toastShownRef.current.add('png_export');
    }
  } catch (e) {
    console.error('Export failed:', e);
  }
};
```

#### 6. ãƒ•ãƒƒã‚¿ãƒ¼QR CTA
```typescript
// src/components/FooterCta.client.tsx
export default function FooterCta() {
  return (
    <div className="mb-6 flex flex-col items-center gap-3">
      <div className="text-sm font-medium text-black/80 dark:text-white/80">
        Get the full experience on iOS
      </div>
      <a href="https://apps.apple.com/app/ototheory"
         className="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium bg-blue-600 hover:bg-blue-700 text-white rounded-lg"
         onClick={() => trackCtaClick('qr')}>
        <AppleIcon /> Download on App Store
      </a>
      <div className="text-xs opacity-60">
        â€¢ Pro features: MIDI export, Section editing, Unlimited sketches
      </div>
    </div>
  );
}
```

---

### Phase 3: Telemetryæ‹¡å¼µ âœ…

#### æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆ
```typescript
// src/lib/telemetry.ts
export type CtaPlace = "header" | "sticky" | "limit_toast" | "png_toast" | "qr";

export type OtEvent =
  | /* æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆ */
  | "cta_appstore_click"; // æ–°è¦

export function trackCtaClick(place: CtaPlace, extra: Record<string, unknown> = {}) {
  track("cta_appstore_click", { place, ...extra });
}
```

#### ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ï¼ˆM3.5è¿½åŠ åˆ†ï¼‰
| ã‚¤ãƒ™ãƒ³ãƒˆ | ç™ºç«æ¡ä»¶ | placeå€¤ |
|---------|---------|---------|
| `cta_appstore_click` | ãƒ˜ãƒƒãƒ€ãƒ¼CTAã‚¯ãƒªãƒƒã‚¯ | `header` |
| `cta_appstore_click` | ãƒ¢ãƒã‚¤ãƒ«ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼CTAã‚¯ãƒªãƒƒã‚¯ | `sticky` |
| `cta_appstore_click` | åˆ¶é™ãƒˆãƒ¼ã‚¹ãƒˆCTAã‚¯ãƒªãƒƒã‚¯ | `limit_toast` |
| `cta_appstore_click` | PNGãƒˆãƒ¼ã‚¹ãƒˆCTAã‚¯ãƒªãƒƒã‚¯ | `png_toast` |
| `cta_appstore_click` | ãƒ•ãƒƒã‚¿ãƒ¼CTAã‚¯ãƒªãƒƒã‚¯ | `qr` |

---

### ä¸»ãªæˆæœ

#### UI/UXæ”¹å–„
- âœ… éŒ²éŸ³æ©Ÿèƒ½ã‚’å®Œå…¨ã«ééœ²å‡ºï¼ˆFlag OFFæ–¹é‡ã¨ä¸€è‡´ï¼‰
- âœ… 6ç®‡æ‰€ã‹ã‚‰iOS App Storeã¸ã®å°ç·š
- âœ… åˆ¶é™åˆ°é”æ™‚ã®æ˜ç¢ºãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- âœ… ãƒ¢ãƒã‚¤ãƒ«UXæœ€é©åŒ–ï¼ˆã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼CTAã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€£å‹•ï¼‰

#### æŠ€è¡“å®Ÿè£…
- âœ… Toasté€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ3ç¨®é¡: info/warning/successï¼‰
- âœ… localStorageç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§Freeåˆ¶é™ãƒã‚§ãƒƒã‚¯
- âœ… Sketchåã®PNG Exportåæ˜ 
- âœ… CTAã‚¤ãƒ™ãƒ³ãƒˆã®å®Œå…¨ãªè¨ˆæ¸¬

#### ãƒã‚°ä¿®æ­£
- âœ… Sketch 4ä»¶ç›®ãŒä¿å­˜ã§ãã¦ã—ã¾ã†å•é¡Œã‚’ä¿®æ­£
  - åŸå› : `isPro`ã®ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ
  - è§£æ±º: localStorageç›´æ¥èª­ã¿å–ã‚Šã§ä¿å­˜å‰ãƒã‚§ãƒƒã‚¯
- âœ… PNG Exportã§sketchåãŒåæ˜ ã•ã‚Œãªã„å•é¡Œã‚’ä¿®æ­£
  - åŸå› : `nameInput` stateãŒç©º
  - è§£æ±º: `currentExportName` stateè¿½åŠ 

---

### DoDé”æˆçŠ¶æ³

| é …ç›® | çŠ¶æ…‹ | å‚™è€ƒ |
|-----|------|------|
| ãƒ—ãƒªã‚»ãƒƒãƒˆâ†’ãƒ«ãƒ¼ãƒ—â†’PNGå‡ºåŠ›ãŒ3ã‚¯ãƒªãƒƒã‚¯ä»¥å†… | âœ… | 1) Preseté¸æŠ â†’ 2) Play â†’ 3) Export |
| `export_png`ãŒ1å›ã®ã¿ç™ºç« | âœ… | `toastShownRef`ã§åˆ¶å¾¡ |
| `toast_shown`ã§Proèª˜å°ç¢ºèªå¯èƒ½ | âœ… | `limit_warn`/`limit_block` |
| `cta_appstore_click{place}`è¨ˆæ¸¬å¯èƒ½ | âœ… | 5ç®‡æ‰€ã™ã¹ã¦ã‹ã‚‰ç™ºç« |
| Webâ†’iOSãƒ•ã‚¡ãƒãƒ«å¯è¦–åŒ– | âœ… | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç¢ºèªå¯èƒ½ |
| Analyzeééœ²å‡º | âœ… | `/analyze`ã¯`/find-key`ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ |
| 6é¢CTAå‹•ä½œ | âœ… | Header/Sticky/ToastÃ—3/Footer |

---

### çµ±è¨ˆ

| é …ç›® | æ•°å€¤ |
|-----|------|
| **æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** | 3å€‹ï¼ˆToast, HeaderCta, FooterCta, MobileStickyCtaï¼‰ |
| **æ–°è¦Telemetryã‚¤ãƒ™ãƒ³ãƒˆ** | 1å€‹ï¼ˆcta_appstore_clickï¼‰ |
| **CTAç®‡æ‰€** | 6ç®‡æ‰€ |
| **åˆ¶é™ãƒã‚§ãƒƒã‚¯ç®‡æ‰€** | 3ç®‡æ‰€ï¼ˆ9ã‚³ãƒ¼ãƒ‰/12ã‚³ãƒ¼ãƒ‰/Sketch 4ä»¶ç›®ï¼‰ |

---

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

#### æ–°è¦ä½œæˆ
- `src/components/Toast.client.tsx`: Toasté€šçŸ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/components/HeaderCta.client.tsx`: ãƒ˜ãƒƒãƒ€ãƒ¼CTA
- `src/components/FooterCta.client.tsx`: ãƒ•ãƒƒã‚¿ãƒ¼CTA
- `src/components/MobileStickyCta.client.tsx`: ãƒ¢ãƒã‚¤ãƒ«ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼CTA

#### ä¸»è¦æ›´æ–°
- `src/app/find-key/page.tsx`: åˆ¶é™ãƒã‚§ãƒƒã‚¯ã€Toastè¡¨ç¤ºã€Exportåä¿®æ­£
- `src/app/analyze/page.tsx`: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Ÿè£…
- `src/components/Nav.tsx`: Melody/Solo Analyzeå‰Šé™¤
- `src/app/layout.tsx`: CTAçµ±åˆ
- `src/lib/telemetry.ts`: `cta_appstore_click`è¿½åŠ 
- `src/app/globals.css`: Toast/CTAç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

---

### ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°

å®Ÿè£…ä¸­ã«ç™ºè¦‹ãƒ»ä¿®æ­£ã—ãŸå•é¡Œ:

1. **isProåˆ¤å®šå•é¡Œ**
   - ç—‡çŠ¶: Sketch 4ä»¶ç›®ãŒä¿å­˜ã§ãã¦ã—ã¾ã†
   - åŸå› : `localStorage.isPro = "1"` ãŒãƒ†ã‚¹ãƒˆç”¨ã«æ®‹ã£ã¦ã„ãŸ
   - è§£æ±º: localStorageç›´æ¥èª­ã¿å–ã‚Š + ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¿½åŠ 

2. **PNG Exportåå‰å•é¡Œ**
   - ç—‡çŠ¶: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - åŸå› : `nameInput` stateãŒãƒ­ãƒ¼ãƒ‰å¾Œã«ç©º
   - è§£æ±º: `currentExportName` stateè¿½åŠ ã€Exportå‰ã«ã‚»ãƒƒãƒˆ

---

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
**M3.5å®Œå…¨å®Œäº†ï¼Web Lite GAãƒªãƒªãƒ¼ã‚¹æº–å‚™å®Œäº†ã€‚æ¬¡ã¯M4: iOS v1ï¼ˆProã®æ ¸ï¼‰** ã«é€²ã‚€ã€‚

**Policy & Legalè¿½åŠ ** (2025-10-04):
- `/docs/SSOT/OtoTheory_Privacy_Legal_SSOT.md` ä½œæˆ
- 9ã¤ã®ãƒãƒªã‚·ãƒ¼ãƒšãƒ¼ã‚¸å®šç¾©ï¼ˆPrivacy, Terms, Subscription, Support, Account Deletion, Security, Accessibility, Transparency, Licensesï¼‰
- JP/ENä½µè¨˜ã€App Storeå¯©æŸ»å¯¾å¿œ
- ãƒ•ãƒƒã‚¿ãƒ¼å¸¸è¨­ãƒªãƒ³ã‚¯ + Appå†…ã€Œè¨­å®šã€ã‹ã‚‰1ã‚¿ãƒƒãƒ—é·ç§»
- å®Ÿè£…ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆä»˜ãï¼ˆNext.js/SwiftUIï¼‰

---

## M4 Week 1: iOSåŸºç›¤æ§‹ç¯‰ âœ… å®Œäº†
**å®Ÿè£…æ—¥**: 2025-10-04  
**ãƒ–ãƒ©ãƒ³ãƒ**: ãªã—ï¼ˆiOS ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–ï¼‰  
**ç›®æ¨™**: iOSé–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— + å…±é€šãƒ­ã‚¸ãƒƒã‚¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ– + JavaScriptCore Bridge + Audio Engine

### å®Ÿè£…æ¦‚è¦
iOS ã‚¢ãƒ—ãƒªã®åŸºç›¤ã‚’æ§‹ç¯‰ã€‚å…±é€šãƒ­ã‚¸ãƒƒã‚¯ã‚’ TypeScript ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦æŠ½å‡ºã—ã€JavaScriptCore çµŒç”±ã§ Swift ã‹ã‚‰å‘¼ã³å‡ºã™ä»•çµ„ã¿ã‚’å®Ÿè£…ã€‚ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¨ãƒ³ã‚¸ãƒ³ã‚‚å®Ÿè£…ã—ã€å®Ÿæ©Ÿã§ã®éŸ³å‡ºã—ã«æˆåŠŸã€‚

---

### A. å…±é€šãƒ­ã‚¸ãƒƒã‚¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (`packages/core`) âœ…

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
/Users/nh/App/OtoTheory/packages/core/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ README.md
â”œâ”€â”€ .gitignore
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ music-theory/
â”‚   â”‚   â”œâ”€â”€ constants.ts    // PC_NAMES, mod12, transpose
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ chords/
â”‚   â”‚   â”œâ”€â”€ types.ts        // ChordSpec, Family, ParsedChord
â”‚   â”‚   â””â”€â”€ index.ts        // parseChordSymbol, getDiatonicChords (ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼)
â”‚   â””â”€â”€ index.ts            // ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â””â”€â”€ dist/                   // tsc ãƒ“ãƒ«ãƒ‰å‡ºåŠ›
```

#### å®Ÿè£…å†…å®¹

**1. `music-theory/constants.ts`**
```typescript
export const PC_NAMES = ['C', 'C#', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'Ab', 'A', 'Bb', 'B'] as const;
export const PITCH_CLASS_COUNT = 12;
export const DEFAULT_MIDI_OCTAVE = 60;

export function mod12(pc: number): number {
  return ((pc % 12) + 12) % 12;
}

export function pcToName(pc: number): string {
  return PC_NAMES[mod12(pc)];
}

export function nameToPc(name: string): number {
  const idx = PC_NAMES.indexOf(name as any);
  return idx >= 0 ? idx : 0;
}
```

**2. `music-theory/index.ts`**
```typescript
export * from './constants';
import { mod12 } from './constants';

export function transpose(pc: number, semitones: number): number {
  return mod12(pc + semitones);
}

export function interval(from: number, to: number): number {
  return mod12(to - from);
}

// ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
export function normalizeChordSymbol(symbol: string): string {
  return symbol.trim();
}
```

**3. `chords/types.ts`**
```typescript
export type Plan = 'free' | 'pro';
export type NotationStyle = 'english' | 'compact' | 'jazz';
export type Family = 'maj'|'min'|'dom'|'sus'|'dim'|'aug'|'power';

export type ChordSpec = {
  root: string;
  quality: string;
  bass?: string;
  extensions?: string[];
};

export type ChordContext = {
  rootPc: number;
  quality: string;
  degree?: number;
  key?: { tonic: number; mode: string };
};

export type ParsedChord = ChordSpec & {
  family: Family;
  pitches: number[];
};
```

**4. `chords/index.ts`**
```typescript
export * from './types';

// ç°¡æ˜“å®Ÿè£…ï¼ˆWeek 2ã§æ‹¡å……äºˆå®šï¼‰
export function parseChordSymbol(symbol: string): { root: string; quality: string } | null {
  const match = symbol.match(/^([A-G](?:#|b)?)(.*)$/);
  if (!match) return null;
  return { root: match[1], quality: match[2] || '' };
}

export function getDiatonicChords(key: string, scale: string): string[] {
  return getDiatonicChordSymbols(key, scale);
}
```

#### ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰
```bash
cd /Users/nh/App/OtoTheory/packages/core
npm run build  # â†’ dist/ ã« JS + .d.ts ç”Ÿæˆ
```

#### JS ãƒãƒ³ãƒ‰ãƒ«ç”Ÿæˆ
```bash
cd /Users/nh/App/OtoTheory
npx esbuild packages/core/dist/index.js \
  --bundle \
  --format=iife \
  --global-name=OtoCore \
  --platform=browser \
  --outfile=ototheory-ios-resources/ototheory-core.js
```

**æˆæœç‰©**: `/Users/nh/App/OtoTheory/ototheory-ios-resources/ototheory-core.js` (2.2KB)

---

### B. JavaScriptCore Bridge (`TheoryBridge.swift`) âœ…

**ãƒ‘ã‚¹**: `/Users/nh/App/OtoTheory/OtoTheory-iOS/OtoTheory/Core/Theory/TheoryBridge.swift`

#### å®Ÿè£…å†…å®¹

```swift
import Foundation
import JavaScriptCore

class TheoryBridge {
    private let context: JSContext
    
    init?() {
        guard let context = JSContext() else {
            print("âŒ Failed to create JSContext")
            return nil
        }
        self.context = context
        
        // JS Error Handler
        context.exceptionHandler = { context, exception in
            if let exc = exception {
                print("âŒ JS Error: \(exc)")
            }
        }
        
        // Load JS Bundle
        guard let jsPath = Bundle.main.path(forResource: "ototheory-core", ofType: "js") else {
            print("âŒ JS file not found in bundle")
            return nil
        }
        
        guard let jsCode = try? String(contentsOfFile: jsPath) else {
            print("âŒ Failed to read JS file")
            return nil
        }
        
        print("âœ… JS file loaded, size: \(jsCode.count) bytes")
        context.evaluateScript(jsCode)
        
        // Check OtoCore
        let checkScript = """
        (function() {
            if (typeof OtoCore === 'undefined') {
                return 'OtoCore is undefined';
            }
            const keys = Object.keys(OtoCore);
            return 'OtoCore keys: ' + keys.join(', ');
        })()
        """
        
        if let checkResult = context.evaluateScript(checkScript) {
            print("ğŸ” \(checkResult.toString() ?? "nil")")
        }
        
        print("âœ… TheoryBridge initialized successfully")
    }
    
    func parseChord(_ symbol: String) -> ChordInfo? {
        let script = """
        (function() {
            try {
                const result = OtoCore.parseChord('\(symbol)');
                return JSON.stringify(result);
            } catch (e) {
                return JSON.stringify({ error: e.message });
            }
        })()
        """
        
        guard let result = context.evaluateScript(script),
              let jsonString = result.toString(),
              let jsonData = jsonString.data(using: .utf8),
              let dict = try? JSONSerialization.jsonObject(with: jsonData) as? [String: Any] else {
            print("âŒ Failed to parse chord result")
            return nil
        }
        
        if dict["error"] != nil {
            print("âŒ JS Error in parseChord: \(dict["error"] ?? "unknown")")
            return nil
        }
        
        return ChordInfo(
            root: dict["root"] as? String ?? "",
            quality: dict["quality"] as? String ?? "",
            bass: dict["bass"] as? String
        )
    }
    
    func getDiatonicChords(key: String, scale: String) -> [String] {
        let script = """
        (function() {
            try {
                const result = OtoCore.getDiatonicChords('\(key)', '\(scale)');
                return JSON.stringify(result);
            } catch (e) {
                return JSON.stringify([]);
            }
        })()
        """
        
        guard let result = context.evaluateScript(script),
              let jsonString = result.toString(),
              let jsonData = jsonString.data(using: .utf8),
              let array = try? JSONSerialization.jsonObject(with: jsonData) as? [String] else {
            print("âŒ Failed to parse diatonic chords result")
            return []
        }
        
        print("âœ… getDiatonicChords returned \(array.count) chords: \(array)")
        return array
    }
}

struct ChordInfo {
    let root: String
    let quality: String
    let bass: String?
}
```

#### ãƒ†ã‚¹ãƒˆçµæœï¼ˆå®Ÿæ©Ÿï¼‰ âœ…

**âœ… parseChord æˆåŠŸ**:
- `parseChord('Cmaj7')` â†’ Root: "C", Quality: "maj7" âœ…

**âœ… getDiatonicChords æˆåŠŸ** (Week 2 Day 1 å®Œäº†):
- `getDiatonicChords('C', 'ionian')` â†’ `["C", "Dm", "Em", "F", "G", "Am", "Bdim"]` âœ…
- ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º: 2.2KB (IIFEå½¢å¼)
- OtoCore éœ²å‡ºç¢ºèª: 12å€‹ã®é–¢æ•° exported âœ…

---

### C. Audio Engine (`AudioPlayer.swift`) âœ…

**ãƒ‘ã‚¹**: `/Users/nh/App/OtoTheory/OtoTheory-iOS/OtoTheory/Core/Audio/AudioPlayer.swift`

#### å®Ÿè£…å†…å®¹

```swift
import AVFoundation

@MainActor
class AudioPlayer: ObservableObject {
    private var engine: AVAudioEngine
    private var sampler: AVAudioUnitSampler
    private var isSetup = false
    
    @Published var currentInstrument: String = "Acoustic Guitar (Steel)"
    
    init() {
        engine = AVAudioEngine()
        sampler = AVAudioUnitSampler()
        setupAudio()
    }
    
    private func setupAudio() {
        // Attach sampler to engine
        engine.attach(sampler)
        engine.connect(sampler, to: engine.mainMixerNode, format: nil)
        
        // Load default SoundFont
        loadInstrument(program: 25) // Acoustic Guitar (steel)
        
        // Start engine
        do {
            try engine.start()
            isSetup = true
            print("âœ… Audio Engine started successfully")
        } catch {
            print("âŒ Failed to start audio engine: \(error)")
        }
    }
    
    private func loadInstrument(program: UInt8) {
        let soundFontURL = URL(fileURLWithPath: 
            "/System/Library/Components/CoreAudio.component/Contents/Resources/gs_instruments.dls")
        
        do {
            try sampler.loadSoundBankInstrument(
                at: soundFontURL,
                program: program,
                bankMSB: UInt8(kAUSampler_DefaultMelodicBankMSB),
                bankLSB: UInt8(kAUSampler_DefaultBankLSB)
            )
            print("âœ… Instrument loaded: program \(program)")
        } catch {
            print("âŒ Failed to load instrument: \(error)")
        }
    }
    
    func playNote(midiNote: UInt8, velocity: UInt8 = 100, duration: Double = 1.0) {
        guard isSetup else { return }
        sampler.startNote(midiNote, withVelocity: velocity, onChannel: 0)
        
        Task { @MainActor in
            try? await Task.sleep(nanoseconds: UInt64(duration * 1_000_000_000))
            self.sampler.stopNote(midiNote, onChannel: 0)
        }
    }
    
    func playChord(midiNotes: [UInt8], velocity: UInt8 = 100, duration: Double = 2.0, strum: Bool = false) {
        guard isSetup else { return }
        
        if strum {
            for (index, note) in midiNotes.enumerated() {
                let delay = Double(index) * 0.02 // 20ms per note
                Task { @MainActor in
                    try? await Task.sleep(nanoseconds: UInt64(delay * 1_000_000_000))
                    self.sampler.startNote(note, withVelocity: velocity, onChannel: 0)
                }
            }
        } else {
            for note in midiNotes {
                sampler.startNote(note, withVelocity: velocity, onChannel: 0)
            }
        }
        
        Task { @MainActor in
            try? await Task.sleep(nanoseconds: UInt64(duration * 1_000_000_000))
            for note in midiNotes {
                self.sampler.stopNote(note, onChannel: 0)
            }
        }
    }
}

// Instrument presets
extension AudioPlayer {
    enum Instrument {
        case acousticGuitarSteel
        case acousticGuitarNylon
        case electricGuitarClean
        case distortionGuitar
        case acousticGrandPiano
        case electricBass
        
        var program: UInt8 {
            switch self {
            case .acousticGuitarSteel: return 25
            case .acousticGuitarNylon: return 24
            case .electricGuitarClean: return 27
            case .distortionGuitar: return 30
            case .acousticGrandPiano: return 0
            case .electricBass: return 33
            }
        }
    }
}
```

#### ãƒ†ã‚¹ãƒˆçµæœï¼ˆå®Ÿæ©Ÿï¼‰

**âœ… æˆåŠŸ**:
- "Play C" ãƒœã‚¿ãƒ³ â†’ C4 (MIDI 60) ã®éŸ³ãŒé³´ã£ãŸ âœ…
- "Play Chord" ãƒœã‚¿ãƒ³ â†’ C ãƒ¡ã‚¸ãƒ£ãƒ¼ã‚³ãƒ¼ãƒ‰ (C-E-G) ãŒã‚¹ãƒˆãƒ©ãƒ ã§é³´ã£ãŸ âœ…

---

### D. UIå®Ÿè£… (`ContentView.swift`) âœ…

**ãƒ‘ã‚¹**: `/Users/nh/App/OtoTheory/OtoTheory-iOS/OtoTheory/ContentView.swift`

#### å®Ÿè£…å†…å®¹

```swift
import SwiftUI

struct ContentView: View {
    @State private var testResult = "Tap 'Test Bridge' to start..."
    @StateObject private var audioPlayer = AudioPlayer()
    
    var body: some View {
        ScrollView {
            VStack(spacing: 20) {
                Image(systemName: "music.note")
                    .font(.system(size: 60))
                    .foregroundColor(.blue)
                
                Text("OtoTheory iOS")
                    .font(.largeTitle)
                    .fontWeight(.bold)
                
                Text(testResult)
                    .font(.body)
                    .multilineTextAlignment(.center)
                    .padding()
                    .frame(maxWidth: .infinity)
                    .background(Color.gray.opacity(0.1))
                    .cornerRadius(10)
                
                VStack(spacing: 12) {
                    Button("Test Bridge") { testBridge() }
                        .buttonStyle(.borderedProminent)
                        .controlSize(.large)
                        .frame(maxWidth: .infinity)
                    
                    Button("Play C") { playTestNote() }
                        .buttonStyle(.bordered)
                        .controlSize(.large)
                        .frame(maxWidth: .infinity)
                    
                    Button("Play Chord") { playTestChord() }
                        .buttonStyle(.bordered)
                        .controlSize(.large)
                        .frame(maxWidth: .infinity)
                }
                .padding(.horizontal)
            }
            .padding()
        }
    }
    
    func testBridge() {
        testResult = "Testing..."
        guard let bridge = TheoryBridge() else {
            testResult = "âŒ Failed to initialize TheoryBridge"
            return
        }
        
        var results: [String] = []
        
        // Test 1: Chord parsing
        if let chord = bridge.parseChord("Cmaj7") {
            results.append("âœ… parseChord('Cmaj7')")
            results.append("   Root: \(chord.root)")
            results.append("   Quality: \(chord.quality)")
        } else {
            results.append("âŒ Failed to parse chord")
        }
        
        // Test 2: Diatonic chords
        let diatonic = bridge.getDiatonicChords(key: "C", scale: "ionian")
        if !diatonic.isEmpty {
            results.append("âœ… getDiatonicChords('C', 'ionian')")
            results.append("   \(diatonic.joined(separator: ", "))")
        } else {
            results.append("âŒ Failed to get diatonic chords")
        }
        
        testResult = results.joined(separator: "\n")
    }
    
    func playTestNote() {
        audioPlayer.playNote(midiNote: 60, duration: 1.0)
        testResult = "ğŸµ Playing C4..."
    }
    
    func playTestChord() {
        let cMajor: [UInt8] = [60, 64, 67]
        audioPlayer.playChord(midiNotes: cMajor, duration: 2.0, strum: true)
        testResult = "ğŸ¸ Playing C Major chord..."
    }
}
```

---

### E. è§£æ±ºã—ãŸæŠ€è¡“èª²é¡Œ âœ…

#### 1. Swift 6 ä¸¦è¡Œæ€§ã‚¨ãƒ©ãƒ¼
**å•é¡Œ**: `Task` å†…ã§ `@MainActor` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**è§£æ±º**:
```swift
Task { @MainActor in
    try? await Task.sleep(nanoseconds: ...)
    self.sampler.stopNote(midiNote, onChannel: 0)
}
```

#### 2. AVAudioUnitSampler API ã‚¨ãƒ©ãƒ¼
**å•é¡Œ**: `loadInstrument(at:program:bankMSB:bankLSB:)` ãŒå­˜åœ¨ã—ãªã„

**è§£æ±º**: æ­£ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰åã¯ `loadSoundBankInstrument(at:program:bankMSB:bankLSB:)`

#### 3. Xcode Code Signing
**å•é¡Œ**: "Signing for 'OtoTheory' requires a development team."

**è§£æ±º**: Xcode > Signing & Capabilities > Team ã‚’è¨­å®š

#### 4. JS Bundle ãŒè¦‹ã¤ã‹ã‚‰ãªã„
**å•é¡Œ**: `TheoryBridge` ãŒ `ototheory-core.js` ã‚’èª­ã¿è¾¼ã‚ãªã„

**è§£æ±º**: Xcode ã§ `ototheory-core.js` ã® "Target Membership" ã‚’ãƒã‚§ãƒƒã‚¯

#### 5. `getDiatonicChords` ãŒç©ºé…åˆ—ã‚’è¿”ã™
**åŸå› **: JavaScript å®Ÿè£…ãŒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆ`return []`ï¼‰

**å¯¾å¿œ**: Week 2 ã§å®Ÿè£…äºˆå®šï¼ˆäºˆæƒ³é€šã‚Šã®å‹•ä½œï¼‰

---

### F. çµ±è¨ˆ

| é …ç›® | æ•°å€¤ |
|-----|------|
| **æ–°è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸** | 1å€‹ï¼ˆ`packages/core`ï¼‰ |
| **æ–°è¦Swiftãƒ•ã‚¡ã‚¤ãƒ«** | 3å€‹ï¼ˆTheoryBridge, AudioPlayer, ContentViewæ›´æ–°ï¼‰ |
| **å®Ÿè£…é–¢æ•°ï¼ˆJSï¼‰** | 6å€‹ï¼ˆmod12, transpose, parseChordSymbol, getDiatonicChords ç­‰ï¼‰ |
| **å®Ÿè£…é–¢æ•°ï¼ˆSwiftï¼‰** | 5å€‹ï¼ˆparseChord, getDiatonicChords, playNote, playChord, loadInstrumentï¼‰ |
| **æ¥½å™¨ãƒ—ãƒªã‚»ãƒƒãƒˆ** | 6ç¨®é¡ï¼ˆSteel, Nylon, Clean, Distortion, Piano, Bassï¼‰ |
| **ãƒ†ã‚¹ãƒˆæ¸ˆã¿æ©Ÿèƒ½** | 3å€‹ï¼ˆChord Parsing âœ…, Audio Playback âœ…, **getDiatonicChords âœ…**ï¼‰ |
| **ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º** | 2.2KBï¼ˆIIFEå½¢å¼ã€ES2020ã€minifyæ¸ˆã¿ï¼‰ |

---

### G. é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

#### æ–°è¦ä½œæˆ
- `packages/core/package.json`
- `packages/core/tsconfig.json`
- `packages/core/src/music-theory/constants.ts`
- `packages/core/src/music-theory/index.ts`
- `packages/core/src/theory/diatonic.ts` (**Week 2 Day 1 è¿½åŠ **)
- `packages/core/src/chords/types.ts`
- `packages/core/src/chords/index.ts`
- `packages/core/src/index.ts`
- `ototheory-ios-resources/ototheory-core.js` (2.2KB)
- `OtoTheory-iOS/OtoTheory/Core/Theory/TheoryBridge.swift`
- `OtoTheory-iOS/OtoTheory/Core/Audio/AudioPlayer.swift`

#### ä¸»è¦æ›´æ–°
- `OtoTheory-iOS/OtoTheory/ContentView.swift`

---

### H. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆæœ¬ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰**:
- ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`v3.1_Implementation_Report.md`ï¼‰ã«M4 Week 1å®Œäº†ã¨Week 2 Day 1å®Œäº†ã®å†…å®¹ã‚’çµ±åˆæ¸ˆã¿

**è£œåŠ©ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [`M4_Xcode_Setup_Guide.md`](./M4_Xcode_Setup_Guide.md) - åˆå›Xcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã®è©³ç´°æ‰‹é †ï¼ˆå‚è€ƒç”¨ï¼‰
- [`M4_Week2_Tasks.md`](./M4_Week2_Tasks.md) - Week 2ã‚¿ã‚¹ã‚¯è©³ç´°ï¼ˆDay 2-5ã®äºˆå®šï¼‰

**SSOT**:
- [`v3.1_Roadmap_Milestones.md`](../SSOT/v3.1_Roadmap_Milestones.md) - M4ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³å…¨ä½“
- [`v3.1_Implementation_SSOT.md`](../SSOT/v3.1_Implementation_SSOT.md) - å®Ÿè£…åŸºæº–

---

### I. M4 Week 2 å®Œäº†ï¼ˆ2025-10-04ï¼‰âœ…

#### Day 1: getDiatonicChords å®Ÿè£… âœ…
1. âœ… **éŸ³å‡ºã—ãƒ†ã‚¹ãƒˆ**: "Play Chord" ãƒœã‚¿ãƒ³å‹•ä½œç¢ºèªå®Œäº†
2. âœ… **`getDiatonicChords` å®Ÿè£…å®Œäº†**: C ionian â†’ `["C", "Dm", "Em", "F", "G", "Am", "Bdim"]`
   - `packages/core/src/theory/diatonic.ts` æ–°è¦å®Ÿè£…
   - TypeScript â†’ ES2020 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¤‰æ›ï¼ˆ`tsconfig.json` æ›´æ–°ï¼‰
   - esbuild IIFE ãƒãƒ³ãƒ‰ãƒ«ç”Ÿæˆï¼ˆ`--platform=browser`ï¼‰
   - Swift â†” JS é€šä¿¡ç¢ºç«‹ãƒ»OtoCore ã‚°ãƒ­ãƒ¼ãƒãƒ«éœ²å‡ºç¢ºèª
   - **è§£æ±ºã—ãŸå•é¡Œ**: CommonJS exports ã‚¨ãƒ©ãƒ¼ã€Xcode å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§ã€ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥

#### Day 2-3: Tab Bar Navigation å®Ÿè£… âœ…
3. âœ… **Tab Bar Navigation**: 3ç”»é¢åˆ‡ã‚Šæ›¿ãˆï¼ˆChord Progression / Find Chords / Referenceï¼‰
   - `MainTabView.swift` æ–°è¦ä½œæˆï¼ˆTabç®¡ç†ï¼‰
   - `ProgressionView.swift` æ–°è¦ä½œæˆï¼ˆChord Progressionç”»é¢ï¼‰
   - `FindChordsView.swift` æ–°è¦ä½œæˆï¼ˆKey/Scaleé¸æŠUIï¼‰
   - `ReferenceView.swift` æ–°è¦ä½œæˆï¼ˆãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ç”»é¢ã‚¹ã‚±ãƒ«ãƒˆãƒ³ï¼‰
   - `ContentView.swift` æ›´æ–°ï¼ˆMainTabViewã‚’è¡¨ç¤ºï¼‰

#### Day 4: 12-Slot UI å®Ÿè£… âœ…
4. âœ… **12-Slot Progression Builder**: 
   - 12ã‚¹ãƒ­ãƒƒãƒˆã®ã‚°ãƒªãƒƒãƒ‰UIï¼ˆ4åˆ—Ã—3è¡Œï¼‰
   - ã‚¹ãƒ­ãƒƒãƒˆç•ªå·ãƒãƒƒã‚¸ï¼ˆå·¦ä¸Šï¼‰
   - ã‚«ãƒ¼ã‚½ãƒ«ç®¡ç†ï¼ˆç·‘è‰²æ ã€è‡ªå‹•ç§»å‹•ï¼‰
   - Resetæ©Ÿèƒ½

#### Day 5: ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªçµ±åˆ & Webç‰ˆUXå®Œå…¨æº–æ‹  âœ…
5. âœ… **ã‚³ãƒ¼ãƒ‰å†ç”Ÿæ©Ÿèƒ½**:
   - ç°¡æ˜“ã‚³ãƒ¼ãƒ‰â†’MIDIå¤‰æ›ï¼ˆ12ã‚­ãƒ¼ã€7ç¨®é¡ã®Quickå¯¾å¿œï¼‰
   - ã‚¹ãƒ­ãƒƒãƒˆã‚¿ãƒƒãƒ—ã§å†ç”Ÿï¼ˆ2ç§’ã€ã‚¹ãƒˆãƒ©ãƒ 20msï¼‰
   - Previewå†ç”Ÿï¼ˆ1.5ç§’ï¼‰

6. âœ… **Webç‰ˆUXå®Œå…¨æº–æ‹ **:
   - **Root + Quick é¸æŠæ–¹å¼**ï¼ˆQuality â†’ Quick ã«åç§°çµ±ä¸€ï¼‰
   - Quick: Major, m, 7, maj7, m7, dim, sus4ï¼ˆaugé™¤å¤–ã€Proç”¨ï¼‰
   - **Preview + Add å¸¸æ™‚è¡¨ç¤º**ï¼ˆåˆæœŸçŠ¶æ…‹ã‹ã‚‰è¡¨ç¤ºï¼‰
   - **ã‚¹ãƒ­ãƒƒãƒˆå‰Šé™¤ãƒœã‚¿ãƒ³**ï¼ˆå³ä¸Šãƒãƒ„ãƒãƒ¼ã‚¯ã€`xmark.circle.fill`ï¼‰
   - **NavigationTitleå‰Šé™¤**ï¼ˆå…¨ç”»é¢ã€ç”»é¢é ˜åŸŸæœ€å¤§åŒ–ï¼‰
   - **ã‚¿ãƒ–å**: "Chord Progression" ã«çµ±ä¸€

#### æŠ€è¡“èª²é¡Œè§£æ±º
- ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆä¿®æ­£ï¼ˆä½™åˆ†ãªé–‰ã˜æ‹¬å¼§å‰Šé™¤ï¼‰
- ã‚¹ã‚³ãƒ¼ãƒ—ã‚¨ãƒ©ãƒ¼è§£æ±º
- TheoryBridgeéæ¨å¥¨APIä¿®æ­£ï¼ˆ`String(contentsOfFile:encoding:)`ï¼‰

---

### J. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆWeek 3ä»¥é™ï¼‰

**Week 3-4ï¼ˆäºˆå®šï¼‰**:
- Diatonic Tableï¼ˆãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºï¼‰
- Fretboardï¼ˆã‚®ã‚¿ãƒ¼æŒ‡æ¿å¯è¦–åŒ–ï¼‰
- Drag & Dropï¼ˆã‚¹ãƒ­ãƒƒãƒˆå…¥ã‚Œæ›¿ãˆï¼‰
- Progression Playbackï¼ˆPlay/Stop/BPMï¼‰
- Instrument Selectionï¼ˆéŸ³è‰²é¸æŠï¼‰

**Week 5ï¼ˆäºˆå®šï¼‰**:
- **Presetsï¼ˆFree 20ç¨®ï¼‰**
- Auto-loop playback
- Sketchï¼ˆ3ä»¶ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰

**M4-B: iOS Proï¼ˆWeek 5-6äºˆå®šï¼‰**:
- **Presets Pro 30ç¨®è¿½åŠ **ï¼ˆåˆè¨ˆ50ç¨®ï¼‰
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç·¨é›†
- MIDIå‡ºåŠ›
- Sketchç„¡åˆ¶é™ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ï¼‰
- IAPï¼ˆÂ¥490/æœˆï¼‰

---

### K. ãƒ—ãƒªã‚»ãƒƒãƒˆä»•æ§˜å¤‰æ›´ï¼ˆ2025-10-04ï¼‰âœ…

#### å¤‰æ›´å†…å®¹
**Free / Pro åˆ†é›¢**:
- **Free**: æ—¢å­˜20ç¨®ï¼ˆRock 5, Pop 5, Blues 2, Ballad 4, Jazz 4ï¼‰
- **Pro**: è¿½åŠ 30ç¨®ï¼ˆRock 6, Pop 8, Ballad 5, Jazz 5, Blues 2, Other 4ï¼‰
- **åˆè¨ˆ**: iOS Proç‰ˆã¯50ç¨®ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’æä¾›

#### Pro 30ç¨®ã®å†…è¨³
- **Rock 6ç¨®**: Backdoor Rock, Aeolian Borrow, Minor Drive, Phrygian Tag, Mixolydian Push, Pedal Home
- **Pop 8ç¨®**: Pop Walkdown, Preâ€‘Chorus Lydian Lift, Axis Flip, Canon (8â€‘bar), Plagal Push, Anticipation Pop, Lydian Chorus, Sunrise Pop
- **Ballad 5ç¨®**: Circle Ballad, Descending Thirds, Deceptive End, Borrowed iv Glow, Gentle Rise
- **Jazz 5ç¨®**: Rhythm Changes (Bridge), Tadd Dameron Turnaround, iiâ€“V Vamp, Iâ†’IV Turnaround, Secondary Chain
- **Blues 2ç¨®**: 12â€‘bar Blues (Quick IV), 12â€‘bar Minor
- **Other 4ç¨®**: Andalusian Cadence, EDM Minor Loop, Gospel Walkâ€‘up, Bossa Turnaround

#### å®Ÿè£…å‚ç…§
- **å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/data/presets_pro_pack.md`
- **iOSå®Ÿè£…**: `OtoTheory-iOS/OtoTheory/Data/PresetsPro.swift`ï¼ˆå®Ÿè£…æ™‚ä½œæˆï¼‰
- **Webå®Ÿè£…**: `ototheory-web/src/lib/presetsPro.ts`ï¼ˆå®Ÿè£…æ™‚ä½œæˆï¼‰

#### SSOTåæ˜ 
- âœ… `v3.1_Business_Plan.md` - æ©Ÿèƒ½ãƒãƒˆãƒªã‚¯ã‚¹ãƒ»Proä¾¡å€¤ææ¡ˆæ›´æ–°
- âœ… `v3.1_SSOT.md` - Progressionä»•æ§˜ãƒ»Free/Proå¢ƒç•Œæ›´æ–°
- âœ… `v3.1_Implementation_SSOT.md` - å®Ÿè£…è¦ä»¶æ›´æ–°
- âœ… `v3.1_Implementation_Report.md` - æœ¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 

#### Proä¾¡å€¤ææ¡ˆï¼ˆ4æœ¬æŸ±ï¼‰
1. **ç„¡åˆ¶é™ä¿å­˜**ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼‰
2. **MIDIå‡ºåŠ›**ï¼ˆChordï¼‹Markersï¼‹Guideï¼‰
3. **ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç·¨é›†**ï¼ˆVerse/Chorus/Bridgeï¼‰
4. **ãƒ—ãƒªã‚»ãƒƒãƒˆ50ç¨®**ï¼ˆFree 20ï¼‹Pro 30ï¼‰

---

---

### L. Progression Playbackå®Œå…¨ç‰ˆå®Ÿè£…ï¼ˆ2025-10-04ï¼‰âœ…

#### å®Ÿè£…å†…å®¹

**1. ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ï¼ˆ4æ‹ã€ãƒ¡ãƒˆãƒ­ãƒãƒ¼ãƒ éŸ³ï¼‰**
- 1æ‹ç›®: F5ï¼ˆé«˜éŸ³ã€ãƒ™ãƒ­ã‚·ãƒ†ã‚£100ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼‰
- 2-4æ‹ç›®: E5ï¼ˆãƒ™ãƒ­ã‚·ãƒ†ã‚£80ï¼‰
- å„éŸ³50msï¼ˆçŸ­ã„ã‚¯ãƒªãƒƒã‚¯éŸ³ï¼‰
- BPMã«å¿œã˜ãŸ1æ‹å¾…æ©Ÿ
```swift
private func playCountIn(beatDuration: Double) async {
    let metronomeNote: UInt8 = 76 // E5 (woodblock sound)
    let accentNote: UInt8 = 77 // F5 (slightly higher for downbeat)
    
    for beat in 0..<4 {
        guard isPlaying else { break }
        
        let note = (beat == 0) ? accentNote : metronomeNote
        let velocity: UInt8 = (beat == 0) ? 100 : 80
        
        await MainActor.run {
            // çŸ­ã„ã‚¯ãƒªãƒƒã‚¯éŸ³ï¼ˆ50msï¼‰
            self.audioPlayer.sampler.startNote(note, withVelocity: velocity, onChannel: 0)
            
            DispatchQueue.main.asyncAfter(deadline: .now() + 0.05) {
                self.audioPlayer.sampler.stopNote(note, onChannel: 0)
            }
        }
        
        // 1æ‹å¾…æ©Ÿ
        try? await Task.sleep(nanoseconds: UInt64(beatDuration * 1_000_000_000))
    }
}
```

**2. ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•ãƒ«ãƒ¼ãƒ—å†ç”Ÿ**
- ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³å¾Œã«é–‹å§‹
- `while isPlaying` ã§ãƒ«ãƒ¼ãƒ—
- å„ã‚³ãƒ¼ãƒ‰4æ‹å†ç”Ÿ
- ãƒãƒ£ãƒ³ãƒãƒ«äº¤äº’ï¼ˆPhase 1æ–¹å¼ï¼‰

**3. å†ç”Ÿä¸­ã®ã‚¹ãƒ­ãƒƒãƒˆãƒã‚¤ãƒ©ã‚¤ãƒˆ**
- `currentSlotIndex` æ›´æ–°
- ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®æ è¡¨ç¤ºï¼ˆ`Color.orange`ï¼‰
- `SlotView` ã« `isPlaying` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

**4. Stopåˆ¶å¾¡**
- `isPlaying = false`
- `hardStopChannel(0/1)` ã§ç¢ºå®Ÿã«åœæ­¢
- `currentSlotIndex = nil` ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆè§£é™¤

**5. BPMèª¿æ•´ï¼ˆ40-240ï¼‰**
- `beatDuration = 60.0 / bpm`
- `chordDuration = beatDuration * 4`
- ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ã‚‚BPMã«é€£å‹•

#### DoDç¢ºèª
- âœ… ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³4æ‹ï¼ˆãƒ¡ãƒˆãƒ­ãƒãƒ¼ãƒ éŸ³ã€1æ‹ç›®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼‰
- âœ… ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•ãƒ«ãƒ¼ãƒ—å†ç”Ÿ
- âœ… å†ç”Ÿä¸­ã®ã‚¹ãƒ­ãƒƒãƒˆãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆã‚ªãƒ¬ãƒ³ã‚¸æ ï¼‰
- âœ… Stopåˆ¶å¾¡ï¼ˆç¢ºå®Ÿã«éŸ³ã‚’æ­¢ã‚ã‚‹ï¼‰
- âœ… BPMèª¿æ•´ã«å…¨ä½“é€£å‹•

---

---

### M. Playbacké‡å¤§ãƒã‚°ä¿®æ­£ + éŸ³è‰²é¸æŠå®Ÿè£…ï¼ˆ2025-10-04ï¼‰âœ…

#### å ±å‘Šã•ã‚ŒãŸå•é¡Œï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
1. âŒ **4æ‹ã«ã¯ãªã£ã¦ã„ãªã„** - éŸ³ãŒçŸ­ãåˆ‡ã‚Œã‚‹
2. âŒ **ãƒ«ãƒ¼ãƒ—æ™‚ã«éŸ³ãŒã‹ã¶ã‚‹** - æœ€å¾Œã®ã‚³ãƒ¼ãƒ‰ãŒé³´ã‚Šç¶šã‘ã¦æœ€åˆã®ã‚³ãƒ¼ãƒ‰ã¨é‡ãªã‚‹
3. â“ **éŸ³è‰²é¸æŠãŒãªã„** - ã„ã¤å®Ÿè£…ã•ã‚Œã‚‹ã®ã‹

#### ä¿®æ­£å†…å®¹

**1. 4æ‹é³´ã‚‰ã—ç¶šã‘ã‚‹å•é¡Œã‚’ä¿®æ­£**
```swift
// Before: startNoteã ã‘ â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¸›è¡°ã§çŸ­ãåˆ‡ã‚Œã‚‹
self.audioPlayer.sampler.startNote(note, withVelocity: 80, onChannel: currentChannel)

// After: 4æ‹å¾Œã«stopNote â†’ æ˜ç¤ºçš„ã«4æ‹é³´ã‚‰ã™
self.audioPlayer.sampler.startNote(note, withVelocity: 80, onChannel: currentChannel)

// 4æ‹å¾Œã«æ˜ç¤ºçš„ã«éŸ³ã‚’æ­¢ã‚ã‚‹
DispatchQueue.main.asyncAfter(deadline: .now() + chordDuration) {
    for note in midiNotes {
        self.audioPlayer.sampler.stopNote(note, onChannel: currentChannel)
    }
}
```

**åŸå› **: `startNote` ã§éŸ³ã‚’é³´ã‚‰ã™ã ã‘ã§ã€æ˜ç¤ºçš„ã« `stopNote` ã—ã¦ã„ãªã‹ã£ãŸãŸã‚ã€SoundFontã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¸›è¡°ï¼ˆçŸ­ã„ï¼‰ã§éŸ³ãŒåˆ‡ã‚Œã¦ã„ãŸã€‚

**è§£æ±º**: 4æ‹åˆ†ã®ã‚¿ã‚¤ãƒãƒ¼ã§æ˜ç¤ºçš„ã« `stopNote` ã‚’å‘¼ã³å‡ºã—ã€éŸ³ã‚’4æ‹é³´ã‚‰ã—ç¶šã‘ã‚‹ã€‚

---

**2. ãƒ«ãƒ¼ãƒ—æ™‚ã«éŸ³ãŒã‹ã¶ã‚‹å•é¡Œã‚’ä¿®æ­£**
```swift
// Before: if index > 0 â†’ æœ€åˆã®ãƒ«ãƒ¼ãƒ—ã§å‰ãƒãƒ£ãƒ³ãƒãƒ«åœæ­¢ã—ãªã„
if index > 0 {
    await MainActor.run {
        self.audioPlayer.hardStopChannel(previousChannel)
    }
}

// After: å¸¸ã«hardStopChannel(previousChannel) â†’ ç¢ºå®Ÿã«åœæ­¢
// å¸¸ã«å‰ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å¼·åˆ¶åœæ­¢ï¼ˆãƒ«ãƒ¼ãƒ—å¯¾ç­–ï¼‰
await MainActor.run {
    self.audioPlayer.hardStopChannel(previousChannel)
}
```

**åŸå› **: `if index > 0` ã«ã‚ˆã‚Šã€ãƒ«ãƒ¼ãƒ—ã®æœ€åˆï¼ˆ`index == 0`ï¼‰ã§å‰ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’åœæ­¢ã—ã¦ã„ãªã‹ã£ãŸã€‚æœ€å¾Œã®ã‚³ãƒ¼ãƒ‰ï¼ˆãƒãƒ£ãƒ³ãƒãƒ«1ï¼‰ãŒé³´ã‚Šç¶šã‘ã¦æœ€åˆã®ã‚³ãƒ¼ãƒ‰ï¼ˆãƒãƒ£ãƒ³ãƒãƒ«0ï¼‰ã¨é‡ãªã£ã¦ã„ãŸã€‚

**è§£æ±º**: `if` æ–‡ã‚’å‰Šé™¤ã—ã€å¸¸ã«å‰ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’åœæ­¢ã™ã‚‹ã€‚ãƒ«ãƒ¼ãƒ—æ™‚ã‚‚ç¢ºå®Ÿã«å‰ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ãƒŸãƒ¥ãƒ¼ãƒˆã€‚

---

**3. éŸ³è‰²é¸æŠæ©Ÿèƒ½ã‚’å®Ÿè£…**
```swift
@State private var selectedInstrument: Int = 0

private let instruments = [
    ("Acoustic Steel", 25),
    ("Acoustic Nylon", 24),
    ("Electric Clean", 27),
    ("Distortion", 30),
    ("Over Drive", 29),
    ("Electric Muted", 28),
    ("Piano", 0)
]

// UI: Playback Controlså†…ã«Pickerè¿½åŠ 
HStack(spacing: 8) {
    Text("Instrument:")
        .font(.caption)
        .fontWeight(.medium)
    
    Picker("Instrument", selection: $selectedInstrument) {
        ForEach(0..<instruments.count, id: \.self) { index in
            Text(instruments[index].0).tag(index)
        }
    }
    .pickerStyle(.menu)
    .onChange(of: selectedInstrument) { _, newValue in
        changeInstrument(instruments[newValue].1)
    }
}

// éŸ³è‰²å¤‰æ›´é–¢æ•°
private func changeInstrument(_ program: Int) {
    let soundFontURL = URL(fileURLWithPath: "/System/Library/Components/CoreAudio.component/Contents/Resources/gs_instruments.dls")
    
    do {
        try audioPlayer.sampler.loadSoundBankInstrument(
            at: soundFontURL,
            program: UInt8(program),
            bankMSB: UInt8(kAUSampler_DefaultMelodicBankMSB),
            bankLSB: UInt8(kAUSampler_DefaultBankLSB)
        )
        print("âœ… Instrument changed: program \(program)")
    } catch {
        print("âŒ Failed to change instrument: \(error)")
    }
}
```

**å®Ÿè£…**: 
- 7ç¨®é¡ã®æ¥½å™¨ã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆAcoustic Steel/Nylon, Electric Clean/Dist/Over Drive/Muted, Pianoï¼‰
- General MIDI ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç•ªå·ã§éŸ³è‰²åˆ‡ã‚Šæ›¿ãˆ
- Build Progression ã‚«ãƒ¼ãƒ‰å†…ã® Playback Controls ã«é…ç½®

#### DoDç¢ºèª
- âœ… ã‚³ãƒ¼ãƒ‰ãŒ4æ‹é³´ã‚Šç¶šã‘ã‚‹
- âœ… ãƒ«ãƒ¼ãƒ—æ™‚ã«éŸ³ãŒã‹ã¶ã‚‰ãªã„
- âœ… 7ç¨®é¡ã®éŸ³è‰²é¸æŠå¯èƒ½
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§éŸ³è‰²å¤‰æ›´å¯èƒ½

---

**M4 Week 1 å®Œäº†ï¼Week 2 å®Œå…¨é”æˆï¼Week 3 Playbackå®Œå…¨ç‰ˆå®Ÿè£…å®Œäº†ï¼é‡å¤§ãƒã‚°ä¿®æ­£å®Œäº†ï¼ãƒ—ãƒªã‚»ãƒƒãƒˆä»•æ§˜ç¢ºå®šï¼** ğŸ‰

**æ¬¡ã®å®Ÿè£…: ãƒ—ãƒªã‚»ãƒƒãƒˆPro 30ç¨®ã®å®Ÿè£…æº–å‚™ï¼ˆãƒ‡ãƒ¼ã‚¿å®šç¾©æ¸ˆã¿ï¼‰** ğŸ“¦

---

## 14. M4 ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå®Ÿè£… â€” Phase Aï¼ˆåŸºç›¤ï¼‰âœ… å®Œäº†

**å®Ÿè£…æ—¥**: 2025-10-05  
**ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³**: M4 â€” Hybrid Audio Architecture  
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase Aï¼ˆåŸºç›¤ï¼‰  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

### æ¦‚è¦

**Phase A ã®ç›®çš„**: Hybrid Audio Architecture ã®åŸºç›¤ã‚’æ§‹ç¯‰ã—ã€Phase B ã§ã®æœ€å°å†ç”Ÿå®Ÿè£…ã«å‘ã‘ãŸåœŸå°ã‚’ä½œæˆã€‚

**å®Ÿè£…æœŸé–“**: 1æ—¥ï¼ˆ2025-10-05ï¼‰

---

### å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯

#### 1. Score / Bar ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ  âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `OtoTheory-iOS/OtoTheory/Core/Audio/Models/Score.swift`

**å®Ÿè£…å†…å®¹**:
- `Score` æ§‹é€ ä½“: BPM ã¨ å°ç¯€é…åˆ—ï¼ˆ`bars: [Bar]`ï¼‰ã‚’ä¿æŒ
- `Bar` æ§‹é€ ä½“: ã‚³ãƒ¼ãƒ‰ã‚·ãƒ³ãƒœãƒ«ï¼ˆ`chord: String`ï¼‰ã‚’ä¿æŒ
- `Score.from(slots:bpm:)`: æ—¢å­˜ã®UIã® `slots: [String?]` ã‹ã‚‰ `Score` ã‚’ç”Ÿæˆ
- `barCount`: å°ç¯€æ•°ã‚’å–å¾—
- `totalDuration`: ç·ç§’æ•°ã‚’è¨ˆç®—ï¼ˆBPM120ãªã‚‰1å°ç¯€=2.0ç§’ï¼‰

**ä¸»è¦ã‚³ãƒ¼ãƒ‰**:
```swift
struct Score {
    var bpm: Double
    var bars: [Bar]
    
    static func from(slots: [String?], bpm: Double = 120.0) -> Score {
        let bars: [Bar] = slots.compactMap { chord -> Bar? in
            guard let chord = chord, !chord.isEmpty else { return nil }
            return Bar(chord: chord)
        }
        return Score(bpm: bpm, bars: bars)
    }
    
    var barCount: Int { bars.count }
    var totalDuration: Double {
        let secondsPerBar = 60.0 / bpm * 4.0
        return secondsPerBar * Double(barCount)
    }
}

struct Bar {
    var chord: String  // "C", "Am7", "G/B" ãªã©
}
```

**æŠ€è¡“èª²é¡Œã¨è§£æ±º**:
- **èª²é¡Œ**: `compactMap` ã®å‹æ¨è«–ã‚¨ãƒ©ãƒ¼ï¼ˆ`generic parameter 'ElementOfResult' could not be inferred`ï¼‰
- **è§£æ±º**: æˆ»ã‚Šå€¤ã®å‹ã‚’æ˜ç¤ºçš„ã« `Bar?` ã¨ã—ã¦æŒ‡å®š

---

#### 2. GuitarBounceService ã‚’æ–°è¦ä½œæˆ âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `OtoTheory-iOS/OtoTheory/Core/Audio/GuitarBounceService.swift`

**å®Ÿè£…å†…å®¹**:
- 1å°ç¯€ï¼ˆ2.0ç§’@120BPMï¼‰ã®ã‚®ã‚¿ãƒ¼PCMã‚’ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- æœ«å°¾120msã‚’æ³¢å½¢ã§ç·šå½¢ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
- LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆæœ€å¤§16ä»¶ã€ç´„11MBï¼‰
- `CacheKey`: `(chord: String, program: UInt8, bpm: Double)`

**ä¸»è¦æ©Ÿèƒ½**:
1. **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**:
   - `AVAudioEngine.enableManualRenderingMode(.offline)`
   - 44.1kHz, 2ch
   - 4096ãƒ•ãƒ¬ãƒ¼ãƒ ãšã¤ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

2. **ã‚¹ãƒˆãƒ©ãƒ é…å»¶**:
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ15ms
   - æœ€å¤§6å£°ã¾ã§

3. **ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ**:
   - æœ«å°¾120msã‚’ç·šå½¢ãƒ•ã‚§ãƒ¼ãƒ‰ï¼ˆ1.0 â†’ 0.0ï¼‰
   - æ³¢å½¢ãƒ¬ãƒ™ãƒ«ã§ç›´æ¥æ“ä½œ

4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†**:
   - LRUæ–¹å¼
   - æœ€å¤§16ãƒãƒƒãƒ•ã‚¡
   - é‡è¤‡ã‚³ãƒ¼ãƒ‰ã¯åŒã˜ãƒãƒƒãƒ•ã‚¡ã‚’å†åˆ©ç”¨

**æŠ€è¡“ä»•æ§˜**:
- ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆ: 44.1kHz
- ãƒãƒ£ãƒ³ãƒãƒ«æ•°: 2ï¼ˆã‚¹ãƒ†ãƒ¬ã‚ªï¼‰
- ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º: ç´„0.7MB/Bar
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®¹é‡: æœ€å¤§16ä»¶ï¼ˆç´„11MBï¼‰

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
```swift
func buffer(
    for key: CacheKey,
    sf2URL: URL,
    strumMs: Double = 15.0,
    releaseMs: Double = 120.0
) throws -> AVAudioPCMBuffer
```

---

#### 3. HybridPlayer ã®åœŸå° âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `OtoTheory-iOS/OtoTheory/Core/Audio/HybridPlayer.swift`

**å®Ÿè£…å†…å®¹**:
- `AVAudioEngine` + `AVAudioPlayerNode` (Guitar) + `AVAudioUnitSampler` Ã— 2 (Bass/Drums)
- `AVAudioSequencer` ã®åˆæœŸåŒ–
- `prepare(sf2URL:drumKitURL:)`: SF2ãƒ­ãƒ¼ãƒ‰ã€AVAudioSessionè¨­å®š
- `play(score:guitarBuffers:onBarChange:)`: å†ç”Ÿé–‹å§‹ï¼ˆPhase Aã¯ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼‰
- `stop()`: åœæ­¢ã€CC120/123ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

**ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ**:
```
AVAudioEngine
  â”œâ”€ playerGtr (AVAudioPlayerNode) â†’ mainMixerNode
  â”œâ”€ samplerBass (AVAudioUnitSampler) â†’ mainMixerNode
  â”œâ”€ samplerDrum (AVAudioUnitSampler) â†’ mainMixerNode
  â””â”€ mainMixerNode
  
AVAudioSequencer
  â”œâ”€ MusicSequence (Bass/Drums)
  â”œâ”€ TempoTrack (BPM control)
  â””â”€ MusicTrack destination â†’ samplerBass/Drum
```

**AVAudioSessionè¨­å®š**:
- ã‚«ãƒ†ã‚´ãƒª: `.playback`
- ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆ: 44.1kHz
- I/Oãƒãƒƒãƒ•ã‚¡: 10msï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼‰ã€5msï¼ˆå®Ÿæ©Ÿï¼‰

**CCåˆæœŸåŒ–**:
- Reverb (CC91) = 0
- Chorus (CC93) = 0
- Sustain (CC64) = 0
- Volume (CC7) = 100

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
```swift
func prepare(sf2URL: URL, drumKitURL: URL?) throws
func play(score: Score, guitarBuffers: [AVAudioPCMBuffer], onBarChange: @escaping (Int) -> Void) throws
func stop()
```

---

#### 4. SequencerBuilder ã®é››å½¢ âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `OtoTheory-iOS/OtoTheory/Core/Audio/SequencerBuilder.swift`

**å®Ÿè£…å†…å®¹**:
- `build(score:includeBass:includeDrums:)`: Scoreã‹ã‚‰MusicSequenceã‚’æ§‹ç¯‰
- Phase A: ãƒ†ãƒ³ãƒãƒˆãƒ©ãƒƒã‚¯ã®ã¿å®Ÿè£…
- Phase B: ãƒ™ãƒ¼ã‚¹ãƒˆãƒ©ãƒƒã‚¯è¿½åŠ ï¼ˆTODOï¼‰
- Phase C: ãƒ‰ãƒ©ãƒ ãƒˆãƒ©ãƒƒã‚¯è¿½åŠ ï¼ˆTODOï¼‰

**å®Ÿè£…æ¸ˆã¿**:
- MusicSequence ç”Ÿæˆ
- ãƒ†ãƒ³ãƒãƒˆãƒ©ãƒƒã‚¯è¨­å®šï¼ˆ`MusicTrackNewExtendedTempoEvent`ï¼‰

**Phase B/C ã§å®Ÿè£…äºˆå®š**:
- ãƒ™ãƒ¼ã‚¹ãƒˆãƒ©ãƒƒã‚¯: Root/5th ãƒ‘ã‚¿ãƒ¼ãƒ³ã€destination binding
- ãƒ‰ãƒ©ãƒ ãƒˆãƒ©ãƒƒã‚¯: 16ã‚¹ãƒ†ãƒƒãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆK=36, S=38, H=42/46ï¼‰ã€ch10

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
```swift
static func build(
    score: Score,
    includeBass: Bool = false,
    includeDrums: Bool = false
) throws -> MusicSequence
```

---

#### 5. ProgressionView ã‚’æ›´æ–° âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `OtoTheory-iOS/OtoTheory/Views/ProgressionView.swift`

**å®Ÿè£…å†…å®¹**:
- `@State private var hybridPlayer: HybridPlayer?`
- `@State private var bounceService: GuitarBounceService?`
- `init()` ã§ HybridPlayer ã¨ GuitarBounceService ã‚’åˆæœŸåŒ–
- `playProgression()` ã« HybridPlayer ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
- `stopProgression()` ã« HybridPlayer ã®åœæ­¢ã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰

**æ³¨è¨˜**:
- Phase A ã§ã¯æ—§å®Ÿè£…ï¼ˆChordSequencerï¼‰ã‚’ç¶­æŒ
- Phase B ã§ HybridPlayer ã«å®Œå…¨ç§»è¡Œ
- ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ãŸã‚³ãƒ¼ãƒ‰ã¯ Phase B ã§æœ‰åŠ¹åŒ–

---

### æŠ€è¡“èª²é¡Œã¨è§£æ±º

#### èª²é¡Œ 1: `compactMap` ã®å‹æ¨è«–ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼**:
```
error: generic parameter 'ElementOfResult' could not be inferred
let bars = slots.compactMap { chord in
```

**åŸå› **: Swift ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒ `compactMap` ã®æˆ»ã‚Šå€¤ã®å‹ã‚’æ¨è«–ã§ããªã„

**è§£æ±ºç­–**:
```swift
let bars: [Bar] = slots.compactMap { chord -> Bar? in
    guard let chord = chord, !chord.isEmpty else { return nil }
    return Bar(chord: chord)
}
```

**å­¦ã³**: ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã®æˆ»ã‚Šå€¤ã®å‹ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹ã“ã¨ã§å‹æ¨è«–ã‚’åŠ©ã‘ã‚‹

---

#### èª²é¡Œ 2: `AVAudioSequencer.load(from:options:)` ã®APIãƒŸã‚¹ãƒãƒƒãƒ

**ã‚¨ãƒ©ãƒ¼**:
```
error: no exact matches in call to instance method 'load'
sequencer.load(from: sequence, options: [])
```

**åŸå› **: 
- `AVAudioSequencer.load(from:options:)` ã¯ `URL` ã‚’æœŸå¾…
- `MusicSequence` ã¯ç›´æ¥è¨­å®šã§ããªã„
- `AVAudioSequencer.musicSequence` ã¯ get-only ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

**Phase A ã®è§£æ±ºç­–**:
```swift
// AVAudioSequencer.musicSequence ã¯ get-only ãªã®ã§ã€
// Phase A ã§ã¯ Sequencer ã‚’å†ä½œæˆ
sequencer = AVAudioSequencer(audioEngine: engine)
```

**Phase B ã§ã®è§£æ±ºç­–**:
- `MusicSequence` â†’ ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.midï¼‰ã¨ã—ã¦ä¿å­˜
- `sequencer.load(from: fileURL, options: [])` ã§èª­ã¿è¾¼ã¿
- ã¾ãŸã¯ `MusicPlayer` + `MusicSequence` ã®ç›´æ¥æ“ä½œ

---

### Phase A DoD é”æˆçŠ¶æ³

| é …ç›® | åŸºæº– | é”æˆ |
|------|------|------|
| **Score / Bar ãƒ¢ãƒ‡ãƒ«** | æ—¢å­˜UIã®slotsâ†’Scoreã«é›†ç´„ | âœ… å®Œäº† |
| **GuitarBounceService** | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³renderâ†’PCMåŒ–â†’æœ«å°¾120msãƒ•ã‚§ãƒ¼ãƒ‰ | âœ… å®Œäº† |
| **HybridPlayer** | Engine+PlayerNode+2ã‚µãƒ³ãƒ—ãƒ©ãƒ¼ã€prepare/start/stop | âœ… å®Œäº† |
| **SequencerBuilder** | TempoTrackã®ã¿ | âœ… å®Œäº† |
| **ãƒ“ãƒ«ãƒ‰æˆåŠŸ** | ã‚¨ãƒ©ãƒ¼ãªããƒ“ãƒ«ãƒ‰å®Œäº† | âœ… å®Œäº† |

**é”æˆç‡**: **100%** âœ…

---

### ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

1. `OtoTheory-iOS/OtoTheory/Core/Audio/Models/Score.swift` (æ–°è¦)
2. `OtoTheory-iOS/OtoTheory/Core/Audio/GuitarBounceService.swift` (æ–°è¦)
3. `OtoTheory-iOS/OtoTheory/Core/Audio/HybridPlayer.swift` (æ–°è¦)
4. `OtoTheory-iOS/OtoTheory/Core/Audio/SequencerBuilder.swift` (æ–°è¦)
5. `OtoTheory-iOS/OtoTheory/Views/ProgressionView.swift` (æ›´æ–°)

**åˆè¨ˆ**: 4ãƒ•ã‚¡ã‚¤ãƒ«æ–°è¦ä½œæˆã€1ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°

---

### Phase A ã®æˆæœ

âœ… **Hybrid Audio Architecture ã®åŸºç›¤ãŒå®Œå…¨ã«æ§‹ç¯‰ã•ã‚Œã¾ã—ãŸï¼**

**ä¸»è¦ãªæˆæœ**:
1. **Score/Barãƒ¢ãƒ‡ãƒ«**: æ—¢å­˜UIã¨ã®çµ±åˆæº–å‚™å®Œäº†
2. **GuitarBounceService**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã€LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…å®Œäº†
3. **HybridPlayer**: Engine/PlayerNode/Sampleræ§‹æˆã€prepare/start/stopå®Ÿè£…å®Œäº†
4. **SequencerBuilder**: é››å½¢å®Ÿè£…å®Œäº†ï¼ˆPhase Bã§æ‹¡å¼µï¼‰
5. **ãƒ“ãƒ«ãƒ‰æˆåŠŸ**: å…¨ã¦ã®æ–°è¦ã‚³ãƒ¼ãƒ‰ãŒã‚¨ãƒ©ãƒ¼ãªãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å®Œäº†

**Phase B ã§ã®æœ€å°å†ç”Ÿå®Ÿè£…ã«å‘ã‘ãŸåœŸå°ãŒå®Œå…¨ã«æ•´ã„ã¾ã—ãŸï¼**

---

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: Phase Bï¼ˆæœ€å°å†ç”Ÿï¼‰

**Phase B ã‚¿ã‚¹ã‚¯**ï¼ˆæ¨å®š: 1-2æ—¥ï¼‰:

1. **C/G/Am/F ã®ã‚®ã‚¿ãƒ¼PCMç”Ÿæˆ**
   - `GuitarBounceService` ã‚’ä½¿ã£ã¦4ã‚³ãƒ¼ãƒ‰ã®PCMãƒãƒƒãƒ•ã‚¡ã‚’ç”Ÿæˆ
   - PlayerNodeã§é€£çµå†ç”Ÿ

2. **ãƒ™ãƒ¼ã‚¹åŸºæœ¬å½¢ã‚’ã‚¤ãƒ™ãƒ³ãƒˆåŒ–**
   - Root/5th ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆ
   - Sequencerã§ç™ºéŸ³

3. **ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³å®Ÿè£…**
   - ã‚¯ãƒªãƒƒã‚¯PCMã‚’4ã¤å…ˆé ­ã«schedule
   - ã¾ãŸã¯ Drumãƒˆãƒ©ãƒƒã‚¯ã®ãƒã‚¤ãƒãƒƒãƒˆã§ä»£ç”¨

4. **ãƒ«ãƒ¼ãƒ—å®Ÿè£…**
   - æœ€å¾Œã®completionã§å†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

5. **åœæ­¢å®Ÿè£…**
   - CC120/123 + reset

**Phase B æŠ€è¡“èª²é¡Œ**:
- **MusicSequence â†’ Sequencer**: ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«çµŒç”±ã§ `sequencer.load(from: fileURL)` ã‚’ä½¿ç”¨
- **PlayerNode + Sequencer åŒæœŸ**: 0.2ç§’å…ˆã«é–‹å§‹ã‚’äºˆç´„ã—ã¦åŒæœŸç²¾åº¦å‘ä¸Š
- **ãƒ«ãƒ¼ãƒ—ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹æ€§**: ãƒãƒƒãƒ•ã‚¡ã®é€£çµã§éš™é–“ãªã—

**Phase B DoD**:
| é …ç›® | åŸºæº– |
|------|------|
| **ã‚®ã‚¿ãƒ¼PCMå†ç”Ÿ** | C/G/Am/F ã®é€£çµå†ç”ŸãŒå‹•ä½œ |
| **ãƒ™ãƒ¼ã‚¹åŸºæœ¬å½¢** | Root/5th ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒSequencerã§ç™ºéŸ³ |
| **ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³** | 4æ‹ã®ã‚«ã‚¦ãƒ³ãƒˆãŒèã“ãˆã‚‹ |
| **ãƒ«ãƒ¼ãƒ—** | ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«ç¹°ã‚Šè¿”ã—å†ç”Ÿ |
| **åœæ­¢** | ã‚¯ãƒªãƒ¼ãƒ³ã«åœæ­¢ã€æ®‹éŸ¿ãªã— |

---

**æ¬¡å›æ›´æ–°**: Phase B å®Ÿè£…å®Œäº†æ™‚ã«å ±å‘Šäºˆå®š

---
