# M4-B Proæ©Ÿèƒ½å®Ÿè£…è¨ˆç”» & é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-10-11  
**æœ€çµ‚æ›´æ–°**: 2025-10-11  
**å¯¾è±¡**: OtoTheory iOS v1 Proæ©Ÿèƒ½ï¼ˆM4-Bï¼‰

---

## ğŸ“‹ å®Ÿè£…æ¦‚è¦

### M4-B ã®ç›®æ¨™
**åç›ŠåŒ–ã®ä¸­æ ¸** = Proæ©Ÿèƒ½ã«ã‚ˆã‚‹æœˆé¡èª²é‡‘ï¼ˆÂ¥490/æœˆï¼‰

### Proæ©Ÿèƒ½ä¸€è¦§
1. âœ… **ãƒ—ãƒªã‚»ãƒƒãƒˆ20ç¨®ï¼ˆFreeï¼‰+ 30ç¨®ï¼ˆProã€Phase 5ã§è¿½åŠ äºˆå®šï¼‰**
2. âœ… **ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç·¨é›†**ï¼ˆVerse/Chorus/Bridgeâ€¦ï¼‰- UIå®Ÿè£…å®Œäº†
3. âœ… **MIDIå‡ºåŠ›**ï¼ˆ4ãƒˆãƒ©ãƒƒã‚¯æ§‹æˆ: Guitar/Bass/Scale GuideÃ—2ï¼‰- Phase 3-Bå®Œäº†ï¼ˆ2025-10-11ï¼‰
4. ğŸ”œ **Sketchç„¡åˆ¶é™**ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼‰
5. âœ… **IAPå®Ÿè£…**ï¼ˆÂ¥490/æœˆï¼‰
6. âœ… **Paywall & è¨ˆæ¸¬**

---

## ğŸ¯ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã¨é€²æ—

### Phase 1: åŸºç›¤ï¼ˆIAP & Paywallï¼‰âœ… **å®Œäº†**
1. **ProçŠ¶æ…‹ç®¡ç†**ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ»è³¼å…¥çŠ¶æ…‹ï¼‰
2. **IAPå®Ÿè£…**ï¼ˆStoreKit 2ï¼‰
3. **Paywall UI**ï¼ˆè³¼å…¥ç”»é¢ï¼‰
4. **è¨ˆæ¸¬**ï¼ˆ`paywall_view`, `purchase_success`ï¼‰
5. **Free/Proæ©Ÿèƒ½åˆ†å²**

### Phase 2: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç·¨é›† âœ… **å®Œäº†ï¼ˆUIå®Ÿè£…ï¼‰**
1. âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«**ï¼ˆSectionå‹ï¼šname, range, repeatï¼‰
2. âœ… **UIå®Ÿè£…**ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãƒ»ä¸¦ã¹æ›¿ãˆï¼‰
3. âœ… **ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º**ï¼ˆProgressionViewã«æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰
4. âœ… **æ°¸ç¶šåŒ–**ï¼ˆSketchã«å«ã‚ã‚‹ï¼‰
5. ğŸ”œ **å†ç”Ÿé€£å‹•**ï¼ˆPhase 2.5ã§å®Ÿè£…äºˆå®šï¼‰

### Phase 3: MIDIå‡ºåŠ› âœ… **å®Œäº†ï¼ˆPhase 3-A/3-Bï¼‰**

#### Phase 3-A: åŸºæœ¬å®Ÿè£…ï¼ˆå®Œäº†ï¼‰
1. âœ… **MusicSequenceæ‹¡å¼µ**ï¼ˆMarkersè¿½åŠ ï¼‰
2. âœ… **Chord Trackç”Ÿæˆ**ï¼ˆã‚³ãƒ¼ãƒ‰â†’MIDI Notesï¼‰
3. âœ… **Guide Tonesç”Ÿæˆ**ï¼ˆ3rd + 7thï¼‰
4. âœ… **SMF Type-1æ›¸ãå‡ºã—**
5. âœ… **å…±æœ‰ã‚·ãƒ¼ãƒˆ**ï¼ˆ.midãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

#### Phase 3-B: MIDIå¤§å¹…å¼·åŒ–ï¼ˆå®Œäº†ã€2025-10-11ï¼‰
1. âœ… **4ãƒˆãƒ©ãƒƒã‚¯æ§‹æˆ**ï¼ˆGuitar/Bass/Scale GuideÃ—2ï¼‰
2. âœ… **Program Change**ï¼ˆæ¥½å™¨è‡ªå‹•é¸æŠï¼‰
3. âœ… **ã‚³ãƒ¼ãƒ‰ãƒœã‚¤ã‚·ãƒ³ã‚°**ï¼ˆRoot+3rd+5th+7thï¼‰
4. âœ… **ãƒªã‚ºãƒ ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼ˆ4æ‹å­ã‚¹ãƒˆãƒ©ãƒ ï¼‰
5. âœ… **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³**ï¼ˆRoot-Root-5th-Root(Oct)ï¼‰
6. âœ… **Scale Guide Track**ï¼ˆOtoTheoryç‹¬è‡ªæ©Ÿèƒ½ï¼‰
7. âœ… **UIå†è¨­è¨ˆ**ï¼ˆSketch Exportæ–¹å¼ï¼‰

### Phase 4: Sketchç„¡åˆ¶é™ & ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ
1. **CloudKitçµ±åˆ**
2. **åŒæœŸãƒ­ã‚¸ãƒƒã‚¯**ï¼ˆç«¶åˆè§£æ±ºï¼‰
3. **Proå°‚ç”¨UI**ï¼ˆç„¡åˆ¶é™ãƒªã‚¹ãƒˆï¼‰

### Phase 5: ãƒ—ãƒªã‚»ãƒƒãƒˆæ‹¡å¼µ
1. **Proå°‚ç”¨ãƒ—ãƒªã‚»ãƒƒãƒˆ30ç¨®**
2. **Free/Proåˆ†å²è¡¨ç¤º**
3. **Paywallèª˜å°**

---

## âœ… Phase 1 å®Ÿè£…å®Œäº†ã‚µãƒãƒªãƒ¼

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
1. **`ProManager.swift`** - StoreKit 2çµ±åˆã€è³¼å…¥çŠ¶æ…‹ç®¡ç†
2. **`TelemetryService.swift`** - ã‚¤ãƒ™ãƒ³ãƒˆè¨ˆæ¸¬ã‚µãƒ¼ãƒ“ã‚¹
3. **`PaywallView.swift`** - Proè³¼èª­UI
4. **`Configuration.storekit`** - StoreKitãƒ†ã‚¹ãƒˆè¨­å®š
5. **`Preset.swift`** - `isFree`ãƒ•ãƒ©ã‚°è¿½åŠ ï¼ˆFree 20ç¨®ï¼‰
6. **`PresetPickerView.swift`** - Free/Proåˆ†å²UI
7. **`ProgressionView.swift`** - Paywallçµ±åˆ

### ãƒ“ãƒ«ãƒ‰çµæœ
âœ… **BUILD SUCCEEDED**

### è¨ˆæ¸¬ã‚¤ãƒ™ãƒ³ãƒˆ
- `paywall_view` - Paywallè¡¨ç¤º
- `purchase_success` - è³¼å…¥æˆåŠŸ
- `purchase_fail` - è³¼å…¥å¤±æ•—
- `restore_success` - ãƒªã‚¹ãƒˆã‚¢æˆåŠŸ
- `restore_fail` - ãƒªã‚¹ãƒˆã‚¢å¤±æ•—

---

## âœ… Phase 2 å®Ÿè£…å®Œäº†ã‚µãƒãƒªãƒ¼

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
1. **`Section.swift`** - ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆ9ç¨®é¡ã®ã‚¿ã‚¤ãƒ—ã€ç¯„å›²ã€ãƒªãƒ”ãƒ¼ãƒˆï¼‰
2. **`SectionEditorView.swift`** - ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç·¨é›†UI
3. **`Sketch.swift`** - `sections`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ 
4. **`ProgressionView.swift`** - Sectionsãƒœã‚¿ãƒ³ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º

### æ©Ÿèƒ½
- âœ… 9ç¨®é¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ï¼ˆIntro, Verse, Pre-Chorus, Chorus, Bridge, Solo, Outro, Interlude, Breakdownï¼‰
- âœ… ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãƒ»ä¸¦ã¹æ›¿ãˆ
- âœ… ç¯„å›²æŒ‡å®šï¼ˆ0-11ãƒãƒ¼ï¼‰ã€ãƒªãƒ”ãƒ¼ãƒˆå›æ•°ï¼ˆ1-8å›ï¼‰
- âœ… é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- âœ… ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰
- âœ… Proåˆ†å²ï¼ˆSectionsãƒœã‚¿ãƒ³ï¼‰

### ãƒ“ãƒ«ãƒ‰çµæœ
âœ… **BUILD SUCCEEDED**

---

## âœ… Phase 3 å®Ÿè£…å®Œäº†ã‚µãƒãƒªãƒ¼

*æœ€çµ‚æ›´æ–°: 2025-10-11ï¼ˆPhase 3-Bå®Œäº†ï¼‰*

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

#### Phase 3-Aï¼ˆåŸºæœ¬å®Ÿè£…ï¼‰
1. **`MIDIExportService.swift`** - MIDIæ›¸ãå‡ºã—ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆåŸºæœ¬æ©Ÿèƒ½ï¼‰
2. **`ProgressionView.swift`** - MIDIãƒœã‚¿ãƒ³ï¼ˆå¾Œã«Sketch Exportã«ç§»å‹•ï¼‰
3. **`TelemetryService.swift`** - `midiExport`ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 

#### Phase 3-Bï¼ˆå¤§å¹…å¼·åŒ–ï¼‰
1. **`MIDIExportService.swift`** - 9é–¢æ•°è¿½åŠ /æ›´æ–°
   - `addProgramChange()` - æ¥½å™¨æŒ‡å®š
   - `addScaleGuide()` - ã‚¹ã‚±ãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰
   - `parseChordVoicing()` - ã‚³ãƒ¼ãƒ‰ãƒœã‚¤ã‚·ãƒ³ã‚°
   - `addBassLineEvents()` - ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³
   - `addChordEvents()` - 4æ‹å­ã‚¹ãƒˆãƒ©ãƒ 
   - `removeKeyPrefix()` - ã‚­ãƒ¼åå‰Šé™¤
   - `getScaleDegrees()` - ã‚¹ã‚±ãƒ¼ãƒ«åº¦æ•°ãƒãƒƒãƒ—
   - `degreeToSemitones()` - åº¦æ•°â†’åŠéŸ³å¤‰æ›
2. **`SketchListView.swift`** - Export Menuçµ±åˆï¼ˆPNG/MIDIï¼‰
3. **`ProgressionView.swift`** - MIDIãƒœã‚¿ãƒ³å‰Šé™¤ã€1è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåŒ–
4. **`ActivityViewController.swift`** - UIActivityViewController wrapper

### æ©Ÿèƒ½

#### Phase 3-A
- âœ… Chord Trackç”Ÿæˆï¼ˆãƒ«ãƒ¼ãƒˆéŸ³ã®MIDIãƒãƒ¼ãƒˆï¼‰
- âœ… Guide Tonesç”Ÿæˆï¼ˆ3rd + 7thï¼‰
- âœ… Section MarkersåŸ‹ã‚è¾¼ã¿ï¼ˆMeta Event Type 6ï¼‰
- âœ… SMF Type-1æ›¸ãå‡ºã—ï¼ˆ2ãƒˆãƒ©ãƒƒã‚¯æ§‹æˆï¼‰
- âœ… å…±æœ‰ã‚·ãƒ¼ãƒˆï¼ˆUIActivityViewControllerï¼‰

#### Phase 3-Bï¼ˆâ˜…å¤§å¹…å¼·åŒ–ï¼‰
- âœ… **4ãƒˆãƒ©ãƒƒã‚¯æ§‹æˆ**ï¼ˆGuitar/Bass/Scale GuideÃ—2ï¼‰
- âœ… **Program Change**ï¼ˆæ¥½å™¨è‡ªå‹•é¸æŠï¼‰
- âœ… **ã‚³ãƒ¼ãƒ‰ãƒœã‚¤ã‚·ãƒ³ã‚°**ï¼ˆRoot+3rd+5th+7thã€å…¨éŸ³å‡ºåŠ›ï¼‰
- âœ… **ãƒªã‚ºãƒ ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼ˆ4æ‹å­ã‚¹ãƒˆãƒ©ãƒ ã€4åˆ†éŸ³ç¬¦Ã—4ï¼‰
- âœ… **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³**ï¼ˆRoot-Root-5th-Root(Oct)ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- âœ… **Chord Symbols**ï¼ˆMarker Type 6ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºï¼‰
- âœ… **Scale Guide Trackï¼ˆâ˜…ç‹¬è‡ªæ©Ÿèƒ½ï¼‰**
  - 2éŸ³åŸŸå¯¾å¿œï¼ˆMiddle: C4å‘¨è¾ºã€Bass: C3å‘¨è¾ºï¼‰
  - 15ç¨®é¡ã®ã‚¹ã‚±ãƒ¼ãƒ«å¯¾å¿œ
  - Velocity 30ï¼ˆè–„ãèã“ãˆã‚‹ã€è¦‹ãˆã‚‹ã‚´ãƒ¼ã‚¹ãƒˆãƒãƒ¼ãƒˆï¼‰
  - ä¸Šæ˜‡â†’ä¸‹é™ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ1å°ç¯€ã§å¾€å¾©ï¼‰
- âœ… **UIå†è¨­è¨ˆ**ï¼ˆSketch Exportæ–¹å¼ï¼‰
- âœ… **SwiftUI Sheetçµ±åˆ**ï¼ˆActivityViewController wrapperï¼‰

### MIDIå‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆæœ€æ–°ç‰ˆï¼‰

#### Tempo Track
- Chord Symbolsï¼ˆMarker Type 6ï¼‰
- Section Markersï¼ˆMarker Type 6ï¼‰
- Tempoï¼ˆBPMï¼‰

#### Track 1: Guitar [Program 25: Acoustic Steel]
- ã‚³ãƒ¼ãƒ‰ãƒœã‚¤ã‚·ãƒ³ã‚°ï¼ˆRoot+3rd+5th+7thï¼‰
- 4æ‹å­ã‚¹ãƒˆãƒ©ãƒ ï¼ˆ4åˆ†éŸ³ç¬¦Ã—4ï¼‰
- Velocity: 80Â±10

#### Track 2: Bass [Program 33: Electric Bass]
- ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆRoot-Root-5th-Root(Oct)ï¼‰
- Velocity: 85

#### Track 3: Scale Guide (Middle) [Piano]
- ã‚¹ã‚±ãƒ¼ãƒ«æ§‹æˆéŸ³ï¼ˆä¸­éŸ³åŸŸã€C4å‘¨è¾ºï¼‰
- ä¸Šæ˜‡â†’ä¸‹é™ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ125msé–“éš”ï¼‰
- Velocity: 30ï¼ˆä¸Šæ˜‡ï¼‰/ 25ï¼ˆä¸‹é™ï¼‰
- â˜…OtoTheoryç‹¬è‡ªæ©Ÿèƒ½

#### Track 4: Scale Guide (Bass) [Piano]
- ã‚¹ã‚±ãƒ¼ãƒ«æ§‹æˆéŸ³ï¼ˆä½éŸ³åŸŸã€C3å‘¨è¾ºã€-12åŠéŸ³ï¼‰
- Track 3ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ä¸‹ï¼‰
- Velocity: 30ï¼ˆä¸Šæ˜‡ï¼‰/ 25ï¼ˆä¸‹é™ï¼‰

### ãƒ“ãƒ«ãƒ‰çµæœ
âœ… **BUILD SUCCEEDED**ï¼ˆ2025-10-11ï¼‰

### ãƒ†ã‚¹ãƒˆçµæœ
- âœ… 4ãƒˆãƒ©ãƒƒã‚¯ç”Ÿæˆç¢ºèªï¼ˆGarageBandï¼‰
- âœ… æ¥½å™¨è‡ªå‹•é¸æŠç¢ºèªï¼ˆGuitar: Acoustic Steel, Bass: Electric Bassï¼‰
- âœ… Scale Guideå¯è¦–åŒ–ç¢ºèªï¼ˆå°ã•ãªç‚¹ã€…ã¨ã—ã¦è¡¨ç¤ºï¼‰
- âœ… 1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–å·®ç¢ºèªï¼ˆTrack 4 = Track 3 - 12åŠéŸ³ï¼‰
- âœ… ã‚­ãƒ¼åé™¤å»ç¢ºèªï¼ˆ"C Major Scale" â†’ "Major Scale"ï¼‰

---

## ğŸ”§ Phase 1: åŸºç›¤ï¼ˆIAP & Paywallï¼‰å®Ÿè£…è©³ç´°

### 1.1 ProçŠ¶æ…‹ç®¡ç†

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/OtoTheory-iOS/OtoTheory/Services/ProManager.swift`ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```swift
import StoreKit
import Combine

@MainActor
class ProManager: ObservableObject {
    static let shared = ProManager()
    
    @Published var isProUser: Bool = false
    @Published var products: [Product] = []
    @Published var purchasedProductIDs: Set<String> = []
    
    // Product ID
    private let proSubscriptionID = "com.ototheory.pro.monthly"
    
    init() {
        Task {
            await loadProducts()
            await updatePurchasedProducts()
        }
    }
    
    // StoreKit 2: å•†å“èª­ã¿è¾¼ã¿
    func loadProducts() async {
        do {
            products = try await Product.products(for: [proSubscriptionID])
        } catch {
            print("Failed to load products: \(error)")
        }
    }
    
    // StoreKit 2: è³¼å…¥çŠ¶æ…‹ç¢ºèª
    func updatePurchasedProducts() async {
        for await result in Transaction.currentEntitlements {
            guard case .verified(let transaction) = result else {
                continue
            }
            
            if transaction.productID == proSubscriptionID {
                purchasedProductIDs.insert(transaction.productID)
                isProUser = true
            }
        }
    }
    
    // è³¼å…¥å‡¦ç†
    func purchase(_ product: Product) async throws {
        let result = try await product.purchase()
        
        switch result {
        case .success(let verification):
            switch verification {
            case .verified(let transaction):
                await transaction.finish()
                await updatePurchasedProducts()
                // Telemetry: purchase_success
                TelemetryService.track("purchase_success")
            case .unverified:
                throw PurchaseError.unverified
            }
        case .userCancelled:
            throw PurchaseError.userCancelled
        case .pending:
            throw PurchaseError.pending
        @unknown default:
            throw PurchaseError.unknown
        }
    }
    
    // ãƒªã‚¹ãƒˆã‚¢
    func restore() async throws {
        try await AppStore.sync()
        await updatePurchasedProducts()
    }
}

enum PurchaseError: Error {
    case unverified
    case userCancelled
    case pending
    case unknown
}
```

---

### 1.2 Paywall UI

**ãƒ•ã‚¡ã‚¤ãƒ«**: `PaywallView.swift`ï¼ˆæ–°è¦ä½œæˆï¼‰

```swift
import SwiftUI
import StoreKit

struct PaywallView: View {
    @Environment(\.dismiss) var dismiss
    @StateObject private var proManager = ProManager.shared
    @State private var isPurchasing = false
    
    var body: some View {
        NavigationView {
            ScrollView {
                VStack(spacing: 24) {
                    // Hero Section
                    VStack(spacing: 12) {
                        Image(systemName: "music.note.list")
                            .font(.system(size: 60))
                            .foregroundColor(.blue)
                        
                        Text("OtoTheory Pro")
                            .font(.largeTitle)
                            .fontWeight(.bold)
                        
                        Text("Unlock all features")
                            .font(.headline)
                            .foregroundColor(.secondary)
                    }
                    .padding(.top, 32)
                    
                    // Features
                    VStack(alignment: .leading, spacing: 16) {
                        FeatureRow(icon: "music.note", title: "50ç¨®é¡ã®ãƒ—ãƒªã‚»ãƒƒãƒˆ", description: "Free 20ç¨® + Proé™å®š 30ç¨®")
                        FeatureRow(icon: "square.grid.3x2", title: "ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç·¨é›†", description: "Verse/Chorus/Bridge ã‚’è‡ªç”±ã«æ§‹æˆ")
                        FeatureRow(icon: "waveform", title: "MIDIå‡ºåŠ›", description: "DAWã§ç·¨é›†å¯èƒ½ãªSMFãƒ•ã‚¡ã‚¤ãƒ«")
                        FeatureRow(icon: "icloud", title: "ç„¡åˆ¶é™ä¿å­˜", description: "ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸã§ãƒ‡ãƒã‚¤ã‚¹é–“ã§å…±æœ‰")
                    }
                    .padding(.horizontal, 24)
                    
                    // Pricing
                    if let product = proManager.products.first {
                        VStack(spacing: 12) {
                            Text(product.displayPrice)
                                .font(.system(size: 48, weight: .bold))
                            
                            Text("/ æœˆ")
                                .font(.title2)
                                .foregroundColor(.secondary)
                            
                            Button(action: {
                                Task {
                                    isPurchasing = true
                                    do {
                                        try await proManager.purchase(product)
                                        dismiss()
                                    } catch {
                                        print("Purchase failed: \(error)")
                                    }
                                    isPurchasing = false
                                }
                            }) {
                                Text(isPurchasing ? "å‡¦ç†ä¸­..." : "è³¼èª­é–‹å§‹")
                                    .font(.headline)
                                    .frame(maxWidth: .infinity)
                                    .padding()
                                    .background(Color.blue)
                                    .foregroundColor(.white)
                                    .cornerRadius(12)
                            }
                            .disabled(isPurchasing)
                            
                            Button("è³¼å…¥å±¥æ­´ã‚’å¾©å…ƒ") {
                                Task {
                                    try? await proManager.restore()
                                }
                            }
                            .font(.caption)
                            .foregroundColor(.secondary)
                        }
                        .padding(.horizontal, 24)
                    }
                    
                    // Terms
                    VStack(spacing: 8) {
                        Text("è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ã€‚ã„ã¤ã§ã‚‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½ã€‚")
                            .font(.caption)
                            .foregroundColor(.secondary)
                        
                        HStack(spacing: 16) {
                            Link("åˆ©ç”¨è¦ç´„", destination: URL(string: "https://ototheory.com/terms")!)
                            Link("ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼", destination: URL(string: "https://ototheory.com/privacy")!)
                        }
                        .font(.caption)
                    }
                    .padding(.bottom, 32)
                }
            }
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .navigationBarTrailing) {
                    Button("é–‰ã˜ã‚‹") {
                        dismiss()
                    }
                }
            }
        }
        .onAppear {
            // Telemetry: paywall_view
            TelemetryService.track("paywall_view")
        }
    }
}

struct FeatureRow: View {
    let icon: String
    let title: String
    let description: String
    
    var body: some View {
        HStack(alignment: .top, spacing: 16) {
            Image(systemName: icon)
                .font(.title2)
                .foregroundColor(.blue)
                .frame(width: 32)
            
            VStack(alignment: .leading, spacing: 4) {
                Text(title)
                    .font(.headline)
                Text(description)
                    .font(.subheadline)
                    .foregroundColor(.secondary)
            }
        }
    }
}
```

---

### 1.3 Free/Proåˆ†å²

**æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°**: `ProgressionView.swift`

```swift
@StateObject private var proManager = ProManager.shared
@State private var showPaywall = false

// ãƒ—ãƒªã‚»ãƒƒãƒˆè¡¨ç¤ºåˆ¶é™
var visiblePresets: [Preset] {
    if proManager.isProUser {
        return allPresets  // 50ç¨®
    } else {
        return allPresets.filter { $0.isFree }  // 20ç¨®ã®ã¿
    }
}

// Proæ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
Button("MIDIå‡ºåŠ›") {
    if proManager.isProUser {
        exportMIDI()
    } else {
        showPaywall = true
    }
}
.sheet(isPresented: $showPaywall) {
    PaywallView()
}
```

---

## ğŸ“Š è¨ˆæ¸¬ï¼ˆTelemetryï¼‰

### æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆ
```swift
// Paywallè¡¨ç¤º
TelemetryService.track("paywall_view")

// è³¼å…¥æˆåŠŸ
TelemetryService.track("purchase_success")

// Proæ©Ÿèƒ½ä½¿ç”¨
TelemetryService.track("section_edit")
TelemetryService.track("midi_export")
```

---

## âœ… Phase 1 å—ã‘å…¥ã‚ŒåŸºæº–ï¼ˆDoDï¼‰

- [x] StoreKit 2ã§IAPå®Ÿè£… âœ…
- [x] Paywall UIãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ âœ…
- [x] è³¼å…¥ãƒ•ãƒ­ãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œ âœ…ï¼ˆå®Ÿè£…æ¸ˆã¿ã€æ‰‹å‹•ãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰
- [x] è³¼å…¥çŠ¶æ…‹ãŒæ°¸ç¶šåŒ–ã•ã‚Œã‚‹ âœ…ï¼ˆStoreKit 2ã®Transactionç®¡ç†ï¼‰
- [x] `paywall_view` / `purchase_success` ãŒè¨˜éŒ²ã•ã‚Œã‚‹ âœ…
- [x] Free/Proåˆ†å²ãŒæ­£ã—ãå‹•ä½œ âœ…ï¼ˆPresetPickerViewå®Ÿè£…ï¼‰
- [x] ãƒªã‚¹ãƒˆã‚¢æ©Ÿèƒ½ãŒå‹•ä½œ âœ…

## âœ… Phase 2 å—ã‘å…¥ã‚ŒåŸºæº–ï¼ˆDoDï¼‰

- [x] Sectionãƒ¢ãƒ‡ãƒ«å®Ÿè£… âœ…
- [x] Sketchã«sectionsè¿½åŠ  âœ…
- [x] SectionEditorViewå®Ÿè£… âœ…
- [x] ProgressionViewã«Sectionsãƒœã‚¿ãƒ³è¿½åŠ  âœ…
- [x] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º âœ…
- [x] Proåˆ†å²ï¼ˆSectionsãƒœã‚¿ãƒ³ï¼‰ âœ…
- [x] ãƒ“ãƒ«ãƒ‰æˆåŠŸ âœ…
- [ ] ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†ç”Ÿãƒ»ãƒ«ãƒ¼ãƒ—æ©Ÿèƒ½ ğŸ”œ Phase 2.5ã§å®Ÿè£…äºˆå®š

---

## ğŸ¯ ç¾åœ¨ã®çŠ¶æ…‹ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å®Œäº†ã—ãŸãƒ•ã‚§ãƒ¼ã‚º
- âœ… **Phase 1**: IAP & Paywallï¼ˆå®Œäº†ï¼‰
- âœ… **Phase 2**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç·¨é›†UIï¼ˆå®Œäº†ï¼‰
- âœ… **Phase 3**: MIDIå‡ºåŠ›ï¼ˆå®Œäº†ï¼‰

### æ¬¡ã®å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º
1. **Phase 4: Sketchç„¡åˆ¶é™ & ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ** â† æ¬¡ã¯ã“ã“
   - CloudKitçµ±åˆ
   - åŒæœŸãƒ­ã‚¸ãƒƒã‚¯
   - ç«¶åˆè§£æ±º

2. **Phase 2.5: ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†ç”Ÿæ©Ÿèƒ½**ï¼ˆPhase 3å¾Œã«å®Ÿè£…æ¨å¥¨ï¼‰
   - HybridPlayerã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³æŒ‡å®šå†ç”Ÿãƒ»ãƒ«ãƒ¼ãƒ—æ©Ÿèƒ½è¿½åŠ 

3. **Phase 4: Sketchç„¡åˆ¶é™ & ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ**
   - CloudKitçµ±åˆ
   - åŒæœŸãƒ­ã‚¸ãƒƒã‚¯

4. **Phase 5: ãƒ—ãƒªã‚»ãƒƒãƒˆæ‹¡å¼µ**
   - Proå°‚ç”¨ãƒ—ãƒªã‚»ãƒƒãƒˆ30ç¨®ã‚’è¿½åŠ 

---

## ğŸ“ é–¢é€£ãƒ¬ãƒãƒ¼ãƒˆ

- **Phase 1è©³ç´°**: `/docs/reports/Phase_1_IAP_Paywall_Implementation_Report.md`
- **Phase 2è©³ç´°**: `/docs/reports/Phase_2_Section_Editing_Implementation_Report.md`
- **Phase 3è©³ç´°**: `/docs/reports/Phase_3_MIDI_Export_Implementation_Report.md`

---

**Phase 4ï¼ˆSketchç„¡åˆ¶é™ & ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼‰ã«é€²ã‚€æº–å‚™å®Œäº†ï¼** â˜ï¸ğŸ’¾

