# OtoTheory v3.1 — マイルストーン & 範囲（期日なし方式・Web→iOSシフト）

> **参照**：
> ・現行マイルストーン（M0〜M3 完了／M4定義）
> ・実装要件 v3.0（ProのMIDI：Chord＋セクションマーカー＋ガイドトーン／録音UIはFlag OFF） 
> ・SSOT v3.0 正本（結果カード→Diatonic→Fretboard二層→提案／Capo Top2（Shaped）／出力境界） 

---

## ✅ 変更サマリー（v3.1差分）

* **Undo**：**キャンセル確定**（個別削除＆D&Dで代替）。DoD／ドキュメント注記を更新。
* **PNG出力**：**白背景固定**を明記（テーマ自動反転は将来）。Telemetry `export_png` は**必ず1回のみ**送出の原則を継続。
* **Web Lite**：M3完了範囲で**即リリース可**。**Melody/Solo Analyze（録音）**は**メニューから撤去**（Flag OFF方針と一致）。
* **M4以降**：**iOSアプリ開発を主軸**に移行（**セクション編集／MIDI出力（Chord＋Markers＋Guide）／Sketch無制限**＝Proの核）。

---

## M0. Baseline（統合の土台） ✅ 完了

* Chord Progression を主導線、**結果カード→Diatonic→Fretboard二層**、Capo Top2（Shaped）。

## M1. Sketch Library（保存・呼び出し） ✅ 完了

* **Free=3件ローカル**（LRU）／**Auto‑save 3秒**／**PNG出力**（白背景固定・視認性最適化・`export_png` 1回計測）。

## M2. Progression Lite ✅ 完了

* **12コード上限**／**プリセット20**／**自動ループ**（Play/Stop, BPM, 4/4）／**Undo=キャンセル**に確定。

## M3. Find Chords 強化 ✅ 完了

* **Scale Table（Why一文＋Glossary＋アルペジオ）**／**Chord Forms（試聴）**／**Capo Top2（Shaped）**／**基礎代理コード**。

---

## **M3.5 Web Lite GA（サイト同時公開）** ✅ 完了

**実装日**: 2025-10-04  
**目的**：M3までの機能で**"触って曲の芯が分かる"**体験を提供し、**iOS Proへ送客**。App Store審査対応のため法務・サポートページを同時公開。

**In**

* **Analyze（録音）メニュー撤去**・該当ルートはChord Progressionへ**リダイレクト**（Flag OFF方針と一致）。
* **6面CTA**（ヘッダー常設／モバイル下部スティッキー／9–12到達トースト／Sketch 4件目モーダル／PNG後トースト／フッターQR）
* **計測**：既存 `export_png / progression_play / preset_inserted / toast_shown` に加え `cta_appstore_click{place}` を追加（Web→iOSファネルを可視化）。
* **Policy 9ページ（JP/EN）公開**：`/privacy` `/terms` `/subscription` `/support` `/account-deletion` `/security` `/accessibility` `/transparency` `/licenses`
* **App内設定リンク**：「設定」＞「プライバシー/利用規約/アカウント削除」へ1タップで遷移（審査対応）
* **ドキュメント整合**：Undo=キャンセル／PNG=白固定を**SSOT v3.1 注記**として反映。

**DoD**

* Web上で**プリセット→即ループ→PNG出力**まで一連を3クリック以内で完了。
* `export_png` は**成功/失敗に関わらず1発火**、`toast_shown(kind=limit_warn|limit_block)`でPro誘導が確認できる。
* **政策系URLは外部公開済み**（フッター常設）、JP/EN併記。
* `cta_appstore_click{place}` が全6面で発火。
* **録音UIは非露出**（Flag OFF）を確認済み。

---

## **M4. iOS v1（Proの核）** ★主軸移行

**狙い**：**「DAW前処理を数分で」**を**成果物（MIDI）**で実現し、IAPに直結。

### M4‑A：iOS 基盤 & M3パリティ（Free）

* 結果カード → **Diatonic → Fretboard（二層）** → Patterns/Cadence/基礎代理（**試聴→＋Add→即ループ**）。
* **Sketch 3件（ローカル）**、プリセット→自動ループ、Capo Top2（Shaped）／非ヘプタ規則を踏襲。
  **DoD**：Web M3相当の体験が**2タップ以内**で再現。録音UIは**非露出（Flag OFF）**。

### M4‑B：iOS Pro（収益の中核）

* **セクション編集**（Verse/Chorus/Bridge…）→ 再生/ループと連動。
* **MIDI出力**：**Chord Track＋セクションMarkers＋Guide Tones**（SMF Type‑1）。
* **Sketch無制限（クラウド同期）**／**IAP（¥490/月）**／**Paywall & 計測**。
  **DoD**：DAWへ読み込むだけで**構成（Markers）とコード骨格＋ガイドトーン**が再現。`paywall_view / purchase_success` を記録。

> *メモ：ベース/ドラム/スプリット小節等は**M4.1 以降**の拡張として扱い、**ミニDAW化は回避**。中核のMIDIを先行で完成させる。*

---

## **M4.1 以降（拡張：前処理の時短をさらに強化）** ★任意

* **Split Bar**（1小節=2コード）：曲っぽさの最小強化（MIDIは2拍/2拍で反映）。
* **Groove（簡易ドラム）／ミニベース（Root‑5/Walk）**：**再生はプリセットのみ**、**音色の作り込みはしない**。**MIDI多トラック拡張**（Drum/Bass）をオプションで追加。
  **DoD**：適用が**2タップ**で即反映。MIDI拡張は**Chord/Guide/Markers**を壊さない。

---

## M5. Polish & Release（横断仕上げ）

* **PNGテーマ自動反転**の**再検討**（v3.1は白固定）／背景バリエーションの整理。
* **A11y**：roving‑tablist／focus‑visible／色以外の手掛かり。
* **Telemetry最終化**：各操作=1発火（`export_png / progression_play / save_project` ほか）。
* **QA**：非ヘプタ例外（Pent/Blues Roman）／Capo注記（Shaped vs Sounding）の回帰。

---

## スコープ整理（v3.1 確定）

**In（v3.1）**

* **Web Lite GA**（録音撤去・6面CTA・計測追加・ドキュメント整合）
* **iOS v1**：Free＝M3パリティ／Pro＝**セクション編集＋MIDI（Chord＋Markers＋Guide）＋無制限保存＋IAP**。

**Out / vNext**

* 録音解析（Analyze）一式（**Flag OFF 継続**）。
* Split Bar／Groove／ミニベース／MIDI多トラックは**M4.1+**で段階導入。
* Undo再検討（今回は**非搭載**で確定）。

---

## 受け入れ基準（DoDの更新点）

* **Undo**：**なし**（キャンセル確定）。Milestones/SSOTの該当記述を**v3.1注記**で上書き。
* **PNG**：**白背景固定**。`export_png` は**成功/失敗に関わらず1回**送出。
* **Web GA**：Analyze非露出／6面CTA動作／ファネル計測が取得できること。
* **iOS Pro**：**MIDI（Chord＋Markers＋Guide）**がDAWで再現／セクション編集の結果が**Marker**に反映／IAP計測（`paywall_view/purchase_success`）。

---

## ドキュメント整合（PRメモ）

1. `docs/SSOT/OtoTheory_Roadmap_Milestones.md` を**本テキストで置換**（v3.1としてコミット）。
2. `docs/SSOT/OtoTheory_v3.0_Implementation_SSOT.md` に**注記を追記**：

   * Undo=キャンセル（LiteのDoDから削除）
   * PNG=白固定（テーマ自動反転は将来）
   * Web v1は録音非搭載（Flag OFFのまま） 
3. `docs/SSOT/OtoTheory_v3.0_SSOT.md` の**"出力/Free vs Pro"**・**"録音（β）"**の節に上記注記の参照リンクを追加。

---

